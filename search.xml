<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Bootstrap-Table</title>
    <url>/2020/10/23/Bootstrap-Table/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>ç”±äºéœ€è¦ä½¿ç”¨åˆ°è¡¨æ ¼çš„æ’åºåŠŸèƒ½ï¼Œæ‡’äºè‡ªå·±å†™å°±æ‰“ç®—æä¸ªæ¡†æ¶ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯Bootstrapæ¡†æ¶ï¼Œæƒ³ç€å¦‚æœå®ƒè‡ªèº«æœ‰ï¼Œé‚£å°±å¤ªæ£’äº†â€¦è¿˜çœŸæœ‰ï¼Œ(ï¼¾ï¼µï¼¾)ãƒ~ï¼¹ï¼¯</p>
<p>å®ƒå°±æ˜¯ <span class="ljspan ljspan-reverse ljspan-blue"><a href="https://bootstrap-table.com/docs/getting-started/introduction/">Bootstrap-Table</a></span><a id="more"></a></p>
<p><span class="ljspan ljspan-reverse ljspan-blue"><a href="https://bootstrap-table.com/docs/getting-started/introduction/">Bootstrap-Table</a></span>åœ¨é¡µé¢ä¸­çš„ä½¿ç”¨ï¼Œæœ‰å¤šç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨HTML5çš„å†™æ³•ï¼Œç›´æ¥é€šè¿‡<span class="label warning">data-*</span>çš„æ–¹å¼æŒ‡å®šä¸ªä¸­å±æ€§è®¾ç½®ï¼Œå¦ä¸€ç§å°±æ˜¯HTML+JSæ–¹å¼å®ç°å¼¹æ€§è®¾ç½®ï¼Œæˆ‘ç”¨çš„å°±æ˜¯ç¬¬äºŒç§</p>
<p>ç”±äºæ•°æ®æƒ³ä½¿ç”¨ajaxå¼‚æ­¥è¯»å–ï¼Œè¿™æ ·æ–¹ä¾¿ï¼Œåˆšå¥½ï¼Œæ–¹æ³• <span class="ljspan ljspan-blue">bootstrapTable</span>å°±æœ‰è¿™æ ·çš„åŠŸèƒ½ã€‚</p>
<p>å®˜æ–¹æ–‡æ¡£åœ¨<a href="https://bootstrap-table.com/docs/getting-started/introduction/">è¿™é‡Œ</a>ï¼Œè¯´å®è¯ï¼Œä¸å¤ªå–œæ¬¢ï¼Œè¿™ç©æ„ç”¨çš„æ–¹å¼è·Ÿæˆ‘ä¸åŒï¼ŒğŸ¢ğŸ¢ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥å½“ä½œå‚è€ƒçš„ã€‚</p>
<blockquote>
<p>å…ˆå‡†å¤‡ä¸€ä¸ªè¡¨å¤´ï¼Œä¹Ÿå¯ä»¥æŠŠè¡¨æ ¼å¤´çš„ä¿¡æ¯ä¹Ÿå†™åœ¨<span class="ljspan ljspan-blue">bootstrapTable</span>æ–¹æ³•é‡Œ</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">id</span>=<span class="string">&quot;bootstrap-table&quot;</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">&quot;Id&quot;</span> <span class="attr">data-sortable</span>=<span class="string">&quot;true&quot;</span>&gt;</span>#<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">&quot;Name&quot;</span> <span class="attr">data-sortable</span>=<span class="string">&quot;true&quot;</span>&gt;</span>name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-field</span>=<span class="string">&quot;Age&quot;</span> <span class="attr">data-sortable</span>=<span class="string">&quot;true&quot;</span>&gt;</span>age<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span>	</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¼€å§‹ä½¿ç”¨ <span class="ljspan ljspan-reverse ljspan-blue">Bootstrap-Table</span></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&quot;#bootstrap-table&quot;</span>).bootstrapTable(&#123;</span><br><span class="line">		&lt;!------------å‘é€ajaxè¯·æ±‚-----------&gt;</span><br><span class="line">		url : queryUrl,    <span class="comment">//è¯·æ±‚åå°çš„URLï¼ˆ*ï¼‰</span></span><br><span class="line">		dataType:<span class="string">&quot;json&quot;</span>,		</span><br><span class="line">		contentType : <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>,</span><br><span class="line">        sidePagination : <span class="string">&quot;server&quot;</span>, <span class="comment">//åˆ†é¡µæ–¹å¼ï¼šclientå®¢æˆ·ç«¯åˆ†é¡µï¼ŒserveræœåŠ¡ç«¯åˆ†é¡µï¼ˆ*ï¼‰	</span></span><br><span class="line">		method : <span class="string">&#x27;POST&#x27;</span>, <span class="comment">//è¯·æ±‚æ–¹å¼ï¼ˆ*ï¼‰</span></span><br><span class="line">   		&lt;!-----------------------------------&gt;		</span><br><span class="line">		search : <span class="literal">false</span>, <span class="comment">//æ˜¯å¦æ˜¾ç¤ºè¡¨æ ¼æœç´¢</span></span><br><span class="line">		showFooter : <span class="literal">false</span>, <span class="comment">//æ˜¾ç¤ºåº•éƒ¨ï¼Œé»˜è®¤ä¸æ˜¾ç¤º</span></span><br><span class="line">		sortName : <span class="string">&quot;genesId&quot;</span>,</span><br><span class="line">		sortOrder : <span class="string">&quot;desc&quot;</span>, <span class="comment">//æ’åºæ–¹å¼</span></span><br><span class="line">		....</span><br><span class="line">&#125;)		</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åˆšå¼€å§‹ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“å®ƒå¦‚ä½•å‘é€è¯·æ±‚ï¼Œåé¢çœ‹äº†ä¸Šé¢æœ€å¼€å§‹éƒ¨åˆ†æ•°æ®çš„æ•°æ®æ ¼å¼åï¼Œå‘ç°ï¼Œè¿™å­—æ®µæ€ä¹ˆè·Ÿajaxé‚£ä¹ˆåƒï¼ŒæŸ¥äº†æºç æ‰å‘ç°è¿™å°±æ˜¯é‡‡ç”¨ajaxçš„æ–¹å¼ï¼Œå‚æ•°dataæ”¹ä¸ºä½¿ç”¨sidePageinationæ¥ä¼ è¾“ï¼Œåˆ†clientå’Œserverä¸¤ç§</p>
</blockquote>
<p>é™¤äº†ä½¿ç”¨ä½¿ç”¨ajaxå‘é€è¯·æ±‚å¤–ï¼Œå…¶ä»–å­—æ®µéƒ½æ˜¯ä¸€äº›å¯¹è¡¨æ ¼çš„è®¾è®¡çš„å±æ€§ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ª</p>
<ul>
<li>
<p>sidePaginationï¼šç”¨æ¥è®¾ç½®å‘é€æ•°æ®ç»™åå°çš„æ–¹æ³•é€‰æ‹©ï¼Œæœ‰â€œserverâ€å’Œâ€œclientâ€ä¹‹åˆ†ï¼Œâ€œclientâ€ç”¨äº</p>
</li>
<li>
<p>Query Paramsï¼šå®ƒå°±æ˜¯ä¸€ä¸ªå‘é€æ•°æ®ç»™æœåŠ¡å™¨çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ajaxæ–¹æ³•ä¸­çš„dataï¼Œå‰ææ˜¯éœ€è¦è®¾ç½®<code>sidePagination : &quot;server&quot;</code>ï¼›é™¤äº†æœ¬èº«çš„å‚æ•°ï¼Œå¯ä»¥é¢å¤–æ·»åŠ å‚æ•°</p>
</li>
<li>
<p>Formatterï¼šç”¨æ¥æ ¼å¼åŒ–è¿”å›çš„è¡¨æ ¼åˆ—çš„æ˜¾ç¤ºå½¢å¼ï¼Œæ¯”å¦‚åŠ å›¾å½¢ï¼Œæ”¹å˜cssæ ·å¼ç­‰ç­‰</p>
</li>
<li>
<p>Localeï¼šæ±‰åŒ–ï¼Œå‰ææ˜¯å¯¼å…¥<a href="https://examples.bootstrap-table.com/index.html#options/table-locale.html#view-source">è¯­è¨€jsæ–‡ä»¶</a>ï¼Œè€Œä¸”è¿™ä¸ªæ–‡ä»¶éœ€è¦å† <span class="ljspan ljspan-reverse ljspan-blue">Bootstrap-Table</span>çš„jsæ–‡ä»¶åé¢</p>
</li>
</ul>
<p>å‘é€å®Œå‚æ•°åï¼Œåé¢å°±å¯ä»¥è·å–åˆ°å“åº”äº†ï¼Œé‚£å“åº”çš„å†…å®¹å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿ</p>
<h2 id="å“åº”æ•°æ®">å“åº”æ•°æ®</h2>
<p>å“åº”æ•°æ®æ˜¯jsonæ•°æ®ï¼Œåå°è¦å¤„ç†ä¸ºjsonå­—ç¬¦ä¸²æ•°æ®åè¿”å›ã€‚ç„¶åå“åº”çš„å†…å®¹æ ¼å¼ä¸º<code>&#123;total:22,rows:&#123;&#125;&#125;</code>ï¼Œæˆ‘åœ¨åå°éœ€è¦ç»“åˆ <span class="ljspan ljspan-reverse ljspan-red">pagehelper</span>çš„ä½¿ç”¨ï¼Œè·å–totalã€‚è¿™æ ·å°±æ›´åŠ ç®€å•äº†ğŸ˜„</p>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>Classpathæ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <url>/2020/09/04/Classpath%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>åœ¨å†™<code>SSM</code>é…ç½®æ–‡ä»¶çš„æ—¶å€™ç»å¸¸çœ‹åˆ°è¿™ä¸ªä¸œè¥¿ï¼Œæ¯”å¦‚ï¼š<code>classpath:applicationContext.xml</code>ï¼Œæœ‰å°è±¡äº†å—ğŸ˜¤ï¼Ÿ</p>
<a id="more"></a>
<p>è¯·çœ‹ä¸‹å›¾ğŸ‘‡ï¼Œä¸€çœ‹ä¾¿çŸ¥</p>
<p><img src="/assets/img/image-20200604094831938.png" alt="ä¸€èˆ¬é¡¹ç›®æ¶æ„å›¾"></p>
<p>å¯å½“é¡¹ç›®è¢«ç¼–è¯‘åï¼Œæ¶æ„å°±å˜åŒ–äº†å“¦~ğŸ˜‰</p>
<p><img src="/assets/img/image-20200604095454394.png" alt="ç¼–è¯‘åçš„æ¶æ„å›¾"></p>
<p>æ‰€ä»¥,ç¼–è¯‘å<code>java</code>æ–‡ä»¶å¤¹çš„æ–‡ä»¶å’Œ<code>resource</code>æ–‡ä»¶å¤¹çš„æ–‡ä»¶å°±éƒ½æ”¾åœ¨äº†<code>classes</code>ç›®å½•ï¼›è€Œ<code>classpath</code>å…¶å®å°±æ˜¯<code>WEB-INF/classes</code>è¿™ä¸ªç›®å½•è·¯å¾„</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SSM</tag>
        <tag>Configuration</tag>
      </tags>
  </entry>
  <entry>
    <title>Condaç”¨æ³•</title>
    <url>/2020/09/08/Conda%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h3 id="condaæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†ã€ç¯å¢ƒç®¡ç†å·¥å…·âš™ï¸">condaæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†ã€ç¯å¢ƒç®¡ç†å·¥å…·âš™ï¸</h3>
<p>ä¸€èˆ¬ï¼Œminicondaåªé’ˆå¯¹pythonğŸè¿™ä¸ªç¯å¢ƒï¼Œè€Œanacondaå…¶å®å°±æ¯”è¾ƒå…¨é¢ï¼Œå¯ä»¥ç”¨äºå¤šä¸ªç¼–ç¨‹è¯­è¨€çš„ç¯å¢ƒç®¡ç†ï¼Œæ¯”å¦‚Rè¯­è¨€ï¼ŒJavaScriptç­‰ç­‰</p>
<a id="more"></a>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">å®‰è£…è·¯å¾„ï¼š/home/xxx/miniconda3</span><br><span class="line"></span><br><span class="line">é€€å‡ºå‘½ä»¤ï¼šconda deactivate env_name</span><br><span class="line"></span><br><span class="line">åˆ é™¤ç¯å¢ƒï¼šconda env <span class="builtin-name">remove</span> env_name</span><br><span class="line"></span><br><span class="line">æ˜¾ç¤ºç¯å¢ƒåˆ—è¡¨ï¼šconda env list</span><br><span class="line"></span><br><span class="line">å¦‚æœåˆ›å»ºç¯å¢ƒï¼Œä½¿ç”¨æŒ‡å®šè·¯å¾„çš„æ–¹å¼ï¼Œå‘½ä»¤å¦‚ä¸‹</span><br><span class="line"></span><br><span class="line">conda create <span class="attribute">-p</span>=path/env_name <span class="attribute">python</span>=python_version</span><br><span class="line"></span><br><span class="line">é‚£ä¹ˆå¼€å¯è¿™ä¸ªç¯å¢ƒçš„æ–¹æ³•ï¼šconda activate path/env_name</span><br><span class="line"></span><br><span class="line">åŒç†ï¼Œåˆ é™¤è¿™ä¸ªç¯å¢ƒçš„æ–¹æ³•å°±æ˜¯conda env <span class="builtin-name">remove</span> -p /path/env_name</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„è¯ï¼Œè¯¥ç¯å¢ƒå°±æŒ‡å®šäº†ç‰¹å®šçš„è·¯å¾„ï¼Œä½†æ˜¯åç§°å´ä¸ºç©ºï¼Œæš‚æ—¶è¿˜æ‰¾ä¸åˆ°å¦‚ä½•æ”¹åå­—çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åˆ›å»ºç¯å¢ƒçš„æ—¶å€™ï¼Œè¦ä¹ˆæŒ‡å®šè·¯å¾„ï¼Œè¦ä¹ˆæŒ‡å®šåç§°ï¼ˆè·¯å¾„è§„å®šåªåœ¨path/miniconda/envä¸­ï¼‰</p>
<p>ğŸ’¥è§£å†³æ–¹æ³•:æ˜¯ä½¿ç”¨<span class="label success">è½¯é“¾æ¥</span>æŠŠè·¯å¾„å¼•å…¥path/miniconda/env/env_nameä¸­ï¼Œå°±å¯ä»¥äº†ï¼Œlike the picture show below.</p>
<p><img src="/assets/img/Conda%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE.png" alt=""></p>
<hr>
<p>æœ‰æ—¶å€™ï¼Œä½¿ç”¨pythonæ— æ³•ä¸‹è½½æŸäº›åŒ…ï¼Œæˆ–è€…ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢ï¼Œè¿™æ˜¯å› ä¸ºcondaä¸‹è½½åŒ…æ˜¯ä½¿ç”¨å›½å¤–çš„ç½‘å€æ¥ä¸‹è½½çš„ï¼Œå¯ä»¥ä¿®æ”¹é…ç½®ï¼Œä½¿ç”¨å›½å†…çš„é•œåƒ</p>
<p>æ¸…åğŸ‘¨â€ğŸ“é•œåƒå†…å®¹å’Œä¿®æ”¹æ–¹æ³•åœ¨<a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/">è¿™é‡Œ</a></p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>DNSæœåŠ¡-åŸŸåè§£æå’Œè½¬å‘</title>
    <url>/2020/09/20/DNS%E6%9C%8D%E5%8A%A1-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%92%8C%E8%BD%AC%E5%8F%91/</url>
    <content><![CDATA[<p>åœ¨çœ‹frpæ—¶ï¼Œçœ‹åˆ°å®ƒæœ‰ä¸€ä¸ªForward DNS query requestçš„åŠŸèƒ½ï¼Œçœ‹ä¸æ‡‚ï¼Œå°±ç¿»äº†ç¿»ç½‘ä¸Šçš„èµ„æ–™ï¼Œå¤§æ¦‚çŸ¥é“å®ƒæ˜¯æƒ³å¹²å˜›äº†ï¼Œä½†æ˜¯æ—¢ç„¶è°ˆåˆ°<span class="ljspan ljspan-red">è½¬å‘DNS</span>ï¼Œå°±å¹²è„†æŠŠDNSè§£æå’Œè½¬å‘ç­‰è¿™äº›ä¸œè¥¿é¡ºä¾¿å†™å†™âœï¸å’¯</p>
<a id="more"></a>	
<h2 id="DNSåŸŸåè§£æ">DNSåŸŸåè§£æ</h2>
<h3 id="namespaceä¸ºäº’è”ç½‘ä¸Šçš„æœåŠ¡">namespaceä¸ºäº’è”ç½‘ä¸Šçš„æœåŠ¡</h3>
<p>linuxä¸Šæœ‰ä¸ªæ–‡ä»¶ï¼Œ<code>/etc/resolv.conf</code>æ˜¯ç”¨æ¥åªæƒ³äº’è”ç½‘ä¸Šçš„DNSæœåŠ¡å™¨çš„ã€‚ä¸€èˆ¬å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 8.8.8.8</span><br><span class="line">nameserver 222.222.222.222</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±æ˜¯åŸŸåè§£æå•¦ï¼Œä¸€èˆ¬è®¡ç®—æœºä½¿ç”¨åŸŸåä¸Šç½‘æ—¶ï¼Œä¼šå…ˆæ‰¾è¯¥æœ¬æœºçš„DNSæœåŠ¡å™¨ã€‚å¦‚æœæœ¬åœ°DNSèƒ½æ‰¾åˆ°åŸŸåï¼Œæœ¬åœ°DNSç›´æ¥å›å¤å®¢æˆ·æœºã€‚å¦‚æœæœ¬åœ°DNSæœåŠ¡å™¨ä¸çŸ¥é“ä½ è¯·æ±‚çš„åŸŸåï¼Œä»–å°±è½¬å‘DNSè¯·æ±‚åˆ°äº’è”ç½‘ä¸Šï¼ŒæŸ¥æ‰¾åŸŸåï¼Œå°±æ˜¯é€šè¿‡8.8.8.8æˆ–è€…222.222.222.222ï¼Œç„¶åå°†æŸ¥è¯¢åˆ°çš„åŸŸåè§£æåï¼Œæœ€ç»ˆå°†åŸŸåè§£æç»“æœè¿”å›ç»™å®¢æˆ·æœº</p>
<h3 id="namespaceä¸º127-0-0-53">namespaceä¸º127.0.0.53</h3>
<p>ä¹‹å‰åœ¨ä¸€ç¯‡<span class="ljspan ljspan-reverse ljspan-green"><a href="">resolv.conf</a></span>æœ‰è°ˆåˆ°æœ‰ç‚¹è¿™ä¸ªä¸œè¥¿ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰è§£é‡Šï¼Œè¿™é‡Œé¡ºé“è§£é‡Šå’¯ï¼Œå¦‚æœnameserveré…ç½®ä¸º127.0.0.53ï¼Œé‚£ä¹ˆå®ƒå°†ä¸è§£æä½ çš„ä¸»æœºåã€‚ä¹Ÿå°±æ˜¯ä¸ä»æœ¬åœ°ä¸»æœºä¸Šè¯»å–DNSæœåŠ¡</p>
<h3 id="namespaceä¸ºä¸»æœºIP">namespaceä¸ºä¸»æœºIP</h3>
<p>é‚£èƒ½å¦æŠŠè‡ªå·±ä¸»æœºIPå½“ä½œå½“ä½œDNSæœåŠ¡å™¨å—ï¼Ÿè€Œä¸ç”¨Internetä¸Šçš„DNSæœåŠ¡ï¼Œå½“ç„¶å¯ä»¥å•¦:happy:</p>
<p>DNSæœåŠ¡å®‰è£…å®Œæ¯•åï¼Œä»–å°±æœ‰æ ¹æç¤ºï¼Œå¤©ç”Ÿå°±çŸ¥é“äº’è”ç½‘ä¸Š13ä¸ªæ ¹DNSæœåŠ¡å™¨ã€‚åªè¦å®‰è£…DNSæœåŠ¡çš„é‚£å°æœºå™¨å¯ä»¥è®¿é—®Internetï¼Œå°±å®Œå…¨å¯ä»¥è§£æå…¨çƒåŸŸåã€‚</p>
<p>å› æ­¤DNSæœåŠ¡å™¨çš„/etc/resolv.confå®Œå…¨å¯ä»¥æŒ‡å‘è‡ªå·±ï¼Œå¯¹äºæœªçŸ¥åŸŸåï¼ŒDNSæœåŠ¡å™¨ä¸Šçš„DNSæœåŠ¡ä¼šè‡ªå·±æ‰¾æ ¹DNSæœåŠ¡å™¨è¿›è¡ŒåŸŸåè§£æï¼Œå¹¶æŠŠè§£æç»“æœä¿å­˜åœ¨æœ¬åœ°DNSæœåŠ¡å™¨ä¸Šã€‚</p>
<hr>
<h2 id="åŸŸåè§£æè½¬å‘">åŸŸåè§£æè½¬å‘</h2>
<p>è€ƒè™‘å¦‚ä¸‹åœºæ™¯ï¼Œæ¯å…¬å¸å†…éƒ¨é…ç½®æœ‰æœ¬åœ°DNSæœåŠ¡å™¨ï¼Œè´Ÿè´£è§£ææ¯å…¬å¸å†…éƒ¨æœåŠ¡å™¨åŸŸåä»¥åŠäº’è”ç½‘ä¸Šçš„åŸŸåã€‚å­å…¬å¸ä¸æ¯å…¬å¸ç‰©ç†è·ç¦»è¾ƒè¿œï¼Œä¸¤åœ°ä½¿ç”¨ä¸“çº¿é“¾æ¥ï¼Œä¸“çº¿å¸¦å®½ä¸é«˜ã€‚å­å…¬å¸å†…éƒ¨è®¡ç®—æœºä¸ç›´æ¥è¿æ¥äº’è”ç½‘ã€‚</p>
<p>å‡å¦‚ä¸åœ¨å­å…¬å¸å†…éƒ¨è®¾ç½®DNSæœåŠ¡å™¨ï¼Œå­å…¬å¸å†…éƒ¨è®¡ç®—æœºå¯¹æ¯å…¬å¸å†…éƒ¨åŸŸåè§£æè¯·æ±‚ä»¥åŠäº’è”ç½‘ä¸ŠåŸŸåè§£æè¯·æ±‚éƒ½ä¼šäº¤ç”±æ¯å…¬å¸çš„DNSæœåŠ¡å™¨ï¼ˆä¸ºå•¥å­å…¬å¸ç”µè„‘ä¸ç›´æ¥å¡«äº’è”ç½‘ä¸Šçš„DNSï¼Ÿ1.è§£æä¸åˆ°æ¯å…¬å¸ç§ç½‘çš„æœåŠ¡å™¨ 2.å…¬å¸ä¹Ÿä¸å¯èƒ½å…è®¸ä½ è¿™ä¹ˆåšï¼‰ã€‚è¿™éƒ¨åˆ†åŸŸåè§£ææµé‡ä¼šä¸¥é‡å ç”¨ä¸“ç”¨é“¾è·¯çš„å¸¦å®½ï¼Œå¯¼è‡´ç½‘ç»œé˜»å¡ã€‚</p>
<p>åœ¨å­å…¬å¸å†…éƒ¨è®¾ç½®ä¸€ä¸ªDNSæœåŠ¡å™¨ï¼Œä½†æ˜¯è¿™ä¸ªDNSæœåŠ¡å™¨åˆæœ‰ç‚¹ä¸åŒã€‚å¯¹äºè‡ªå·±ä¸çŸ¥é“åŸŸåï¼Œä»–å¹¶æ²¡æœ‰è¯·æ±‚äº’è”ç½‘ä¸Šçš„æ ¹DNSæœåŠ¡å™¨ï¼Œè€Œæ˜¯æŠŠåŸŸåè§£æçš„æµé‡è½¬å‘ç»™äº†æ¯å…¬å¸DNSæœåŠ¡å™¨ï¼Œè¿™æ ·æœ‰æ•ˆé™ä½äº†ä¸“ç”¨é“¾è·¯ä¸ŠåŸŸåè§£æçš„å¸¦å®½å ç”¨ã€‚è¿™ç§åœºæ™¯å°±æ˜¯DNSè½¬å‘ã€‚</p>
<p>DNSè½¬å‘è¿˜æœ‰2ç§åœºæ™¯ï¼ˆæˆ–è€…è¯´2ä¸ªå‚æ•°ï¼‰</p>
<p><strong>â‘ </strong>foward onlyï¼šå­å…¬å¸DNSæœåŠ¡å™¨æŒ‡å‘æ¯å…¬å¸DNSæœåŠ¡å™¨è¯·æ±‚DNSè§£æã€‚å¦‚æœæ¯å…¬å¸DNSæœåŠ¡å™¨æŒ‚äº† æˆ– å­å…¬å¸åˆ°æ¯å…¬å¸é“¾è·¯æ•…éšœ æˆ– æ¯å…¬å¸DNSä¸Šä¸äº†ç½‘ï¼ˆå­å…¬å¸DNSæœåŠ¡å™¨å¯ä»¥è§£ææ¯å…¬å¸å†…ç½‘æœåŠ¡å™¨åŸŸåï¼‰ï¼Œå­å…¬å¸DNSæœåŠ¡å™¨æ— æ³•è§£æInternetåŸŸå</p>
<p><strong>â‘¡</strong>foward firstï¼šå­å…¬å¸DNSæœåŠ¡å™¨ä¼˜å…ˆæŒ‡å‘æ¯å…¬å¸DNSæœåŠ¡å™¨ï¼Œå¦‚æœæ¯å…¬å¸DNSæœåŠ¡å™¨è¿ä¸ä¸Šï¼ˆæ¯”å¦‚å­å…¬å¸åˆ°æ¯å…¬å¸çš„é“¾è·¯æ•…éšœï¼‰ä¼šä½¿ç”¨å­DNSæœåŠ¡å™¨ä¿å­˜çš„æ ¹DNSæœåŠ¡å™¨æ¥è§£æåŸŸåï¼ˆè¿™æ—¶å€™æ— æ³•è§£ææ¯å…¬å¸å†…ç½‘åŸŸåï¼Œå¯ä»¥è§£æInternetåŸŸåï¼‰ã€‚</p>
<p>å¦‚æœå­å…¬å¸åˆ°æ¯å…¬å¸ä¹‹é—´é“¾è·¯æ˜¯å¥½çš„ï¼Œå•çº¯æ¯å…¬å¸DNSæœåŠ¡å™¨ä¸Šä¸äº†ç½‘ã€‚å­å…¬å¸å¯ä»¥è§£ææ¯å…¬å¸å†…ç½‘æœåŠ¡å™¨åŸŸåï¼Œä½†æ˜¯æ— æ³•è§£æInternetåŸŸåã€‚</p>
<blockquote>
<p>æ­¤æ®µåŸŸåè§£æè½¬å‘æ‘˜æŠ„è‡ªè¿™ä¸ª<a href="https://www.cnblogs.com/kelamoyujuzhen/">kelamoyujuzhen</a>çš„<a href="https://www.cnblogs.com/kelamoyujuzhen/p/9526915.html">æ–‡ç« </a></p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>JavaScript</title>
    <url>/2020/09/11/JavaScript/</url>
    <content><![CDATA[<h3 id="jsæ¯”å€¼å‡½æ•°">jsæ¯”å€¼å‡½æ•°</h3>
<ol>
<li><code>sort()</code>ä»¥å­—æ¯é¡ºåºå¯¹æ•°ç»„è¿›è¡Œå‡åºæ’åº</li>
<li>è€Œ**æ•°å­—é¡ºåº<code>**sort( )</code>æ— æ³•å‡­è‡ªå·±å•ç‹¬å®ç°ï¼Œè¿™é‡Œå°±ä½“ç°äº†æ¯”å€¼å‡½æ•°çš„ä½œç”¨</li>
</ol>
<a id="more"></a>
<p>è¿™å°±æ˜¯æ¯”å€¼å‡½æ•°ï¼š<code>function(a,b)&#123;return (a-b)&#125;</code>ï¼Œä¼šè¿”å›æ­£è´Ÿå’Œé›¶ï¼Œ<code>sort( )</code>å¯æ ¹æ®è¿”å›çš„å€¼çš„<strong>æ­£è´Ÿ</strong>å¯¹æ•°ç»„è¿›è¡Œæ’åºã€‚</p>
<p><span class="ljspan"><a href="https://blog.csdn.net/qwe122343/article/details/103992772">å‚è€ƒæ–‡æ¡£</a></span></p>
<h3 id="Scriptæ ‡ç­¾åµŒå¥—å†…å®¹">Scriptæ ‡ç­¾åµŒå¥—å†…å®¹</h3>
<p>ç¼–å†™<code>js</code>å‡ºç°çš„å¥‡æ€ªé—®é¢˜ğŸƒä¸€èˆ¬åœ°ï¼Œå¼•å…¥èµ„æºï¼Œéƒ½ç”¨å•ç‹¬ç”¨ä¸€ä¸ª<code>Script</code>æ ‡ç­¾ï¼Œæ ‡ç­¾å†…å†…å®¹ä¸ºç©ºï¼Œè€Œæ”¹ç”¨srcå¼•å…¥å¤–éƒ¨<code>js</code>èµ„æºã€‚ç„¶åï¼Œæˆ‘å°±æƒ³å¦‚æœæˆ‘å¼•å…¥çš„åŒæ—¶åˆåœ¨æ ‡ç­¾å†…å†™å…¥ï¼Œèƒ½ä¸èƒ½ç”¨å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼Œä¸ç®¡æ˜¯æ ‡ç­¾å†…å†™çš„è¿˜æ˜¯å¼•ç”¨çš„å¤–éƒ¨èµ„æºï¼Œéƒ½æ— æ³•ç›¸äº’ä½¿ç”¨</p>
<h3 id="Ajax">Ajax</h3>
<h4 id="å½“æ•°æ®åœ¨æµè§ˆå™¨è·ŸæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®åªèƒ½æ˜¯æ–‡æœ¬ï¼Œè¿™æ—¶å€™å°±éœ€è¦-Json-å‡ºé©¬ğŸäº†ï¼">å½“æ•°æ®åœ¨æµè§ˆå™¨è·ŸæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®åªèƒ½æ˜¯æ–‡æœ¬ï¼Œè¿™æ—¶å€™å°±éœ€è¦**<code>Json</code>**å‡ºé©¬ğŸäº†ï¼</h4>
<ol>
<li>ä½¿ç”¨<code>Ajax</code>æ¥å‘é€æ•°æ®ï¼Œå¯ä»¥é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œè²Œä¼¼è¦åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®å“åº”å¤´éƒ¨<code>Access-Control-Allow-Origin</code></li>
</ol>
<p><img src="/assets/img/JavaScript.png" alt="image-20200611105650226"></p>
<p>â€‹	è§£å†³æ–¹æ¡ˆï¼šæŠŠæœåŠ¡å™¨å“åº”çš„æ•°æ®æ”¹ä¸º<code>Json</code>ï¼Œè¿™æ ·å°±å¯ä»¥äº†ï¼å› ä¸ºéœ€è¦è§£æï¼</p>
<ol start="2">
<li>å¯¹äº**<code>Ajax</code>**:é€šè¿‡å¯¹<code>javascript</code>ä¸­<code>Ajax</code>çš„ç»ƒä¹ ğŸ“ƒï¼Œå‘ç°<code>Ajax</code>ç¡®å®å…·å¤‡çŠ¶æ€æ€§ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘åˆšåˆšæœç´¢äº†æŸä¸œè¥¿ï¼Œç„¶åä¿¡æ¯å¾ˆå¤šï¼Œåˆ†äº†å¾ˆå¤šé¡µï¼Œé‚£ä¹ˆå½“æˆ‘ç‚¹å‡»ä¸‹ä¸€é¡µæ—¶ğŸ“‘ï¼Œå‘é€<code>Ajax</code>è¯·æ±‚ï¼Œå®ƒä¼šæ˜¾ç¤ºæˆ‘åˆšåˆšæœç´¢çš„å†…å®¹çš„ä¸‹ä¸€é¡µï¼Œè€Œä¸éœ€è¦æˆ‘å†æ¬¡æäº¤æœç´¢å†…å®¹ï¼</li>
<li><code>ajax</code>æ˜¯å‘é€å¼‚æ­¥è¯·æ±‚ğŸ“§ï¼šåŒæ­¥å’Œå¼‚æ­¥å¾—åŒºåˆ«å¾ˆæ˜æ˜¾ï¼ŒåŒæ­¥å‘é€è¯·æ±‚åï¼Œéœ€è¦ç­‰åˆ°æ¥æ”¶åˆ°è¿”å›ä¿¡æ¯å’Œæ•°æ®æ‰èƒ½ç»§ç»­å‘é€è¯·æ±‚ï¼›è€Œå¼‚æ­¥åˆ™å¯ä»¥åœ¨å‘é€è¯·æ±‚åï¼Œä¸éœ€è¦ç­‰å¾…æ¥æ”¶è¿”å›ä¿¡æ¯ï¼Œç›´æ¥å‘é€å…¶ä»–è¯·æ±‚ï¼Œç­‰å¾…è¿”å›ä¿¡æ¯å’Œæ•°æ®æ˜¯åœ¨å¦ä¸€ä¸ªçº¿ç¨‹âš™ï¸ä¸­è¿›è¡Œçš„ï¼Œä¸å½±å“å½“å‰çº¿ç¨‹ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>javascript</category>
      </categories>
  </entry>
  <entry>
    <title>Javaä¸Šä¼ å’Œä¸‹è½½</title>
    <url>/2020/11/18/Java%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/</url>
    <content><![CDATA[<p>ä¸ç®¡æ˜¯ä¸Šä¼ å’Œä¸‹è½½ï¼Œæˆ‘å‘ç°éƒ½éœ€è¦è®¾ç½®è¯·æ±‚å¤´ä¹‹ç±»çš„é…ç½®ï¼Œæ‰èƒ½å¤Ÿå®Œæˆä¸Šä¼ ä¸‹è½½åŠŸèƒ½</p>
<h2 id="ä¸Šä¼ ">ä¸Šä¼ </h2>
<p>ä¸Šä¼ çš„è¯·æ±‚å¤´ç­‰è®¾ç½®æ˜¯åœ¨è¡¨å•é‡Œé¢è®¾ç½®çš„ï¼Œæ¯”å¦‚formè¡¨å•ä¸­è®¾ç½®**<code>enctype=&quot;multipart/form-data&quot;</code>**<a id="more"></a></p>
<p>æœåŠ¡å™¨é‡Œé¢å¯¹æ–‡ä»¶çš„å¤„ç†</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‰æï¼šè·å–æ–‡ä»¶å</span></span><br><span class="line"><span class="comment">#è·å–æ–‡ä»¶å</span></span><br><span class="line"><span class="keyword">String</span> filename = <span class="keyword">file</span>.getOriginalFilename();</span><br><span class="line"><span class="keyword">String</span> path = <span class="string">&quot;F:\\download&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">##åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ–‡ä»¶ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸åœ¨å°±æ–°å»º</span></span><br><span class="line"><span class="keyword">File</span> filefake = new <span class="keyword">File</span>(path,filename);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!filefake.getParentFile().<span class="keyword">exists</span>()) &#123; </span><br><span class="line">	filefake.getParentFile().mkdirs();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŠŠæ–‡ä»¶ä¼ è¾“åˆ°æŒ‡å®šè·¯å¾„</span></span><br><span class="line"><span class="keyword">file</span>.transferTo(new <span class="keyword">File</span>(path+<span class="keyword">File</span>.separator+filename));</span><br></pre></td></tr></table></figure>
<h2 id="ä¸‹è½½">ä¸‹è½½</h2>
<p>ä¸‹è½½æœ€é‡è¦çš„æ˜¯è®¾ç½®**<span class="label info">Content-Disposition</span><strong>å“åº”å¤´å’Œå®ä½“å¤´éƒ¨</strong><span class="label info">Content-Disposition</span>**</p>
<h3 id="Content-Disposition">Content-Disposition</h3>
<p>åœ¨å¸¸è§„çš„HTTPåº”ç­”ä¸­ï¼Œ<strong><span class="label info">Content-Disposition</span></strong> å“åº”å¤´æŒ‡ç¤ºå›å¤çš„å†…å®¹è¯¥ä»¥ä½•ç§å½¢å¼å±•ç¤ºï¼Œæ˜¯ä»¥<strong>å†…è”</strong>çš„å½¢å¼ï¼ˆå³ç½‘é¡µæˆ–è€…é¡µé¢çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œè¿˜æ˜¯ä»¥<strong>é™„ä»¶</strong>çš„å½¢å¼ä¸‹è½½å¹¶ä¿å­˜åˆ°æœ¬åœ°ã€‚</p>
<p>åœ¨multipart/form-dataç±»å‹çš„åº”ç­”æ¶ˆæ¯ä½“ä¸­ï¼Œ <strong><span class="label info">Content-Disposition</span></strong> æ¶ˆæ¯å¤´å¯ä»¥è¢«ç”¨åœ¨multipartæ¶ˆæ¯ä½“çš„å­éƒ¨åˆ†ä¸­ï¼Œç”¨æ¥ç»™å‡ºå…¶å¯¹åº”å­—æ®µçš„ç›¸å…³ä¿¡æ¯ã€‚å„ä¸ªå­éƒ¨åˆ†ç”±åœ¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><span class="label warning">Content-Type</span></a> ä¸­å®šä¹‰çš„<strong>åˆ†éš”ç¬¦</strong>åˆ†éš”ã€‚ç”¨åœ¨æ¶ˆæ¯ä½“è‡ªèº«åˆ™æ— å®é™…æ„ä¹‰ã€‚</p>
<p>Content-Dispositionæ¶ˆæ¯å¤´æœ€åˆæ˜¯åœ¨MIMEæ ‡å‡†ä¸­å®šä¹‰çš„ï¼ŒHTTPè¡¨å•åŠ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> è¯·æ±‚åªç”¨åˆ°äº†å…¶æ‰€æœ‰å‚æ•°çš„ä¸€ä¸ªå­é›†ã€‚åªæœ‰<code>form-data</code>ä»¥åŠå¯é€‰çš„<code>name</code>å’Œ<code>filename</code>ä¸‰ä¸ªå‚æ•°å¯ä»¥åº”ç”¨åœ¨HTTPåœºæ™¯ä¸­ã€‚</p>
<h4 id="1-ä½œä¸ºæ¶ˆæ¯ä¸»ä½“ä¸­çš„æ¶ˆæ¯å¤´">1.ä½œä¸ºæ¶ˆæ¯ä¸»ä½“ä¸­çš„æ¶ˆæ¯å¤´</h4>
<p>åœ¨HTTPåœºæ™¯ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æˆ–è€…æ˜¯**<code>inline</code>**ï¼ˆé»˜è®¤å€¼ï¼Œè¡¨ç¤ºå›å¤ä¸­çš„æ¶ˆæ¯ä½“ä¼šä»¥é¡µé¢çš„ä¸€éƒ¨åˆ†æˆ–è€…æ•´ä¸ªé¡µé¢çš„å½¢å¼å±•ç¤ºï¼‰ï¼Œæˆ–è€…æ˜¯<code>attachment</code>ï¼ˆæ„å‘³ç€æ¶ˆæ¯ä½“åº”è¯¥è¢«ä¸‹è½½åˆ°æœ¬åœ°ï¼›å¤§å¤šæ•°æµè§ˆå™¨ä¼šå‘ˆç°ä¸€ä¸ªâ€œä¿å­˜ä¸ºâ€çš„å¯¹è¯æ¡†ï¼Œå°†<code>filename</code>çš„å€¼é¢„å¡«ä¸ºä¸‹è½½åçš„æ–‡ä»¶åï¼Œå‡å¦‚å®ƒå­˜åœ¨çš„è¯ï¼‰ã€‚</p>
<div class="note default">
            <p>Content-Disposition: inline<br>Content-Disposition: attachment<br>Content-Disposition: attachment; filename=â€œfilename.jpgâ€</p>
          </div>
<h4 id="2-ä½œä¸ºmultipart-bodyä¸­çš„æ¶ˆæ¯å¤´">2.ä½œä¸ºmultipart bodyä¸­çš„æ¶ˆæ¯å¤´</h4>
<div class="note default">
            <p>Content-Disposition: form-data<br>Content-Disposition: form-data; attachment<br>Content-Disposition: form-data; attachment; filename=â€œfilename.jpgâ€</p>
          </div>
<blockquote>
<p>è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Disposition"><span class="label default">è¿™é‡Œ</span></a></p>
</blockquote>
<h3 id="Content-Type">Content-Type</h3>
<p><strong><span class="label info">Content-Type</span></strong> å®ä½“å¤´éƒ¨ç”¨äºæŒ‡ç¤ºèµ„æºçš„MIMEç±»å‹ <a href="https://developer.mozilla.org/zh-CN/docs/Glossary/MIME_type">media type</a> ã€‚</p>
<p>åœ¨å“åº”ä¸­ï¼Œ<span class="label info">Content-Type</span>æ ‡å¤´å‘Šè¯‰å®¢æˆ·ç«¯å®é™…è¿”å›çš„å†…å®¹çš„å†…å®¹ç±»å‹ã€‚æµè§ˆå™¨ä¼šåœ¨æŸäº›æƒ…å†µä¸‹è¿›è¡ŒMIMEæŸ¥æ‰¾ï¼Œå¹¶ä¸ä¸€å®šéµå¾ªæ­¤æ ‡é¢˜çš„å€¼; ä¸ºäº†é˜²æ­¢è¿™ç§è¡Œä¸ºï¼Œå¯ä»¥å°†æ ‡é¢˜ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Content-Type-Options"><code>X-Content-Type-Options</code></a> è®¾ç½®ä¸º <strong>nosniff</strong>ã€‚</p>
<p>åœ¨è¯·æ±‚ä¸­ (å¦‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> æˆ– <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PUT"><code>PUT</code></a>)ï¼Œå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨å®é™…å‘é€çš„æ•°æ®ç±»å‹</p>
<blockquote>
<p>è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><span class="label default">è¿™é‡Œ</span></a></p>
</blockquote>
<hr>
### ä¸‹è½½æ–‡ä»¶çš„è®¾ç½®
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">#è·å–æ–‡ä»¶</span><br><span class="line">File file = <span class="keyword">new</span> <span class="constructor">File(<span class="params">url</span>)</span>;</span><br><span class="line">String filename = file.get<span class="constructor">Name()</span>;		</span><br><span class="line"></span><br><span class="line">#è®¾ç½®å“åº”å¤´å’Œå®ä½“éƒ¨åˆ†</span><br><span class="line">response.set<span class="constructor">ContentType(<span class="string">&quot;application/x-msdownload&quot;</span>)</span>;</span><br><span class="line">response.set<span class="constructor">Header(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + <span class="params">filename</span>)</span>;</span><br><span class="line"></span><br><span class="line">ç‰¹æ®Šçš„ä¼ å¯¼æœºåˆ¶ï¼ŒæŠŠæ–‡ä»¶ä¼ è¾“åˆ°å“åº”ä¸­ï¼Œç±»ä¼¼response.get<span class="constructor">OutputStream()</span>.write<span class="literal">()</span>åŠŸèƒ½;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Files</span>.</span></span>copy(file.<span class="keyword">to</span><span class="constructor">Path()</span>, response.get<span class="constructor">OutputStream()</span>);</span><br></pre></td></tr></table></figure>
<h3 id="åœ¨çº¿æŸ¥çœ‹æ–‡ä»¶çš„è®¾ç½®">åœ¨çº¿æŸ¥çœ‹æ–‡ä»¶çš„è®¾ç½®</h3>
<p>æ„Ÿè§‰è·Ÿä¸‹è½½æœ‰ç‚¹æƒ³åƒï¼Œå°±è¯·æ±‚å¤´å’Œå®ä½“éƒ¨åˆ†ä¸åŒè€Œå·²</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#è·å–æ–‡ä»¶å’Œæ–‡ä»¶å</span></span><br><span class="line">File file = <span class="keyword">new</span> File(url);</span><br><span class="line">String filename = file.getName();</span><br><span class="line"></span><br><span class="line"><span class="meta">#è®¾ç½®å“åº”å¤´å’Œå®ä½“éƒ¨åˆ†</span></span><br><span class="line">response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + filename);		response.setContentType(<span class="string">&quot;application/pdf;charset=UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">#æŠŠæ–‡ä»¶å­˜å‚¨åœ¨ç¼“å­˜æµä¸­</span></span><br><span class="line">byte[] b = <span class="keyword">new</span> byte[fis.available()];</span><br><span class="line">FileInputStream fis = <span class="literal">null</span>;</span><br><span class="line"><span class="meta">#æŠŠç¼“è™«åŒºçš„å­—ç¬¦æµè¯»å…¥bä¸­</span></span><br><span class="line">fis.read(b);</span><br><span class="line"><span class="meta">#å¾€å“åº”ä¸­å†™å…¥æ•°æ®</span></span><br><span class="line">response.getOutputStream().write(b);</span><br><span class="line">fis.close();</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Install_Navicat_with_Docker</title>
    <url>/2020/12/07/Install-Navicat-with-Docker/</url>
    <content><![CDATA[<h1>Navicatæ— æ³•è¿æ¥åˆ°Dockerä¸Šçš„mysql</h1>
<p>Dockerä¸Šè£…çš„æ˜¯mysql 8.0</p>
<p>æƒ³ç”¨Navicatè¿æ¥çš„æ—¶å€™ï¼Œå‘ç°è¿æ¥ä¸ä¸Šäº†ï¼Œé¾Ÿé¾ŸğŸ¢ğŸ¢<a id="more"></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Errorï¼š1251 - Client does not support authentication protocol requested by server; consider upgrading MySQL client.</span><br></pre></td></tr></table></figure>
<p>ç½‘ä¸Šå¤§å¤šæ•°äººè¯´ï¼Œæ˜¯å› ä¸ºæ–°çš„mysqlçš„æƒé™æ›´æ”¹äº†å’Œå®‰å…¨æå‡äº†ï¼Œå¯¹å¯†ç ä½¿ç”¨äº†å¼ºåŠ å¯†çš„æ¨¡å¼ï¼Œæ‰€ä»¥å¯¼è‡´ç¬¬ä¸‰æ–¹è½¯ä»¶æ— æ³•ç™»é™†mysqlã€‚</p>
<p>ç„¶åæˆ‘æ ¹æ®å¤§å¤šæ•°äººçš„å»ºè®®ï¼Œè¿›å…¥dockerå®¹å™¨ä¸­ï¼Œè¿›å…¥mysql</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;password&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;123&#39;;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ä¿®æ”¹å®Œäº†ï¼Œæˆ‘è¿˜æ˜¯æŠ¥ä¸Šé¢1251çš„é”™è¯¯ï¼Œå®åœ¨æ˜¯ä¸çŸ¥é“å¦‚ä½•æï¼Œå°±é‡æ–°è£…äº†ä½ç‰ˆæœ¬mysql 5.7çš„æ•°æ®åº“ï¼Œå°±å¯ä»¥è¿æ¥æˆåŠŸäº†ã€‚</p>
<h3 id="å…¶å®ä¸ç”¨æ”¹ç‰ˆæœ¬">å…¶å®ä¸ç”¨æ”¹ç‰ˆæœ¬</h3>
<p>ä¸ºä½•è¿˜æŠ¥é”™ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ç”¨è¿œç¨‹è¿æ¥ï¼Œä¸Šé¢çš„ä»£ç ä¿®æ”¹çš„æ˜¯æœ¬æœºä¸Šçš„è®¿é—®ï¼Œé€šè¿‡æŸ¥è¯¢æ•°æ®åº“é…ç½®ï¼Œå¦‚ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT Host,User,plugin from user;</span><br><span class="line">+-----------+------------------+-----------------------+</span><br><span class="line">| Host      | User             | plugin                |</span><br><span class="line">+-----------+------------------+-----------------------+</span><br><span class="line">| %         | luoj             | caching_sha2_password |</span><br><span class="line">| %         | root             | caching_sha2_password |</span><br><span class="line">| localhost | mysql.infoschema | caching_sha2_password |</span><br><span class="line">| localhost | mysql.session    | caching_sha2_password |</span><br><span class="line">| localhost | mysql.sys        | caching_sha2_password |</span><br><span class="line">| localhost | root             | mysql_native_password |</span><br><span class="line">+-----------+------------------+-----------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>å¯çŸ¥æˆ‘åªæ”¹äº†localhostä¸Šçš„æ’ä»¶ï¼Œè€Œæˆ‘è¦æ”¹çš„æ˜¯é‚£ä¸ªHostä¸º<code>%</code>çš„ï¼Œ<code>%</code>ä»£è¡¨ä»»ä½•ä¸»æœºã€‚æ‰€ä»¥è‡ªç„¶æŠ¥é”™äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;lj123456&#39; PASSWORD EXPIRE NEVER;</span><br><span class="line">mysql&gt; ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;lj123456&#39;;</span><br><span class="line">mysql&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å¦‚ä¸Šçš„é…ç½®å°±å¯ä»¥å•¦</p>
<h4 id="é‡åˆ°-this-is-incompatible-with-sql-mode-only-full-group-by-é”™è¯¯">é‡åˆ° &quot;this is incompatible with sql_mode=only_full_group_by&quot;é”™è¯¯</h4>
<p>è¿™ä¸ªé—®é¢˜æ›´å¤§</p>
<p>é€šè¿‡ç½‘ä¸Šç½‘å‹çš„è¯´æ³•ï¼Œå‘ç°æ˜¯<code>select @@sql_mode;</code>ï¼Œä¹Ÿå°±æ˜¯sql_modeåœ¨æé¬¼ï¼Œç„¶åæˆ‘è¿›å»dockerçš„mysql.5.7ï¼ˆmysql_02ï¼‰ä¸­ä¿®æ”¹</p>
<p><code>/etc/mysql/mysql.conf.d/mysqld.cnf </code>ï¼Œæ·»åŠ äº†<code>sql_mode = STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</code>;ç„¶åé‡å¯mysqlï¼Œå‘ç°è‡ªåŠ¨é€€å‡ºå®¹å™¨ï¼Œåæ— æ³•å†ç™»é™†è¿™ä¸ªå®¹å™¨äº†ï¼ŒæŠ¥é”™äº†ã€‚é¾Ÿé¾Ÿï¼Œç°åœ¨è¿å®¹å™¨éƒ½è¿›ä¸å»ï¼Œå¦‚ä½•ä¿®æ”¹é˜¿ï¼Œé¾Ÿé¾Ÿ</p>
]]></content>
  </entry>
  <entry>
    <title>Mavenä¾èµ–é—®é¢˜</title>
    <url>/2020/09/05/Maven%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>ç”±äºæˆ‘çš„mavené•œåƒé…ç½®æ˜¯aliyunçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘çš„æ‰€æœ‰ä¾èµ–åŒ…éƒ½ä¼šå»aliyunä»“åº“å»æ‰¾ï¼Œä½†æ˜¯ï¼Œä¸€ç›´æ‰¾ä¸åˆ°ä¸¤ä¸ªåŒ…</p>
<p>é€šè¿‡<a href="https://maven.aliyun.com/mvn/search">aliyunä»“åº“æœåŠ¡</a>ï¼Œæˆ‘ç¡®å®æ‰¾ä¸åˆ°è¿™ä¸¤ä¸ªåŒ…çš„ä¾èµ–ï¼Œæ‰€ä»¥è‡ªç„¶æ— æ³•è‡ªåŠ¨ä¸‹è½½</p>
<a id="more"></a>
<p>ä½†æ˜¯æˆ‘çš„<code>pom.xml</code>æ–‡ä»¶é‡Œé¢ä¹Ÿé…å¤‡äº†ä»“åº“å•Šï¼Œé˜¿é‡Œäº‘é‡Œé¢æ²¡æœ‰ï¼Œé‚£ä¹ˆæˆ‘çš„<code>pom.xml</code>é…å¤‡çš„ä»“åº“åº”è¯¥æœ‰äº†å§</p>
<p>æ„å»ºæˆ‘çš„é¡¹ç›®å´è¿˜ä¸€ç›´æŠ¥ç¼ºå°‘ä¾èµ–çš„é”™è¯¯ã€‚</p>
<p>é€šè¿‡ä¸Šç½‘æŸ¥çœ‹ï¼ŒåŸå› æ˜¯ï¼š</p>
<p>æˆ‘åœ¨<code>/path/to/maven/config/settings.xml</code>ä¸­çœ‹åˆ°æˆ‘çš„mirrorså±æ€§ä¸­é…ç½®å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="params">&lt;mirror&gt;</span></span><br><span class="line">     <span class="params">&lt;id&gt;</span>aliyun<span class="params">&lt;/id&gt;</span></span><br><span class="line">  <span class="meta">#è¿™é‡Œçš„â€œ*â€è¡¨ç¤ºåªç”¨è¿™ä¸ªä»“åº“ï¼Œå…¶ä»–ä»“åº“éƒ½ä¸ç”¨ï¼Œå…¨éƒ¨å¿½ç•¥</span></span><br><span class="line">     <span class="params">&lt;mirrorOf&gt;</span>*<span class="params">&lt;/mirrorOf&gt;</span></span><br><span class="line">     <span class="params">&lt;name&gt;</span>aliyun maven<span class="params">&lt;/name&gt;</span></span><br><span class="line">     <span class="params">&lt;url&gt;</span>http:<span class="comment">//maven.aliyun.com/nexus/content/groups/public&lt;/url&gt;</span></span><br><span class="line"><span class="params">&lt;/mirror&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç”±äºè¿™ä¸ªåŸå› ï¼Œæ‰€ä»¥å¯¼è‡´åé¢pom.xmlé…ç½®çš„ä¸œè¥¿éƒ½è¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥æ‰æ‰¾ä¸åˆ°é‚£äº›ä¾èµ–åŒ…ğŸ’©</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>maven</tag>
      </tags>
  </entry>
  <entry>
    <title>Multipartçš„å¤„ç†æ–¹æ³•</title>
    <url>/2020/10/21/Mutipart%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å¤„ç†Multipartçš„æ–¹æ³•">å¤„ç†Multipartçš„æ–¹æ³•</h2>
<blockquote>
<p>å…³äºStandardServletMultipartResolvertå’ŒCommonsMultipartResolverçš„ä¸¤ç§ä½¿ç”¨æ–¹æ³•</p>
</blockquote>
<h3 id="1-StandardServletMultipartResolvertçš„ç”¨æ³•">1.StandardServletMultipartResolvertçš„ç”¨æ³•</h3>
<a id="more"></a>
<p>éœ€å…·å¤‡æ¡ä»¶ï¼šservlet3.0+</p>
<ul>
<li>åœ¨springmvcå®¹å™¨ä¸­é…ç½®æ·»åŠ ç±»å¯¹è±¡</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="attribute">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attribute">class</span>=<span class="string">&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨web.xmlæ–‡ä»¶ä¸­çš„<code>&lt;servlet&gt;</code>ä¸­é…ç½®å¦‚ä¸‹ï¼š</li>
</ul>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">&lt;multipart-config&gt;</span><br><span class="line">    &lt;<span class="built_in">max</span>-<span class="keyword">file</span>-<span class="built_in">size</span>&gt;<span class="number">20848820</span>&lt;/<span class="built_in">max</span>-<span class="keyword">file</span>-<span class="built_in">size</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">max</span>-request-<span class="built_in">size</span>&gt;<span class="number">418018841</span>&lt;/<span class="built_in">max</span>-request-<span class="built_in">size</span>&gt;</span><br><span class="line">    &lt;<span class="keyword">file</span>-<span class="built_in">size</span>-threshold&gt;<span class="number">1048576</span>&lt;/<span class="keyword">file</span>-<span class="built_in">size</span>-threshold&gt;</span><br><span class="line">&lt;/multipart-config&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-CommonsMultipartResolverçš„ç”¨æ³•">2.CommonsMultipartResolverçš„ç”¨æ³•</h3>
<p>éœ€å…·å¤‡çš„æ¡ä»¶ï¼šå¯¼å…¥ä¸¤ä¸ªé¢å¤–çš„åŒ…ï¼š<a href="https://mvnrepository.com/artifact/commons-fileupload/commons-fileupload"><strong>commons-fileupload</strong></a>å’Œ<a href="https://mvnrepository.com/artifact/commons-io/commons-io"><strong>commons-io</strong></a></p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><br><span class="line">		&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> value=<span class="string">&quot;20000000&quot;</span>&gt;&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">		&lt;<span class="keyword">property</span> <span class="built_in">name</span>=<span class="string">&quot;defaultEncoding&quot;</span> value=<span class="string">&quot;UTF-8&quot;</span>&gt;&lt;/<span class="keyword">property</span>&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<h3 id="å¤„ç†æ•°æ®">å¤„ç†æ•°æ®</h3>
<p>æˆ‘è§‰å¾—éƒ½ä¸€æ ·ï¼Œåªä¸è¿‡è§£æå‡ºæ¥çš„MultipartHttpServletRequestä¸ä¸€æ ·è€Œå·²ï¼Œè·å–æ•°å€¼çš„æ–¹å¼éƒ½ä¸€æ ·çš„</p>
<p>æ³•ä¸€ï¼šè§£ærequestè·å–/ç›´æ¥æ˜ å°„åˆ°å‚æ•°ä¸Š</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line"><span class="comment">#è§£ærequestè¯·æ±‚</span></span><br><span class="line"><span class="keyword">MultipartHttpServletRequest </span><span class="keyword">multipartRequest </span>= (<span class="keyword">MultipartHttpServletRequest) </span>request;</span><br><span class="line"><span class="comment">#è¿™æ ·å°±å¯ä»¥è·å–åˆ°MultipartFileäº†</span></span><br><span class="line">Map&lt;String, <span class="keyword">MultipartFile&gt; </span>fileMap = <span class="keyword">multipartRequest.getFileMap();</span></span><br></pre></td></tr></table></figure>
<p>æ³•äºŒï¼šæŠŠæ•°æ®ç›´æ¥å°è£…åˆ°æ¨¡å‹ç±»ä¸­</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">List&lt;MultipartFile&gt; files = <span class="keyword">new</span><span class="type">User</span>.getFiles();</span><br><span class="line"></span><br><span class="line"><span class="meta">#è¦æå‰å°è£…å¥½æ¨¡å‹ç±»å¹¶å®ç°åºåˆ—åŒ–	</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewUser</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">Serializable</span></span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> final long serialVersionUID = <span class="number">1</span>L;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> username;</span><br><span class="line">	<span class="keyword">private</span> List&lt;MultipartFile&gt; files;</span><br><span class="line">	</span><br><span class="line">	....<span class="keyword">get</span>/<span class="keyword">set</span> method...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Mybatis Generator</title>
    <url>/2020/09/04/Mybatis-Generator/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>é€šè¿‡<code>mybatis</code>è·Ÿæ•°æ®åº“åšIOï¼Œå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯æ¯æ¬¡è¦å†™çš„<code>mapper</code>å’Œ<code>DAO</code>åŒ…æ‹¬<code>Bean</code>ï¼Œä¸œè¥¿å®åœ¨æ˜¯å¤ªå¤šäº†ğŸ˜¢ã€‚æ‰€ä»¥é€šè¿‡é¢œç¾¤è€å¸ˆçš„åœ¨çº¿è¯¾å ‚ï¼Œæˆ‘äº†è§£äº†<span class="ljspan ljspan-reverse ljspan-blue"><a href="http://mybatis.org/generator/index.html">Mybatis Generator</a></span>,å¯ä»¥ä¸€æ¬¡æ€§ç”Ÿæˆ<code>Dao</code>ã€<code>mapper</code>å’Œä¸æ•°æ®åº“è¡¨å¯¹åº”çš„<code>bean</code>ğŸ˜†ï¼ŒçœŸçš„å¾ˆçˆ½è¯¶ã€‚</p>
<a id="more"></a>
<hr>
<h2 id="é…ç½®">é…ç½®</h2>
<p>åœ¨<span class="ljspan ljspan-blue"><a href="http://mybatis.org/generator/quickstart.html">å®˜æ–¹æ–‡æ¡£</a></span>ä¸Šï¼Œç›¸å…³é…ç½®å†™å¾—å¾ˆæ¸…æ¥šå“¦</p>
<h3 id="1-å¯¼å…¥ä¾èµ–åŒ…">1.å¯¼å…¥ä¾èµ–åŒ…</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">#å¼•å…¥ä¾èµ–åŒ…</span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>
<h3 id="2-ç¼–å†™MBG-mybatis-generator-æ–‡ä»¶">2.ç¼–å†™MBG(mybatis generator)æ–‡ä»¶</h3>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç”ŸæˆMybatis3Simpleå½¢å¼çš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;simple&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®åº“è¿æ¥--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:hsqldb:mem:aname&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">userId</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">password</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--é…ç½®æ•°æ®åº“è¡¨ç”Ÿæˆçš„å¯¹åº”bean--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;example.model&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--é…ç½®mapper--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;example.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--é…ç½®dao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;example.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--é…ç½®æ•°æ®åº“è¡¨--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">schema</span>=<span class="string">&quot;wxproject&#x27; tableName=&quot;</span><span class="attr">FooTable</span>&quot;  <span class="attr">domainObjectName</span>=<span class="string">&quot;FooTable&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç”Ÿæˆçš„<code>mybatis</code>ç›¸å…³æ–‡ä»¶å†…å®¹ï¼Œéƒ½è·ŸMBGæ–‡ä»¶ğŸ‘€æœ‰å…³</p>
</blockquote>
<hr>
<h2 id="å®ç°">å®ç°</h2>
<h3 id="è¿è¡ŒMBGé…ç½®æ–‡ä»¶">è¿è¡ŒMBGé…ç½®æ–‡ä»¶</h3>
<p>æœ‰å¾ˆ<a href="http://mybatis.org/generator/running/running.html">å¤šç§æ–¹å¼</a>ï¼Œæˆ‘ä½¿ç”¨<code>java</code>æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨æµ‹è¯•è¿è¡Œæˆ–è€…<code>main</code>å‡½æ•°å†…ä¸è¿è¡Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"> <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line"> <span class="comment">//ä½ çš„mbgæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œè¿™æ ·å°±ä¸ç”¨å†™è·¯å¾„äº†</span></span><br><span class="line"> File configFile = <span class="keyword">new</span> File(<span class="string">&quot;generatorConfig.xml&quot;</span>);</span><br><span class="line"> ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line"> Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line"> DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line"> MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line"> myBatisGenerator.generate(<span class="keyword">null</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Mybatis-Example">Mybatis Example</h2>
<p>åˆšå¼€å§‹æ¥è§¦åˆ° <span class="ljspan ljspan-green">mybatis Example</span>çš„æ—¶å€™ï¼Œæˆ‘éƒ½æ˜¯ç»•é“èµ°ï¼ˆç”šè‡³å¹²è„†ä¸ç”Ÿæˆå®ƒï¼‰ï¼Œè‡ªå·±åœ¨mybatisç”Ÿæˆçš„å®ä¾‹é‡Œé¢é‡æ–°å†™æ–¹æ³•ï¼Œåé¢æ‰å‘ç°å®ƒï¼Œå¤§æœ‰ç”¨å¤„ğŸ˜‚ï¼Œä¸€èµ·æ¥çœ‹çœ‹å§ï¼</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> countByExample(UserExample example) thorws SQLException    æŒ‰æ¡ä»¶è®¡æ•°</span><br><span class="line"><span class="built_in">int</span> deleteByPrimaryKey(Integer id) thorws SQLException    æŒ‰ä¸»é”®åˆ é™¤</span><br><span class="line"><span class="built_in">int</span> deleteByExample(UserExample example) thorws SQLException    æŒ‰æ¡ä»¶æŸ¥è¯¢</span><br><span class="line"><span class="built_in">String</span>/Integer insert(User record) thorws SQLException    æ’å…¥æ•°æ®ï¼ˆè¿”å›å€¼ä¸ºIDï¼‰</span><br><span class="line">User selectByPrimaryKey(Integer id) thorws SQLException    æŒ‰ä¸»é”®æŸ¥è¯¢</span><br><span class="line">ListselectByExample(UserExample example) thorws SQLException    æŒ‰æ¡ä»¶æŸ¥è¯¢</span><br><span class="line">ListselectByExampleWithBLOGs(UserExample example) thorws SQLException    æŒ‰æ¡ä»¶æŸ¥è¯¢ï¼ˆåŒ…æ‹¬BLOBå­—æ®µï¼‰ã€‚åªæœ‰å½“æ•°æ®è¡¨ä¸­çš„å­—æ®µç±»å‹æœ‰ä¸ºäºŒè¿›åˆ¶çš„æ‰ä¼šäº§ç”Ÿã€‚</span><br><span class="line"><span class="built_in">int</span> updateByPrimaryKey(User record) thorws SQLException    æŒ‰ä¸»é”®æ›´æ–°</span><br><span class="line"><span class="built_in">int</span> updateByPrimaryKeySelective(User record) thorws SQLException    æŒ‰ä¸»é”®æ›´æ–°å€¼ä¸ä¸º<span class="keyword">null</span>çš„å­—æ®µ</span><br><span class="line"><span class="built_in">int</span> updateByExample(User record, UserExample example) thorws SQLException    æŒ‰æ¡ä»¶æ›´æ–°</span><br><span class="line"><span class="built_in">int</span> updateByExampleSelective(User record, UserExample example) thorws SQLException    æŒ‰æ¡ä»¶æ›´æ–°å€¼ä¸ä¸º<span class="keyword">null</span>çš„å­—æ®µ</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¾ˆå¤šå…³äº <span class="ljspan ljspan-green">mybatis Example</span>çš„æ–¹æ³•å§</p>
</blockquote>
<h3 id="æ¡ˆä¾‹ï¼š">æ¡ˆä¾‹ï¼š</h3>
<p>Mybatisçš„é€†å‘å·¥ç¨‹ä¸­ä¼šç”Ÿæˆå®ä¾‹åŠå®ä¾‹å¯¹åº”çš„exampleï¼Œexampleç”¨äºæ·»åŠ æ¡ä»¶ï¼Œç›¸å½“whereåé¢çš„éƒ¨åˆ†</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">xxxExample example = <span class="keyword">new</span> xxx<span class="constructor">Example()</span>;</span><br><span class="line">Criteria criteria = <span class="keyword">new</span> <span class="constructor">Example()</span>.create<span class="constructor">Criteria()</span>;</span><br><span class="line">example.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>exampleå’Œcriteriaæœ‰å¾ˆå¤šçš„æ–¹æ³•å¯ä¾›ä½¿ç”¨</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">example.setOrderByClause(â€œå­—æ®µå ASCâ€);    æ·»åŠ å‡åºæ’åˆ—æ¡ä»¶ï¼ŒDESCä¸ºé™åº</span><br><span class="line">example.setDistinct(<span class="literal">false</span>)    å»é™¤é‡å¤ï¼Œbooleanå‹ï¼Œ<span class="literal">true</span>ä¸ºé€‰æ‹©ä¸é‡å¤çš„è®°å½•ã€‚</span><br><span class="line">criteria.andXxxIsNull    æ·»åŠ å­—æ®µxxxä¸º<span class="literal">null</span>çš„æ¡ä»¶</span><br><span class="line">criteria.andXxxIsNotNull    æ·»åŠ å­—æ®µxxxä¸ä¸º<span class="literal">null</span>çš„æ¡ä»¶</span><br><span class="line">criteria.andXxxEqualTo(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µç­‰äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxNotEqualTo(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µä¸ç­‰äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxGreaterThan(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µå¤§äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxGreaterThanOrEqualTo(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µå¤§äºç­‰äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxLessThan(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µå°äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxLessThanOrEqualTo(<span class="keyword">value</span>)    æ·»åŠ xxxå­—æ®µå°äºç­‰äº<span class="keyword">value</span>æ¡ä»¶</span><br><span class="line">criteria.andXxxIn(List&lt;ï¼Ÿ&gt;)    æ·»åŠ xxxå­—æ®µå€¼åœ¨List&lt;ï¼Ÿ&gt;æ¡ä»¶</span><br><span class="line">criteria.andXxxNotIn(List&lt;ï¼Ÿ&gt;)    æ·»åŠ xxxå­—æ®µå€¼ä¸åœ¨List&lt;ï¼Ÿ&gt;æ¡ä»¶</span><br><span class="line">criteria.andXxxLike(â€œ%â€+<span class="keyword">value</span>+â€%â€)    æ·»åŠ xxxå­—æ®µå€¼ä¸º<span class="keyword">value</span>çš„æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶</span><br><span class="line">criteria.andXxxNotLike(â€œ%â€+<span class="keyword">value</span>+â€%â€)    æ·»åŠ xxxå­—æ®µå€¼ä¸ä¸º<span class="keyword">value</span>çš„æ¨¡ç³ŠæŸ¥è¯¢æ¡ä»¶</span><br><span class="line">criteria.andXxxBetween(value1,value2)    æ·»åŠ xxxå­—æ®µå€¼åœ¨value1å’Œvalue2ä¹‹é—´æ¡ä»¶</span><br><span class="line">criteria.andXxxNotBetween(value1,value2)    æ·»åŠ xxxå­—æ®µå€¼ä¸åœ¨value1å’Œvalue2ä¹‹é—´æ¡ä»¶</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="é™„åŠ é…ç½®">é™„åŠ é…ç½®</h2>
<p>é’ˆå¯¹<code>mybatis</code>ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶<a href="http://mybatis.org/generator/afterRunning.html">MapperConfig.xml</a>ï¼Œå®ƒå¯¹<span class="ljspan ljspan-black"><a href="https://mybatis.org/mybatis-3/zh/index.html">MyBatis</a> </span>è¡Œä¸ºçš„è®¾ç½®å’Œå±æ€§ä¿¡æ¯æœ‰å…³ï¼Œå¯ä»¥é€šè¿‡<span class="ljspan ljspan-reverse ljspan-black"><a href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">é…ç½®å‚æ•°</a></span>æ¥è®¾ç½®ç”Ÿæˆmybatisç›¸å…³æ–‡ä»¶çš„å†…å®¹å½¢å¼ï¼Œæ¯”å¦‚<code>mapUnderscoreToCamelCase</code>å¼€å¯<code>é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„</code></p>
<hr>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<p>1.ä¸€èˆ¬ä½¿ç”¨<code>mybatis generator</code>ç”Ÿæˆçš„<code>bean</code>,éƒ½æ˜¯æ²¡æœ‰æ„é€ å‡½æ•°çš„ï¼›æ‰€ä»¥éœ€è¦è‡ªå·±æ–°å»ºï¼Œä½†æ˜¯å¦‚æœæœ‰æœ‰å‚æ„é€ å‡½æ•°ï¼Œå°±å¿…é¡»è¦æœ‰æ— å‚æ„é€ å‡½æ•°ï¼Œè¿™æ˜¯å¿…é¡»çš„ã€‚</p>
<p>2.ä½¿ç”¨mybatis generatorç”Ÿæˆmapper.xml(ä¹Ÿå°±æ˜¯æ•°æ®åº“è¯­è¨€)ï¼Œå‘ç°åªæœ‰å‡ ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”å…³é”®çš„insertSelectiveæ–¹æ³•æ²¡æœ‰ï¼Œè¿™å°±å¾ˆå°´å°¬äº†ğŸ˜–ï¼Œæˆ‘æ”¹äº†ä¾èµ–åŒ…å‘ç°æ²¡æœ‰ç”¨ï¼Œæœ€åå‘ç°æ˜¯åœ¨mbgçš„é…ç½®æ–‡ä»¶ä¸­&lt;context&gt;ä¸­çš„å±æ€§targetRuntime,ä»åŸæ¥çš„MyBatis3Simpleæ”¹ä¸ºMyBatis3ï¼Œå°±å¯ä»¥äº†ã€‚</p>
<p>3.ğŸ’¥è®°å¾—åœ¨<code>SpringIoC</code>å®¹å™¨ä¸­æ·»åŠ <code>mapperscannerconfigurer</code>è¿™ä¸ª<code>bean</code>ï¼Œä¸ç„¶æ— æ³•ä½¿ç”¨<code>dao</code>å±‚é‡Œé¢çš„æ¥å£ï¼Œå› ä¸º<code>&lt;context:component-scan&gt;</code>æ‰«æä¸åŒ…æ‹¬<code>dao</code>å±‚ã€‚</p>
<hr>
<h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>
<h4 id="1-MyBatis-Generator-ç”Ÿæˆå™¨æŠŠå…¶ä»–æ•°æ®åº“çš„åŒåè¡¨ç”Ÿæˆä¸‹æ¥çš„é—®é¢˜"><strong>1.MyBatis Generator ç”Ÿæˆå™¨æŠŠå…¶ä»–æ•°æ®åº“çš„åŒåè¡¨ç”Ÿæˆä¸‹æ¥çš„é—®é¢˜</strong></h4>
<p>è¿™æ˜¯å› ä¸ºmysqlä¸æ”¯æŒschemaå’Œcatalogï¼Œæ‰€ä»¥éœ€è¦åœ¨&lt;jabcConnection&gt;ä¸­æ·»åŠ å±æ€§â€œ &lt;property name=â€œnullCatalogMeansCurrentâ€ value=â€œtrueâ€/&gt;â€</p>
<p>ğŸ˜µæˆ‘çœ‹ä¸æ‡‚ğŸ¢ğŸ¢ï¼Œåæ­£åŠ äº†å°±å¯¹äº†ï¼Œæ—¢è§£å†³äº†é—®é¢˜ï¼ŒåŠ äº†å¯¹ç¨‹åºä¹Ÿæ²¡å•¥å½±å“ã€‚</p>
<p><a href="https://blog.csdn.net/qq_40233736/article/details/83314596">å‚è€ƒæ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title>Microsoft-Storeæ‰“ä¸å¼€?</title>
    <url>/2020/09/05/Microsoft-Store%E6%89%93%E4%B8%8D%E5%BC%80/</url>
    <content><![CDATA[<p><strong>æ‰“ä¸å¼€microsoftçš„åº”ç”¨å•†åŸï¼Œwindowæ›´æ–°ä¹Ÿæ²¡åŠæ³•?</strong>,å…¶å®æ›´æ–°å°±å¯ä»¥äº†ï¼Œåªä¸è¿‡ä½ çš„æ›´æ–°ä¸æ˜¯çœŸæ­£çš„æ›´æ–°ğŸ™Œ</p>
<blockquote>
<p>é‡‡ç”¨è¿™ä¸ªæ–¹æ³•æ‰“å¼€Microsoft Store,å¹¶ä¸éœ€è¦ç¿»å¢™å“¦âœ”ï¸</p>
</blockquote>
<a id="more"></a>
<h2 id="æ­¥éª¤">æ­¥éª¤</h2>
<p>â€‹	1.åˆ°<strong>æœåŠ¡</strong>âš™ï¸é‡Œé¢æ‰“å¼€<code>Windows</code>æ›´æ–°ï¼Œå°±å¯ä»¥æ›´æ–°<code>Windows</code></p>
<p>â€‹	2.ç­‰å¾…æ›´æ–°å¥½äº†ï¼Œé‡å¯ç³»ç»ŸğŸ’»ï¼ŒæŸ¥çœ‹æ›´æ–°å¹¶å°è¯•æ‰“å¼€<code>Store</code>ğŸ ,å¦‚æœæ›´æ–°é‚£é‡Œè¿˜æ˜¯æç¤ºé‡å¯ä»¥å®Œæˆé‡è¦æ›´æ–°,è®°å¾—å†é‡å¯</p>
<p>â€‹	3.è¿™æ ·ï¼Œä¸€èˆ¬å°±å¯ä»¥æ‰“å¼€<code>Store</code></p>
<h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>
<p>å¦‚æœå¯ä»¥æ‰“å¼€<code>Store</code>,ä½†æ˜¯å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥ï¼Œ<code>store</code>æŸäº›é€‰é¡¹ä¹Ÿæ‰“ä¸å¼€</p>
</li>
<li>
<p>æ‰“å¼€ç³»ç»Ÿè‡ªå¸¦**<code>IE</code>æµè§ˆå™¨**ï¼Œè¿›å…¥**<code>Internet</code>é€‰é¡¹<strong>åï¼Œé€‰æ‹©</strong>è¿æ¥**æ ç›®</p>
</li>
<li>
<p>ç‚¹å‡»<strong>å±€åŸŸç½‘è®¾ç½®</strong>ï¼Œè¿›å…¥è®¾ç½®é¡µé¢ä»¥åï¼Œå‹¾é€‰ä¸Š<strong>è‡ªåŠ¨æ£€æµ‹è®¾ç½®</strong>å…¶ä»–éƒ½ä¸å‹¾é€‰</p>
</li>
<li>
<p>ç‚¹å‡»<strong>ç¡®å®š</strong>ç¦»å¼€ï¼Œå°±å¯ä»¥è¿›å…¥<code>Store</code>äº†</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title>PageHelper</title>
    <url>/2020/10/15/PageHelper/</url>
    <content><![CDATA[<p>æ²¡ä½¿ç”¨è¿‡åˆ†é¡µä¹‹å‰ï¼Œä¸è§‰å¾—åˆ†é¡µéš¾ï¼Œç­‰åˆ°éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå®Œå…¨æ²¡æœ‰å¤´ç»ªï¼Œç›´åˆ°é‡åˆ°<span class="ljspan ljspan-reverse ljspan-red">Mybatis Pagination</span> - <span class="ljspan ljspan-reverse ljspan-blue">PageHelper</span>æ‰è®©æˆ‘æ¾äº†ä¸€å£æ°”ï¼Œ<span class="ljspan ljspan-reverse ljspan-blue">PageHelper</span>å°è£…äº†å¾ˆå¤šåˆ†é¡µçš„åŠŸèƒ½ï¼Œåˆ¤æ–­å‰ä¸€é¡µ/åä¸€é¡µï¼Œç¬¬ä¸€é¡µæˆ–æœ€åä¸€é¡µï¼›å‡ ä¸ªé¡µé¢çš„æ•°æ®å°è£…åœ¨åˆ—è¡¨ä¸­ï¼Œä¸€æ¬¡åªæ˜¾ç¤ºè¿™å‡ ä¸ªé¡µé¢ï¼Œå¿«æ¥çœ‹çœ‹å§ğŸ˜†<a id="more"></a></p>
<h3 id="é…ç½®">é…ç½®</h3>
<p><strong>å¼•å…¥ä¾èµ–åŒ…</strong></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;x.x.x&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>é…ç½®PageHelper</strong></p>
<blockquote>
<p>ä½¿ç”¨mybatis-config.xmlé…ç½®ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Springå®¹å™¨é…ç½®ï¼Œè¯¦æƒ…è¯·çœ‹<a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/en/HowToUse.md">å®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    In the configuration file, </span></span><br><span class="line"><span class="comment">    plugins location must meet the requirements as the following order:</span></span><br><span class="line"><span class="comment">    properties?, settings?, </span></span><br><span class="line"><span class="comment">    typeAliases?, typeHandlers?, </span></span><br><span class="line"><span class="comment">    objectFactory?,objectWrapperFactory?, </span></span><br><span class="line"><span class="comment">    plugins?, </span></span><br><span class="line"><span class="comment">    environments?, databaseIdProvider?, mappers?</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- config params as the following --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--offset ç­‰äº pageNum, limit ç­‰äº pageSize--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;RowBounds&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--pageNum &lt;= 0 ç­‰äº the first page,  pageNum&gt; pages(total pages)ç­‰äº the last page--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;reasonable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;param1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;value1&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šå…³äºå‚æ•°çš„é…ç½®ï¼Œè¯·å‚è€ƒ<a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/en/HowToUse.md">å®˜æ–¹æ–‡æ¡£</a></p>
<hr>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<blockquote>
<p>æˆ‘ç›´æ¥ä½¿ç”¨pageInfoå¯¹è±¡æ¥æ“ä½œåˆ†é¡µæ•°æ®çš„</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">/è·å–ç¬¬<span class="number">1</span>é¡µï¼Œ<span class="number">10</span>æ¡å†…å®¹ï¼Œé»˜è®¤æŸ¥è¯¢æ€»æ•°count</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">PageHelper</span>.</span></span>start<span class="constructor">Page(1, 10)</span>;</span><br><span class="line">List&lt;User&gt; <span class="built_in">list</span> = userMapper.select<span class="constructor">All()</span>;</span><br><span class="line"><span class="comment">//ç”¨PageInfoå¯¹ç»“æœè¿›è¡ŒåŒ…è£…</span></span><br><span class="line">PageInfo page = <span class="keyword">new</span> <span class="constructor">PageInfo(<span class="params">list</span>)</span>;</span><br><span class="line"><span class="comment">//è¿™é‡Œçš„pageæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¼•å…¥fastjsonåŒ…ï¼Œ</span></span><br><span class="line"><span class="comment">//ç›´æ¥è§£æå¯¹è±¡ä¸ºjsonå¯¹è±¡è¿”å›é¡µé¢</span></span><br><span class="line"><span class="comment">//è¿™æ ·å°±èƒ½ä¸€æ­¥åˆ°ä½ï¼Œåœ¨å‰ç«¯è·å–åˆ°åˆ†é¡µä¿¡æ¯ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•PageInfoå…¨éƒ¨å±æ€§</span></span><br><span class="line"><span class="comment">//PageInfoåŒ…å«äº†éå¸¸å…¨é¢çš„åˆ†é¡µå±æ€§</span></span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">page</span>.<span class="params">getPageNum</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(10, <span class="params">page</span>.<span class="params">getPageSize</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">page</span>.<span class="params">getStartRow</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(10, <span class="params">page</span>.<span class="params">getEndRow</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(183, <span class="params">page</span>.<span class="params">getTotal</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(19, <span class="params">page</span>.<span class="params">getPages</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(1, <span class="params">page</span>.<span class="params">getFirstPage</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(8, <span class="params">page</span>.<span class="params">getLastPage</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="params">true</span>, <span class="params">page</span>.<span class="params">isFirstPage</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="params">false</span>, <span class="params">page</span>.<span class="params">isLastPage</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="params">false</span>, <span class="params">page</span>.<span class="params">isHasPreviousPage</span>()</span>);</span><br><span class="line"><span class="keyword">assert</span><span class="constructor">Equals(<span class="params">true</span>, <span class="params">page</span>.<span class="params">isHasNextPage</span>()</span>);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Request-and-Response</title>
    <url>/2020/09/11/Request-and-Response/</url>
    <content><![CDATA[<h2 id="Getè¯·æ±‚">Getè¯·æ±‚</h2>
<p><code>Get</code>è¯·æ±‚âœ‰ï¸çš„å‚æ•°æ˜¯<code>Get</code>è¯·æ±‚çš„é™„å¸¦ä¿¡æ¯ï¼Œä¸å†è¯·æ±‚ä½“å†…ï¼Œè€Œåœ¨è¯·æ±‚ä½“å¤–ï¼Œ<code>Post</code>è¯·æ±‚æ‰æ˜¯åœ¨è¯·æ±‚ä½“å†…</p>
<p>é‚£ä¸ºä»€ä¹ˆè¿˜ç”¨è·å–<code>Get</code>è¯·æ±‚å‚æ•°è¿˜éœ€è¦ç”¨åˆ°<code>Request</code>å¯¹è±¡å‘¢â“</p>
<a id="more"></a>
<p>é€šè¿‡æŸ¥è¯¢æºç ğŸ“œï¼ŒçŸ¥é“åŸæ¥è·å–<code>the query string or posted form data</code>éƒ½éœ€è¦é€šè¿‡<code>Request</code>å¯¹è±¡çš„<code>getParameter</code>æ–¹æ³•æ¥è·å–çš„ï¼Œè€Œå¦‚æœæ—¶<code>Post</code>è¯·æ±‚æ•°æ®ï¼Œåˆ™ä¸€èˆ¬é€šè¿‡<code>Request</code>å¯¹è±¡çš„<code>getInputStream</code>æˆ–<code>getReader</code>æ–¹æ³•æ¥å®ç°</p>
<h2 id="ä½¿ç”¨HttpUrlConnectionæ¥å®ç°Get-Postè¯·æ±‚">ä½¿ç”¨HttpUrlConnectionæ¥å®ç°Get/Postè¯·æ±‚</h2>
<p>å‘ç°<code>Get</code>è¯·æ±‚ä½¿ç”¨<code>connection</code>æ–¹æ³•æ¥å®ç°å‘é€è¯·æ±‚ğŸ“§éœ€è¦å¼€å¯å’Œå…³é—­ï¼Œä½†æ˜¯<code>Post</code>å´ä¸ç”¨ï¼Œé‚£åˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å‘¢â“ï¼ŒåŸæ¥<code>Post</code>è¯·æ±‚æœ‰<code>DoInput/DoOutput</code>å±æ€§ï¼Œè¿™ä¸ªå±æ€§å…è®¸è¿™ä¸ªè¿æ¥å‘æœåŠ¡å™¨è‡ªåŠ¨æäº¤æ•°æ®å’Œè·å–æ•°æ®ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬çœ‹åˆ°å…³é—­ç¼“å­˜æµğŸŒŠä¹‹ç±»çš„ï¼Œå…¶å®å°±åœ¨è‡ªåŠ¨å‘é€è¯·æ±‚å•¦</p>
<h2 id="è¯·æ±‚æ–¹æ³•ç±»å‹">è¯·æ±‚æ–¹æ³•ç±»å‹</h2>
<p>è¯·æ±‚çš„æ–¹æ³•ç±»å‹æœ‰<code>get</code>ã€<code>post</code>ã€<code>put</code>ã€<code>delete</code>ç­‰ğŸ“¬ï¼Œé™¤äº†åœ¨å‰ç«¯é¡µé¢è®¾ç½®ï¼Œä¸€èˆ¬éƒ½æ˜¯åœ¨<code>controller</code>å±‚è®¾ç½®å®ƒçš„ç±»å‹</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>SSMæ¶æ„è§£æ</title>
    <url>/2020/09/05/SSM%E6%9E%B6%E6%9E%84%E8%A7%A3%E6%9E%90/</url>
    <content><![CDATA[<h3 id="ğŸ”°SSMæ¡†æ¶">ğŸ”°SSMæ¡†æ¶</h3>
<p><code>SSM</code>æ¡†æ¶å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†æ¥çœ‹å¾…ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯<code>springmvc</code>ï¼Œå¦ä¸€éƒ¨åˆ†ä¸º<code>spring</code>çš„<code>DI</code>å’Œ<code>IoC</code>ï¼Œå†ä¸€ä¸ªå°±æ˜¯<code>MyBatis</code>äº†</p>
<p>é¦–å…ˆå¯åŠ¨é¡¹ç›®æ—¶ï¼Œå°±æ˜¯å…ˆåŠ è½½<code>web.xml</code>ï¼›</p>
<p>ç›‘å¬å™¨&gt;è¿‡æ»¤å™¨&gt;<code>Servlet</code></p>
<p>æ‰€ä»¥ç›‘å¬å™¨ä¼šå…ˆåŠ è½½<code>Spring</code>å®¹å™¨çš„é…ç½®æ–‡ä»¶</p>
<a id="more"></a>
<p>ç„¶åè¿‡æ»¤å™¨æŠŠè¯·æ±‚çš„å†…å®¹è®¾ç½®ä¸ºåŒæ„çš„å­—ç¬¦ç¼–ç ä¹‹ç±»çš„è®¾ç½®</p>
<p>æœ€åæ‰æ˜¯<code>Servlet</code>æ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚ï¼Œåˆ°<code>SpringMVC</code>ä¸­å¤„ç†</p>
<hr>
<h4 id="ğŸƒSpringéƒ¨åˆ†ï¼š">ğŸƒSpringéƒ¨åˆ†ï¼š</h4>
<p><a href="https://www.zhihu.com/question/23277575"><code>DI</code>å’Œ<code>IoC</code>çš„ç®€å•è§£é‡Š</a></p>
<p><code>DI</code>:ä¾èµ–æ³¨å…¥å°±æ˜¯è®©å¯¹è±¡ä¹‹é—´çš„è€¦åˆæ€§å‡å°‘ï¼Œè®©æ¯ä¸ªå¯¹è±¡æ›´åŠ çµæ´»ï¼Œä¾¿äºä¿®æ”¹ï¼›</p>
<p><code>IoC</code>:å°±æ˜¯æŠŠåˆ›å»ºå¯¹è±¡çš„ä¸»ä½“åˆç¨‹åºå‘˜è½¬ä¸º<code>Spring</code>æˆ–å…¶ä»–æ§åˆ¶åè½¬å®¹å™¨</p>
<p><code>ApplicationContext</code>å°±æ˜¯ä¸€ä¸ªæ§åˆ¶åè½¬å®¹å™¨</p>
<p><code>ApplicationContext</code>é‡Œé¢éƒ½æ˜¯ä¸€ä¸ªä¸ª<code>bean</code>ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡</p>
<p><code>bean</code>çš„<code>property</code>å±æ€§å¯¹åº”å¯¹è±¡çš„setteræ–¹æ³•æ³¨å…¥å®ä¾‹åŒ–ï¼›è€Œ<code>constructor-arg</code>å±æ€§å¯¹åº”å¯¹è±¡çš„æ„é€ å™¨æ–¹æ³•å®ä¾‹åŒ–</p>
<hr>
<h4 id="ğŸŒ€Springmvc">ğŸŒ€Springmvc</h4>
<p><img src="/assets/img/image-20200518131134856.png" alt="è¯·æ±‚å“åº”æµç¨‹å›¾"></p>
<p>å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ç‚¹å‡»é“¾æ¥æˆ–æäº¤è¡¨å•çš„æ—¶å€™ï¼Œè¯·æ±‚å°±å¼€å§‹å·¥ä½œäº†</p>
<p>è¯·æ±‚çš„ç¬¬ä¸€ç«™ä¼šé€šè¿‡ä¸€ä¸ªå…¶å‰ç«¯æ§åˆ¶å™¨ï¼Œ<code>SSM</code>è¿™é‡Œå°±æ˜¯<code>DispacherServlet</code>ï¼›</p>
<p>ç„¶åç¬¬äºŒç«™ï¼Œ<code>DispacherServlet</code>ä¼šå°†è¯·æ±‚å‘é€ç»™<code>SpringMVC</code>æ§åˆ¶å™¨ï¼ˆ<code>Controller</code>ï¼‰ã€‚æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¯·æ±‚çš„<code>Spring</code>ç»„ä»¶ã€‚ä¸€èˆ¬éƒ½ä¼šæœ‰å¤šä¸ªæ§åˆ¶å™¨ï¼Œè¿™æ—¶å€™ï¼Œ<code>DispacherServlet</code>å°±ä¼šæŸ¥è¯¢ä¸€ä¸ªä¼šå¤šä¸ªå¤„ç†æ˜ å°„å™¨æ¥æ‰¾åˆ°é‚£ä¸ªæ§åˆ¶å™¨ï¼›</p>
<p>ç¬¬ä¸‰ç«™ï¼Œåˆ°äº†æ§åˆ¶å™¨ï¼Œè¯·æ±‚ä¼šå¸ä¸‹å™¨è´Ÿè½½ï¼ˆä¹Ÿå°±æ˜¯è¯·æ±‚çš„ä¿¡æ¯ï¼‰å…µç­‰å¾…æ§åˆ¶å™¨å¤„ç†</p>
<p>åˆ°äº†ç¬¬å››ç«™ï¼Œæ§åˆ¶å™¨åœ¨å®Œæˆå¤„ç†åï¼Œä¼šäº§ç”Ÿä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¦è¿”å›ç»™ç”¨æˆ·å¹¶åœ¨æµè§ˆå™¨æ˜¾ç¤ºã€‚è¿™äº›ä¿¡æ¯è¢«ç§°ä¸ºæ¨¡å‹ï¼ˆ<code>model</code>ï¼‰ã€‚å½“ç„¶è¿˜æœ‰ä¸€ä¸ªè§†å›¾åæ¥ä»£è¡¨è§†å›¾ï¼Œæ‰€ä»¥æ§åˆ¶å™¨æœ€åä¸€ä»¶äº‹å°±æ˜¯å°†è¯·æ±‚è¿åŒæ¨¡å‹å’Œè§†å›¾åå‘é€å›<code>DispacherServlet</code></p>
<p>ç„¶ååˆ°äº†ç¬¬äº”ç«™ï¼Œ<code>DispacherServlet</code>æœ‰è§†å›¾è§£æå™¨ï¼Œå®ƒå°†é€»è¾‘è§†å›¾ååŒ¹é…ä¸ºä¸€ä¸ªç‰¹å®šçš„è§†å›¾å®ç°</p>
<p>ç„¶åå°±æ˜¯ç¬¬å…­ç«™ï¼Œ<code>DispacherServlet</code>å°†æ¨¡å‹æ•°æ®æ¸²æŸ“åˆ°è§†å›¾ä¸Š</p>
<p>ç¬¬ä¸ƒæ­¥å°±æ˜¯è§†å›¾é€šè¿‡å“åº”å¯¹è±¡ä¼ é€’ç»™å®¢æˆ·ç«¯</p>
<hr>
<h4 id="â˜ï¸Mybatis">â˜ï¸Mybatis</h4>
<p>äº‹åŠ¡æ§åˆ¶ï¼šå°±æ˜¯è®©æ•°æ®åº“çš„æ›´æ–°èƒ½å¤Ÿå…·å¤‡äº‹åŠ¡çš„å››ç§åŸåˆ™ï¼šåŸå­æ€§ã€éš”ç¦»æ€§ã€ä¸€è‡´æ€§ã€æŒç»­æ€§ï¼›è¿™æ ·å°±å¯ä»¥ä½¿æ•°æ®åº“çš„æ›´æ–°ä¸å‡ºç°è„è¯»å¹»è¯»ç­‰æƒ…å†µã€‚</p>
<p>æ•°æ®æºï¼šä¸€èˆ¬ç”¨<code>C3P0</code>æ¥ç®¡ç†ï¼Œå®ç°è¿æ¥æ•°æ®åº“å¯ä»¥ä¸€æ¬¡æ€§å¤šæ¬¡è¿æ¥å¤šæ¬¡æäº¤ç­‰</p>
<p>æ‰«æå™¨ï¼ˆ<code>MapperScannerConfigurer</code>ï¼‰æ‰«ææ‰€æœ‰çš„<code>Dao</code>æ¥å£å®ç°ï¼ŒåŠ å…¥åˆ°<code>IoC</code>å®¹å™¨ä¸­</p>
<p><code>SqlSessionFactory</code>å¯ä»¥é…ç½®<code>Spring</code>å’Œ<code>MyBatis</code>çš„æ•´åˆ</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>SSMæ¡†æ¶çŸ¥è¯†ç‚¹</title>
    <url>/2020/09/11/SSM%E6%A1%86%E6%9E%B6%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    <content><![CDATA[<h2 id="SSMæ¡†æ¶æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹">SSMæ¡†æ¶æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹</h2>
<ol>
<li>
<p><strong>group id å’Œ artifact id</strong></p>
<p>åˆ›å»ºmavené¡¹ç›®ï¼Œgroup id å’Œ artifact idéƒ½æ˜¯å¿…é¡»è¦å¡«å†™çš„ï¼Œå› ä¸ºé¡¹ç›®ä½ç½®å°±æ˜¯é€šè¿‡è¿™ä¸¤ä¸ªidå»æŸ¥æ‰¾çš„ï¼Œgroup id ä¸€èˆ¬åˆ†ä¸ºå¤šä¸ªæ®µï¼Œç¬¬ä¸€æ®µä¸ºåŸŸï¼Œç¬¬äºŒæ®µä¸ºå…¬å¸åç§°ï¼ˆè¿™é‡Œå°±è¯´ä¸¤æ®µè€Œå·²ï¼‰ã€‚<a id="more"></a>åŸŸåˆåˆ†ä¸ºorgã€comã€cnç­‰ï¼›</p>
<p>è€Œartifact id ä¸€èˆ¬ä¸ºé¡¹ç›®åç§°</p>
</li>
<li>
<p><strong>facet å®šä¹‰äº† java ee é¡¹ç›®çš„ç‰¹æ€§å’Œè¦æ±‚</strong></p>
<p>ä¸€èˆ¬åˆ›å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œéƒ½æ²¡æœ‰web.xmlæ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸ºè¯¥é¡¹ç›®è¿˜ä¸æ˜¯ä¸€ä¸ªåŠ¨æ€webé¡¹ç›®ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸‹å…¶ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸‹é¢å¾—Project facetså±æ€§</p>
</li>
<li>
<p><strong>applicationContexté…ç½®</strong></p>
<p>å±æ€§é…ç½®ä¸­å¯ç”¨valueæ¥è·å–ä¸€äº›ç›¸å¯¹ç›®å½•çš„æ•°å€¼æˆ–æ–‡ä»¶</p>
</li>
<li>
<p><strong>&lt;mvc:annotation-driven&gt;</strong></p>
<p>&lt;mvc:annotation-driven&gt;æ ‡ç­¾å…¶å®å°±æ˜¯åˆ†å‘è¯·æ±‚ç»™controlleræ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿæ˜ å°„è¯·æ±‚URLå’Œå‚æ•°ç»™å“åº”çš„controlleræ–¹æ³•ã€‚</p>
</li>
<li>
<p><strong>&lt;context:component-scan&gt;</strong></p>
<p>&lt;context:component-scan&gt;åˆ™æ˜¯æ‰«ææŒ‡å®šåŒ…ä¸‹çš„ç±»å¹¶æ³¨å†Œè¿™äº›åŒ…ä¸‹çš„è¢«æ³¨è§£æ ‡è®°çš„ç»„ä»¶ä¸ºSpringçš„bean</p>
</li>
<li>
<p><strong>jdbcUrl</strong></p>
<p><code>JDBC URL: jdbc:mysql://&lt;host&gt;&lt;port&gt;/&lt;database_name&gt;</code></p>
<p>é»˜è®¤ç«¯å£3306ï¼Œå¦‚æœæœåŠ¡å™¨ä½¿ç”¨é»˜è®¤ç«¯å£åˆ™portå¯ä»¥çœç•¥</p>
<p>MySQL Connector/J Driver å…è®¸åœ¨URLä¸­æ·»åŠ é¢å¤–çš„è¿æ¥å±æ€§</p>
<p><code>jdbc:mysql://&lt;host&gt;:&lt;port&gt;/&lt;database_name&gt;?property1=value1&amp;property2=value2</code></p>
</li>
<li>
<p><strong>SqlSessionFactoryBean</strong></p>
<p>æ­£å¦‚SqlSessionFactoryBeançš„åå­—ï¼Œå®ƒæ˜¯ç”Ÿäº§SqlSessionFactoryçš„å·¥å‚Beanï¼›SqlSessionFactoryæ˜¯ä¸€ç§ç”Ÿäº§SqlSessionçš„å·¥å‚ï¼›SqlSessionæ˜¯ä»£è¡¨æ•°æ®åº“è¿æ¥å®¢æˆ·ç«¯å’Œæ•°æ®åº“Serverä¹‹é—´çš„ä¼šè¯ä¿¡æ¯ï¼›SqlSessionå®ç°å‘é€sqlè¯­å¥ï¼Œç®¡ç†äº‹åŠ¡å’Œè·å–mapperï¼›</p>
<p>SqlSessionæ˜¯å…³è”åˆ°å…·ä½“æ•°æ®åº“è¿æ¥çš„ï¼Œä½†æ˜¯å¦‚æœæ¯æ¬¡åˆ›å»ºå’Œé”€æ¯éƒ½ç›´æ¥æ“ä½œç‰©ç†è¿æ¥çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªèµ„æºæµªè´¹å¾ˆé«˜ï¼Œæ•ˆç‡å¾ˆä½ã€‚</p>
<p>ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± æ—¶ï¼Œå…³é—­SqlSessionå®ä¾‹ ï¼Œå…¶å®åªæ˜¯æŠŠæ•°æ®åº“è¿æ¥å¯¹è±¡ï¼ˆä»£è¡¨ç‰©ç†èµ„æºï¼‰æ”¾å›åˆ°å¯¹è±¡æ± ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥é”€æ¯ï¼Œä½¿ç”¨è¿æ¥æ± æŠ€æœ¯æå¤§æé«˜äº†ç‰©ç†èµ„æºåˆ©ç”¨ç‡ï¼Œç¼©å‡äº†åˆ›å»ºç‰©ç†è¿æ¥æ‰€éœ€çš„æ—¶é—´ã€èµ„æºç­‰ç­‰</p>
<p>ç›¸å…³çŸ¥è¯†ç‚¹å‡ºå¤„<a href="https://www.jianshu.com/p/f19a58938959">åœ¨è¿™é‡Œ</a></p>
</li>
<li>
<p><strong>å…³äºmapperæ˜ å°„çš„è¯¦è§£</strong></p>
<p>è¿˜ä¸æ˜¯å¾ˆæ‡‚æ¥å£å’Œmapperæ˜ å°„ä¹‹é—´å¦‚ä½•åšåˆ°å…³è”çš„</p>
<p>é€šè¿‡ <a href="Mybatis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A.md">Mybatisä»å…¥é—¨åˆ°ç²¾é€š</a> å¯å¤§æ¦‚äº†è§£ã€‚daoå±‚çš„æ¥å£å’Œmapperæ˜ å°„æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°çš„ã€‚åªè¦åœ¨SpringIoCå®¹å™¨ä¸­å®ç°mapperScannerConfigurerç±»å°±è¡Œï¼Œè¿™ä¸ªmapperå…¶å®è§£é‡Šèµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºspringå¸®å¿™åšäº†å¾ˆå¤šäº‹ï¼Œé¦–å…ˆå°±æ˜¯è°ƒç”¨æ¥å£å¯ä»¥ç›´æ¥è°ƒç”¨åˆ°mapper.xmlé‡Œé¢çš„æ•°æ®åº“è¯­å¥ï¼›è¿™ä¸ªå°±æ˜¯mybatisé‡Œé¢çš„åŠ¨æ€ä»£ç†ï¼›ä½†æ˜¯mapperæ¥å£è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¿˜éœ€è¦å®ç°ç±»ï¼Œè¿™ä¸ªå®ç°ç±»å¯ä»¥è·å–åˆ°sqlsessionfactoryæ¥è·å–sessionåè°ƒç”¨mapperæ¥å£ï¼Œç„¶åmapperScannerConfigurerå¯ä»¥ä¸€æ¬¡æ€§æ‰«æå¤šä¸ªæ¥å£ï¼Œå¹¶å®ç°è¿™ä¸ªæ¥å£ç”Ÿæˆå®ç°ç±»</p>
<p>å‚è€ƒæ–‡æ¡£åœ¨<a href="http://mybatis.org/spring/zh/mappers.html">è¿™é‡Œ</a></p>
</li>
<li>
<p><strong>äº‹åŠ¡ç®¡ç†/å£°æ˜å¼äº‹åŠ¡ç®¡ç†</strong></p>
<p>äº‹åŠ¡ç®¡ç†éœ€è¦æ•°æ®åº“çš„è¿æ¥ï¼Œæ‰€ä»¥ä¸€å®šè¦å¯¼å…¥æ•°æ®æºï¼›</p>
<p>å£°æ˜å¼äº‹åŠ¡ç®¡ç†æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åŸºäºtxå’Œaopå‘½åç©ºé—´çš„xmlé…ç½®æ–‡ä»¶ï¼›ä¸€ç§æ˜¯åŸºäº@Transactionalæ³¨è§£</p>
<p>ç›¸å…³å‚è€ƒæ–‡æ¡£åœ¨<a href="https://blog.csdn.net/donggua3694857/article/details/69858827">è¿™é‡Œ</a></p>
</li>
<li>
<p><strong>aopå’Œtxåœ¨äº‹åŠ¡æ–¹é¢çš„ç†è§£</strong></p>
<p>å¯¹äºtxåœ¨applicationContextä¸­å‡ºç°ï¼Œæˆ‘ä¸€ç›´ä¸ç†è§£å®ƒæ˜¯ä½•ç‰©ï¼Œç°åœ¨çŸ¥é“äº†</p>
<p>&lt;tx:advice&gt;å…¶å®å°±æ˜¯aopçš„é€šçŸ¥ï¼Œè€Œ&lt;tx:attributes&gt;å’Œ&lt;tx:method&gt;å…¶å®å°±æ˜¯é’ˆå¯¹serviceé‡Œé¢çš„æ–¹æ³•è®¾ç½®çš„äº‹åŠ¡ç®¡ç†å±æ€§ï¼Œä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ã€‚ã€‚ã€‚ã€‚ã€‚<strong>å¾…ç»­ï¼ï¼ï¼</strong></p>
<p>æˆ‘è§‰å¾—æ˜¯å¯¹çš„ï¼Œå“­äº†ğŸ˜­ğŸ˜­</p>
</li>
<li>
<p><strong>&lt;aop:poincut&gt;<strong>ä¸­çš„</strong>expresstion</strong></p>
<p>æ¯”å¦‚è¿™ä¸€ä¸ª<code>execution(* cn.lj.service..*(..))</code>ï¼Œç¬¬ä¸€ä¸ª<code>*</code>è¡¨ç¤ºè¿”å›å€¼ï¼Œè¿™é‡Œè¡¨ç¤ºä»»æ„ï¼›ç„¶åæ˜¯åŒ…serviceï¼›ç„¶åæ˜¯serviceä¸‹ç±»çš„ä»»æ„æ–¹æ³•ï¼Œå°±æ˜¯é‚£ä¸ª<code>*</code>ï¼Œæœ€å<code>(..)</code>æ˜¯æ‰€æœ‰å‚æ•°</p>
<p>æœ€é è¿‘<code>(..)</code>çš„ä¸ºæ–¹æ³•å,é è¿‘<code>.\*(..))</code>çš„ä¸ºç±»åæˆ–è€…æ¥å£å,å¦‚ä¸Šä¾‹çš„JoinPointObjP2.*(â€¦))</p>
<p><a href="https://blog.csdn.net/kkdelta/article/details/7441829">ç›¸å…³å†…å®¹é“¾æ¥</a></p>
</li>
<li>
<p><strong>å¯åŠ¨é¡¹ç›®å¤±è´¥ï¼Œæ— æ³•æ‰¾åˆ°applicationContext.xml</strong></p>
<p>æˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œåˆšå¼€å§‹æ˜¯å› ä¸ºresourcesæ–‡ä»¶å¤¹æ²¡å†™å¯¹ï¼Œç„¶åä¿®æ”¹ä»¥åè¿˜æ˜¯ä¸è¡Œï¼Œæœ€åå‘ç°ï¼Œæˆ‘çš„é¡¹ç›®ä¹‹å‰æ˜¯jar	ç±»å‹è€Œä¸æ˜¯warç±»å‹ï¼Œæ‰€ä»¥æ‰ä¸€ç›´ä¸æˆåŠŸçš„</p>
</li>
<li>
<p><strong>Spring Aop</strong></p>
<p>&lt;aop:aspect&gt;æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼›è€Œ&lt;aop:advisor&gt;åˆ™æ˜¯è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œä½†äºŒè€…çš„å®ç°åŸç†éƒ½æ˜¯ä¸€æ ·çš„</p>
</li>
<li>
<p><strong>&lt;mvc:annotation-driven&gt;</strong></p>
<p>è¿™ä¸ªä¸œè¥¿æ˜¯å¹²å˜›ç”¨çš„ï¼Ÿå…¶å®è®²èµ·æ¥æŒºéº»çƒ¦çš„ï¼Œç®€å•ç‚¹å°±æ˜¯å®ç°è¯·æ±‚çš„æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå¯¹requestmappingè¿™ä¸ªæ³¨è§£çš„å®ç°ï¼ŒåŒæ—¶è¿˜æœ‰è¯·æ±‚å‚æ•°ç­‰çš„è®¾ç½®ï¼ˆæ¯”å¦‚:@paramï¼‰éƒ½æ˜¯é€šè¿‡å®ƒæ¥å®ç°</p>
</li>
<li>
<p><strong>java properties file</strong></p>
<p>æˆ‘æƒ³é€šè¿‡<code>&lt;context:property-placeholder /&gt;</code>åŠ¨æ€å¼•å…¥ä¸€äº›æ•°æ®åº“è¿æ¥å±æ€§ï¼Œä½†æ˜¯ä¸€ç›´æŠ¥é”™ï¼Œæ— æ³•è§£æï¼›æœ€åå‘ç°åŸæ¥æ˜¯æˆ‘çš„æ–‡ä»¶åå†™é”™äº†ï¼Œå› ä¸ºä¸€èˆ¬javaçš„å±æ€§æ–‡ä»¶éƒ½æ˜¯ä»¥â€œpropertiesâ€ç»“å°¾çš„ï¼Œä½†æ˜¯æˆ‘æ‹¼æªäº†ï¼›</p>
<p><strong>ï¼ï¼ï¼æ€ä¹ˆè¯´ï¼Œå‘ç°springé‡Œé¢å¾ˆå¤šé…ç½®çš„ä¸œè¥¿éƒ½éœ€è¦ç‰¹åˆ«æ³¨æ„åå­—</strong></p>
</li>
<li>
<p><strong>Springå•å…ƒæµ‹è¯•</strong></p>
<p>ä½¿ç”¨springçš„æµ‹è¯•æ¨¡å—ï¼Œéœ€è¦å¯¼å…¥spring-teståŒ…</p>
</li>
<li>
<p><strong>å•å…ƒæµ‹è¯•Mybatis</strong></p>
<p>è®°å¾—åœ¨SpringIoCå®¹å™¨ä¸­æ·»åŠ mapperscannerconfigurerè¿™ä¸ªbeanï¼Œä¸ç„¶æ— æ³•ä½¿ç”¨daoå±‚é‡Œé¢çš„æ¥å£ï¼Œå› ä¸º<code>&lt;context:component-scan&gt;</code>æ‰«æä¸åŒ…æ‹¬daoå±‚ã€‚</p>
</li>
<li>
<p><strong>@Autowired</strong></p>
<p>springå¯ä»¥å®ç°æ§åˆ¶åè½¬ï¼Œå°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡é‡Œé¢æœ‰å±æ€§å‘¢ï¼Ÿé‚£å°±ç”¨æ³¨è§£@autowired ç›´æ¥æ³¨å…¥å±æ€§</p>
</li>
<li>
<p><strong>beanä½œç”¨åŸŸsingletonå’Œprototypeçš„åŒºåˆ«</strong></p>
<p>singletonï¼šå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¯¹è±¡ï¼›å•ä¾‹ä¹Ÿæ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆå°±æ˜¯åªæœ‰åœ¨è¯·æ±‚æ—¶å†ç”Ÿæˆï¼‰ï¼›</p>
<p>prototypeï¼šå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¸åˆ›å»ºå¯¹è±¡ï¼Œåªæ˜¯åœ¨æ¯æ¬¡ä½¿ç”¨æ—¶ï¼ˆæ¯æ¬¡å®¹å™¨è·å–å¯¹è±¡æ—¶ï¼‰å†åˆ›å»ºå¯¹è±¡ï¼›å¹¶ä¸”æ¯æ¬¡è·å–å¯¹è±¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›</p>
</li>
<li>
<p><strong>Beançš„ç”Ÿå‘½å‘¨æœŸä¸åŒäºIoCå®¹å™¨ç­‰çš„ç”Ÿå‘½å‘¨æœŸ</strong></p>
<p>Beançš„ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»ºâ€”åˆå§‹åŒ–ï¼ˆå®ä¾‹åŒ–ï¼‰â€”é”€æ¯</p>
<p>å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼šåˆå§‹åŒ–â€”ä½¿ç”¨â€”é”€æ¯</p>
</li>
<li>
<p><strong>å–ä½™æ–¹æ³•å¯ä»¥ç”¨æ¥ç­›é€‰æ•°</strong></p>
<p>æ¯”å¦‚ç­›é€‰â€œå°äº20â€çš„æ•°ï¼Œå°±å¯ä»¥ç”¨å–ä½™æ–¹æ³•ï¼Œæˆ‘æ˜¯åœ¨ä½¿ç”¨ä»»æ„å¯¹è±¡å–å€¼æ—¶é‡åˆ°çš„ï¼›å¦‚ä¸‹ï¼šint value = random.nextInt()%20</p>
</li>
<li>
<p><strong>randomå¯¹è±¡</strong></p>
<p>å–ä»»æ„å€¼çš„æ—¶å€™ï¼Œæ”¾åœ¨æ–¹æ³•é‡Œé¢çš„æ•°,æ¯”å¦‚valueï¼Œåªä¼šå–â€œ0åˆ°value-1â€è¿™ä¸ªèŒƒå›´çš„æ•°ã€‚</p>
</li>
<li>
<p><strong>graphicså¯¹è±¡</strong>ï¼ˆå›¾å½¢ä¸Šä¸‹æ–‡ï¼‰</p>
<p>graphicsæ˜¯å¯ä»¥ç”¨æ¥å¯¹å‡ ä½•å›¾å½¢çš„åæ ‡è½¬æ¢ï¼Œé¢œè‰²ç®¡ç†å’Œæ–‡æœ¬å¸ƒå±€çš„æ“ä½œçš„ã€‚æ¯”å¦‚åœ¨é‡Œé¢ç”»çº¿ç”»ç‚¹å†™å­—éƒ½å¯ä»¥ï¼Œæˆ‘æ˜¯ç”¨æ¥æ„å»ºéªŒè¯ç çš„ã€‚imageé€šè¿‡æ–¹æ³•getGraphics()å¯è·å–åˆ°è¿™ä¸ªå¯¹è±¡</p>
</li>
<li>
<p><strong>bufferimageå¯¹è±¡</strong></p>
<p>è¿™ä¸ªå¯¹è±¡åªæ˜¯imageå¯¹è±¡çš„å­ç±»ï¼Œä½†æ˜¯å¸¦æœ‰ç¼“å†²åŒºï¼Œå¯ä»¥è‡ªç”±çš„æ“ä½œä¿®æ”¹ï¼Œä¸€èˆ¬é€šè¿‡getGraphics()è·å–åˆ°å›¾å½¢çš„ä¸Šä¸‹æ–‡å¯¹è±¡åè¿›è¡Œå„ä¸ªæ–¹é¢çš„ä¿®æ”¹ã€‚</p>
</li>
<li>
<p><strong>ä¸Šä¼ æ–‡ä»¶</strong>â€“(ç›¸å…³åŒ…:common-fileupload.jar)</p>
<p>è¯·æ±‚requesté‡Œé¢æœ‰multipartFilesï¼Œä½†æ˜¯ï¼Œä¸€ç›´å–ä¸åˆ°é‡Œé¢çš„å€¼ï¼›ç„¶åé€šè¿‡debugçœ‹ï¼Œrequestlé‡Œé¢ä¸æ­¢æœ‰å®ƒå‘¢ï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šã€‚é€šè¿‡å°è£…å¯¹è±¡ï¼ŒæŠŠmultipartFileå°è£…åˆ°å¯¹è±¡newuserä¸­çš„å±æ€§(List<MultipartFile>)filesä¸­ï¼Œç„¶åè¿”å›newuserå€¼åè°ƒç”¨å®ƒçš„æ–¹æ³•è·å–files[0]ï¼Œå°±å¯ä»¥è·å–é‡Œé¢MultipartFileç±»å‹çš„å€¼;</p>
<p>å…³äºä¹‹å‰requesté‡Œé¢çš„å€¼,ä»”ç»†æŸ¥çœ‹è¿™ä¸ªrequestï¼Œå‘ç°å®ƒæ˜¯DefaultMultipartHttpServletRequest,æ‰€ä»¥åªè¦æŠŠè¯·æ±‚æ”¹ä¸ºå®ƒï¼Œå°±å¯ä»¥è·å–åˆ°é‡Œé¢çš„MultipartFilesäº†</p>
</li>
<li>
<p><strong>ä¸Šä¼ ä¸‹è½½è·¯å¾„è®¾ç½®</strong></p>
<p>åˆ©ç”¨è¯·æ±‚<code>request.getServletContext().getRealPath(&quot;/upload/&quot;);</code>è·å–åˆ°å¾—è¿™ä¸ªæ–‡ä»¶è·¯å¾„å¾ˆå¥‡æ€ªï¼Œç»“æœæ˜¯<code>C:\Users\llj\eclipse-workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\demo2\upload\</code>æ‰€ä»¥æˆ‘å½“åˆåœ¨é¡¹ç›®é‡Œé¢æ‰¾æ˜¯æ‰¾ä¸åˆ°çš„ï¼Œåé¢ä½¿ç”¨Stringç›´æ¥è®¾ç½®ï¼Œç®€å•æ˜äº†ï¼›</p>
</li>
<li>
<p><strong>ä¸‹è½½è¦ç‚¹</strong></p>
<p>ä¸‹è½½æ¯”ä¸Šä¼ å¤æ‚ç‚¹ï¼Œéƒ½è¦è®¾ç½®ContentTypeå’Œè¯·æ±‚å¤´çš„Content-Dispositionå±æ€§ï¼Œæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>æ³•ä¸€ï¼šç›´æ¥åœ¨å“åº”ä¸­è®¾ç½®æ–‡ä»¶ï¼Œéœ€è¦ä½¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•<em>Files.copy(è¦ä¸‹è½½çš„æ–‡ä»¶çš„è·¯å¾„,å“åº”çš„è¾“å‡ºæµ)</em></p>
<p>æ³•äºŒï¼šï¼ˆä½¿ç”¨Springæ¡†æ¶ï¼‰è¿”å›å€¼ä¸ºResponseEntity&lt;byte[]&gt;</p>
</li>
<li>
<p><strong>springé…ç½®redis</strong></p>
<p>ä½¿ç”¨1.8ç‰ˆæœ¬åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œé…ç½®redistemplateæ—¶ï¼Œç”¨jedisConnectionFactoryæ—¶ï¼Œå¯ä»¥ç›´æ¥é…ç½®ipå’Œportï¼Œpoolconfig;ä½†æ˜¯é«˜äº1.8ç‰ˆæœ¬æˆ‘å°±æ‰¾ä¸åˆ°è¿™ä¸ªä¸œè¥¿äº†</p>
</li>
<li>
<p><strong>å…³äºmaven pomæ–‡ä»¶ä¸­ scopeçš„åˆ†ç±»</strong></p>
<p>ç½‘å‹å…³äºè¿™äº›åˆ†ç±»çš„<a href="https://www.cnblogs.com/molao-doing/articles/Maven.html">è§£é‡Š</a></p>
<ul>
<li>é»˜è®¤æ˜¯<strong>compile</strong>ï¼Œè¡¨ç¤ºè¢«ä¾èµ–éœ€è¦å‚ä¸å½“å‰é¡¹ç›®çš„ç¼–è¯‘ï¼Œæµ‹è¯•ã€è¿è¡Œä¹Ÿä¸€æ ·å‚ä¸å…¶</li>
<li><strong>runtime</strong>è¡¨ç¤ºä¾èµ–åŒ…æ— éœ€å‚ä¸é¡¹ç›®çš„ç¼–è¯‘ï¼Œä½†æ˜¯æµ‹è¯•å’Œè¿è¡Œå‘¨æœŸå‚ä¸å…¶ä¸­ã€‚ï¼ˆä¹Ÿå°±æ˜¯è·³è¿‡ç¼–è¯‘ï¼‰</li>
<li><strong>test</strong>è¡¨ç¤ºåœ¨ä¸€èˆ¬çš„ç¼–è¯‘å’Œè¿è¡Œæ—¶éƒ½ä¸éœ€è¦ï¼Œåªæœ‰åœ¨æµ‹è¯•ç¼–è¯‘å’Œè¿è¡Œé˜¶æ®µæ‰ç”¨åˆ°ã€‚</li>
<li><strong>provided</strong>è¡¨ç¤ºè¯¥ä¾èµ–å·²ç»æä¾›ï¼Œæ—¨åœ¨æœªæä¾›æ—¶æ‰è¢«ä½¿ç”¨ã€‚</li>
<li><strong>system</strong>è¡¨ç¤ºè¯¥ä¾èµ–ä¸ä¼šä»mavenä»“åº“ä¸‹è½½ï¼Œè€Œæ˜¯ä»æœ¬åœ°ç³»ç»ŸæŒ‡å®šè·¯å¾„ä¸‹å¯»æ‰¾ã€‚</li>
<li><strong>import</strong>ä»…æ”¯æŒåœ¨<code>&lt;dependencyManagement&gt;</code>ä¸­çš„ç±»å‹ä¾èµ–é¡¹ä¸Šä½¿ç”¨ã€‚è¡¨ç¤ºè¦åœ¨æŒ‡å®šPOMä¸­ç”¨æœ‰æ•ˆçš„ä¾èµ–å…³ç³»åˆ—è¡¨æ›¿æ¢çš„ä¾èµ–å…³ç³»ã€‚</li>
</ul>
</li>
<li>
<p><strong>&lt;mvc:resource&gt;</strong></p>
<p>å‡ºç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ğŸ˜“ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„htmlæ–‡ä»¶è°ƒä¸äº†cssæ–‡ä»¶å‘¢ï¼Ÿbootstrapçš„cssæ–‡ä»¶å¯ä»¥è®¿é—®ï¼Œæˆ‘è‡ªå·±å†™çš„common.cssæ–‡ä»¶å°±ä¸è¡Œï¼Ÿè²Œä¼¼ä¸æ˜¯ï¼Œæˆ‘åœ¨servletå®¹å™¨ä¸­å®šä¹‰äº†<a href="mvc:default-servlet-handler">mvc:default-servlet-handler</a>äº†ï¼Œè€Œä¸”bootstrapçš„cssç­‰æ–‡ä»¶ä¹Ÿå¯ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯ä¸ºä½•å°±é‚£ä¸€ä¸ªæ–‡ä»¶è®¿é—®ä¸äº†ï¼Ÿå›¾ç‰‡ä¹Ÿè®¿é—®ä¸äº†</p>
<p>æ‰€ä»¥æˆ‘å°±åªèƒ½åœ¨åœ¨Servletå®¹å™¨ä¸­å†è®¾ç½®<code>&lt;mvc:resource&gt;</code>è¿™ä¸ªé™æ€èµ„æºç›´æ¥æ˜ å°„äº†ã€‚è¿™æ ·çš„è¯ï¼Œå°±éœ€è¦å…¨éƒ¨è®¾ç½®æˆ‘çš„é™æ€èµ„æºäº†ï¼Œä½†æ˜¯è¿™ä¸ª<code>&lt;mvc:resource&gt;</code>æœ‰ä¸ªå¥½å¤„ï¼Œå°±æ˜¯å®ƒå¯ä»¥è®¾ç½®åœ¨ä»»ä½•åœ°æ–¹ã€‚ä»»å›è®¾ç½®ã€‚</p>
</li>
</ol>
]]></content>
      <categories>
        <category>SSM</category>
      </categories>
      <tags>
        <tag>SSM</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaé™æ€ä»£ç†ä¸åŠ¨æ€ä»£ç†</title>
    <url>/2020/09/11/Java%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86%E4%B8%8E%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<h2 id="åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ">åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<ul>
<li>å…ˆç†è§£ä»£ç†ï¼Œé™æ€ä»£ç†ï¼Œåé¢æ‰èƒ½ç†è§£åŠ¨æ€ä»£ç†</li>
</ul>
<p>ä»£ç†å¯ä»¥æŠŠä»£è´­ğŸ›æ‹¿æ¥ç›¸æ¯”ï¼Œå°±æ˜¯é€šè¿‡ä»£è´­è®©ä½ è¦ä¹°æŸäº›ä¸œè¥¿æ—¶ï¼Œä¸ç”¨è‡ªå·±äº²è‡ªå»ï¼Œé¿å…å¾ˆå¤šæ­¥éª¤å’Œä¸å¿…è¦çš„éº»çƒ¦ã€‚<a id="more"></a>ä»£ç†å°±æ˜¯è¿™ä¹ˆå›äº‹ï¼Œæ¯”å¦‚ä½ è¦åšæŸäº›äº‹ï¼Œä½†æ˜¯å®Œæˆå®ƒï¼Œè¿‡ç¨‹æ¯”è¾ƒç¹çåˆéº»çƒ¦ğŸ’«ï¼Œè¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡ä»£ç†ï¼Œé¿è¿‡ä¸å¿…è¦çš„éº»çƒ¦æ¥è·å–å®ƒ</p>
<p>ä»£ç†éœ€è¦å…·å¤‡çš„ä¸œè¥¿ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/assets/img/%E4%BB%A3%E7%90%86%E5%92%8C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.png" alt="é™æ€ä»£ç†ç»“æ„å›¾"></p>
<p>ä»£ç†ç±»éœ€è¦åŒ…å«çœŸå®å¯¹è±¡ï¼ŒåŒæ—¶éœ€è¦å®ç°æ¥å£ï¼Œè¿™ä¸ªæ¥å£å°±æ˜¯æŸäº›çœŸå®å¯¹è±¡æƒ³è¦åšçš„äº‹ï¼Œå³æ–¹æ³•ï¼Œé€šè¿‡æ–¹æ³•åšæƒ³è¦åšçš„äº‹ï¼Œè¿™é‡Œæ‰€è®²çš„å°±æ˜¯<strong>é™æ€ä»£ç†</strong>çš„è§„åˆ™</p>
<p>ä½†æ˜¯<strong>é™æ€ä»£ç†</strong>æœ‰å…¶å¼Šç«¯ï¼Œå› ä¸ºå¦‚æœä½ è¦åšçš„äº‹æƒ…å¤šäº†ï¼Œå°±éœ€è¦ä¸æ–­å®ç°æ¥å£å’Œå¼•å…¥çœŸå®å¯¹è±¡ï¼Œè¿™æ ·çš„è¯ï¼Œä»£ç†ç±»å°±è¶Šæ¥è¶Šè†¨èƒ€ï¼Œé«˜è—•åˆã€‚ä¸å®¹æ˜“ç»´æŠ¤</p>
<p>è€Œ<strong>åŠ¨æ€ä»£ç†</strong>å°±æ˜¯è§£å†³é™æ€ä»£ç†çš„å¼Šç«¯çš„ï¼Œé€šè¿‡JDKçš„åŠ¨æ€ä»£ç†ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯<strong>proxy</strong>ï¼Œä¹Ÿå°±æ˜¯ä»£ç†ç±»ï¼Œåªè´Ÿè´£ç”Ÿæˆä»£ç†å¯¹è±¡ï¼›ä¸€ä¸ªæ˜¯<strong>InvocationHandler</strong>ï¼Œå®ƒçš„åŸå‹å…¶å®å°±æ˜¯é‚£ä¸ªæ¥å£ï¼Œå®ƒæœ‰ä¸€ä¸ª<code>invoke()</code>æ–¹æ³•,è¿™æ˜¯æ–¹æ³•å¯ä»¥ç»™çœŸå®å¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ä¸šåŠ¡å¢å¼ºï¼ˆæ„Ÿè§‰è¿™ä¸ªæ–¹æ³•å¯ä»¥è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥å®Œæˆä¸šåŠ¡å¢å¼ºåŠŸèƒ½ï¼‰ï¼›<code>invoke()</code>æ–¹æ³•é‡Œé¢æœ‰ä¸ªmethodå‚æ•°ï¼Œè¿™æ˜¯åˆ©ç”¨åå°„çš„åŸç†ï¼Œå› ä¸ºåˆšå¼€å§‹å¹¶ä¸çŸ¥é“ä»£ç†çš„æ˜¯ä»€ä¹ˆå¯¹è±¡ï¼Œæ‰€ä»¥ç”¨å¯¹è±¡çš„æ–¹æ³•æ¥è°ƒç”¨éœ€è¦ä¼˜åŒ–çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯<code>invoke()</code>æ–¹æ³•ã€‚è¿™é‡Œçš„<code>invoke()</code>æ–¹æ³•å…¶å®è¿˜æ˜¯ä¸å¤ªæ‡‚ğŸ˜­ğŸ˜­</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>Spring-AOP</title>
    <url>/2020/11/18/Spring-AOP/</url>
    <content><![CDATA[<h4 id="æœ¯è¯­ï¼š">æœ¯è¯­ï¼š</h4>
<p>é€šçŸ¥ï¼ˆadviceï¼‰ã€åˆ‡ç‚¹ï¼ˆpointcutï¼‰ã€è¿æ¥ç‚¹ï¼ˆjoinpointï¼‰ã€åˆ‡é¢ï¼ˆaspectï¼‰</p>
<ul>
<li>
<p>é€šçŸ¥ï¼šå°±æ˜¯åˆ‡é¢çš„å·¥ä½œï¼Œé€šçŸ¥å®šä¹‰äº†åˆ‡é¢æ˜¯ä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨ï¼ˆåº”ç”¨äºæŸä¸ªæ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰ï¼Ÿä¹‹åï¼Ÿä¹‹å‰å’Œ<a id="more"></a>ä¹‹åéƒ½è°ƒç”¨è¿˜æ˜¯åªæœ‰åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶è°ƒç”¨ï¼‰</p>
</li>
<li>
<p>è¿æ¥ç‚¹ï¼šåº”ç”¨å¯èƒ½æœ‰æ•°ä»¥åƒè®°çš„æ—¶æœºåº”ç”¨é€šçŸ¥ã€‚è¿™äº›æ—¶æœºè¢«ç§°ä¸ºè¿æ¥ç‚¹ã€‚è¿æ¥ç‚¹æ˜¯åœ¨åº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ’å…¥åˆ‡é¢çš„ä¸€ä¸ªç‚¹ã€‚è¿™ä¸ªç‚¹å¯ä»¥æ˜¯è°ƒç”¨æ–¹æ³•æ—¶ã€æŠ›å‡ºå¼‚å¸¸æ—¶ã€ç”šè‡³ä¿®æ”¹ä¸€ä¸ªå­—æ®µæ—¶ã€‚</p>
</li>
<li>
<p>åˆ‡ç‚¹ï¼šåˆ‡ç‚¹å®šä¹‰äº†åˆ‡é¢åœ¨<strong>ä½•å¤„</strong>ä½¿ç”¨ï¼Œåˆ‡ç‚¹çš„å®šä¹‰ä¼šåŒ¹é…é€šçŸ¥æ‰€è¦ç»‡å…¥çš„ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¿æ¥ç‚¹ã€‚ä¸€èˆ¬ç”¨æ˜ç¡®çš„ç±»å’Œæ–¹æ³•åç§°ï¼Œæˆ–è€…æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰æ‰€åŒ¹é…å¾—ç±»å’Œæ–¹æ³•åç§°æ¥æŒ‡å®šè¿™äº›åˆ‡ç‚¹ã€‚</p>
</li>
<li>
<p>åˆ‡é¢ï¼šåˆ‡é¢æ˜¯é€šçŸ¥å’Œåˆ‡ç‚¹å¾—ç»“åˆã€‚é€šçŸ¥å’Œåˆ‡ç‚¹å…±åŒå®šä¹‰äº†åˆ‡é¢å¾—å…¨éƒ¨å†…å®¹----å®ƒæ˜¯ä»€ä¹ˆï¼Œåœ¨ä½•æ—¶å’Œä½•å¤„å®Œæˆå…¶åŠŸèƒ½ã€‚</p>
</li>
</ul>
<h4 id="Springæä¾›äº†å››ç§ç±»å‹çš„AOPæ”¯æŒ">Springæä¾›äº†å››ç§ç±»å‹çš„AOPæ”¯æŒ</h4>
<ul>
<li>åŸºäºä»£ç†çš„ç»å…¸Spring AOPï¼ˆå·²å¼ƒç”¨ï¼‰</li>
<li>çº¯POJOåˆ‡é¢ï¼ˆå£°æ˜å¼AOPï¼‰</li>
<li>@AspectJæ³¨è§£é©±åŠ¨çš„åˆ‡é¢ï¼ˆåŸºäºæ³¨è§£çš„AOPï¼‰</li>
<li>æ³¨å…¥å¼AspectJåˆ‡é¢ï¼ˆé€‚ç”¨äºSpring å„ç‰ˆæœ¬ï¼Œéœ€è¦ç”¨åˆ°AspectJæ¥ç¼–å†™ï¼‰</li>
</ul>
<blockquote>
<p>SpringAOPæ„å»ºåœ¨åŠ¨æ€ä»£ç†åŸºç¡€ä¹‹ä¸Šï¼Œå› æ­¤ï¼ŒSpringå¯¹AOPçš„æ”¯æŒå±€é™äºæ–¹æ³•æ‹¦æˆª</p>
</blockquote>
<blockquote>
<p>SpringAOPå€ŸåŠ©äºAspectJï¼Œä½¿å¾—å®ƒçš„AOPç¼–å†™æ›´åŠ ç®€å•ï¼Œæ›´åŠ æ–¹ä¾¿ï¼Œè¿™é‡Œä¸æ˜¯ç”¨ä½¿ç”¨AspectJæ¥å†™åˆ‡é¢ï¼ˆAspectJæ˜¯Javaè¯­è¨€çš„æ‰©å±•ï¼Œå¹¶ä¸æ˜¯çº¯Javaè¯­è¨€ï¼‰ï¼Œåªæ˜¯ä½¿ç”¨AspectJæ¥é©±åŠ¨è€Œå·²ã€‚</p>
</blockquote>
<hr>
<h4 id="åŸºäºæ³¨è§£çš„AOP">åŸºäºæ³¨è§£çš„AOP</h4>
<ul>
<li><strong>AspectJåˆ‡é¢è¡¨è¾¾å¼</strong></li>
</ul>
<blockquote>
<p>åœ¨åˆ‡ç‚¹ä¸­å®šä¹‰</p>
</blockquote>
<p><img src="https://drek4537l1klr.cloudfront.net/walls5/Figures/04fig04.jpg" alt="img"></p>
<ul>
<li>
<p><strong>ä½¿ç”¨æ³¨è§£åˆ›å»ºåˆ‡é¢</strong></p>
<p><strong>ä½¿ç”¨æ³¨è§£æ¥å£°æ˜é€šçŸ¥æ–¹æ³•</strong></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">silenceCellPhones</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Silencing cell phones&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeSeats</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Taking seats&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@AfterReturning(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@AfterThrowing(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demandRefund</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Demanding a refund&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>é€šè¿‡ä½¿ç”¨@Pointcutæ³¨è§£å£°æ˜é¢‘ç¹ä½¿ç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterReturning;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performance</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;performance()&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">silenceCellPhones</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Silencing cell phones&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;performance()&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">takeSeats</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Taking seats&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@AfterReturning(&quot;performance()&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applause</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@AfterThrowing(&quot;performance()&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demandRefund</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Demanding a refund&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å°†åˆ‡é¢å£°æ˜ä¸ºSpringä¸­çš„bean</strong></li>
</ul>
<blockquote>
<p>åœ¨Javaconfigä¸­å¯ç”¨AspectJæ³¨è§£çš„è‡ªåŠ¨ä»£ç†-----@EnableAspectJAutoProxy</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.EnableAspectJAutoProxy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span>	</span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcertConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Audience <span class="title">audience</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Audience();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>åœ¨xmlä¸­å¯ç”¨AspectJæ³¨è§£</strong></li>
</ul>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">  xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">  xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">  xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span>	</span><br><span class="line">  xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;concert&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;aop:aspectj-autoproxy /&gt;	</span><br><span class="line"></span><br><span class="line">  &lt;bean <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;concert.Audience&quot;</span> /&gt;	</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>åˆ›å»ºç¯ç»•é€šçŸ¥</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> concert;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Around;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Audience</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution(** concert.Performance.perform(..))&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">performance</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Around(&quot;performance()&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">watchPerformance</span><span class="params">(ProceedingJoinPoint jp)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Silencing cell phones&quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;Taking seats&quot;</span>);</span><br><span class="line">      jp.proceed();</span><br><span class="line">      System.out.println(<span class="string">&quot;CLAP CLAP CLAP!!!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Demanding a refund&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å¤„ç†é€šçŸ¥ä¸­çš„å‚æ•°</strong></li>
</ul>
<blockquote>
<p>åˆ‡ç‚¹è¡¨è¾¾å¼å¯¼å…¥å‚æ•°</p>
</blockquote>
<p><img src="https://drek4537l1klr.cloudfront.net/walls5/Figures/04fig06_alt.jpg" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> soundsystem;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TrackCounter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Map&lt;Integer, Integer&gt; trackCounts =</span><br><span class="line">      <span class="keyword">new</span> HashMap&lt;Integer, Integer&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(</span></span><br><span class="line"><span class="meta">     &quot;execution(* soundsystem.CompactDisc.playTrack(int)) &quot; +	</span></span><br><span class="line"><span class="meta">     &quot;&amp;&amp; args(trackNumber)&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">trackPlayed</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;trackPlayed(trackNumber)&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">countTrack</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> currentCount = getPlayCount(trackNumber);</span><br><span class="line">    trackCounts.put(trackNumber, currentCount + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPlayCount</span><span class="params">(<span class="keyword">int</span> trackNumber)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> trackCounts.containsKey(trackNumber)</span><br><span class="line">        ? trackCounts.get(trackNumber) : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="åŸºäºxmlçš„AOP">åŸºäºxmlçš„AOP</h4>
<ul>
<li><strong>åˆ›å»ºåˆ‡é¢ï¼Œå£°æ˜é€šçŸ¥æ–¹æ³•</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span>	</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;silenceCellPhones&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;takeSeats&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;applause&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;demandRefund&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å£°æ˜é¢‘ç¹ä½¿ç”¨çš„åˆ‡ç‚¹è¡¨è¾¾å¼</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span>	</span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;silenceCellPhones&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;takeSeats&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;applause&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">method</span>=<span class="string">&quot;demandRefund&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>å£°æ˜ç¯ç»•é€šçŸ¥</strong></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;audience&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span></span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;execution(** concert.Performance.perform(..))&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span>	</span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut-ref</span>=<span class="string">&quot;performance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;watchPerformance&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¼•å…¥å‚æ•°å’Œå¼•å…¥æ–¹æ³•ç­‰ç­‰æ¯”è¾ƒé«˜çº§çš„åˆ‡é¢ï¼Œå’±å…ˆä¸è¯´äº†ï¼Œä»¥åæœ‰æœºä¼šå†è¯´å§</p>
</blockquote>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Springä¸JDBC</title>
    <url>/2020/11/18/Spring%E4%B8%8EJDBC/</url>
    <content><![CDATA[<p>JDBCçš„æ‰§è¡Œæµç¨‹ï¼š</p>
<p>é¦–å…ˆä½ å¾—å…ˆå®šä¹‰ä¸€æ¡squaryè¯­å¥ï¼Œç„¶åæ‰èƒ½å¤Ÿå¼€å§‹åé¢çš„è¯­å¥</p>
<ol>
<li>å¼•å…¥datasourceï¼Œé€šè¿‡datasourceè·å–ä¸€ä¸ªè¿æ¥</li>
<li>é€šè¿‡è¿™ä¸ªè¿æ¥ï¼Œå†è·å–ä¸€ä¸ªäº‹åŠ¡ï¼ˆä¸ºä½•è¦ç»è¿‡äº‹åŠ¡<a id="more"></a>ï¼Œæˆ‘æƒ³äº‹åŠ¡çš„å››ä¸ªæ€§è´¨å·²ç»è¯´çš„å¾ˆæ˜æ˜¾äº†ï¼‰</li>
<li>ç„¶ååœ¨äº‹åŠ¡ä¸­æ”¾å…¥ç›¸å…³çš„squaryè¯­å¥ï¼Œç„¶ååœ¨äº‹åŠ¡ä¸­å†è®¾ç½®å‚æ•°ç»‘å®š</li>
<li>æ‰§è¡Œäº‹åŠ¡</li>
<li>åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ•æ‰ä¸¤æ¬¡å¼‚å¸¸ï¼Œä¸€æ¬¡åœ¨æ’å…¥è®°å½•å‡ºé”™æ—¶æ•æ‰å®ƒï¼Œä¸€æ¬¡åœ¨éœ€è¦å…³é—­è¯­å¥å’Œè¿æ¥æ—¶æ•æ‰å®ƒã€‚</li>
</ol>
<p>ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SQL_INSERT_SPITTER =</span><br><span class="line"> <span class="string">&quot;insert into spitter (username, password, fullname) values (?, ?, ?)&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">  Connection conn = <span class="keyword">null</span>;</span><br><span class="line">  PreparedStatement stmt = <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    conn = dataSource.getConnection();	</span><br><span class="line">    stmt = conn.prepareStatement(SQL_INSERT_SPITTER);	</span><br><span class="line">    stmt.setString(<span class="number">1</span>, spitter.getUsername());	</span><br><span class="line">    stmt.setString(<span class="number">2</span>, spitter.getPassword());</span><br><span class="line">    stmt.setString(<span class="number">3</span>, spitter.getFullName());</span><br><span class="line">    stmt.execute();	</span><br><span class="line">  &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    <span class="comment">// do something...not sure what, though	</span></span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (stmt != <span class="keyword">null</span>) &#123;	</span><br><span class="line">        stmt.close();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">        conn.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">      <span class="comment">// I&#x27;m even less sure about what to do here</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½†æ˜¯JDBCæœ‰ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å®ƒåªèƒ½æ•æ‰åˆ°SQLExceptionå¼‚å¸¸ï¼Œå°±æ˜¯æ²¡åŠæ³•åˆ†ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æ˜¯æ•°æ®åº“æ–¹é¢å‡ºé—®é¢˜ï¼Œå°±ç›´æ¥æŠ›å‡ºSQLExceptionå¼‚å¸¸ï¼Œè€Œä¸ä¼šåˆ†ææ˜¯è¿æ¥å‡ºé”™ï¼Œè¿˜æ˜¯è¯­æ³•å‡ºé”™ç­‰ç­‰ç­‰ï¼Œè¿™æ ·ä½ å°±æ— æ³•çŸ¥é“åˆ°åº•æ˜¯å“ªé‡Œå‡ºé—®é¢˜</p>
<p>ä½†æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨Springçš„æ•°æ®è®¿é—®å¼‚å¸¸ï¼Œä»–å°±èƒ½å¤ŸæŠŠå¼‚å¸¸åˆ†é—¨åˆ«ç±»ï¼Œå‰ææ˜¯éœ€è¦ä½¿ç”¨Springæ‰€æ”¯æŒçš„æ•°æ®è®¿é—®æ¨¡æ¿</p>
</blockquote>
<p>ç”±æ­¤å‚¬ç”Ÿå‡ºäº†JDBCæ¨¡æ¿</p>
<table>
<thead>
<tr>
<th>æ¨¡æ¿ç±»ï¼ˆorg.springframework.*ï¼‰</th>
<th>ç”¨ã€€ã€€é€”</th>
</tr>
</thead>
<tbody>
<tr>
<td>jca.cci.core.CciTemplate</td>
<td>JCA CCIè¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.JdbcTemplate</td>
<td>JDBCè¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.namedparam.NamedParameterJdbcTemplate</td>
<td>æ”¯æŒå‘½åå‚æ•°çš„JDBCè¿æ¥</td>
</tr>
<tr>
<td>jdbc.core.simple.SimpleJdbcTemplate</td>
<td>é€šè¿‡Java 5ç®€åŒ–åçš„JDBCè¿æ¥ï¼ˆSpring 3.1ä¸­å·²ç»åºŸå¼ƒï¼‰</td>
</tr>
<tr>
<td>orm.hibernate3.HibernateTemplate</td>
<td>Hibernate 3.xä»¥ä¸Šçš„Session</td>
</tr>
<tr>
<td>orm.ibatis.SqlMapClientTemplate</td>
<td>iBATIS SqlMapå®¢æˆ·ç«¯</td>
</tr>
<tr>
<td>orm.jdo.JdoTemplate</td>
<td>Javaæ•°æ®å¯¹è±¡ï¼ˆJava Data Objectï¼‰å®ç°</td>
</tr>
<tr>
<td>orm.jpa.JpaTemplate</td>
<td>JavaæŒä¹…åŒ–APIçš„å®ä½“ç®¡ç†å™¨</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Spring æ”¯æŒçš„æ¨¡æ¿</p>
</blockquote>
<p>Springçš„JDBCæ¡†æ¶æ‰¿æ‹…äº†èµ„æºç®¡ç†å’Œå¼‚å¸¸å¤„ç†çš„å·¥ä½œï¼Œä»è€Œç®€åŒ–äº†JDBCä»£ç ï¼Œè®©æˆ‘ä»¬åªéœ€ç¼–å†™ä»æ•°æ®åº“è¯»å†™æ•°æ®çš„å¿…éœ€ä»£ç ã€‚</p>
<p>åªæœ‰åœ¨ä½ éœ€è¦ä½¿ç”¨å‘½åå‚æ•°çš„æ—¶å€™ï¼Œæ‰éœ€è¦ä½¿ç”¨<code>NamedParameterJdbcTemplate</code> ã€‚ï¼Œå¯¹äºå¤§å¤šæ•°çš„JDBCä»»åŠ¡æ¥è¯´ï¼Œ<code>JdbcTemplate</code> å°±æ˜¯æœ€å¥½çš„å¯é€‰æ–¹æ¡ˆ</p>
<p>ä¸ºäº†è®©<code>JdbcTemplate</code> æ­£å¸¸å·¥ä½œï¼Œåªéœ€è¦ä¸ºå…¶è®¾ç½®<code>DataSource</code> å°±å¯ä»¥äº†ï¼Œè¿™ä½¿å¾—åœ¨Springä¸­é…ç½®<code>JdbcTemplate</code> éå¸¸å®¹æ˜“</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ DataSourceæ˜¯é€šè¿‡æ„é€ å™¨å‚æ•°æ³¨å…¥è¿›æ¥çš„ã€‚è¿™é‡Œæ‰€å¼•ç”¨çš„dataSourcebeanå¯ä»¥æ˜¯javax.sql.DataSourceçš„ä»»æ„å®ç°</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†jdbcTemplateè£…é…åˆ°Repositoryä¸­å¹¶ä½¿ç”¨å®ƒæ¥è®¿é—®æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼ŒSpitterRepositoryä½¿ç”¨äº†JdbcTemplate ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdbcSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> JdbcOperations jdbcOperations;</span><br><span class="line">  <span class="meta">@Inject</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">JdbcSpitterRepository</span><span class="params">(JdbcOperations jdbcOperations)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.jdbcOperations = jdbcOperations;</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JdbcSpitterRepositoryç±»ä¸Šä½¿ç”¨äº†@Repositoryæ³¨è§£ï¼Œè¿™è¡¨æ˜å®ƒå°†ä¼šåœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚å®ƒçš„æ„é€ å™¨ä¸Šä½¿ç”¨äº†@Injectæ³¨è§£ï¼Œå› æ­¤åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è·å¾—ä¸€ä¸ªJdbcOperations å¯¹è±¡ã€‚ JdbcOperationsæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰äº†JdbcTemplateæ‰€å®ç°çš„æ“ä½œã€‚é€šè¿‡æ³¨å…¥JdbcOperationsï¼Œè€Œä¸æ˜¯å…·ä½“çš„JdbcTemplateï¼Œèƒ½å¤Ÿä¿è¯JdbcSpitterRepository é€šè¿‡ JdbcOperationsæ¥å£è¾¾åˆ°ä¸JdbcTemplateä¿æŒæ¾è€¦åˆã€‚</p>
<p>ä½œä¸ºå¦å¤–ä¸€ç§ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†JdbcSpitterRepositoryæ˜¾å¼å£°æ˜ä¸ºSpringä¸­çš„beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SpitterRepository <span class="title">spitterRepository</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> JdbcSpitterRepository(jdbcTemplate);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨Repositoryä¸­å…·å¤‡å¯ç”¨çš„JdbcTemplateåï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°ç®€åŒ–addSpitter()æ–¹æ³•ã€‚åŸºäºJdbcTemplate çš„ addSpitter()æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">    jdbcOperations.update(INSERT_SPITTER,	</span><br><span class="line"></span><br><span class="line">        spitter.getUsername(),</span><br><span class="line">        spitter.getPassword(),</span><br><span class="line">        spitter.getFullName(),</span><br><span class="line">        spitter.getEmail(),</span><br><span class="line">        spitter.isUpdateByEmail());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨JdbcTemplateæ¥è¯»å–æ•°æ®">ä½¿ç”¨JdbcTemplateæ¥è¯»å–æ•°æ®</h4>
<p>JdbcTemplateä¹Ÿç®€åŒ–äº†æ•°æ®çš„è¯»å–æ“ä½œã€‚ç¨‹åºæ¸…å•10.8å±•ç°äº†æ–°ç‰ˆæœ¬çš„findOne()æ–¹æ³•ï¼Œå®ƒä½¿ç”¨äº†JdbcTemplateçš„å›è°ƒï¼Œå®ç°æ ¹æ®IDæŸ¥è¯¢Spitterï¼Œå¹¶å°†ç»“æœé›†æ˜ å°„ä¸ºSpitter å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Spitter <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcOperations.queryForObject(	</span><br><span class="line">            SELECT_SPITTER_BY_ID, <span class="keyword">new</span> SpitterRowMapper(),</span><br><span class="line">            id	</span><br><span class="line">            );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterRowMapper</span></span></span><br><span class="line"><span class="class">                    <span class="keyword">implements</span> <span class="title">RowMapper</span>&lt;<span class="title">Spitter</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> Spitter <span class="title">mapRow</span><span class="params">(ResultSet rs, <span class="keyword">int</span> rowNum)</span></span></span><br><span class="line"><span class="function">                                   <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Spitter(	</span><br><span class="line">        rs.getLong(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;username&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;password&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;fullName&quot;</span>),</span><br><span class="line">        rs.getString(<span class="string">&quot;email&quot;</span>),</span><br><span class="line">        rs.getBoolean(<span class="string">&quot;updateByEmail&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ª findOne()æ–¹æ³•ä¸­ä½¿ç”¨äº†JdbcTemplate çš„ queryForObject()æ–¹æ³•æ¥ä»æ•°æ®åº“æŸ¥è¯¢Spitter ã€‚ queryForObject()æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>
<p>Stringå¯¹è±¡ï¼ŒåŒ…å«äº†è¦ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾æ•°æ®çš„SQLï¼›</p>
</li>
<li>
<p>RowMapperå¯¹è±¡ï¼Œç”¨æ¥ä»ResultSetä¸­æå–æ•°æ®å¹¶æ„å»ºåŸŸå¯¹è±¡ï¼ˆæœ¬ä¾‹ä¸­ä¸ºSpitter ï¼‰ï¼›</p>
</li>
<li>
<p>å¯å˜å‚æ•°åˆ—è¡¨ï¼Œåˆ—å‡ºäº†è¦ç»‘å®šåˆ°æŸ¥è¯¢ä¸Šçš„ç´¢å¼•å‚æ•°å€¼ã€‚</p>
</li>
</ul>
<p>çœŸæ­£å¥‡å¦™çš„äº‹æƒ…å‘ç”Ÿåœ¨SpitterRowMapperå¯¹è±¡ä¸­ï¼Œå®ƒå®ç°äº†RowMapperæ¥å£ã€‚å¯¹äºæŸ¥è¯¢è¿”å›çš„æ¯ä¸€è¡Œæ•°æ®ï¼ŒJdbcTemplate å°†ä¼šè°ƒç”¨ RowMapper çš„mapRow()æ–¹æ³•ï¼Œå¹¶ä¼ å…¥ä¸€ä¸ªResultSetå’ŒåŒ…å«è¡Œå·çš„æ•´æ•°ã€‚åœ¨SpitterRowMapper çš„ mapRow()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†Spitter å¯¹è±¡å¹¶å°† ResultSetä¸­çš„å€¼å¡«å……è¿›å»ã€‚</p>
<p>å°±åƒ addSpitter() é‚£æ ·ï¼Œ findOne()æ–¹æ³•ä¹Ÿä¸ç”¨å†™JDBCæ¨¡æ¿ä»£ç ã€‚ä¸åŒäºä¼ ç»Ÿçš„JDBCï¼Œè¿™é‡Œæ²¡æœ‰èµ„æºç®¡ç†æˆ–è€…å¼‚å¸¸å¤„ç†ä»£ç ã€‚ä½¿ç”¨JdbcTemplateçš„æ–¹æ³•åªéœ€å…³æ³¨äºå¦‚ä½•ä»æ•°æ®åº“ä¸­è·å–Spitterå¯¹è±¡å³å¯ã€‚</p>
<blockquote>
<p>è¿˜å¯ä»¥åœ¨JdbcTemplateä¸­ä½¿ç”¨Java 8çš„Lambdaè¡¨è¾¾å¼æˆ–è€…JAVA 8 çš„æ–¹æ³•å¼•ç”¨ï¼Œä½†æ˜¯æˆ‘ä¸æ‡‚Lambdaè¡¨è¾¾å¼ä¹Ÿä¸æ‡‚æ–¹æ³•å¼•ç”¨ğŸ˜‚</p>
</blockquote>
<h4 id="ä½¿ç”¨å‘½åå‚æ•°">ä½¿ç”¨å‘½åå‚æ•°</h4>
<p>ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒaddSpitter()æ–¹æ³•ä½¿ç”¨äº†ç´¢å¼•å‚æ•°ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ç•™æ„æŸ¥è¯¢ä¸­å‚æ•°çš„é¡ºåºï¼Œåœ¨å°†å€¼ä¼ é€’ç»™update()æ–¹æ³•çš„æ—¶å€™è¦ä¿æŒæ­£ç¡®çš„é¡ºåºã€‚å¦‚æœåœ¨ä¿®æ”¹SQLæ—¶æ›´æ”¹äº†å‚æ•°çš„é¡ºåºï¼Œé‚£æˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹å‚æ•°å€¼çš„é¡ºåºã€‚</p>
<p>é™¤äº†è¿™ç§æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å‘½åå‚æ•°ã€‚å‘½åå‚æ•°å¯ä»¥èµ‹äºˆSQLä¸­çš„æ¯ä¸ªå‚æ•°ä¸€ä¸ªæ˜ç¡®çš„åå­—ï¼Œåœ¨ç»‘å®šå€¼åˆ°æŸ¥è¯¢è¯­å¥çš„æ—¶å€™å°±é€šè¿‡è¯¥åå­—æ¥å¼•ç”¨å‚æ•°ã€‚</p>
<p>NamedParameterJdbcTemplateæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„JDBCæ¨¡æ¿ç±»ï¼Œå®ƒæ”¯æŒä½¿ç”¨å‘½åå‚æ•°ã€‚åœ¨Springä¸­ï¼ŒNamedParameterJdbcTemplateçš„å£°æ˜æ–¹å¼ä¸å¸¸è§„çš„JdbcTemplateå‡ ä¹å®Œå…¨ç›¸åŒï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> NamedParameterJdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> NamedParameterJdbcTemplate(dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†NamedParameterJdbcOperations ï¼ˆ NamedParameterJdbcTemplateæ‰€å®ç°çš„æ¥å£ï¼‰æ³¨å…¥åˆ°Repositoryä¸­ï¼Œç”¨å®ƒæ¥æ›¿ä»£JdbcOperations ã€‚ç°åœ¨çš„ addSpitter()æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String INSERT_SPITTER =</span><br><span class="line">        <span class="string">&quot;insert into Spitter &quot;</span> +</span><br><span class="line">        <span class="string">&quot; (username, password, fullname, email, updateByEmail) &quot;</span> +</span><br><span class="line">        <span class="string">&quot;values &quot;</span> +</span><br><span class="line">        <span class="string">&quot; (:username, :password, :fullname, :email, :updateByEmail)&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    paramMap.put(<span class="string">&quot;username&quot;</span>, spitter.getUsername());	</span><br><span class="line">    paramMap.put(<span class="string">&quot;password&quot;</span>, spitter.getPassword());</span><br><span class="line">    paramMap.put(<span class="string">&quot;fullname&quot;</span>, spitter.getFullName());</span><br><span class="line">    paramMap.put(<span class="string">&quot;email&quot;</span>, spitter.getEmail());</span><br><span class="line">    paramMap.put(<span class="string">&quot;updateByEmail&quot;</span>, spitter.isUpdateByEmail());</span><br><span class="line"></span><br><span class="line">    jdbcOperations.update(INSERT_SPITTER, paramMap);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring æ³¨è§£åˆ†æ</title>
    <url>/2020/09/04/Spring-%E6%B3%A8%E8%A7%A3%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h3 id="Autowired">@Autowired</h3>
<p>ğŸƒ<code>Spring</code>å¯ä»¥å®ç°æ§åˆ¶åè½¬ï¼Œå°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡é‡Œé¢æœ‰å±æ€§å‘¢ï¼Ÿé‚£å°±ç”¨æ³¨è§£<code>@autowired </code>ç›´æ¥æ³¨å…¥å±æ€§(å®ä¾‹åŒ–çš„å¯¹è±¡)ï¼Œè¿™æ ·å°±å®ç°äº†è§£è€¦ğŸ™‰ï¼Œ<code>Controllerã€Serviceã€Dao</code>ç­‰åˆ†å±‚å°±æ˜¯åŸºäºæ­¤ã€‚</p>
<ul>
<li><code>bean</code>ä½œç”¨åŸŸ<code>singleton</code>å’Œ<code>prototype</code>çš„åŒºåˆ«</li>
</ul>
<p><code>singleton</code>ï¼šå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶ï¼Œå°±ä¼šåˆ›å»ºå¯¹è±¡ï¼›å•ä¾‹ä¹Ÿæ”¯æŒå»¶è¿ŸåŠ è½½ï¼ˆå°±æ˜¯åªæœ‰åœ¨è¯·æ±‚æ—¶å†ç”Ÿæˆï¼‰ï¼›</p>
<a id="more"></a>
<p><code>prototype</code>ï¼šå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¸åˆ›å»ºå¯¹è±¡ï¼Œåªæ˜¯åœ¨æ¯æ¬¡ä½¿ç”¨æ—¶ï¼ˆæ¯æ¬¡å®¹å™¨è·å–å¯¹è±¡æ—¶ï¼‰å†åˆ›å»ºå¯¹è±¡ï¼›å¹¶ä¸”æ¯æ¬¡è·å–å¯¹è±¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼›</p>
<blockquote>
<p><code>@Resource</code>â€”å®ƒå…¶å®è·Ÿ<code>@Autowired</code>æ•ˆæœä¸€æ ·ï¼Œåªä¸è¿‡å®ƒæ˜¯æ ¹æ®<code>name</code>æ¥æ³¨å…¥å®ä¾‹åŒ–å¯¹è±¡çš„ï¼Œè€ŒAutowiredåˆ™æ ¹æ®<code>id</code></p>
</blockquote>
<hr>
<h3 id="ResponseBody">@ResponseBody</h3>
<p><code>@responseBody</code>æ³¨è§£çš„ä½œç”¨æ˜¯å°†<code>controller</code>ä¸­çš„æ–¹æ³•è¿”å›çš„æ•°æ®ï¼Œé€šè¿‡é€‚å½“çš„è½¬æ¢å™¨è½¬æ¢ä¸ºæŒ‡å®šçš„æ ¼å¼ä¹‹åï¼Œå†™å…¥åˆ°<code>response</code>å¯¹è±¡çš„<code>body</code>åŒºï¼Œé€šå¸¸ç”¨æ¥è¿”å›<code>JSON</code>æ•°æ®æˆ–è€…æ˜¯<code>XML</code>æ•°æ®ğŸ˜µ</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨æ­¤æ³¨è§£ä¹‹åä¸ä¼šå†èµ°<strong>è§†å›¾å¤„ç†å™¨</strong>è¿™ä¸ªæµç¨‹ï¼Œè€Œæ˜¯ç›´æ¥å°†æ•°æ®å†™å…¥åˆ°<strong>è¾“å…¥æµ</strong>ä¸­ğŸ˜ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¿”å›æ•°æ®è€Œä¸æ˜¯é¡µé¢ï¼Œä»–çš„æ•ˆæœç­‰åŒäºé€šè¿‡<code>response</code>å¯¹è±¡è¾“å‡ºæŒ‡å®šæ ¼å¼çš„æ•°æ®ã€‚</p>
<hr>
<h3 id="æµ‹è¯•ä¸‰ä»¶å¥—ğŸ‘º">æµ‹è¯•ä¸‰ä»¶å¥—ğŸ‘º</h3>
<h4 id="Testã€-ContextConfigurationã€-Runwith"><em>@Testã€@ContextConfigurationã€@Runwith</em></h4>
<p>æˆ‘æƒ³ä½¿ç”¨<code>@Test</code>æµ‹è¯•æ¥å®Œæˆæ³¨è§£å½¢å¼çš„<code>SpringIoC</code>ï¼Œä½†æ˜¯æµ‹è¯•æ— æ³•å®ç°ï¼Œä½¿ç”¨<code>Java Application</code>å°±å¯ä»¥å®ç°ï¼åŸæ¥æµ‹è¯•åˆå§‹åŒ–IoCå®¹å™¨å¯ä»¥ç”¨<code>@ContextConfiguration</code>è¿™ä¸ªæ³¨è§£ï¼Œä¸ç®¡æ˜¯<code>XML</code>å½¢å¼è¿˜æ˜¯æ³¨è§£å½¢å¼çš„IoCå®¹å™¨ã€‚</p>
<p><code>@ContextConfiguration</code>å’Œ<code>@Runwith</code>äºŒè€…ä¸€èˆ¬ä¸åˆ†å¼€ï¼Œä¸€ä¸ªæ˜¯ç”¨äºå¯¼å…¥æµ‹è¯•ä½¿ç”¨çš„æµ‹è¯•åº“å‡½æ•°ï¼Œä¸€ä¸ªç”¨äºåŠ è½½é…ç½®æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯åŠ è½½é…ç½®<code>XML</code>æ–‡ä»¶æˆ–è€…<code>Javaæ–‡ä»¶</code>ï¼ˆä½¿ç”¨<code>@Configuration</code>æ ‡æ³¨é…ç½®<code>java</code>ç±»æ–‡ä»¶ï¼‰ï¼Œç”¨ä»¥å¯¼å…¥æŸäº›<code>Spring</code>å®¹å™¨çš„<code>bean</code>å¯¹è±¡ã€‚</p>
<blockquote>
<p>è¯¦æƒ…è¯·çœ‹ï¼š<strong>/demo2/src/main/java/cn/lj/test/addusertest.java</strong>ğŸ¾</p>
</blockquote>
<p>å¦‚æœéœ€è¦åŠ è½½springå®¹å™¨ï¼Œå¯ä»¥åœ¨<code>@ContextConfiguration</code>ä¸­åŠ è½½<code>Spring</code>å®¹å™¨åï¼Œç”¨äºå®ä¾‹åŒ–<code>Springå®¹å™¨</code>å¯¹è±¡</p>
<blockquote>
<p>ç¤ºä¾‹ï¼š/wx/src/main/java/cn.lj.wx.utils.CreateUtilsæ–¹æ³•ğŸ¾</p>
</blockquote>
<hr>
<h3 id="Component">@Component</h3>
<p>æ–°å»ºä¸€ä¸ª<code>Utils</code>ç±»ğŸ¸ï¼Œæœ‰ä¸ªå±æ€§<code>token</code>å’Œä¸¤ä¸ªæ–¹æ³•ï¼Œåœ¨å…¶ä»–ç±»é€šè¿‡<code>@Autowired</code>æ³¨å…¥è¿™ä¸ªç±»å¯¹è±¡æ—¶ï¼Œä¸€ç›´æŠ¥æ²¡æœ‰è¿™ä¸ªbeanå¯¹è±¡ï¼Œå¾ˆå¥‡æ€ªï¼Œæœ€åæŠŠå±æ€§tokenå»æ‰å°±å¯ä»¥äº†ã€‚åŸæ¥åœ¨å¼•å…¥<code>bean</code>å¯¹è±¡æ—¶ï¼Œéœ€è¦é…ç½®å¥½ä»–çš„å±æ€§ï¼Œæ‰€ä»¥åªè¦å±æ€§è®¾ç½®å¥½<code>Getter/Setter</code>æ–¹æ³•å°±å¯ä»¥ä½¿ç”¨<code>Autowired</code>è‡ªåŠ¨è£…é…äº†</p>
<p>æœ€å¥½è¿˜æ˜¯ä¸è¦è®¾ç½®å±æ€§å§ğŸ’…ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨<code>@Autowired</code>æˆ–<code>@Resource</code>æ³¨å…¥å±æ€§(è·Ÿ<code>Controller</code>ã€<code>Service</code>ä¸€æ ·)ï¼Œå°±å¯ä»¥ç›´æ¥æŠŠè¿™ä¸ªç±»è®¾ä¸º<code>component</code>ç±»ï¼Œè®©å…¶ä»–ç±»å¯ä»¥è°ƒç”¨ã€‚</p>
<hr>
<h3 id="Dataã€-Getter">@Dataã€@Getter</h3>
<p>çœç•¥å¯¹è±¡get/setæ–¹æ³•çš„ç¼–å†™ï¼Œçœç•¥æ— å‚æ„é€ å‡½æ•°çš„ç¼–å†™ï¼Œæ€ä¹ˆåšåˆ°å‘¢ï¼Ÿé‚£å½“ç„¶è¦ä½¿ç”¨<span class="ljspan ljspan-blue"><a href="https://objectcomputing.com/resources/publications/sett/january-2010-reducing-boilerplate-code-with-project-lombok">lombok</a></span></p>
<h4 id="é…ç½®">é…ç½®</h4>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ³¨è§£Get/Setç­‰æ–¹æ³• --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä¸‹è½½å®‰è£…lombokçš„æ’ä»¶">ä¸‹è½½å®‰è£…<code>lombok</code>çš„æ’ä»¶</h4>
<p>å…¶å®å°±æ˜¯ä¸‹è½½<span class="ljspan ljspan-blue"><a href="https://projectlombok.org/all-versions">lombok.jar</a></span>åï¼Œæ‰“å¼€å®ƒï¼Œå¼¹å‡ºå®‰è£…ç•Œé¢ï¼Œç„¶ååœ¨æ‰“å¼€çš„ç•Œé¢ä¸­æŒ‡å®šä½ çš„eclipseå®‰è£…çš„æ ¹ç›®å½•åå®‰è£…/æ›´æ–°ï¼Œæœ€åå®‰è£…å®Œæˆä¹‹åï¼Œè¯·ç¡®è®¤eclipseå®‰è£…è·¯å¾„ä¸‹æ˜¯å¦å¤šäº†ä¸€ä¸ªlombok.jaråŒ…ï¼Œå¹¶ä¸”å…¶é…ç½®æ–‡ä»¶eclipse.iniä¸­æ˜¯å¦ æ·»åŠ äº†å¦‚ä¸‹å†…å®¹:-javaagent:path\to\lombok.jar</p>
<p>å…·ä½“æ“ä½œæ­¥éª¤å¯<a href="https://www.cnblogs.com/boonya/p/10691466.html">å‚è€ƒåšä¸»</a>çš„å®‰è£…æ­¥éª¤</p>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>SSM</tag>
        <tag>annotation</tag>
      </tags>
  </entry>
  <entry>
    <title>Tomcatçš„ä¸‹è½½å’Œé…ç½®</title>
    <url>/2020/09/08/Tomcat%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>åœ¨Linuxä¸Šå®‰è£…tomcatï¼Œå…¶å®è·Ÿwindowä¸€æ ·ï¼Œé…ç½®JDKã€é…ç½®ç¯å¢ƒå˜é‡ç­‰ç­‰ï¼Œåªä¸è¿‡é…ç½®è·¯å¾„å’Œæ–‡ä»¶åä¸åŒè€Œå·²ğŸ˜˜</p>
<a id="more"></a>
<hr>
<h3 id="ä¸‹è½½é…ç½®jdk">ä¸‹è½½é…ç½®jdk</h3>
<p>å¾ˆéš¾ï¼Œè¯•è¿‡ç”¨apt-get/aptä½¿ç”¨ppaæºå®‰è£…ï¼Œå¤±è´¥ï¼›ä½¿ç”¨ç³»ç»Ÿæ¨èçš„openjdkå®‰è£…ä¹Ÿå¤±è´¥ï¼›æœ€ååªèƒ½é‡‡ç”¨ä¸‹è½½binæ¥è§£å‹å®‰è£…ï¼Œæ‰èƒ½æˆåŠŸ</p>
<div class="note default">
            <h4 id="Note">Note:</h4><p>åœ¨oracleå®˜ç½‘ä¸‹è½½jdkæ—¶ï¼Œå¯ä»¥ç›´æ¥æœç´¢jdk archiveæ¥ä¸‹è½½ï¼Œä¸è¿‡éœ€è¦ç™»é™†oracleè´¦å·ï¼</p>
          </div>
<blockquote>
<p>å®‰è£…å¥½jdkéœ€è¦é…ç½®å¥½ç¯å¢ƒå˜é‡</p>
</blockquote>
<p>å¦‚æœåªæƒ³é…ç½®ç”¨æˆ·å˜é‡ï¼Œå°±åœ¨æ–‡ä»¶~/.bashrcä¸­</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME=/path/to/java</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> PATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³ç›´æ¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡é‚£ä¾¿æŠŠä¸Šé¢çš„è®¾ç½®æ·»åŠ åˆ°/etc/profileæ–‡ä»¶ä¸­</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æµ‹è¯•javaæ˜¯å¦å®‰è£…é…ç½®å®Œæˆ</span></span><br><span class="line"><span class="variable">$java</span> -version</span><br><span class="line">openjdk version <span class="string">&quot;1.8.0_252&quot;</span></span><br><span class="line">OpenJDK Runtime Environment (build 1.8.0_252-8u252-b09-1~16.04-b09)</span><br><span class="line">OpenJDK 64-Bit Server VM (build 25.252-b09, mixed mode)</span><br><span class="line"><span class="comment">#æœ‰ä¸Šé¢çš„æ–‡æ®µè¯æ˜å®‰è£…å®Œæˆ</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="ä¸‹è½½é…ç½®tomcat">ä¸‹è½½é…ç½®tomcat</h3>
<p>é…ç½®æ•™ç¨‹åœ¨<a href="https://blog.csdn.net/jenyzhang/article/details/70159769">è¿™é‡Œ</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">tar -xzvf apache-tomcat.xxx.tar.gz</span><br><span class="line"><span class="comment">#é…ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">vim ~/.bashrc</span><br><span class="line"><span class="comment">#tomcat</span></span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/path/to/tomcat </span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨tomcat</span></span><br><span class="line"><span class="built_in">cd</span> /path/to/tomcat</span><br><span class="line">./bin/startup.sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•tomcaté…ç½®æˆåŠŸä¸å¦,ç”¨æµè§ˆå™¨ç™»å½•ä¸‹çœ‹çœ‹</span></span><br><span class="line">http://localhost:8080</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé…ç½®å®‰è£…çš„tomcatè¿˜ä¸æ˜¯å¾ˆå®Œæ•´ï¼Œæ¯”å¦‚è¯´ï¼Œæ²¡æœ‰æœåŠ¡ï¼Œæ¯æ¬¡å¼€æœºéƒ½å»tomcatæ–‡ä»¶å¤¹å»æ‰¾ï¼Œå¾ˆéº»çƒ¦ï¼Œè€Œä¸”æœ‰äº›è½¯ä»¶éœ€è¦ä½¿ç”¨åˆ°systemctlæ¥å¯åŠ¨tomcatæœåŠ¡ï¼Œæ¯”å¦‚OpenElis</p>
<p>è§£å†³åŠæ³•ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/tomcatç›®å½•</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹startup.sh</span></span><br><span class="line"></span><br><span class="line">vim ./startup.sh</span><br><span class="line"><span class="comment">#æ·»åŠ å¦‚ä¸‹</span></span><br><span class="line"><span class="comment">#set java environment</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/path/to/java</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#tomcat</span></span><br><span class="line"><span class="built_in">export</span> TOMCAT_HOME=/path/to/tomcat</span><br><span class="line"><span class="built_in">exec</span> <span class="string">&quot;<span class="variable">$PRGDIR</span>&quot;</span>/<span class="string">&quot;<span class="variable">$EXECUTABLE</span>&quot;</span> start <span class="string">&quot;<span class="variable">$@</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨å†ŒtomcatæœåŠ¡</span></span><br><span class="line">sudo cp /path/to/tomcat/bin/catalina.sh /etc/init.d/tomcat</span><br><span class="line"><span class="comment">#ä¿®æ”¹catalina.sh</span></span><br><span class="line">vim catalina.sh</span><br><span class="line"><span class="comment">#æ·»åŠ å¦‚ä¸‹</span></span><br><span class="line">JAVA_HOME=/usr/lib/jvm/javaç›®å½•</span><br><span class="line">CATALINA_HOME=/path/to/tomcat</span><br><span class="line"></span><br><span class="line">åœ¨<span class="comment">#!/bash/shä¸‹æ–¹ç›´æ¥æ·»åŠ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">### BEGIN INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Provides:          tomcat</span></span><br><span class="line"><span class="comment"># Required-Start:Â Â Â  $remote_fs $network</span></span><br><span class="line"><span class="comment"># Required-Stop:Â Â Â Â  $remote_fs $network</span></span><br><span class="line"><span class="comment"># Default-Start:Â Â Â Â  2 3 4 5</span></span><br><span class="line"><span class="comment"># Default-Stop:Â Â Â Â Â  0 1 6</span></span><br><span class="line"><span class="comment"># Short-Description: The tomcat Java Application Server</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### END INIT INFO</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°æ³¨å†ŒtomcatæœåŠ¡</span></span><br><span class="line">sudo update-rc.d tomcat defaults</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç°åœ¨å°±å¯ä»¥ä½¿ç”¨tomcatæœåŠ¡äº†</span></span><br><span class="line">sudo systemctl status tomcat </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>tomcat</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu18.04è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</title>
    <url>/2020/09/08/Ubuntu18-04%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8/</url>
    <content><![CDATA[<div class="note info">
            <h4 id="Note1">Note1:</h4><p>ç”±äºæ–°ç‰ˆubuntuä¸å†ä½¿ç”¨<strong>initd</strong>ç®¡ç†ç³»ç»Ÿï¼Œè€Œæ”¹ç”¨<strong>systemd</strong>;</p><p>æ•…ç”¨systemctlå‘½ä»¤æ¥æ›¿æ¢äº†<strong>service</strong>å’Œ<strong>chkconfig</strong>çš„åŠŸèƒ½</p><p>ç³»ç»Ÿå¼€æœºå¯åŠ¨ï¼Œsystemdé»˜è®¤è¯»å–<code>/etc/systemd/system</code>ä¸‹çš„é…ç½®/è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šé“¾æ¥<code>lib/systemd/system/</code>ä¸‹çš„æ–‡ä»¶</p>
          </div>
<a id="more"></a>
<div class="note info">
            <h4 id="Note2">Note2:</h4><p>shçš„è„šæœ¬ï¼Œè„šæœ¬å¼€å¤´çš„#!+shellï¼Œè¿™é‡Œçš„shellä¸€èˆ¬æœ‰shå’Œbashï¼Œè€Œshå…¶å®æ˜¯â€˜bash --posixâ€™çš„å˜ä½“ï¼ŒäºŒè€…æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¹ˆçœ‹æ¥ï¼Œshå…¶å®æ˜¯bashçš„ä¸€ç§æ ‡å‡†ğŸ˜³</p>
          </div>
<h2 id="å¼€å§‹é…ç½®">å¼€å§‹é…ç½®</h2>
<blockquote>
<p>æˆ‘çš„è‡ªå®šä¹‰å¯åŠ¨æ–‡ä»¶æ˜¯rc-local.serviceï¼Œç›´æ¥ä¿®æ”¹å®ƒ</p>
</blockquote>
<h4 id="é…ç½®rc-local-service">é…ç½®rc-local.service</h4>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">  SPDX-License-Identifier: LGPL-2.1+</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  This file is part of systemd.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  systemd is free software; you can redistribute it and/or modify it</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This unit gets pulled automatically into multi-user.target by</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemd-rc-local-generator <span class="keyword">if</span> /etc/rc.local is executable.</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=/etc/rc.local Compatibility</span><br><span class="line">Documentation=man:systemd-rc-local-generator(8)</span><br><span class="line">ConditionFileIsExecutable=/etc/rc.local</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/rc.local start</span><br><span class="line">TimeoutSec=0</span><br><span class="line">RemainAfterExit=yes</span><br><span class="line">GuessMainPID=no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è¿™é‡Œæ˜¯éœ€è¦æ·»åŠ çš„éƒ¨åˆ†</span></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">Alias=rc-local.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æ­£å¸¸çš„å¯åŠ¨æ–‡ä»¶ä¸»è¦åˆ†æˆä¸‰éƒ¨åˆ†ğŸ’¦</p>
<p><em>[Unit]</em> æ®µ: <span class="label info">å¯åŠ¨é¡ºåºä¸ä¾èµ–å…³ç³»</span></p>
<p><em>[Service]</em> æ®µ: <span class="label warning">å¯åŠ¨è¡Œä¸º,å¦‚ä½•å¯åŠ¨,å¯åŠ¨ç±»å‹</span></p>
<p><em>[Install]</em> æ®µ: å®šä¹‰å¦‚ä½•å®‰è£…è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œå³<span class="label success">æ€æ ·åšåˆ°å¼€æœºå¯åŠ¨</span></p>
<h4 id="é…ç½®rc-local">é…ç½®rc.local</h4>
<p>Ubuntu18.04é»˜è®¤æ²¡æœ‰<code>/etc/rc.local</code>è¿™ä¸ªæ–‡ä»¶ï¼Œéœ€è¦è‡ªå·±åˆ›å»º</p>
<p>å¦‚ä¸‹ğŸ‘‡ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/bin/sh -e</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># rc.local</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This script is executed at the end of each multiuser runlevel.</span></span><br><span class="line"><span class="comment"># Make sure that the script will &quot;exit 0&quot; on success or any other</span></span><br><span class="line"><span class="comment"># value on error.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># In order to enable or disable this script just change the execution</span></span><br><span class="line"><span class="comment"># bits.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># By default this script does nothing.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;this just a test&quot;</span> &gt; /home/luoj/testdir/text.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨">è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æ·»åŠ å¯æ‰§è¡Œæƒé™</span></span><br><span class="line">sudo chmod +x /etc/rc.local</span><br><span class="line"><span class="comment">#æ·»åŠ rc-local.serviceè½¯è¿æ¥åˆ°/etc/systemd/system</span></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> rc-local</span><br><span class="line"><span class="comment">#å¯åŠ¨è¿™ä¸ªæœåŠ¡</span></span><br><span class="line">sudo systemctl start rc-local.service</span><br><span class="line"><span class="comment">#æŸ¥çœ‹è¿™ä¸ªæœåŠ¡</span></span><br><span class="line">sudo systemctl status rc-local.service</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>apt-getç”¨æ³•</title>
    <url>/2020/09/08/apt-get%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>apt-getæ˜¯ubuntuç­‰ç³»ç»Ÿç‹¬æœ‰çš„ä¸€ä¸ªè½¯ä»¶åŒ…å®‰è£…å·¥å…·ï¼Œaptå…¶å®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡ï¼Œæˆ‘ä¹ æƒ¯ç”¨apt-getã€‚ä¸é€‚ç”¨äºcentoså“¦ï¼ğŸ’</p>
<a id="more"></a>
<h2 id="å‘½ä»¤ï¼š">å‘½ä»¤ï¼š</h2>
<blockquote>
<p>ä¸‹åˆ—æ˜¯apt-getçš„å‘½ä»¤é€‰é¡¹</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">update - å–å›æ›´æ–°çš„è½¯ä»¶åŒ…åˆ—è¡¨ä¿¡æ¯     **<span class="comment">#åªæ£€æŸ¥æ›´æ–°è½¯ä»¶åŒ…ï¼Œä¸æ›´æ–°è½¯ä»¶**</span></span><br><span class="line"></span><br><span class="line">upgrade - è¿›è¡Œä¸€æ¬¡å‡çº§   **<span class="comment">#çœŸæ­£çš„æ›´æ–°è½¯ä»¶**</span></span><br><span class="line"></span><br><span class="line">install - å®‰è£…æ–°çš„è½¯ä»¶åŒ…(æ³¨ï¼šè½¯ä»¶åŒ…åç§°æ˜¯ libc6 è€Œé libc6.deb)</span><br><span class="line"></span><br><span class="line">remove - å¸è½½è½¯ä»¶åŒ…</span><br><span class="line"></span><br><span class="line">autoremove - å¸è½½æ‰€æœ‰è‡ªåŠ¨å®‰è£…ä¸”ä¸å†ä½¿ç”¨çš„è½¯ä»¶åŒ…</span><br><span class="line"></span><br><span class="line">purge - å¸è½½å¹¶æ¸…é™¤è½¯ä»¶åŒ…çš„é…ç½®</span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> - ä¸‹è½½æºç åŒ…æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">build-dep - ä¸ºæºç åŒ…é…ç½®æ‰€éœ€çš„ç¼–è¯‘ä¾èµ–å…³ç³»</span><br><span class="line"></span><br><span class="line">dist-upgrade - å‘å¸ƒç‰ˆå‡çº§ï¼Œè§ apt-get(8)</span><br><span class="line"></span><br><span class="line">dselect-upgrade - æ ¹æ® dselect çš„é€‰æ‹©æ¥è¿›è¡Œå‡çº§</span><br><span class="line"></span><br><span class="line">clean - åˆ é™¤æ‰€æœ‰å·²ä¸‹è½½çš„åŒ…æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">autoclean - åˆ é™¤å·²ä¸‹è½½çš„æ—§åŒ…æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">check - æ ¸å¯¹ä»¥ç¡®è®¤ç³»ç»Ÿçš„ä¾èµ–å…³ç³»çš„å®Œæ•´æ€§</span><br><span class="line"></span><br><span class="line">changelog - ä¸‹è½½æŒ‡å®šè½¯ä»¶åŒ…ï¼Œå¹¶æ˜¾ç¤ºå…¶changelog</span><br><span class="line"></span><br><span class="line">download - ä¸‹è½½æŒ‡å®šçš„äºŒè¿›åˆ¶åŒ…åˆ°å½“å‰ç›®å½•</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="é’ˆå¯¹apt-getå®‰è£…è½¯ä»¶å¤±è´¥ï¼Œç½‘é€Ÿæ…¢çš„é—®é¢˜">é’ˆå¯¹apt-getå®‰è£…è½¯ä»¶å¤±è´¥ï¼Œç½‘é€Ÿæ…¢çš„é—®é¢˜</h2>
<blockquote>
<p>å¯é€šè¿‡æ›´æ¢apt-geté•œåƒæºæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¤‡ä»½åŸå§‹é•œåƒæº</span></span><br><span class="line"></span><br><span class="line">cp /etc/apt/source.list  /etc/apt/source.list.old</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ¢é•œåƒæºåœ°å€</span></span><br><span class="line"></span><br><span class="line">vim /etc/apt/source.list</span><br><span class="line"></span><br><span class="line">:%d            <span class="comment">#æ¸…ç©ºå†…å®¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤åˆ¶[æ¸…åé•œåƒæº](https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/)åˆ°/etc/apt/source.listæ–‡ä»¶ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°ä¸€ä¸‹é…ç½®</span></span><br><span class="line"></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="apt-getå®‰è£…ç¨‹åºåŒ…å‡ºç°é—®é¢˜ï¼ˆå¸è½½ç³»ç»Ÿè‡ªå¸¦python3åå‡ºç°çš„é—®é¢˜ï¼‰">apt-getå®‰è£…ç¨‹åºåŒ…å‡ºç°é—®é¢˜ï¼ˆå¸è½½ç³»ç»Ÿè‡ªå¸¦python3åå‡ºç°çš„é—®é¢˜ï¼‰</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä»¥ä¸‹ä¸ºé”™è¯¯å†…å®¹ï¼Œå¯èƒ½æœ‰å¤šä¸ªæˆ–è‡³å°‘ä¸€ä¸ª</span></span><br><span class="line">xxx.postinst: xxx: not found</span><br><span class="line">dpkg: å¤„ç†è½¯ä»¶åŒ… xxx (--configure)æ—¶å‡ºé”™:</span><br><span class="line"> å­è¿›ç¨‹ å·²å®‰è£… post-installation è„šæœ¬ è¿”å›é”™è¯¯çŠ¶æ€ 127</span><br><span class="line">åœ¨å¤„ç†æ—¶æœ‰é”™è¯¯å‘ç”Ÿ:</span><br><span class="line">	xxx</span><br><span class="line">E:Sub-process /usr/bin/dpkg returned an error code (1)</span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•ï¼š</span></span><br><span class="line">sudo mv /var/lib/dpkg/info /var/lib/dpkg/info_old</span><br><span class="line"></span><br><span class="line">sudo mkdir /var/lib/dpkg/info</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°è½¯ä»¶åŒ…å¹¶ä¿®å¤è½¯ä»¶çš„ä¾èµ–åŒ…</span></span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get -f install</span><br><span class="line"></span><br><span class="line">sudo mv /var/lib/dpkg/info/* /var/lib/dpkg/info_old</span><br><span class="line"></span><br><span class="line">sudo rm -rf /var/lib/dpkg/info </span><br><span class="line"></span><br><span class="line">sudo mv /var/lib/dpkg/info_old /var/lib/dpkg/info</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°è¿›å…¥shell</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>æœ€å¥½ä¸è¦å¸è½½ç³»ç»Ÿè‡ªå¸¦çš„pythonï¼Œæœ€å¤šå¸è½½ä½ ä¹‹å‰ä½¿ç”¨apt-getå®‰è£…çš„è½¯ä»¶ï¼Œä¸ç„¶å¯èƒ½ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ğŸ˜°</p>
</blockquote>
<h2 id="å¸è½½è½¯ä»¶-ç¨‹åº">å¸è½½è½¯ä»¶/ç¨‹åº</h2>
<blockquote>
<p>æˆ‘è§‰å¾—ä¹Ÿå¯ä»¥ç”¨æ¥åˆ é™¤å…¶ä»–é€šè¿‡apt-getå®‰è£…çš„è½¯ä»¶ï¼</p>
</blockquote>
<h4 id="ç¤ºä¾‹ï¼šå®Œå…¨å¸è½½mariadb">ç¤ºä¾‹ï¼šå®Œå…¨å¸è½½mariadb</h4>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆå¸è½½mariadbå¹¶åˆ é™¤ç›¸å…³é…ç½®æ–‡ä»¶(datadirç›®å½•)</span></span><br><span class="line">sudo apt-get purge mariadb*</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ²¡ç”¨çš„ç›¸å…³ä¾èµ–åŒ…</span></span><br><span class="line">sudo apt-get automove </span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯mariadbæœåŠ¡æ˜¯å¦è¿˜åœ¨</span></span><br><span class="line">sudo service mysql status</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¦‚æœè¿˜æ˜¯ä¸èƒ½å¤Ÿåˆ é™¤!!!</span></span><br><span class="line"><span class="comment">#å°±ç›´æ¥åˆ°aptè½¯ä»¶åŒ…åˆ—è¡¨å»åˆ é™¤</span></span><br><span class="line">/var/lib/dpkg/info</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>dockerç”¨æ³•</title>
    <url>/2020/09/08/docker%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p><img src="/assets/img/Docker-wallpaper.jpg" alt=""></p>
<a id="more"></a>
<h2 id="é•œåƒæ“ä½œ">é•œåƒæ“ä½œ</h2>
<p>æ£€ç´¢ï¼šdocker search å…³é”®å­—</p>
<p>æ‹‰å–ï¼šdocker pull é•œåƒå:tag</p>
<p>åˆ—è¡¨ï¼šdocker images</p>
<p>åˆ é™¤ï¼šdocker rmi image-id</p>
<h2 id="å®¹å™¨æ“ä½œ">å®¹å™¨æ“ä½œ</h2>
<p>æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨ï¼šdocker run --name -container-name -d -image-name</p>
<p>ï¼ˆ-dï¼šåå°è¿è¡Œ;-p: -host-port; -container-portï¼šç«¯å£æ˜ å°„; -it  è¿è¡Œäº¤äº’æ¨¡å¼çš„å®¹å™¨; -P å°†æ‰€æœ‰çš„å…¬å¼€ç«¯å£æ˜ å°„åˆ°éšæœºç«¯å£ä¸Šï¼‰</p>
<p>æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨ï¼šdocker ps (åŠ -aï¼Œè¡¨ç¤ºæŸ¥çœ‹æ‰€ä»¥çš„å®¹å™¨)</p>
<p>åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ï¼šdocker stop -container-id/-container-name</p>
<p>å¯åŠ¨å®¹å™¨ï¼šdocker start -container-id/-container-name</p>
<p>åˆ é™¤å®¹å™¨ï¼šdocker rm -container-id</p>
<p>æŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼šdocker logs -container-id/-container-name</p>
<p>è¿›å…¥å®¹å™¨ï¼šdocker exec -it -container-id/container-name /bin/bash</p>
<p>è®¾ç½®dockerå®¹å™¨è‡ªå¯åŠ¨:</p>
<ul>
<li>å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºå®¹å™¨<br>
docker run --restart=always --name=å®¹å™¨å</li>
<li>å¦‚æœå·²ç»åˆ›å»ºäº†å®¹å™¨<br>
docker update --restart=always å®¹å™¨å</li>
</ul>
<blockquote>
<p>dockerå‘½ä»¤è¡Œ çš„é€‰é¡¹åˆ—è¡¨åœ¨<a href="https://docs.docker.com/engine/reference/commandline/run/#options">è¿™é‡Œ</a>ğŸ˜œ</p>
</blockquote>
<hr>
<h2 id="å…³äºdockerå ç”¨ç£ç›˜ç©ºé—´çš„æƒ…å†µ">å…³äºdockerå ç”¨ç£ç›˜ç©ºé—´çš„æƒ…å†µ</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹Dockerçš„ç£ç›˜ä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">docker system df </span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸€èˆ¬æœ‰Imagesï¼ˆé•œåƒï¼‰ã€Containers(å®¹å™¨)ã€Local Volumes(æ•°æ®å·)</span></span><br><span class="line"><span class="comment">#é•œåƒæ˜¯ç”¨æ¥åœ¨å®¹å™¨ä¸­ç”Ÿæˆä¸€ä¸ªå®ä¾‹çš„ï¼Œå½“é‡æ–°ç”¨å®¹å™¨ç”Ÿæˆä¸€ä¸ªé•œåƒçš„æ—¶å€™ï¼Œå°±æ˜¯å¦ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œä¹‹å‰çš„æ•°æ®éƒ½ä¼šæ²¡æœ‰äº†ï¼Œå› ä¸ºæ˜¯æ–°çš„å®ä¾‹å˜›ï¼Œè€Œä¹‹å‰çš„å®ä¾‹æ•°æ®å…¶å®æ˜¯å­˜æ”¾åœ¨æ•°æ®å·é‡Œé¢çš„ï¼</span></span><br><span class="line"><span class="comment">#æ•°æ®å·ä¹Ÿæ˜¯å®ç°æŒä¹…åŒ–çš„å…³é”®å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¸…ç†ç£ç›˜ç©ºé—´  ï¼ï¼ï¼æ…ç”¨</span></span><br><span class="line">docker system prune</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰‹åŠ¨æ¸…ç†Dockeré•œåƒ/å®¹å™¨/æ•°æ®å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ‰€æœ‰å…³é—­çš„å®¹å™¨</span></span><br><span class="line">docker ps -a | grep Exit | cut -d <span class="string">&#x27; &#x27;</span> -f 1 | xargs docker rm</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ‰€æœ‰danglingé•œåƒï¼ˆå³æ— tagçš„é•œåƒï¼‰</span></span><br><span class="line">docker rmi $(docker images | grep <span class="string">&quot;^&lt;none&gt;&quot;</span> | awk <span class="string">&quot;&#123;print <span class="variable">$3</span>&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ‰€æœ‰danglingæ•°æ®å·ï¼ˆå³æ— ç”¨çš„Volumeï¼‰</span></span><br><span class="line">docker volume rm $(docker volume ls -qf dangling=<span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntuåˆ›å»ºç”¨æˆ·</title>
    <url>/2020/09/09/Ubuntu%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>æ–°å»ºç”¨æˆ·ä¸ä»…ä»…æ˜¯æ–°å»ºä¸€ä¸ªç”¨æˆ·è€Œå·²ï¼Œè¿˜æœ‰å…¶å®¶ç›®å½•çš„è®¾ç½®å’Œç¯å¢ƒå˜é‡çš„è®¾ç½®ç­‰ç­‰ï¼Œæ‰€ä»¥æ–°å»ºç”¨æˆ·å¹¶æ²¡æœ‰æƒ³è±¡çš„é‚£ä¹ˆç®€å•ğŸ˜³</p>
<a id="more"></a>
<h2 id="æ–°å»ºç”¨æˆ·">æ–°å»ºç”¨æˆ·</h2>
<p>æœ‰<strong>useradd</strong>å’Œ<strong>adduser</strong>ä¸¤ç§æ–¹æ³•å“¦ğŸ™Š</p>
<blockquote>
<p>é‚£ä¹ˆå¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæ ¹æ®ç³»ç»Ÿæ¥å’¯ç¡®å®šç³»ç»Ÿ</p>
</blockquote>
<p>å¦‚æœæ˜¯ubuntu(æˆ‘çš„å°±æ˜¯ğŸ˜),é‚£ä¹ˆuseraddå’Œadduseræ˜¯ä¸ä¸€æ ·çš„</p>
<p>adduserå¯ä»¥ä¸ºæ–°å»ºç”¨æˆ·è‡ªåŠ¨åˆ›å»ºè·Ÿç”¨æˆ·ååŒåçš„ç”¨æˆ·ç›®å½•ï¼Œç»„åï¼Œç³»ç»Ÿshellç‰ˆæœ¬ï¼ŒåŒæ—¶ä¼šæç¤ºè¾“å…¥å¯†ç ä¹‹ç±»çš„ã€‚</p>
<p>è€Œuseraddåœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨åˆ›å»ºç›®å½•ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨é€‰æ‹©shellç‰ˆæœ¬ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®å¯†ç ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨passwdå‘½ä»¤ä¿®æ”¹å¯†ç </p>
<blockquote>
<p>è€Œåœ¨å…¶ä»–ç³»ç»Ÿä¸Šè¿˜æ²¡è¯•éªŒè¿‡</p>
</blockquote>
<hr>
<h2 id="å·²å»ºç”¨æˆ·">å·²å»ºç”¨æˆ·</h2>
<p>å¦‚æœæ˜¯å·²å»ºç”¨æˆ·ï¼Œä½†æ˜¯ä½ ä¸¢å¤±äº†æŸäº›ä¸œè¥¿ï¼Ÿæ¯”å¦‚ä½ è¯¯åˆ äº†å®¶ç›®å½•ğŸ˜‚ï¼Œé‚£è¿˜éœ€è¦æ–°å»ºç”¨æˆ·å—ï¼Ÿ</p>
<p>æœ‰ä¸€æ¬¡å› ä¸ºå¤±è¯¯ï¼Œåˆ äº†å®¶ç›®å½•åŠå…¶å­ç›®å½•çš„æ‰€æœ‰æ•°æ®ğŸ‘»</p>
<p>é‚£å¦‚ä½•æ–°å»ºå®¶ç›®å½•å‘¢ã€‚</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>skec<span class="regexp">/* /</span>path<span class="regexp">/to/u</span>ser -A </span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™ä¸ªå‘½ä»¤çš„æ„ä¹‰å°±æ˜¯æŠŠshellç­‰ä¸€äº›é…ç½®æ–‡ä»¶å¤åˆ¶åˆ°æˆ‘çš„ç”¨æˆ·ç›®å½•ä¸­</p>
</blockquote>
<hr>
<h2 id="é—®é¢˜">é—®é¢˜</h2>
<p>å¦‚æœåœ¨åˆ›å»ºç”¨æˆ·çš„æ—¶å€™æ²¡æœ‰è®¾ç½®ä¸»ç›®å½•å’Œshellï¼Œä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢â”</p>
<p>æˆ‘æš‚æ—¶è¿˜ä¸çŸ¥é“ï¼Œç½‘ä¸Šæœä¸åˆ°è¿™ç§é—®é¢˜ğŸ˜</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>Springé…ç½®æ•°æ®æº</title>
    <url>/2020/11/18/Spring%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%BA%90/</url>
    <content><![CDATA[<p>æ— è®ºé€‰æ‹©Springçš„å“ªç§æ•°æ®è®¿é—®æ–¹å¼ï¼Œä½ éƒ½éœ€è¦é…ç½®ä¸€ä¸ªæ•°æ®æºçš„å¼•ç”¨ã€‚Springæä¾›äº†åœ¨Springä¸Šä¸‹æ–‡ä¸­é…ç½®æ•°æ®æºbeançš„å¤šç§æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>é€šè¿‡JDBCé©±åŠ¨ç¨‹åºå®šä¹‰çš„æ•°æ®æºï¼›</li>
<li>é€šè¿‡JNDIæŸ¥æ‰¾çš„æ•°æ®æºï¼›<a id="more"></a></li>
<li>è¿æ¥æ± çš„æ•°æ®æºã€‚</li>
</ol>
<p>å¯¹äºå³å°†å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘å»ºè®®ä½¿ç”¨ä»è¿æ¥æ± è·å–è¿æ¥çš„æ•°æ®æºã€‚å¦‚æœå¯èƒ½çš„è¯ï¼Œæˆ‘å€¾å‘äºé€šè¿‡åº”ç”¨æœåŠ¡å™¨çš„JNDIæ¥è·å–æ•°æ®æºã€‚</p>
<h2 id="ä½¿ç”¨JNDIæ•°æ®æº">ä½¿ç”¨JNDIæ•°æ®æº</h2>
<p>Springåº”ç”¨ç¨‹åºç»å¸¸éƒ¨ç½²åœ¨Java EEåº”ç”¨æœåŠ¡å™¨ä¸­ï¼Œå¦‚WebSphereã€JBossæˆ–ç”šè‡³åƒTomcatè¿™æ ·çš„Webå®¹å™¨ä¸­ã€‚è¿™äº›æœåŠ¡å™¨å…è®¸ä½ é…ç½®é€šè¿‡JNDIè·å–æ•°æ®æºã€‚è¿™ç§é…ç½®çš„å¥½å¤„åœ¨äºæ•°æ®æºå®Œå…¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¹‹å¤–è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºåªéœ€åœ¨è®¿é—®æ•°æ®åº“çš„æ—¶å€™æŸ¥æ‰¾æ•°æ®æºå°±å¯ä»¥äº†ã€‚å¦å¤–ï¼Œåœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ç®¡ç†çš„æ•°æ®æºé€šå¸¸ä»¥æ± çš„æ–¹å¼ç»„ç»‡ï¼Œä»è€Œå…·å¤‡æ›´å¥½çš„æ€§èƒ½ï¼Œå¹¶ä¸”è¿˜æ”¯æŒç³»ç»Ÿç®¡ç†å‘˜å¯¹å…¶è¿›è¡Œçƒ­åˆ‡æ¢ã€‚</p>
<p>åˆ©ç”¨Springï¼Œæˆ‘ä»¬å¯ä»¥åƒä½¿ç”¨Spring beané‚£æ ·é…ç½®JNDIä¸­æ•°æ®æºçš„å¼•ç”¨å¹¶å°†å…¶è£…é…åˆ°éœ€è¦çš„ç±»ä¸­ã€‚ä½äºjeeå‘½åç©ºé—´ä¸‹çš„<a href="jee:jndi-lookup">jee:jndi-lookup</a>å…ƒç´ å¯ä»¥ç”¨äºæ£€ç´¢JNDIä¸­çš„ä»»ä½•å¯¹è±¡ï¼ˆåŒ…æ‹¬æ•°æ®æºï¼‰å¹¶å°†å…¶ä½œä¸ºSpringçš„beanã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨ç¨‹åºçš„æ•°æ®æºé…ç½®åœ¨JNDIä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="jee:jndi-lookup">jee:jndi-lookup</a>å…ƒç´ å°†å…¶è£…é…åˆ°Springä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span></span></span><br><span class="line"><span class="tag">     <span class="attr">jndi-name</span>=<span class="string">&quot;/jdbc/SpitterDS&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">resource-ref</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ jndi-nameå±æ€§ç”¨äºæŒ‡å®šJNDIä¸­èµ„æºçš„åç§°ã€‚å¦‚æœåªè®¾ç½®äº†jndi-nameå±æ€§ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®æŒ‡å®šçš„åç§°æŸ¥æ‰¾æ•°æ®æºã€‚ä½†æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºè¿è¡Œåœ¨Javaåº”ç”¨æœåŠ¡å™¨ä¸­ï¼Œä½ éœ€è¦å°†resource-refå±æ€§è®¾ç½®ä¸ºtrueï¼Œè¿™æ ·ç»™å®šçš„jndi-nameå°†ä¼šè‡ªåŠ¨æ·»åŠ â€œjava:comp/env/â€å‰ç¼€ã€‚</p>
<p>å¦‚æœæƒ³ä½¿ç”¨Javaé…ç½®çš„è¯ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å€ŸåŠ©JndiObjectFactoryBeanä»JNDIä¸­æŸ¥æ‰¾DataSource</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JndiObjectFactoryBean <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  JndiObjectFactoryBean jndiObjectFB = <span class="keyword">new</span> JndiObjectFactoryBean();</span><br><span class="line">  jndiObjectFB.setJndiName(<span class="string">&quot;jdbc/SpittrDS&quot;</span>);</span><br><span class="line">  jndiObjectFB.setResourceRef(<span class="keyword">true</span>);</span><br><span class="line">  jndiObjectFB.setProxyInterface(javax.sql.DataSource.class);</span><br><span class="line">  <span class="keyword">return</span> jndiObjectFB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ä½¿ç”¨æ•°æ®è¿æ¥æ± ">ä½¿ç”¨æ•°æ®è¿æ¥æ± </h2>
<p>å¦‚æœä½ ä¸èƒ½ä»JNDIä¸­æŸ¥æ‰¾æ•°æ®æºï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªé€‰æ‹©å°±æ˜¯ç›´æ¥åœ¨Springä¸­é…ç½®æ•°æ®æºè¿æ¥æ± ã€‚å°½ç®¡Springå¹¶æ²¡æœ‰æä¾›æ•°æ®æºè¿æ¥æ± å®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰å¤šé¡¹å¯ç”¨çš„æ–¹æ¡ˆï¼ŒåŒ…æ‹¬å¦‚ä¸‹å¼€æºçš„å®ç°ï¼š</p>
<ol>
<li>Apache Commons DBCP (<a href="http://jakarta.apache.org/commons/dbcp">http://jakarta.apache.org/commons/dbcp</a>)ï¼›</li>
<li>c3p0 (<a href="http://sourceforge.net/projects/c3p0/">http://sourceforge.net/projects/c3p0/</a>) ï¼›</li>
<li>BoneCP (<a href="http://jolbox.com/">http://jolbox.com/</a>) ã€‚</li>
</ol>
<p>è¿™äº›è¿æ¥æ± ä¸­çš„å¤§å¤šæ•°éƒ½èƒ½é…ç½®ä¸ºSpringçš„æ•°æ®æºï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¸Springè‡ªå¸¦çš„DriverManagerDataSource æˆ– SingleConnectionDataSourceå¾ˆç±»ä¼¼ï¼ˆæˆ‘ä»¬ç¨åä¼šå¯¹å…¶è¿›è¡Œä»‹ç»ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯é…ç½®DBCP BasicDataSource çš„æ–¹å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:driverClassName</span>=<span class="string">&quot;org.h2.Driver&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:url</span>=<span class="string">&quot;jdbc:h2:tcp://localhost/~/spitter&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:username</span>=<span class="string">&quot;sa&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:password</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:initialSize</span>=<span class="string">&quot;5&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">p:maxActive</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="BasicDataSourceçš„æ± é…ç½®å±æ€§">BasicDataSourceçš„æ± é…ç½®å±æ€§</h4>
<table>
<thead>
<tr>
<th>æ± é…ç½®å±æ€§</th>
<th>æ‰€æŒ‡å®šçš„å†…å®¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>initialSize</td>
<td>æ± å¯åŠ¨æ—¶åˆ›å»ºçš„è¿æ¥æ•°é‡</td>
</tr>
<tr>
<td>maxActive</td>
<td>åŒä¸€æ—¶é—´å¯ä»æ± ä¸­åˆ†é…çš„æœ€å¤šè¿æ¥æ•°ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxIdle</td>
<td>æ± é‡Œä¸ä¼šè¢«é‡Šæ”¾çš„æœ€å¤šç©ºé—²è¿æ¥æ•°ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxOpenPreparedStatements</td>
<td>åœ¨åŒä¸€æ—¶é—´èƒ½å¤Ÿä»è¯­å¥æ± ä¸­åˆ†é…çš„é¢„å¤„ç†è¯­å¥ï¼ˆprepared statementï¼‰çš„æœ€å¤§æ•°é‡ã€‚å¦‚æœè®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºæ— é™åˆ¶</td>
</tr>
<tr>
<td>maxWait</td>
<td>åœ¨æŠ›å‡ºå¼‚å¸¸ä¹‹å‰ï¼Œæ± ç­‰å¾…è¿æ¥å›æ”¶çš„æœ€å¤§æ—¶é—´ï¼ˆå½“æ²¡æœ‰å¯ç”¨è¿æ¥æ—¶ï¼‰ã€‚å¦‚æœè®¾ç½®ä¸º-1ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…</td>
</tr>
<tr>
<td>minEvictableIdleTimeMillis</td>
<td>è¿æ¥åœ¨æ± ä¸­ä¿æŒç©ºé—²è€Œä¸è¢«å›æ”¶çš„æœ€å¤§æ—¶é—´</td>
</tr>
<tr>
<td>minIdle</td>
<td>åœ¨ä¸åˆ›å»ºæ–°è¿æ¥çš„æƒ…å†µä¸‹ï¼Œæ± ä¸­ä¿æŒç©ºé—²çš„æœ€å°è¿æ¥æ•°</td>
</tr>
<tr>
<td>poolPreparedStatements</td>
<td>æ˜¯å¦å¯¹é¢„å¤„ç†è¯­å¥ï¼ˆprepared statementï¼‰è¿›è¡Œæ± ç®¡ç†ï¼ˆå¸ƒå°”å€¼ï¼‰</td>
</tr>
</tbody>
</table>
<h2 id="åŸºäºJDBCé©±åŠ¨çš„æ•°æ®æº">åŸºäºJDBCé©±åŠ¨çš„æ•°æ®æº</h2>
<p>åœ¨Springä¸­ï¼Œé€šè¿‡JDBCé©±åŠ¨å®šä¹‰æ•°æ®æºæ˜¯æœ€ç®€å•çš„é…ç½®æ–¹å¼ã€‚Springæä¾›äº†ä¸‰ä¸ªè¿™æ ·çš„æ•°æ®æºç±»ï¼ˆå‡ä½äºorg.springframework.jdbc.datasourceåŒ…ä¸­ï¼‰ä¾›é€‰æ‹©ï¼š</p>
<ol>
<li>DriverManagerDataSourceï¼šåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°å»ºçš„è¿æ¥ã€‚ä¸DBCPçš„BasicDataSource ä¸åŒï¼Œç”± DriverManagerDataSourceæä¾›çš„è¿æ¥å¹¶æ²¡æœ‰è¿›è¡Œæ± åŒ–ç®¡ç†ï¼›</li>
<li>SimpleDriverDataSource ï¼šä¸ DriverManagerDataSourceçš„å·¥ä½œæ–¹å¼ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒç›´æ¥ä½¿ç”¨JDBCé©±åŠ¨ï¼Œæ¥è§£å†³åœ¨ç‰¹å®šç¯å¢ƒä¸‹çš„ç±»åŠ è½½é—®é¢˜ï¼Œè¿™æ ·çš„ç¯å¢ƒåŒ…æ‹¬OSGiå®¹å™¨ï¼› SingleConnectionDataSourceï¼šåœ¨æ¯ä¸ªè¿æ¥è¯·æ±‚æ—¶éƒ½ä¼šè¿”å›åŒä¸€ä¸ªçš„è¿æ¥ã€‚å°½ç®¡</li>
<li>SingleConnectionDataSourceä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„è¿æ¥æ± æ•°æ®æºï¼Œä½†æ˜¯ä½ å¯ä»¥å°†å…¶è§†ä¸ºåªæœ‰ä¸€ä¸ªè¿æ¥çš„æ± ã€‚ ä»¥ä¸Šè¿™äº›æ•°æ®æºçš„é…ç½®ä¸DBCPBasicDataSourceçš„é…ç½®ç±»ä¼¼ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹å°±æ˜¯é…ç½®DriverManagerDataSource</li>
</ol>
<p>ä¸å…·å¤‡æ± åŠŸèƒ½çš„æ•°æ®æºç›¸æ¯”ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºè¿™äº›æ•°æ®æºbeanéƒ½æ²¡æœ‰æä¾›è¿æ¥æ± åŠŸèƒ½ï¼Œæ‰€ä»¥æ²¡æœ‰å¯é…ç½®çš„æ± ç›¸å…³çš„å±æ€§ã€‚</p>
<p>å°½ç®¡è¿™äº›æ•°æ®æºå¯¹äºå°åº”ç”¨æˆ–å¼€å‘ç¯å¢ƒæ¥è¯´æ˜¯ä¸é”™çš„ï¼Œä½†æ˜¯è¦å°†å…¶ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œä½ è¿˜æ˜¯éœ€è¦æ…é‡è€ƒè™‘ã€‚å› ä¸ºSingleConnectionDataSourceæœ‰ä¸”åªæœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨äºå¤šçº¿ç¨‹çš„åº”ç”¨ç¨‹åºï¼Œæœ€å¥½åªåœ¨æµ‹è¯•çš„æ—¶å€™ä½¿ç”¨ã€‚è€ŒDriverManagerDataSource å’Œ SimpleDriverDataSourceå°½ç®¡æ”¯æŒå¤šçº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ¯æ¬¡è¯·æ±‚è¿æ¥çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºæ–°è¿æ¥ï¼Œè¿™æ˜¯ä»¥æ€§èƒ½ä¸ºä»£ä»·çš„ã€‚é‰´äºä»¥ä¸Šçš„è¿™äº›é™åˆ¶ï¼Œæˆ‘å¼ºçƒˆå»ºè®®åº”è¯¥ä½¿ç”¨æ•°æ®æºè¿æ¥æ± ã€‚</p>
<h2 id="ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº">ä½¿ç”¨åµŒå…¥å¼çš„æ•°æ®æº</h2>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°æ®æºæ˜¯æˆ‘æƒ³å¯¹è¯»è€…ä»‹ç»çš„ï¼šåµŒå…¥å¼æ•°æ®åº“ï¼ˆembedded databaseï¼‰ã€‚åµŒå…¥å¼æ•°æ®åº“ä½œä¸ºåº”ç”¨çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œè€Œä¸æ˜¯åº”ç”¨è¿æ¥çš„ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨ã€‚å°½ç®¡åœ¨ç”Ÿäº§ç¯å¢ƒçš„è®¾ç½®ä¸­ï¼Œå®ƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ç”¨å¤„ï¼Œä½†æ˜¯å¯¹äºå¼€å‘å’Œæµ‹è¯•æ¥è®²ï¼ŒåµŒå…¥å¼æ•°æ®åº“éƒ½æ˜¯å¾ˆå¥½çš„å¯é€‰æ–¹æ¡ˆã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡é‡å¯åº”ç”¨æˆ–è¿è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œéƒ½èƒ½å¤Ÿé‡æ–°å¡«å……æµ‹è¯•æ•°æ®ã€‚</p>
<p>Springçš„jdbcå‘½åç©ºé—´èƒ½å¤Ÿç®€åŒ–åµŒå…¥å¼æ•°æ®åº“çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨jdbcå‘½åç©ºé—´æ¥é…ç½®åµŒå…¥å¼çš„H2æ•°æ®åº“ï¼Œå®ƒä¼šé¢„å…ˆåŠ è½½ä¸€ç»„æµ‹è¯•æ•°æ®ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°æ®æºæ˜¯æˆ‘æƒ³å¯¹è¯»è€…ä»‹ç»çš„ï¼šåµŒå…¥å¼æ•°æ®åº“ï¼ˆembedded databaseï¼‰ã€‚åµŒå…¥å¼æ•°æ®åº“ä½œä¸ºåº”ç”¨çš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œè€Œä¸æ˜¯åº”ç”¨è¿æ¥çš„ç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨ã€‚å°½ç®¡åœ¨ç”Ÿäº§ç¯å¢ƒçš„è®¾ç½®ä¸­ï¼Œå®ƒå¹¶æ²¡æœ‰å¤ªå¤§çš„ç”¨å¤„ï¼Œä½†æ˜¯å¯¹äºå¼€å‘å’Œæµ‹è¯•æ¥è®²ï¼ŒåµŒå…¥å¼æ•°æ®åº“éƒ½æ˜¯å¾ˆå¥½çš„å¯é€‰æ–¹æ¡ˆã€‚è¿™æ˜¯å› ä¸ºæ¯æ¬¡é‡å¯åº”ç”¨æˆ–è¿è¡Œæµ‹è¯•çš„æ—¶å€™ï¼Œéƒ½èƒ½å¤Ÿé‡æ–°å¡«å……æµ‹è¯•æ•°æ®ã€‚ Springçš„jdbcå‘½åç©ºé—´èƒ½å¤Ÿç®€åŒ–åµŒå…¥å¼æ•°æ®åº“çš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨jdbcå‘½åç©ºé—´æ¥é…ç½®åµŒå…¥å¼çš„H2æ•°æ®åº“ï¼Œå®ƒä¼šé¢„å…ˆåŠ è½½ä¸€ç»„æµ‹è¯•æ•°æ®ã€‚</p>
<blockquote>
<p>ä½¿ç”¨jdbcå‘½åç©ºé—´é…ç½®åµŒå…¥å¼æ•°æ®åº“</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span> <span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:jdbc</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:c</span>=<span class="string">&quot;http://www.springframework.org/schema/c&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/jdbc</span></span></span><br><span class="line"><span class="tag"><span class="string">      http://www.springframework.org/schema/jdbc/spring-jdbc-3.1.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">jdbc:embedded-</span></span></span><br><span class="line"><span class="tag">     <span class="attr">database</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">type</span>=<span class="string">&quot;H2&quot;</span>&gt;</span>     <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;com/habum</span></span></span><br><span class="line"><span class="tag"><span class="string">     a/spitter/db/jdbc/schema.sql&quot;</span>/&gt;</span>     <span class="tag">&lt;<span class="name">jdbc:script</span> <span class="attr">location</span>=<span class="string">&quot;com/habuma/sp</span></span></span><br><span class="line"><span class="tag"><span class="string">     itter/db/jdbc/test-data.sql&quot;</span>/&gt;</span>   <span class="tag">&lt;/<span class="name">jdbc:embedded-database</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶å®åµŒå…¥å¼æ•°æ®åº“å°±æ˜¯æå‰ç¼–å†™å¥½å»ºç«‹æ•°æ®åº“å’Œè¡¨çš„sqlè¯­å¥å’Œæ’å…¥æ•°æ®åº“è¡¨æ•°æ®çš„è¯­å¥ï¼Œæ¯ä¸€æ¬¡ä½¿ç”¨æ•°æ®åº“ï¼Œéƒ½æ˜¯åŒæ ·çš„æ•°æ®ï¼Œå°±æ˜¯ä¸ä¼šæ”¹å˜</p>
</blockquote>
<h2 id="ä½¿ç”¨profileé€‰æ‹©æ•°æ®æº">ä½¿ç”¨profileé€‰æ‹©æ•°æ®æº</h2>
<p>å‚è€ƒæ–‡ç« â€“ã€‹Spring 4.0 é«˜çº§è£…é…çš„Profileç« èŠ‚</p>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>javaå‘½ä»¤è¡Œ</title>
    <url>/2020/09/11/java%E5%91%BD%E4%BB%A4%E8%A1%8C/</url>
    <content><![CDATA[<p>è¯•è¿‡ç›´æ¥åœ¨cmdä¸­ç›´æ¥ä½¿ç”¨javaç¼–è¯‘å¹¶è¿è¡Œå—ï¼Ÿç§ç§ğŸ‘€ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æœç´¢æŸä¸ªjaræ–‡ä»¶ï¼Œç„¶åé€šè¿‡è¿™ä¸ªæ–‡ä»¶ä¸­å®šä¹‰çš„ç±»æ¥è¿è¡Œã€‚</span></span><br><span class="line">java -<span class="function">classpath <span class="title">jarfile</span> <span class="params">(jarä¸­çš„)</span>class [args]</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</h3>
<p>å¯é€šè¿‡windowçš„cmdå‘½ä»¤è¡Œæ¥æ‰§è¡Œã€‚</p>
<p>æ¶‰åŠåˆ°çš„jaråŒ…åœ¨<code>F:\AA_LLJ\llj\files\liripo_proj\lib</code></p>
<p>ä»¥ä¸‹ä¸ºæ¡ˆä¾‹è§£é‡Š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#In order to keep GNomEx secure we encrypt the passwords for the mysql users gnomex and gnomexguest. This is done by creating a /properties directory that needs to contain a file called gnomex_tomcat.properties â€“ this file has one line:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#key=zzzzzzzzzz</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#where you specify a combination of upper/lower case letters and numbers (instead of zzzzzzzzz) to use as a key during encryption</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#In my example I will use gnomex$129 as the mysql password for gnomex</span></span><br><span class="line"><span class="comment">#And gnomexguest$129 as the mysql password for gnomexguest</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#So:</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$CATALINA_HOME</span>/lib</span><br><span class="line"></span><br><span class="line">java â€“classpath ./gnomex_realm.jar hci.gnomex.security.tomcat.AESEncryption gnomex<span class="variable">$129</span> zzzzzzzzz</span><br><span class="line"></span><br><span class="line">gnomex<span class="variable">$129</span>:963aab6e93a6965b1fad2076f8ec96e5</span><br><span class="line"></span><br><span class="line">java -classpath ./gnomex_realm.jar hci.gnomex.security.tomcat.AESEncryption gnomexguest<span class="variable">$129</span> zzzzzzzzz</span><br><span class="line"></span><br><span class="line">gnomexguest<span class="variable">$129</span>:26fa1aada7c618cbb050fe6d2facd535 </span><br><span class="line"></span><br><span class="line">Now instead of specifying the password directly as gnomex<span class="variable">$129</span> we use the encrypted form: 963aab6e93a6965b1fad2076f8ec96e5</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="ç¤ºä¾‹äºŒï¼š">ç¤ºä¾‹äºŒï¼š</h3>
<p>åœ¨20å¹´çš„ç¬¬äºŒå‘¨æ—¥è®°é‡Œæœ‰è®°è½½å…³äºåœ¨windowä¸Šè¿è¡Œä¸€æ¬¡javaç¨‹åºç¼–è¯‘çš„è¿‡ç¨‹</p>
<p>åœ¨çº¯javaç¯å¢ƒä¸­ï¼Œå¦‚ä½•å¼•å…¥jaråŒ…åï¼Œè¿è¡Œclassæ–‡ä»¶å‘¢ï¼Œæ–¹æ³•<a href="https://www.cnblogs.com/webcyz/p/6551655.html">åœ¨è¿™é‡Œ</a></p>
<p>ä½†æ˜¯è¿˜æ˜¯å‡ºç°é—®é¢˜äº†ï¼Œå‡ºç°ç¼–ç é—®é¢˜ï¼Œæˆ‘æ”¹å˜äº†ç¼–ç è¿˜æ˜¯å‡ºé—®é¢˜</p>
<p><img src="/assets/img/java%E5%91%BD%E4%BB%A4%E8%A1%8C1.png" alt="" title="ç¼–ç é”™è¯¯"></p>
<p><img src="/assets/img/java%E5%91%BD%E4%BB%A4%E8%A1%8C2.png" alt="" title="å¥‡æ€ªé”™è¯¯"></p>
<p>æˆ‘ä¹Ÿä¸çŸ¥é“å¦‚ä½•è§£å†³äº†ï¼Œä»»é¹ä½¿ç”¨linuxç³»ç»Ÿå°±æ²¡æœ‰é—®é¢˜ï¼Œæˆ‘åœ¨windowçš„å‘½ä»¤è¡Œä¸Šå°±å‡ºç°è¿™ä¸ªâ€œå¥‡æ€ªé—®é¢˜â€ï¼Œæ— æ³•è§£å†³ï¼</p>
<p><span class="ljspan ljspan-red">è§£å†³åŠæ³•</span></p>
<div class="note primary">
            <p>éæ³•å­—ç¬¦â€˜\ufeffâ€™å’Œéœ€è¦class,interfaceæˆ–enumçš„é”™è¯¯ï¼Œå…¶å®æ˜¯ç¼–ç çš„é—®é¢˜ï¼Œé‡‡ç”¨utfæ— bomçš„ç¼–ç å°±å¯ä»¥è¿è¡Œäº†</p>
          </div>
<blockquote>
<p>Note:åœ¨notepad++ä¸­ï¼Œutf-8å°±æ˜¯utf8æ— bomæ ¼å¼</p>
</blockquote>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>javaé›†åˆ</title>
    <url>/2020/09/12/java%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h2 id="é›†åˆçš„çŸ¥è¯†ç‚¹">é›†åˆçš„çŸ¥è¯†ç‚¹</h2>
<ol>
<li>ä¸è®ºCollectionçš„å®é™…ç±»å‹å¦‚ä½•ï¼Œå®ƒéƒ½æ”¯æŒä¸€ä¸ªiteratorï¼ˆï¼‰çš„æ–¹æ³•;ä¸€èˆ¬éƒ½æ˜¯åˆ›å»ºå­ç±»å¯¹è±¡åèµ‹å€¼ç»™çˆ¶ç±»ï¼Œè¿™æ ·å¯ä»¥ä½¿ç”¨æ›´å¤šçš„æ–¹æ³•ã€‚</li>
</ol>
<a id="more"></a>
<ol start="2">
<li>
<p>Javaé›†åˆç±»åº“å°†é›†åˆçš„æ¥å£ä¸å®ç°åˆ†ç¦»ã€‚åŒæ ·çš„æ¥å£ï¼Œå¯ä»¥æœ‰ä¸åŒçš„å®ç°ã€‚Javaé›†åˆç±»çš„åŸºæœ¬æ¥å£æ˜¯Collectionæ¥å£ã€‚è€ŒCollectionæ¥å£å¿…é¡»ç»§æ‰¿java.lang.Iterableæ¥å£ã€‚</p>
</li>
<li>
<p>å¯¹äºmap,éƒ½çŸ¥é“æ˜¯é”®å€¼å¯¹ï¼Œä½†æ˜¯è·Ÿæ•°ç»„æœ‰å•¥åŒºåˆ«ï¼Ÿmapç±»å‹å¯ç†è§£ä¸ºå…³è”æ•°ç»„ï¼Œå¯ä½¿ç”¨é”®å€¼å¯¹ä½œä¸ºä¸‹æ ‡æ¥è·å–ä¸€ä¸ªå€¼ï¼Œæ­£å¦‚å†…ç½®æ•°ç»„ç±»å‹ä¸€æ ·ã€‚è€Œå…³è”çš„æœ¬è´¨æ˜¯å…ƒç´ çš„å€¼ä¸æŸä¸ªç‰¹å®šé”®ç›¸å…³è”ï¼Œè€Œå¹¶éé€šè¿‡å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®æ¥è·å–ã€‚</p>
<p>æ–¹æ³•æœ‰ï¼šequals(Object o)(æ¯”è¾ƒæŒ‡å®šå¯¹è±¡ä¸æ­¤mapçš„ç­‰ä»·æ€§)ã€hashCode()ï¼ˆè¿”å›æ­¤mapçš„å“ˆå¸Œç ï¼‰ã€clear()ï¼ˆä»mapä¸­åˆ é™¤æ‰€æœ‰æ˜ å°„ï¼‰ã€remove(Object key)ï¼ˆä»Mapä¸­åˆ é™¤é”®å’Œå…³è”çš„å€¼ï¼‰ã€put(Object key,Object value)ï¼ˆå°†æŒ‡å®šå€¼ä¸æŒ‡å®šé”®ç›¸å…³è”ï¼‰ã€putAll(Map t)ï¼ˆå°†æŒ‡å®šMapä¸­çš„æ‰€æœ‰æ˜ å°„å¤åˆ¶åˆ°æ­¤mapï¼‰ï¼Œå…¶ä¸­hashMapè¿˜æœ‰Get()æ–¹æ³•</p>
</li>
<li>
<p>å¯¹äºè¿­ä»£å™¨Iteratorï¼Œå®ƒæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå¯ä»¥éå†å¹¶é€‰æ‹©åºåˆ—ä¸­çš„å¯¹è±¡å¯ç”¨ï¼Œä½¿ç”¨æ–¹æ³•iteratorï¼ˆï¼‰æ¥ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œæ–¹æ³•æœ‰next()(è·å¾—åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ )ã€hasNext()ï¼ˆæ£€æŸ¥åºåˆ—ä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´ ï¼‰ã€remove()ï¼ˆåˆ é™¤åºåˆ—ä¸­çš„å…ƒç´ ï¼‰ï¼›</p>
</li>
<li>
<p>Listæ¥å£æœ‰ä¸¤ä¸ªå­ç±»LinkedListå’ŒArrayListï¼Œå¸¸ç”¨æ–¹æ³•æœ‰ï¼šadd(Object e )å‘é›†åˆæœ«å°¾å¤„æ·»åŠ æŒ‡å®šçš„å…ƒç´ ã€remove(Object e)å°†æŒ‡å®šå…ƒç´ å¯¹è±¡ï¼Œä»é›†åˆåˆ é™¤ï¼Œè¿”å›å€¼ä¸ºè¢«åˆ é™¤çš„å¯¹è±¡ã€set(int index,Object e)å°†æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ï¼Œæ›¿æ¢æˆæŒ‡å®šçš„å…ƒç´ ï¼Œè¿”å›å€¼ä¸ºæ›¿æ¢å‰çš„å…ƒç´ ã€get(int index)è·å–æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ ã€‚</p>
</li>
<li>
<p>å¯¹äºLindedList, LinkedListå®ç°äº†List<a href="http://baike.baidu.com/view/159864.htm">æ¥å£</a>ï¼Œå…è®¸nullå…ƒç´ ã€‚æ­¤å¤–LinkedListæä¾›é¢å¤–çš„getï¼Œremoveï¼Œinsertæ–¹æ³•åœ¨LinkedListçš„é¦–éƒ¨æˆ–å°¾éƒ¨ã€‚è¿™äº›æ“ä½œä½¿LinkedListå¯è¢«ç”¨ä½œå †æ ˆï¼ˆstackï¼‰ï¼Œé˜Ÿåˆ—ï¼ˆqueueï¼‰æˆ–åŒå‘é˜Ÿåˆ—ï¼ˆdequeï¼‰ã€‚</p>
</li>
<li>
<p>å¯¹äºArrayList,ArrayListå®ç°äº†å¯å˜å¤§å°çš„<a href="http://baike.baidu.com/view/209670.htm">æ•°ç»„</a>ã€‚å®ƒå…è®¸æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬nullã€‚ArrayListæ²¡æœ‰åŒæ­¥(å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªListï¼Œåˆ™å¿…é¡»è‡ªå·±å®ç°è®¿é—®åŒæ­¥,LinkedListä¹Ÿæ˜¯ä¸åŒæ­¥çš„)ã€‚sizeï¼ŒisEmptyï¼Œgetï¼Œsetæ–¹æ³•è¿è¡Œæ—¶é—´ä¸ºå¸¸æ•°ã€‚</p>
</li>
<li>
<p>å¯¹äºVector, Vectoréå¸¸ç±»ä¼¼ArrayListï¼Œä½†æ˜¯Vectoræ˜¯åŒæ­¥çš„ã€‚ç”±Vectoråˆ›å»ºçš„Iteratorï¼Œè™½ç„¶å’ŒArrayListåˆ›å»ºçš„Iteratoræ˜¯åŒä¸€<a href="http://baike.baidu.com/view/159864.htm">æ¥å£</a>ï¼Œä½†æ˜¯ï¼Œå› ä¸ºVectoræ˜¯åŒæ­¥çš„ï¼Œå½“ä¸€ä¸ªIteratorè¢«åˆ›å»ºè€Œä¸”æ­£åœ¨è¢«ä½¿ç”¨ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ”¹å˜äº†Vectorçš„çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œæ·»åŠ æˆ–åˆ é™¤äº†ä¸€äº›å…ƒç´ ï¼‰ï¼Œè¿™æ—¶è°ƒç”¨Iteratorçš„æ–¹æ³•æ—¶å°†æŠ›å‡ºConcurrentModificationExceptionï¼Œå› æ­¤å¿…é¡»æ•è·è¯¥å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>å¯¹äºStackï¼ŒStackç»§æ‰¿è‡ªVectorï¼Œå®ç°ä¸€ä¸ªåè¿›å…ˆå‡ºçš„<a href="http://baike.baidu.com/view/93201.htm">å †æ ˆ</a>ã€‚Stackæä¾›5ä¸ªé¢å¤–çš„æ–¹æ³•ä½¿å¾—Vectorå¾—ä»¥è¢«å½“ä½œ<a href="http://baike.baidu.com/view/93201.htm">å †æ ˆ</a>ä½¿ç”¨ã€‚åŸºæœ¬çš„pushå’Œpopæ–¹æ³•ï¼Œè¿˜æœ‰peekæ–¹æ³•å¾—åˆ°æ ˆé¡¶çš„å…ƒç´ ï¼Œemptyæ–¹æ³•æµ‹è¯•<a href="http://baike.baidu.com/view/93201.htm">å †æ ˆ</a>æ˜¯å¦ä¸ºç©ºï¼Œsearchæ–¹æ³•æ£€æµ‹ä¸€ä¸ªå…ƒç´ åœ¨å †æ ˆä¸­çš„ä½ç½®ã€‚Stackåˆšåˆ›å»ºåæ˜¯ç©ºæ ˆã€‚</p>
</li>
<li>
<p>å¯¹äºSetæ¥å£ã€‚Setæ˜¯ä¸€ç§ä¸åŒ…å«é‡å¤çš„å…ƒç´ çš„Collectionï¼Œå³ä»»æ„çš„ä¸¤ä¸ªå…ƒç´ e1å’Œe2éƒ½æœ‰e1.equals(e2ï¼‰=falseï¼ŒSetæœ€å¤šæœ‰ä¸€ä¸ªnullå…ƒç´ ã€‚</p>
</li>
</ol>
<blockquote>
<p>å…³äºé›†åˆçš„ä»‹ç»è¯¦æƒ…åœ¨<a href="https://www.cnblogs.com/jmsjh/p/7740123.html">è¿™é‡Œ</a></p>
</blockquote>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>linuxä¸­çš„.configureã€makeã€make installç­‰å‘½ä»¤</title>
    <url>/2020/09/19/linux%E4%B8%AD%E7%9A%84-configure-make-make-install%E7%AD%89%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>åœ¨å®‰è£…æŸäº›è½¯ä»¶çš„æ—¶å€™ç»å¸¸ä¼šä½¿ç”¨åˆ°è¿™äº›æŒ‡ä»¤ï¼Œå°±æ˜¯<span class="ljspan  ljspan-reverse ljspan-red">./configure</span>ã€<span class="ljspan ljspan-reverse ljspan-blue">make</span>ã€<span class="ljspan ljspan-reverse ljspan-yellow">make install</span></p>
<p>æˆ‘ä¸€ç›´æ˜¯ä¸çŸ¥é“ä¸ºä½•è¦æ‰§è¡Œè¿™äº›æŒ‡ä»¤çš„ï¼Œä¸€èˆ¬ä¸éƒ½æ˜¯installä¸å°±å®Œäº‹äº†å—ï¼Ÿ</p>
<p>å…¶å®è¿™é‡Œé¢å¤§æœ‰æ–‡ç« å•¦ğŸ˜,è¿™äº›å°±æ˜¯æ‰€è°“çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·å•¦<a id="more"></a></p>
<div class="note info">
            <p>ä¸€èˆ¬é€šè¿‡æºç å®‰è£…æ‰ä¼šç”¨åˆ°è¿™äº›ä¸œè¥¿å•¦ã€‚</p>
          </div>
<blockquote>
<p>é‚£configureæ–‡ä»¶åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿå…¶å®ä»–è¿˜ä¸æ˜¯çœŸæ­£çš„æºç ï¼ŒçœŸæ­£çš„æºç é€šè¿‡autoconfå’Œautomakeæ„å»ºäº§ç”Ÿäº†configureæ–‡ä»¶ã€‚è¿™æ–¹é¢å°±æ¯”è¾ƒéš¾äº†ï¼Œè¯¦æƒ…å¯æŸ¥çœ‹<a href="https://www.ibm.com/developerworks/cn/linux/l-makefile/">è¿™é‡Œ</a></p>
</blockquote>
<hr>
<h2 id="configure">configure</h2>
<p><span class="ljspan ljspan-reverse ljspan-red">configure</span>å…¶å®æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„è„šæœ¬ï¼Œå®ƒæ˜¯ç”¨æ¥ç”Ÿæˆ <span class="ljspan ljspan-blue">makefile</span>çš„ï¼Œ<span class="ljspan ljspan-blue">makefile</span>æ˜¯ç”¨æ¥å¹²å˜›çš„å‘¢ï¼Ÿä»–å°±æ˜¯å®‰è£…çš„æœªç¼–è¯‘è„šæœ¬å•¦ï¼Œæ‰€ä»¥åœ¨ç”Ÿæˆå®ƒæ—¶ï¼Œå¯ä»¥é€šè¿‡ <span class="ljspan ljspan-reverse ljspan-red">configure</span>çš„é€‰é¡¹ï¼Œæ¥è®¾ç½®å®‰è£…ä½ç½®ç­‰</p>
<hr>
<h2 id="make">make</h2>
<p><span class="ljspan ljspan-reverse ljspan-blue">make</span>æ˜¯ç”¨æ¥ç¼–è¯‘ç”± <span class="ljspan ljspan-reverse ljspan-red">configure</span>äº§ç”Ÿçš„ <span class="ljspan ljspan-blue">makefile</span>æ–‡ä»¶çš„ï¼Œç¼–è¯‘åå°±ç”Ÿæˆäº†æ‰€éœ€è¦çš„å®‰è£…æ–‡ä»¶</p>
<hr>
<h2 id="make-install">make install</h2>
<p>é€šè¿‡ <span class="ljspan ljspan-blue">makefile</span>æ–‡ä»¶æ¥å®‰è£…ç¨‹åº</p>
<hr>
<h2 id="å…¶ä»–å‘½ä»¤">å…¶ä»–å‘½ä»¤</h2>
<h3 id="make-clean">make clean</h3>
<p>æ¸…é™¤ç¼–è¯‘äº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶åŠç›®æ ‡æ–‡ä»¶(object fileï¼Œ*.o)ï¼›å…¶å®æˆ‘è§‰å¾—è¿™é‡Œè¯´çš„ä¸æ˜¯å¾ˆå¯¹ï¼Œä¸€åˆ‡ä»¥<span class="ljspan ljspan-blue">makefile</span>é‡Œé¢æ‰€å†™å†…å®¹ä¸ºä¸»ã€‚</p>
<h3 id="make-check-make-test">make check/make test</h3>
<p>ä¸€èˆ¬åœ¨make installå‘½ä»¤ä¹‹å‰æ‰§è¡Œçš„å‘½ä»¤ï¼Œç”¨äºæ£€æµ‹ç¼–è¯‘æ–‡ä»¶æ—¶å€™æ­£ç¡®ã€‚</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>javaåŸºç¡€</title>
    <url>/2020/09/11/java%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h3 id="Stringå­—ç¬¦ä¸²åˆ¤ç©º">Stringå­—ç¬¦ä¸²åˆ¤ç©º</h3>
<p>å¯¹äº<code>String</code>ç±»å‹åˆ¤æ–­å®ƒæ˜¯å¦ä¸ºç©ºâ˜ï¸ï¼Œè¦ä½¿ç”¨<code>isEmpty()</code>è¿™ä¸ªæ–¹æ³•æˆ–<code>string==&quot;&quot;</code>ï¼Œä¸èƒ½ç”¨<code>string == Null</code>,å› ä¸º<code>String</code>æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸å¯ä»¥åˆ¤<code>Null</code></p>
<a id="more"></a>
<h3 id="æšä¸¾ç±»ğŸ““">æšä¸¾ç±»ğŸ““</h3>
<p><a href="https://www.jianshu.com/p/46dbd930f6a2">å‚è€ƒæ–‡æ¡£</a></p>
<h3 id="é™æ€ç±»å’Œé™æ€æ–¹æ³•">é™æ€ç±»å’Œé™æ€æ–¹æ³•</h3>
<p>é™æ€ç±»ä¸€å®šæ˜¯ä¸€ä¸ªå†…éƒ¨ç±»,é™æ€ç±»çš„å±æ€§å’Œæ–¹æ³•ä¹Ÿéƒ½éœ€è¦æ—¶é™æ€çš„ã€‚</p>
<p>é™æ€æ–¹æ³•å†…éƒ¨çš„å±æ€§éƒ½éœ€è¦æ—¶é™æ€çš„ã€‚é™æ€æ–¹æ³•å¯ä»¥ç›´æ¥è·¨ç±»è°ƒç”¨ã€‚ç›´æ¥å¼•ç”¨è¯¥ç±»çš„æ–¹æ³•å°±å¯ä»¥äº†ã€‚</p>
<p><a href="https://www.jianshu.com/p/80b404da976b">å‚è€ƒæ–‡æ¡£</a></p>
<h3 id="super">super()</h3>
<p>ç»å¸¸åœ¨å®ç°æ— å‚æ„é€ å‡½æ•°çš„æ—¶å€™é‡è§è¿™å®¶ä¼™ğŸ‘¦ï¼Œè¿™ä¸ª<code>super</code>å…¶å®ä»£è¡¨çš„æ˜¯çˆ¶ç±»å¯¹è±¡ï¼Œé€šè¿‡<code>super</code>å¯ä»¥è·å–åˆ°çˆ¶ç±»ğŸ‘¨çš„å±æ€§ã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼›</p>
<p>super.å±æ€§å                è°ƒç”¨çˆ¶ç±»å±æ€§</p>
<p>super.fun_name()        è°ƒç”¨ç¬¦ç±»æ–¹æ³•</p>
<p>super()/super(å‚æ•°)     è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</p>
<h3 id="PrintWriterä¸­write-å’Œprint-çš„åŒºåˆ«">PrintWriterä¸­write()å’Œprint()çš„åŒºåˆ«</h3>
<p>å…¶å®éƒ½æ˜¯è¾“å‡ºå†…å®¹ğŸ’¬ï¼Œä½†æ˜¯<code>print()</code>è¿˜å¯ä»¥å°†å„ç§ç±»å‹çš„æ•°æ®è½¬åŒ–æˆå­—ç¬¦ä¸²çš„å½¢å¼è¾“å‡ºã€‚(æœ€åå†è½¬æ¢æˆå­—èŠ‚è¾“å‡º)</p>
<h3 id="æ–°å»ºå¯¹è±¡ğŸ˜">æ–°å»ºå¯¹è±¡ğŸ˜</h3>
<p>åœ¨ä½¿ç”¨<code>xstream</code>çš„æ—¶å€™ï¼Œå‘ç°æ–°å»ºå¯¹è±¡æ—¶åé¢è¿˜å¯ä»¥æœ‰ä»£ç å—ï¼Œåœ¨ä»£ç å—é‡Œé¢å¯ä»¥è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„æ–¹æ³•è·å–æ–°å»ºå¯¹è±¡æ‰€éœ€è¦çš„ä¸œè¥¿ï¼ˆä»¥å‰çœŸæ²¡é‡åˆ°è¿‡è¿™ç§ä¸œè¥¿ï¼‰</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰xmlå¯¹è±¡æ ¼å¼</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> XStream xStream = <span class="keyword">new</span> XStream(<span class="keyword">new</span> XppDriver() &#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> HierarchicalStreamWriter <span class="title">createWriter</span><span class="params">(Writer out)</span> </span>&#123;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> PrettyPrintWriter(out) &#123;</span><br><span class="line">				<span class="keyword">boolean</span> cdata = <span class="keyword">true</span>;</span><br><span class="line">				</span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startNode</span><span class="params">(String name, Class clazz)</span> </span>&#123;</span><br><span class="line">					<span class="keyword">super</span>.startNode(name, clazz);</span><br><span class="line">				&#125;</span><br><span class="line">				......</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
  </entry>
  <entry>
    <title>linuxå‰åå°çš„å‘½ä»¤</title>
    <url>/2020/09/08/linux%E5%89%8D%E5%90%8E%E5%8F%B0%E7%9A%84%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>1.åŠ åœ¨ä¸€ä¸ªå‘½ä»¤çš„æœ€åï¼Œå¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ”¾åˆ°<span class="label primary">åå°æ‰§è¡Œ</span>ï¼š<strong>&amp;</strong></p>
<blockquote>
<p>eg: <code>sh run.sh &amp;</code></p>
</blockquote>
<a id="more"></a>
<p>2.å¯ä»¥å°†ä¸€ä¸ªæ­£åœ¨å‰å°æ‰§è¡Œçš„<span class="label danger">å‘½ä»¤æ”¾åˆ°åå°ï¼Œå¹¶å¤„äºæš‚åœçŠ¶æ€</span>ï¼š<strong>ctrl+z</strong></p>
<p>3.<span class="label danger">æŸ¥çœ‹å½“å‰æœ‰å¤šå°‘ç¨‹åºåœ¨åå°è¿è¡Œ</span>çš„å‘½ä»¤ï¼š<strong>jobs</strong></p>
<p><code>jobs -l</code>é€‰é¡¹å¯æ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡çš„PIDï¼Œjobsçš„çŠ¶æ€å¯ä»¥æ˜¯running, stopped, Terminatedã€‚ä½†æ˜¯å¦‚æœä»»åŠ¡è¢«ç»ˆæ­¢äº†ï¼ˆkillï¼‰ï¼Œshell ä»å½“å‰çš„shellç¯å¢ƒå·²çŸ¥çš„åˆ—è¡¨ä¸­åˆ é™¤ä»»åŠ¡çš„è¿›ç¨‹æ ‡è¯†</p>
<p>4.å°†<span class="label danger">åå°çš„å‘½ä»¤è°ƒè‡³å‰å°ç»§ç»­è¿è¡Œ</span>ï¼š<strong>fg</strong></p>
<blockquote>
<p>egï¼š<code>fg %jobsnumber</code></p>
</blockquote>
<p>5.<span class="label danger">å°†åå°æš‚åœçš„å‘½ä»¤ï¼Œå˜æˆåœ¨åå°ç»§ç»­æ‰§è¡Œ</span>ï¼š<strong>bg</strong></p>
<blockquote>
<p>egï¼š<code>bg %jobsnumber</code></p>
</blockquote>
<p>6.<span class="label danger">æ€æ­»è¿›ç¨‹</span>ï¼š<strong>kill</strong></p>
<p>æ³•å­1ï¼šé€šè¿‡jobså‘½ä»¤æŸ¥çœ‹jobå·ï¼ˆå‡è®¾ä¸ºnumï¼‰ï¼Œç„¶åæ‰§è¡Œ<code>kill %num</code><br>
æ³•å­2ï¼šé€šè¿‡pså‘½ä»¤æŸ¥çœ‹jobçš„è¿›ç¨‹å·ï¼ˆPIDï¼Œå‡è®¾ä¸ºpidï¼‰ï¼Œç„¶åæ‰§è¡Œ<code>kill pid</code></p>
<p>7.<span class="label danger">å‰å°è¿›ç¨‹çš„ç»ˆæ­¢</span>ï¼š<strong>Ctrl+c</strong></p>
<p>8.<span class="label warning">è®©ç¨‹åº/è¿›ç¨‹åœ¨åå°è¿›è¡Œï¼Œå³ä½¿å…³é—­ç»ˆç«¯ä¹Ÿåœ¨æ‰§è¡Œ</span>ï¼š<strong>nohup</strong></p>
<p>å¦‚æœè®©ç¨‹åºå§‹ç»ˆåœ¨åå°æ‰§è¡Œï¼Œå³ä½¿å…³é—­å½“å‰çš„ç»ˆç«¯ä¹Ÿæ‰§è¡Œï¼ˆä¹‹å‰çš„&amp;åšä¸åˆ°ï¼‰ï¼Œè¿™æ—¶å€™éœ€è¦nohupã€‚è¯¥å‘½ä»¤å¯ä»¥åœ¨ä½ é€€å‡ºå¸æˆ·/å…³é—­ç»ˆç«¯ä¹‹åç»§ç»­è¿è¡Œç›¸åº”çš„è¿›ç¨‹ã€‚å…³é—­ä¸­æ–­åï¼Œåœ¨å¦ä¸€ä¸ªç»ˆç«¯jobså·²ç»æ— æ³•çœ‹åˆ°åå°è·‘å¾—ç¨‹åºäº†ï¼Œæ­¤æ—¶åˆ©ç”¨psï¼ˆè¿›ç¨‹æŸ¥çœ‹å‘½ä»¤ï¼‰</p>
<blockquote>
<p>#åœ¨åå°è¿è¡Œçš„nohupå‘½ä»¤<br>
egï¼š<code>nohup xxx &amp;</code></p>
</blockquote>
<p>9.<span class="label success">è¿›ç¨‹æŸ¥çœ‹å‘½ä»¤</span>ï¼š<strong>ps</strong></p>
<p>#æŸ¥çœ‹æ‰§è¡Œçš„test.shå‘½ä»¤</p>
<blockquote>
<p>ps -aux | grep â€œ<a href="http://test.sh">test.sh</a>â€</p>
</blockquote>
<p>#æŸ¥çœ‹tomcatè¿›ç¨‹</p>
<blockquote>
<p>ps -aux |grep tomcat</p>
</blockquote>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">a:</span>æ˜¾ç¤ºæ‰€æœ‰ç¨‹åº </span><br><span class="line"><span class="symbol">u:</span>ä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼æ¥æ˜¾ç¤º </span><br><span class="line"><span class="symbol">x:</span>æ˜¾ç¤ºæ‰€æœ‰ç¨‹åºï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ†</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>mariadbå¿˜è®°å¯†ç </title>
    <url>/2020/09/20/mariadb%E5%BF%98%E8%AE%B0%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<div class="note info">
            <p>mariadbå’Œmysqlç­‰æ•°æ®åº“ï¼Œå…¶å®æ²¡æœ‰ä»€ä¹ˆé…ç½®æ–‡ä»¶ï¼Œå°±<span class="label warning">/etc/my.cnf</span>ï¼Œå°±ç®—æœ‰å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œä¹Ÿéƒ½å†™åœ¨<span class="label info">my.cnf</span>é‡Œé¢ï¼Œä»è¿™é‡Œé¢æ‰¾å°±è¡ŒğŸ˜„</p>
          </div>
<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h2>
<p>å¿˜è®° <span class="ljspan ljspan-reverse ljspan-red">MariaDB</span>çš„rootå¯†ç ï¼Œéœ€è¦ä¿®æ”¹rootå¯†ç </p>
<p>åœ¨ <span class="ljspan ljspan-reverse ljspan-red">MariaDB</span>é…ç½®æ–‡ä»¶<span class="label warning">/etc/my.cnf</span>ä¸­çš„<span class="label success">[mysqld]</span>ä¸­åŠ å…¥ä¸€è¡Œï¼š<code>skip-grant-tables</code></p>
<a id="more"></a>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">port</span>=<span class="number">3307</span></span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks</span></span><br><span class="line"><span class="attr">symbolic-links</span>=<span class="number">0</span></span><br><span class="line"><span class="comment"># Settings user and group are ignored when systemd is used.</span></span><br><span class="line"><span class="comment"># If you need to run mysqld under a different user or group,</span></span><br><span class="line"><span class="comment"># customize your systemd unit file for mariadb according to the</span></span><br><span class="line"><span class="comment"># instructions in http://fedoraproject.org/wiki/Systemd</span></span><br><span class="line"><span class="comment">#å–æ¶ˆmysqlè¿›è¡ŒåŸŸåè§£æ</span></span><br><span class="line">skip-name-resolve</span><br><span class="line"><span class="comment">#è®¾ç½®æ•°æ®å»é»˜è®¤ç¼–ç ä¸ºUTF-8</span></span><br><span class="line"><span class="attr">character_set_server</span>=utf8</span><br><span class="line"><span class="attr">init_connect</span>=<span class="string">&#x27;SET NAMES utf8&#x27;</span></span><br><span class="line"><span class="comment">#skip-grant-tables</span></span><br><span class="line"><span class="comment">#åŠ å…¥ä¸‹é¢è¿™ä¸€è¡Œ</span></span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>
<p>é‡å¯æœåŠ¡</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ <span class="regexp">/etc/i</span>nit.d/mysqld restart</span><br></pre></td></tr></table></figure>
<h2 id="é‡æ–°ç™»é™†">é‡æ–°ç™»é™†</h2>
<p>è¿›å…¥ <span class="ljspan ljspan-reverse ljspan-red">MariaDB</span>ä¿®æ”¹rootçš„å¯†ç </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysql -uroot</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.27 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_mysql           |</span><br><span class="line">+---------------------------+</span><br><span class="line">| columns_priv              |</span><br><span class="line">| db                        |</span><br><span class="line">| engine_cost               |</span><br><span class="line">| event                     |</span><br><span class="line">| func                      |</span><br><span class="line">| general_log               |</span><br><span class="line">| gtid_executed             |</span><br><span class="line">| help_category             |</span><br><span class="line">| help_keyword              |</span><br><span class="line">| help_relation             |</span><br><span class="line">| help_topic                |</span><br><span class="line">| innodb_index_stats        |</span><br><span class="line">| innodb_table_stats        |</span><br><span class="line">| ndb_binlog_index          |</span><br><span class="line">| plugin                    |</span><br><span class="line">| proc                      |</span><br><span class="line">| procs_priv                |</span><br><span class="line">| proxies_priv              |</span><br><span class="line">| server_cost               |</span><br><span class="line">| servers                   |</span><br><span class="line">| slave_master_info         |</span><br><span class="line">| slave_relay_log_info      |</span><br><span class="line">| slave_worker_info         |</span><br><span class="line">| slow_log                  |</span><br><span class="line">| tables_priv               |</span><br><span class="line">| time_zone                 |</span><br><span class="line">| time_zone_leap_second     |</span><br><span class="line">| time_zone_name            |</span><br><span class="line">| time_zone_transition      |</span><br><span class="line">| time_zone_transition_type |</span><br><span class="line">| user                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">31 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; update user set authentication_string&#x3D;password(&#39;root&#39;) where user&#x3D;&#39;root</span><br><span class="line"></span><br><span class="line">Query OK, 1 row affected, 1 warning (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 1</span><br><span class="line"></span><br><span class="line">mysql&gt; flush privileges</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; quit</span><br><span class="line">Bye</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œçš„authentication_stringå­—æ®µæœ‰æ—¶å€™å¯èƒ½æ˜¯passwordï¼Œå–å†³äºä½ çš„ç‰ˆæœ¬</p>
<p>å¦‚æœåœ¨ä¿®æ”¹å¯†ç çš„æ—¶å€™å‡ºç°è¿™æ ·çš„é”™è¯¯<code>Unknown column 'password' in 'field list'</code>ï¼Œé‚£è¯æ˜mysqlä¸æ”¯æŒpasswardå­—æ®µäº†ï¼Œmysql5.7ä»¥åï¼Œauthentication_stringå­—æ®µä»£æ›¿äº†passwordå­—æ®µ</p>
</blockquote>
<h2 id="å†æ¬¡ç™»é™†">å†æ¬¡ç™»é™†</h2>
<p>åœ¨ç™»é™†å‰è¦æ³¨é‡Šæ‰é…ç½®æ–‡ä»¶<span class="label warning">/etc/my.cnf</span>ä¸­ <span class="label success">[mysqld]</span>é‡Œé¢çš„çš„<code>skip-grant-tables</code>å­—æ®µ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.27 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2019, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>mariadb</tag>
      </tags>
  </entry>
  <entry>
    <title>resolv.conf</title>
    <url>/2020/09/09/resolv-conf/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>resolv.confæ˜¯ä»€ä¹ˆå‘¢â”ï¼Œå…‰çœ‹åå­—ä¸æ‡‚ï¼ğŸ’«å…¶å®ä»–å°±æ˜¯ä¸€ä¸ªDNSå®¢æˆ·æœºé…ç½®æ–‡ä»¶ï¼Œç”¨äºè®¾ç½®DNSæœåŠ¡å™¨çš„IPåœ°å€ä»¥åŠDNSåŸŸå</p>
<a id="more"></a>
<h2 id="resolv-confæ–‡ä»¶è§£æ">resolv.confæ–‡ä»¶è§£æ</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">nameserver    *//å®šä¹‰DNSæœåŠ¡å™¨çš„IPåœ°å€* </span><br><span class="line">domain       *//å®šä¹‰æœ¬åœ°åŸŸå* </span><br><span class="line">search        *//å®šä¹‰åŸŸåçš„æœç´¢åˆ—è¡¨* </span><br><span class="line">sortlist        *//å¯¹è¿”å›çš„åŸŸåè¿›è¡Œæ’åº*</span><br></pre></td></tr></table></figure>
<blockquote>
<p>nameserverå‚æ•°å¿…é¡»æœ‰ğŸ˜€ï¼Œå…¶ä»–ä¸ºå¯é€‰</p>
</blockquote>
<hr>
<h2 id="resolv-confç”±ä¸‰ç§æ–¹å¼æ§åˆ¶">resolv.confç”±ä¸‰ç§æ–¹å¼æ§åˆ¶</h2>
<p>1.network manager</p>
<p>2.resolvconf</p>
<p>3.systemd-resolved</p>
<hr>
<h2 id="å…³äºé¿å…åœ¨-etc-resolv-confä¸­ä½¿ç”¨namespace127-0-0-53">å…³äºé¿å…åœ¨/etc/resolv.confä¸­ä½¿ç”¨namespace127.0.0.53</h2>
<p>è¿™ä¸ªé—®é¢˜åœ¨<span class="ljspan ljspan-reverse ljspan-blue"><a href="/2020/09/08/%E5%AE%89%E8%A3%85elabFTW/">å®‰è£…elabFTW</a></span>æ—¶å‡ºç°è¿‡ï¼Œå› ä¸ºelabftwæ˜¯é‡‡ç”¨dockerå®‰è£…çš„ï¼Œå®‰è£…æ—¶ï¼Œç”¨åˆ°ä¸¤ä¸ªå®¹å™¨ï¼Œåˆ†åˆ«æ˜¯elabftw_webå’Œmysqlå®¹å™¨ï¼Œä½†æ˜¯ä¸¤ä¸ªå®¹å™¨ä¸€ç›´æ— æ³•è¿æ¥ï¼Œä¸€ç›´æŠ¥æ²¡æœ‰å®‰è£…mysqlå®¹å™¨ï¼Œæœ€åé€šè¿‡<span class="ljspan ljspan-blue"><a href="https://github.com/elabftw/elabftw/issues/1881">githubæé—®</a></span>,ä½œè€…å‘Šè¯‰äº†æˆ‘é—®é¢˜çš„åŸå› å°±æ˜¯è¿™ä¸ªï¼Œæä¾›çš„è§£å†³åŠæ³•å†ä¸Šé¢çš„æ–‡ç« ä¸Šï¼Œæœ€åæˆ‘æ˜¯æ”¹ç”¨networkmanageræ¥ç®¡ç†,æ‰è§£å†³è¯¥é—®é¢˜</p>
<blockquote>
<p>å…³äºè¿™ä¸ªé—®é¢˜çš„è¯¦ç»†å™è¿°æ–‡ç« åœ¨<a href="https://www.hiroom2.com/2017/08/24/ubuntu-1610-nameserver-127-0-0-53-en/">è¿™é‡Œ</a></p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>mysqlçš„ç”¨æ³•</title>
    <url>/2020/09/10/mysql%E7%9A%84%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p><img src="/assets/img/640px-MySQL_logo.svg.png" alt=""></p>
<p>è¿™é‡Œçš„mysqlç”¨æ³•åˆ†linuxå’Œwindowä¸¤ä¸ªéƒ¨åˆ†ï¼ŒåŒæ—¶ä¹Ÿé‡‡é›†äº†ä¸€äº›æ“ä½œmysqlæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œæ”¾åœ¨ç»“å°¾éƒ¨åˆ†ğŸ—‚</p>
<a id="more"></a>
<hr>
<h2 id="linuxä¸Šçš„mysql">linuxä¸Šçš„mysql</h2>
<h3 id="æ“ä½œmysqlæœåŠ¡ğŸ„">æ“ä½œmysqlæœåŠ¡ğŸ„</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹mysqlæœåŠ¡çš„çŠ¶æ€</span></span><br><span class="line">sudo service mysql status</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…³é—­mysqlæœåŠ¡</span></span><br><span class="line">sudo service mysql stop</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯mysqlæœåŠ¡</span></span><br><span class="line">sudo service mysql start </span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥æ‰¾mysqlæ–‡ä»¶ğŸŒ»">æŸ¥æ‰¾mysqlæ–‡ä»¶ğŸŒ»</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥è¯¢mysqlçš„å†…å®¹çš„åœ°å€(æ¯”è¾ƒè¯¦ç»†)</span></span><br><span class="line">find / -name mysql  </span><br><span class="line"><span class="comment">#ä¹Ÿå¯é€šè¿‡whereis(æ¯”è¾ƒç¬¼ç»Ÿ)</span></span><br><span class="line">whereis mysql</span><br></pre></td></tr></table></figure>
<h3 id="æŸ¥çœ‹å®‰è£…åŒ…ğŸŒ¿">æŸ¥çœ‹å®‰è£…åŒ…ğŸŒ¿</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥è¯¢é€šè¿‡apt-getçš„å·²å®‰è£…çš„è½¯ä»¶</span></span><br><span class="line">sudo dpkg -l</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®çš„å„ç§ç›®å½•è§£æğŸŒ±">æ•°æ®çš„å„ç§ç›®å½•è§£æğŸŒ±</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#mysqlçš„datadir,ç”¨äºå­˜å‚¨æ•°æ®</span></span><br><span class="line">/var/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqlçš„é…ç½®æ–‡ä»¶ç›®å½•</span></span><br><span class="line">/etc/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#mysqlæœåŠ¡çš„ç›®å½•ï¼Œå°±æ˜¯â€˜service mysql startâ€™ç­‰å‘½ä»¤çš„æ‰§è¡Œå¤„</span></span><br><span class="line">/etc/init.d/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…¶å®å¾ˆå¤šæ–‡ä»¶éƒ½åœ¨/usrç›®å½•ä¸­</span></span><br><span class="line"><span class="comment">#mysqlå‘½ä»¤ç›®å½•</span></span><br><span class="line">/usr/bin/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#åŠ¨æ€åº“</span></span><br><span class="line">/usr/lib/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line">/usr/share/mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="windowä¸Šçš„mysql">windowä¸Šçš„mysql</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¼€å¯æœåŠ¡</span></span><br><span class="line">net start mysql</span><br><span class="line"><span class="comment">#å…³é—­æœåŠ¡</span></span><br><span class="line">net stop mysql</span><br><span class="line">--------------------</span><br><span class="line">(éœ€è¦ç™»å½•åˆ°mysqlåæ‰ä½¿ç”¨)</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ•°æ®åº“åŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">status;</span><br><span class="line"><span class="comment">#æŸ¥çœ‹ç«¯å£å·</span></span><br><span class="line">show global variables like <span class="string">&#x27;port&#x27;</span>;  </span><br></pre></td></tr></table></figure>
<hr>
<h2 id="mysqlé—®é¢˜é›†">mysqlé—®é¢˜é›†</h2>
<h3 id="1-ç¨‹åºè¢«å ç”¨ï¼Ÿsock-lock-fileæ— æ³•ä¿®æ”¹ï¼Ÿ">1.ç¨‹åºè¢«å ç”¨ï¼Ÿsock lock fileæ— æ³•ä¿®æ”¹ï¼Ÿ</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">2020-03-27T06:51:55.089835Z 0 [ERROR] Another process with pid 5244 is using unix socket file.</span><br><span class="line">2020-03-27T06:51:55.089873Z 0 [ERROR] Unable to setup unix socket lock file.</span><br><span class="line">2020-03-27T06:51:55.089886Z 0 [ERROR] Aborting</span><br></pre></td></tr></table></figure>
<p><span class="ljspan ljspan-red">è§£å†³åŠæ³•</span>:</p>
<p>â€‹	1ï¸âƒ£ï¼šå…³é—­mysqlæœåŠ¡<br>
â€‹	2ï¸âƒ£ï¼šåˆ°/var/run/mysqld/ç›®å½•ä¸­ï¼Œæ‰¾åˆ°mysqld.sock.lockæ–‡ä»¶,é‡å‘½åæˆ–è€…å¤‡ä»½ååˆ é™¤åŸæ–‡ä»¶<br>
â€‹	3ï¸âƒ£ï¼šé‡æ–°å¯åŠ¨mysqlæœåŠ¡å³å¯</p>
<h3 id="2-ç»‘å®šIP-ç«¯å£æƒé™é™åˆ¶">2.ç»‘å®šIP/ç«¯å£æƒé™é™åˆ¶</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">2020-03-26T06:52:46.063437Z 0 [ERROR] Can<span class="string">&#x27;t start server: Bind on TCP/IP port: Permission denied</span></span><br><span class="line"><span class="string">2020-03-26T06:52:46.063462Z 0 [ERROR] Do you already have another mysqld server running on port: 3306 ?</span></span><br><span class="line"><span class="string">2020-03-26T06:52:46.063487Z 0 [ERROR] Aborting</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>é‡åˆ°è¿™ä¸ªé—®é¢˜å¯èƒ½æ˜¯ç«¯å£å ç”¨é—®é¢˜ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸»æœºIPçš„è®¾ç½®é—®é¢˜</p>
</blockquote>
<p>æƒ…å†µä¸€ï¼š</p>
<p>æˆ‘æ— æ³•é€šè¿‡sshæ–¹å¼è¿œç¨‹ç™»å½•mysqlï¼Œä½†ä½¿ç”¨localhostæœ¬æœºï¼Œå°±å¯ä»¥ç™»é™†äº†ï¼Œè¿™ä¸ªå°±æ˜¯IPé—®é¢˜å•¦ğŸ“</p>
<p>å¯é€šè¿‡ä¿®æ”¹mysqlé…ç½®æ–‡ä»¶è§£å†³ï¼Œå¯èƒ½æ˜¯<span class="label danger">my.cnf</span>æ–‡ä»¶ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯<span class="label warning">mysqld.cnf</span>ç­‰ç­‰ï¼Œåæ­£çœ‹åˆ°æœ‰é…ç½®<span class="label info">datadir</span>å’Œ<span class="label info">socket</span>ç­‰å­—çœ¼çš„æ–‡ä»¶å°±æ˜¯äº†</p>
<p>è¿›å…¥<span class="label danger">my.cnf</span>ç„¶åå¦‚æœçœ‹åˆ°<code>bind-address   = 127.0.0.1</code>ï¼Œå°±æ³¨é”€æ‰ï¼Œè¿™æ ·å°±å¯ä»¥è¿œç¨‹å¼€å¯mysqlæœåŠ¡äº†</p>
<p>æƒ…å†µäºŒï¼š<br>
ç”±äºç«¯å£3306è¢«å ç”¨ï¼Œæ‰€ä»¥å¼€å¯ä¸äº†ï¼killæ‰å ç”¨è¿™ä¸ªç«¯å£çš„è¿›ç¨‹å°±è¡Œäº†</p>
<h3 id="3-mysqlå­—ç¬¦æ ¼å¼å¯¼è‡´æ— æ³•å¯¼å‡ºæ•°æ®">3.mysqlå­—ç¬¦æ ¼å¼å¯¼è‡´æ— æ³•å¯¼å‡ºæ•°æ®</h3>
<p>æƒ³ä½¿ç”¨workbench<span class="label success">å¯¼å‡ºæ•°æ®åº“è¡¨ä¸ºsqlè„šæœ¬</span>ï¼Œç„¶åå¯¼å…¥åˆ°å…¶ä»–ç³»ç»Ÿä¸­å»<br>
ä½†æ˜¯åœ¨ä½¿ç”¨sqlè„šæœ¬ç›´æ¥å¯¼å…¥åˆ°linuxä¸­çš„mysqlæ•°æ®åº“ä¸­ï¼Œä½†æ˜¯ä¸€ç›´æŠ¥é”™ï¼Œå¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ERROR 1273 (HY000): Unknown collation: <span class="string">&#x27;utf8mb4_0900_ai_ci&#x27;</span></span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾æ˜¯å­—ç¬¦é”™è¯¯çš„é—®é¢˜ï¼ˆæ’åºè§„åˆ™ï¼‰ï¼Œæ‰€ä»¥æˆ‘æ”¹äº†æ•°æ®åº“çš„æ’åºè§„åˆ™ï¼Œä½†æ˜¯ä¸è¡ŒğŸ˜µ</p>
<p>ç‚¹å¼€æ¯ä¸ªæ•°æ®åº“è¡¨ï¼Œå‘ç°å®ƒçš„æ’åºè§„åˆ™ä¹Ÿä¸åŒï¼Œæ¥ç€ä¿®æ”¹ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå¾ˆå¥‡æ€ªğŸ‘´</p>
<p>åé¢å‘ç°æ¯ä¸ªcolumnçš„æ’åºè§„åˆ™ä¹Ÿè¦ä¿®æ”¹ï¼ŒğŸ¢ğŸ¢ï¼Œåšå®Œè¿™ä¸€æ­¥ï¼Œæ‰èƒ½å®ç°å¯¼å…¥æˆåŠŸ</p>
<blockquote>
<p>sqlè„šæœ¬è®°å½•çš„æ˜¯è¡¨æ•°æ®ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥ä¸€èˆ¬éœ€è¦æ–°å»º</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">è¿›å…¥æ•°æ®åº“</span></span><br><span class="line">mysql -u username -p password</span><br><span class="line"><span class="meta">#</span><span class="bash">è¿›å…¥æ•°æ®åº“ï¼ˆæ²¡æœ‰éœ€è¦æ–°å»ºï¼‰</span></span><br><span class="line">use database;</span><br><span class="line"><span class="meta">#</span><span class="bash">è·‘sqlè„šæœ¬</span></span><br><span class="line">source /path/to/xxx.sql</span><br></pre></td></tr></table></figure>
<h3 id="4-å¤šä¸ªæ•°æ®åº“æ··åˆä½¿ç”¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶">4.å¤šä¸ªæ•°æ®åº“æ··åˆä½¿ç”¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶</h3>
<p>ä½¿ç”¨<span class="ljspan ljspan-blue">sqlyog</span>ç™»å½•æ•°æ®åº“ä¸€ç›´å¤±è´¥,ä½†æ˜¯ä½¿ç”¨cmdç™»å½•mysqlå´æˆåŠŸäº†ğŸ™‡<br>
ç„¶åæˆ‘å°±è¿›å…¥mysqlä¸­æŸ¥çœ‹æ•°æ®åº“çš„ç‰ˆæœ¬ä¿¡æ¯å’Œç«¯å£å·çš„ä¿¡æ¯,å‘ç°ç‰ˆæœ¬å¯¹äº†ï¼Œä½†æ˜¯ç«¯å£é”™äº†ï¼Œä¿®æ”¹ç«¯å£é‡å¯ï¼Œä½†æ˜¯ç«¯å£è¿˜æ˜¯æ²¡æœ‰å˜ï¼(âŠ™oâŠ™)ï¼Ÿâ€¦é˜¿è¿™â€¦<br>
æ‰¾åˆ°é—®é¢˜äº†ï¼ŒåŸæ¥å› ä¸ºæˆ‘<span class="label danger">ä¸‹è½½å®‰è£…äº†å¤šä¸ªæ•°æ®åº“</span>åˆæ²¡æœ‰é…ç½®æ¸…æ¥šï¼Œæ‰€ä»¥å¯¼è‡´æˆ‘ç™»å½•çš„æ•°æ®åº“ä½¿ç”¨åˆ°çš„æ˜¯å…¶ä»–æ•°æ®åº“çš„é…ç½®æ–‡ä»¶my.iniï¼Œè¿™å°±å¯¼è‡´äº†ä¹‹å‰çš„ä¿®æ”¹ç«¯å£æ— æ•ˆã€‚</p>
<p>é—®é¢˜æ‰¾åˆ°äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ‰§è¡Œæ–‡ä»¶çš„é»˜è®¤è¯»å–é…ç½®æ–‡ä»¶è·¯å¾„æ€ä¹ˆæ”¹å‘¢ï¼Ÿâ€¦(âŠ™ï¹âŠ™)</p>
<blockquote>
<p>é€šè¿‡ä¸Šç½‘å¯çŸ¥ï¼Œå¯é€šè¿‡ä¿®æ”¹æ³¨å†Œè¡¨æ¥è®¾ç½®ã€‚</p>
</blockquote>
<p>æ‰“å¼€<code>æ³¨å†Œè¡¨ç¼–è¾‘å™¨</code>â€“<code>HKEY_LOCAL_MACHINE</code>â€“<code>SYSTEM</code>â€“<code>CurrentControlSet</code>â€“<code>Services</code>(åˆ°è¿™ä¸€æ­¥å¯ä»¥çœ‹åˆ°æ•°æ®åº“åç§°)ï¼Œä¹‹å‰æˆ‘å°±æ˜¯é€šè¿‡åœ¨è¿™é‡Œä¿®æ”¹<code>DisplayName</code>/<code>ImagePath</code>æ¥åŒºåˆ†ä¸åŒçš„æ•°æ®åº“æœåŠ¡çš„ã€‚ç°åœ¨å¯é€šè¿‡ä¿®æ”¹<code>ImagePath</code>ï¼Œåœ¨é‡Œé¢çš„æ‰§è¡Œæ–‡ä»¶åæ·»åŠ <br>
â€“defaults-file=â€œpath\to\your mysql file\my.iniâ€ï¼ˆè¿™æ˜¯æˆ‘åœ¨mysql8.0çš„æœåŠ¡ä¸­çœ‹åˆ°çš„:happy:ï¼‰<br>
è¿™æ ·å°±å¯ä»¥å•¦</p>
<h3 id="5-è¯¯ç”¨å…¶ä»–æ•°æ®åº“é…ç½®å¯¼è‡´æ— æ³•è¯»å–æ•°æ®">5.è¯¯ç”¨å…¶ä»–æ•°æ®åº“é…ç½®å¯¼è‡´æ— æ³•è¯»å–æ•°æ®</h3>
<p>ç”±äºä¸Šä¸€ä¸ªé—®é¢˜å¯¼è‡´äº†è¿™ä¸€ä¸ªé—®é¢˜(+_+)?</p>
<div class="note info">
            <p>åœ¨linuxä¸Šå¯ä»¥é€šè¿‡æ—¥å¿—ç›®å½•ç›´æ¥æŸ¥çœ‹æ—¥å¿—ï¼›é‚£windowsä¸Šçš„æ—¥å¿—æ–‡ä»¶åº”è¯¥ä¹Ÿæœ‰å§ï¼Œæ²¡æœ‰æ—¥å¿—ç›®å½•ï¼Œä½†æ˜¯åœ¨dataæ–‡ä»¶ä¸­ï¼Œå…¶å®æœ‰å…³äºæ•°æ®åº“å¢åˆ æ”¹æŸ¥çš„ç¼“å­˜å’Œé”™è¯¯ä¿¡æ¯çš„æ—¥å¿—ï¼Œæ‰€ä»¥å¦‚æœæ•°æ®åº“æ— æ³•è¿æ¥ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰¾é”™è¯¯æ—¥å¿—æ–‡ä»¶</p>
          </div>
<p>è¿™æ¬¡çš„é—®é¢˜æ˜¯å› ä¸ºä¹‹å‰mysql8.0ä½¿ç”¨mysql5.7çš„é…ç½®æ–‡ä»¶my.iniï¼Œè€Œmysql5.7çš„<span class="label info">æ•°æ®é…ç½®</span>éƒ½æ˜¯åœ¨my.iniä¸­çš„ï¼Œæ‰€ä»¥å¯¼è‡´ä¹‹å‰<span class="label warning">mysql5.7æ“ä½œæ•°æ®åº“</span>ä½¿ç”¨çš„æ˜¯<span class="label danger">mysql8.0çš„å¼•æ“</span>ï¼Œè€Œç°åœ¨æ¢æˆmysql.5.7å¼•æ“äº†,è‡ªç„¶å†…éƒ¨çš„ç¼“å­˜æ•°æ®æ–‡ä»¶æ— æ³•æ“ä½œã€‚</p>
<p><span class="ljspan ljspan-red">è§£å†³æ–¹æ³•</span><br>
1.ç›´æ¥é‡è£…æ•°æ®åº“ï¼ˆå¦‚æœé‡Œé¢æ²¡æœ‰é‡è¦æ•°æ®ï¼‰<br>
2.åˆ æ‰æ‰€æœ‰æ•°æ®æ–‡ä»¶åé‡å¯æ•°æ®åº“<br>
3.é€šè¿‡æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–‡ä»¶ï¼Œå®˜æ–¹æ¨èæ˜¯ä½¿ç”¨<a href="https://dev.mysql.com/doc/refman/5.7/en/forcing-innodb-recovery.html">å¼ºåˆ¶æ¢å¤æ¨¡å¼</a>æ¥æ¢å¤æ•°æ®</p>
<h3 id="6-mysqlåˆå§‹åŒ–å¤±è´¥">6.mysqlåˆå§‹åŒ–å¤±è´¥</h3>
<p>æƒ³åœ¨ç”µè„‘ä¸Šå®‰è£…mysql5.7ï¼Œä¹‹å‰å·²ç»åœ¨æˆ‘çš„ç”µè„‘ä¸Šè£…äº†ä¸¤ä¸ªmysql8ï¼Œä¸€ä¸ªæ˜¯æºç å®‰è£…ï¼Œä¸€ä¸ªæ˜¯å®‰è£…å™¨å®‰è£…</p>
<p>è¿™ä¸€æ¬¡æˆ‘ä¹Ÿæƒ³é€šè¿‡æºç å®‰è£…ï¼ŒmysqlæœåŠ¡å®‰è£…å€’æ˜¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯mysqlåˆå§‹åŒ–ä¸€ç›´å¤±è´¥ï¼Œä¸çŸ¥é“ä¸ºä½•ğŸ™‰</p>
<p>é€šè¿‡ä¸€äº›è››ä¸é©¬è¿¹ï¼Œæˆ‘å‘ç°ï¼Œæ¯æ¬¡åˆå§‹åŒ–ï¼Œæˆ‘çš„å¦ä¸€ä¸ªmsyqlçš„dataæ–‡ä»¶å¤¹æœ‰æ›´æ–°ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰åŠ¨å®ƒå‘€ï¼(ï¿£ â€˜i ï¿£;)</p>
<p>æŸ¥çœ‹æ—¥å¿—ï¼Œå‘ç°é”™è¯¯å¦‚ä¸‹ğŸ‘‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[Warning] <span class="string">&#x27;NO_ZERO_DATE&#x27;</span>, <span class="string">&#x27;NO_ZERO_IN_DATE&#x27;</span> and <span class="string">&#x27;ERROR_FOR_DIVISION_BY_ZERO&#x27;</span> sql modes should be used with strict mode. They will be merged with strict mode <span class="keyword">in</span> a future release.</span><br><span class="line">[Warning] <span class="string">&#x27;NO_AUTO_CREATE_USER&#x27;</span> sql mode was not <span class="built_in">set</span>.</span><br><span class="line">[Error] initialize specified but the data directory has files <span class="keyword">in</span> it. Aborting</span><br></pre></td></tr></table></figure>
<p>æˆ‘è¿˜æ²¡åˆå§‹åŒ–ï¼Œæˆ‘çš„mysql5.7ç›®å½•ä¸‹ï¼Œå¹¶æ²¡æœ‰dataæ–‡ä»¶å¤¹ï¼Œä¸ºä½•ä¼šè¯´æˆ‘æœ‰ï¼Ÿ</p>
<p>éš¾é“æ¯æ¬¡åˆå§‹åŒ–éƒ½å»mysql8æ–‡ä»¶å¤¹ä¸‹æŸ¥æ‰¾â”(âŠ™oâŠ™)â”</p>
<p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘è§‰å¾—åº”è¯¥å°±æ˜¯<span class="label success">ç¯å¢ƒå˜é‡</span>çš„é—®é¢˜äº†ï¼Œæ‰€ä»¥æˆ‘ä¿®æ”¹mysqlçš„ç¯å¢ƒå˜é‡ä¸ºmysql5.7çš„ï¼Œé‡æ–°æ‰§è¡Œå¦‚ä¸‹å°±å¯ä»¥äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#å¯ä»¥åˆå§‹åŒ–äº†</span><br><span class="line">mysql --initialize  </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸‹è½½å·¥å…·Aria2</title>
    <url>/2020/05/28/%E4%B8%8B%E8%BD%BD%E5%B7%A5%E5%85%B7Aria2/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>ä¸€èˆ¬çš„ä¸‹è½½å·¥å…·éƒ½è¦ä¸‹è½½è½¯ä»¶ï¼Œæ¯æ¬¡è¦ä¸‹è½½ä¸œè¥¿ï¼Œéƒ½éœ€è¦å…ˆæ‰“å¼€å®ƒï¼Œåƒè¿…é›·è¿˜æœ‰ä¸€å †å¹¿å‘Šå’Œæ’ä»¶ğŸ˜¤ã€‚Aria2å¯ä»¥ç›´æ¥é€šè¿‡ç½‘é¡µä¸‹è½½ï¼Œé€Ÿåº¦å¾ˆå¿«å“¦ï¼Œå®Œå…¨æ²¡æœ‰å…¶ä»–æ’ä»¶å’Œå¹¿å‘Šï¼Œä¸è¿‡æš‚ä¸æ”¯æŒå¤–ç½‘èµ„æºï¼Œåæ­£æˆ‘çš„æ˜¯è¿™æ ·ğŸ’©</p>
<a id="more"></a>
<hr>
<h2 id="åŠŸèƒ½">åŠŸèƒ½</h2>
<ul>
<li>æ”¯æŒå¤šç§æ ¼å¼ï¼š<strong>http/https</strong>, <strong>magnet</strong>(ç£åŠ›é“¾æ¥), <strong>BTç§å­</strong>ğŸ‘€</li>
<li>å°è€Œç®€å•ï¼šåªæœ‰2Mçš„å¤§å°</li>
<li>ä½¿ç”¨æµè§ˆå™¨æ˜¾ç¤ºä¸‹è½½ç•Œé¢</li>
</ul>
<h3 id="ä¸‹è½½åœ°å€"><a href="https://github.com/aria2/aria2">ä¸‹è½½åœ°å€</a></h3>
<hr>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>ç”±äº<span class="ljspan ljspan-reverse"><a href="https://github.com/aria2/aria2">Aria2</a></span>æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œçš„å·¥å…·ï¼Œå¯ç”¨äºå¤šç§ç³»ç»Ÿï¼ŒåŒ…æ‹¬<strong>Linuxç³»ç»Ÿ</strong>ï¼Œæ‰€ä»¥ï¼Œå¯¹äºå›¾å½¢åŒ–ç•Œé¢çš„<strong>Windows</strong>ç”¨æˆ·æ¥è¯´ã€‚çŸ­æ—¶é—´éš¾ä»¥æ“ä½œ</p>
<p>æ•…æœ‰è®¸å¤šHackeræä¾›äº†æ’ä»¶ï¼Œé€šè¿‡ç®€ä¾¿çš„è®¾ç½®ä¹‹åå°±å¯ä»¥é€šè¿‡å›¾å½¢åŒ–ç•Œé¢ä¸‹è½½å•¦ï¼</p>
<h3 id="æ’ä»¶ä¸‹è½½-é…ç½®åœ°å€ï¼š">æ’ä»¶ä¸‹è½½/é…ç½®åœ°å€ï¼š</h3>
<p>æ’ä»¶1:<a href="http://aria2c.com/usage.html">æœ‰åº”ç”¨ç¨‹åºçš„å·¥å…·(åŒ…æ‹¬é…ç½®è¯´æ˜æ–‡æ¡£)</a>;</p>
<p>æ’ä»¶2:å¯åœ¨åå°è¿è¡Œçš„å·¥å…·<br>
(é“¾æ¥: <a href="https://pan.baidu.com/s/13QBieprXBuYOfZ9PmlTBAQ">https://pan.baidu.com/s/13QBieprXBuYOfZ9PmlTBAQ</a> æå–ç : skct)ï¼›</p>
<hr>
<h2 id="â­ï¸ç®€å•çš„æŒ‡å¯¼ï¼š">â­ï¸ç®€å•çš„æŒ‡å¯¼ï¼š</h2>
<p>é€šè¿‡ä¸Šé¢çš„ä¸‹è½½åœ°å€ï¼Œä¸‹è½½å®Œæˆåï¼Œè§£å‹æ–‡ä»¶åˆ°ä½ è¦çš„ç›®å½•ä¸­ï¼Œç„¶åä¸‹è½½ä»»ä¸€ä¸€æ¬¾<strong>æ’ä»¶</strong>ï¼Œè§£å‹åæ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œä¸‹å›¾æ˜¯<strong>æ’ä»¶1</strong>çš„è®¾ç½®å†…å®¹ï¼Œ</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/assets/img/image-20200528112413587.png" alt="é…ç½®ç›®å½•"></p>
<p>å¯¹äº<strong>å›¾ä¸­é€‰ä¸­çš„éƒ¨åˆ†</strong>å°±æ˜¯<a href="https://github.com/aria2/aria2">ä¸‹è½½åœ°å€</a>ä¸‹è½½çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†ä¸»è¦éœ€è¦æ›¿ä»£<strong>æ’ä»¶</strong>ä¸­çš„<span class="ljspan ljspan-reverse">aria2c</span>è¿™ä¸ªä¸œè¥¿ï¼Œå…¶ä»–çš„å¯ä»¥å¿½ç•¥</p>
<p>é…ç½®æ–‡ä»¶(ä»¥**.conf**ä¸ºåç¼€)å¯ä»¥è®¾ç½®ä½ æ‰€éœ€è¦çš„å„é¡¹é…ç½®ï¼ˆè¿™é‡Œå°±æ˜¯çœç•¥äº†ä½ åœ¨å‘½ä»¤è¡Œä¸€ä¸ªä¸€ä¸ªçš„è®¾ç½®ï¼‰</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section">#å¯åŠ¨aria2</span></span><br><span class="line">ç‚¹å‡»aria2å¯åŠ¨.VBS</span><br><span class="line"><span class="section">#å…³é—­aria2</span></span><br><span class="line">ç‚¹å‡»aria2å…³é—­.bat</span><br><span class="line"><span class="section">#è®¾ç½®å¿«æ·æ–¹å¼</span></span><br><span class="line">æ’ä»¶ä¸€ï¼šæŠŠaria2.exe(ä¸æ˜¯aria2c.exe)è®¾ç½®ä¸ºå¿«æ·æ–¹å¼</span><br><span class="line">æ’ä»¶äºŒï¼šæŠŠaria2å¯åŠ¨.VBSè®¾ç½®ä¸ºå¿«æ·æ–¹å¼</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹ä¸‹è½½å†…å®¹çš„webç«¯<a href="http://aria2c.com/"><strong>aria2c.com</strong></a>ï¼Œç›´æ¥å†æµè§ˆå™¨è¾“å…¥å°±å¯ä»¥äº†ï¼</p>
<hr>
<p>æœ¬æ–‡ç« ç›¸å…³çš„å‚è€ƒæ–‡æ¡£ï¼š</p>
<p>ã€Š<a href="https://www.appinn.com/aria2-in-windows-setup/">æ’ä»¶ä¸€çš„ç›¸å…³æ–‡æ¡£</a>ã€‹</p>
<p>ã€Š<a href="https://zhuanlan.zhihu.com/p/30666881">æ’ä»¶äºŒçš„ç›¸å…³æ–‡æ¡£</a>ã€‹</p>
<p>ã€Š<a href="https://zhuanlan.zhihu.com/p/21831960">é…ç½®çš„ç›¸å…³æ–‡æ¡£</a>ã€‹</p>
]]></content>
      <categories>
        <category>Tools</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>server</tag>
      </tags>
  </entry>
  <entry>
    <title>pythonåŠå…¶å·¥å…·</title>
    <url>/2020/09/11/python%E5%8F%8A%E5%85%B6%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h2 id="Pythonç‰ˆæœ¬">Pythonç‰ˆæœ¬</h2>
<p>1.åˆ†åˆ«æœ‰pythonå’Œpython3ä¸¤ç§ï¼Œpython3å¯¹åº”Python3.xç‰ˆæœ¬</p>
<p>è€Œpythonå¯¹åº”Python2.xç‰ˆæœ¬</p>
<p>2.pipå’Œpip2ç›¸åŒï¼Œå‡å¯¹åº”Python2.xç‰ˆæœ¬ï¼›è€Œpip3å¯¹åº”Python3.xç‰ˆæœ¬</p>
<a id="more"></a>
<hr>
<h2 id="PythonåŒ…ç®¡ç†å·¥å…·">PythonåŒ…ç®¡ç†å·¥å…·</h2>
<p>ç°åœ¨çš„åŒ…ç®¡ç†å·¥å…·éƒ½æ˜¯ç”¨<span class="ljspan  ljspan-red">pip</span>äº†ï¼Œä»¥å‰éƒ½æ˜¯ä½¿ç”¨<span class="ljspan ljspan-black">setuptools</span>ï¼Œè€ç‰ˆæœ¬çš„pythonå°±è¿˜éƒ½åœ¨ç”¨ã€‚</p>
<hr>
<h2 id="pythonè™šæ‹Ÿç¯å¢ƒ">pythonè™šæ‹Ÿç¯å¢ƒ</h2>
<p>æ­å»ºpythonè™šæ‹Ÿç¯å¢ƒï¼Œç°åœ¨éƒ½ä½¿ç”¨<span class="ljspan ljspan-red">conda</span>æ¥å®‰è£…</p>
<blockquote>
<p>å®‰è£…Condaï¼Œè¯·çœ‹<a href="">è¿™é‡Œ</a></p>
</blockquote>
<p>ä¸è¿‡ï¼Œä»¥å‰éƒ½æ˜¯ç”¨<span class="ljspan">virtualenv</span>æ¥è®¾ç½®è™šæ‹Ÿç¯å¢ƒçš„</p>
<p>è¿™é‡Œæœ‰å®‰è£…æ­¥éª¤ğŸ‘‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#[---]ï¼šå¤§æ‹¬å·å†…çš„å†…å®¹éœ€è¦ç”¨æˆ·è‡ªå·±å¡«å†™</span></span><br><span class="line"><span class="comment">#å®‰è£…</span></span><br><span class="line">pip install virtualenv</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºç›®å½•ï¼Œè¿™æ˜¯å¿…é¡»çš„ï¼Œç”¨äºå­˜å‚¨è™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line">mkdir myproject</span><br><span class="line"><span class="built_in">cd</span> myproject/</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„pythonç¯å¢ƒï¼ˆå³è™šæ‹Ÿç¯å¢ƒï¼‰</span></span><br><span class="line">virtualenv --python=[python-version] [env-name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿›å…¥è¿™ä¸ªè™šæ‹Ÿç¯å¢ƒ</span></span><br><span class="line"><span class="built_in">source</span> [env-name]/bin/activate</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Pythonçš„å…¶ä»–å·¥å…·">Pythonçš„å…¶ä»–å·¥å…·</h4>
<hr>
<ol>
<li>Fabric æ˜¯ä¸€ä¸ª Python (2.5-2.7) çš„åº“å’Œå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥æé«˜åŸºäº SSH çš„åº”ç”¨éƒ¨ç½²å’Œç³»ç»Ÿç®¡ç†æ•ˆç‡ã€‚</li>
<li>æ˜¯ç”¨äºè‡ªåŠ¨åŒ–æ„å»ºè½¯ä»¶çš„å·¥å…·ï¼šbulidout</li>
<li>å›¾åƒå¤„ç†æ ‡å‡†åº“ï¼špillow</li>
</ol>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>ä½¿ç”¨curlé‡åˆ°çš„é—®é¢˜</title>
    <url>/2020/09/11/%E4%BD%BF%E7%94%A8curl%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨curlä¸‹è½½githubå†…å®¹æ—¶ç»å¸¸å‡ºç°é—®é¢˜</p>
<p>æ¯”å¦‚ï¼š<code>curl: (7) Failed to connect to raw.githubusercontent.com port 443: Connection refused</code></p>
<a id="more"></a>
<p>è¿™æ˜¯å› ä¸º<span class="label success">**raw.githubusercontent.com**</span> è¿™ä¸ªåŸŸåè¢«æ±¡æŸ“äº†ï¼Œæ‰€ä»¥åœ¨hostsæ–‡ä»¶é‡Œé¢æ·»åŠ ä¸€ä¸‹ipæ˜ å°„å°±å¯ä»¥å•¦</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ å¦‚ä¸‹ï¼Œipå¯é€šè¿‡ https://www.ipaddress.com/ æŸ¥è¯¢ </span></span><br><span class="line">x.x.x.x(ip) raw.githubusercontent.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™æ ·å°±å¯ä»¥å•¦ï¼</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…¶å®åœ¨windowä¸Šä¹Ÿç»å¸¸é‡åˆ°ç±»ä¼¼é—®é¢˜ğŸ˜</p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>ä¼˜åŒ–ä¸ªäººåšå®¢</title>
    <url>/2020/08/31/%E4%BC%98%E5%8C%96%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/</url>
    <content><![CDATA[<h2 id="å‰è¨€"># å‰è¨€</h2>
<p>çœ‹ç€å°æ¹¾æŸå¤§ç¥çš„âœ¨<span class="ljspan ljspan-blue"><a href="https://oawan.me/">åšå®¢</a></span>âœ¨ï¼Œç”Ÿæˆå‘å¾€ï¼Œå¤ªå¥½çœ‹äº†ğŸ˜­ğŸ˜­ğŸ˜­</p>
<p>æ‰€ä»¥å†³å®šè‡ªå·±ä¹Ÿè·Ÿç€å®Œå–„å’Œä¼˜åŒ–æˆ‘çš„åšå®¢</p>
<a id="more"></a>
<blockquote>
<p>ä»¥ä¸‹ä¸€ä¸‹ç›¸å…³æœ¯è¯­ï¼Œå¯ç¿»<a href="https://theme-next.js.org/docs/getting-started/">NexTå®˜æ–¹æ–‡æ¡£</a>æŸ¥çœ‹ï¼Œæ¯”å¦‚ï¼š<code>theme config file</code></p>
</blockquote>
<hr>
<h2 id="è®¾ç½®åˆ†ç±»-æ ‡ç­¾">è®¾ç½®åˆ†ç±»/æ ‡ç­¾</h2>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆæ–°å»ºä¸€ä¸ªåˆ†ç±»é¡µé¢(æ ‡ç­¾æ”¹&quot;categories&quot;ä¸º&quot;tags&quot;)</span></span><br><span class="line"><span class="string">hexo</span> <span class="string">new</span> <span class="string">page</span> <span class="string">categories</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨è¿™ä¸ªé¡µé¢ä¸­è®¾ç½®(æ ‡ç­¾æ”¹&quot;categories&quot;ä¸º&quot;tags&quot;)</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;categories&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯¹äºæ–‡ç« å¦‚æœæƒ³è®¾ç½®å…¶å±äºå“ªä¸ªåˆ†ç±»/æ ‡ç­¾</span></span><br><span class="line"><span class="comment">#ç›´æ¥åœ¨å¤´éƒ¨æ·»åŠ </span></span><br><span class="line"><span class="comment">#åˆ†ç±»</span></span><br><span class="line"><span class="attr">categories:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">ç›®å½•å</span></span><br><span class="line"><span class="comment">#æ ‡ç­¾</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">æ ‡ç­¾å</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¯ä»¥æ·»åŠ å¤šä¸ªæ ‡ç­¾å“¦ï¼Œåªéœ€è¦åˆ†ç±»çš„ä¸‹ä¸€è¡Œå†æ·»åŠ <code>- ç›®å½•å/æ ‡ç­¾å</code>å°±å¯ä»¥å•¦</p>
</blockquote>
<hr>
<h2 id="è®¾ç½®è‡ªå®šä¹‰æ ·å¼è¡¨">è®¾ç½®è‡ªå®šä¹‰æ ·å¼è¡¨</h2>
<p>å…¶å®<a href="https://theme-next.js.org/docs/advanced-settings/custom-files.html">å®˜æ–¹æ–‡æ¡£</a>éƒ½æœ‰è®°è½½ï¼Œæˆ‘æ˜¯ç›´æ¥é‡‡ç”¨å®˜æ–¹æ–‡æ¡£è®°è½½çš„æ–¹å¼å®ç°çš„ï¼Œè¿™æ ·å°±ä¸å®¹æ˜“å†²çª/å‡ºé”™,æˆ‘åªæ˜¯ç…§æ¬æŠ„å†™è€Œå·²ğŸ˜</p>
<h3 id="1-åˆ›å»º-dataç›®å½•">1.åˆ›å»º_dataç›®å½•</h3>
<blockquote>
<p>åœ¨æ ¹ç›®å½•ä¸‹çš„<code>/source</code>ä¸­åˆ›å»º_dataç›®å½•</p>
</blockquote>
<h3 id="2-åˆ›å»ºè‡ªå®šä¹‰æ ·å¼æ–‡ä»¶">2.åˆ›å»ºè‡ªå®šä¹‰æ ·å¼æ–‡ä»¶</h3>
<blockquote>
<p>æ–‡ä»¶åå’Œè·¯å¾„éœ€è¦è·Ÿ<code>theme config file</code>ä¸­çš„<code>custom_file_path</code>ä¸­çš„ä¸€è‡´</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">custom_file_path:</span></span><br><span class="line">  <span class="comment">#é…ç½®å¸ƒå±€</span></span><br><span class="line">  <span class="comment">#head: source/_data/head.njk</span></span><br><span class="line">  <span class="comment">#header: source/_data/header.njk</span></span><br><span class="line">  <span class="comment">#é…ç½®ä¾§è¾¹æ </span></span><br><span class="line">  <span class="comment">#sidebar: source/_data/sidebar.njk</span></span><br><span class="line">  <span class="comment">#postMeta: source/_data/post-meta.njk</span></span><br><span class="line">  <span class="comment">#postBodyEnd: source/_data/post-body-end.njk</span></span><br><span class="line">  <span class="comment">#footer: source/_data/footer.njk</span></span><br><span class="line">  <span class="comment">#bodyEnd: source/_data/body-end.njk</span></span><br><span class="line">  <span class="comment">#variable: source/_data/variables.styl</span></span><br><span class="line">  <span class="comment">#mixin: source/_data/mixins.styl</span></span><br><span class="line">  <span class="comment">#é…ç½®æ ·å¼ è¦†ç›–+&quot;!important&quot;</span></span><br><span class="line">  <span class="comment">#style: source/_data/styles.styl</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Hexoä¸­ä½¿ç”¨emojiè¡¨æƒ…">Hexoä¸­ä½¿ç”¨emojiè¡¨æƒ…</h2>
<h3 id="å‰è¨€-2">#å‰è¨€</h3>
<p>å…¶å®<a href="https://github.com/theme-next/awesome-next#live-preview">NexT</a>å®˜ç½‘æœ‰å…³äºemojiçš„ä½¿ç”¨ä»‹ç»ğŸ’…ï¼Œä¸è¿‡ï¼Œå®ƒä½¿ç”¨çš„æ˜¯<a href="https://github.com/theme-next/hexo-filter-emoji">hexo-filter-emoji</a>(GitHub emojis for Hexo)ï¼Œå¯æˆ‘æƒ³è¦çš„æ˜¯markdowné‡Œé¢çš„emojiå•Šï¼Œé‚£ä¸ªæ›´å¯çˆ±ç‚¹âœŒï¸</p>
<p>ä¸Šç½‘æ‰¾äº†æ‰¾ï¼Œæœ‰åšä¸»å®ç°äº†ğŸ’¯ï¼Œèµ„æ–™ä¹Ÿæ¯”è¾ƒæ–°ï¼Œç›¸å…³æ–‡æ¡£å¦‚ä¸‹ï¼š</p>
<p><a href="https://www.geek-space.cn/post/emoji.html">å‚è€ƒåšä¸»1</a></p>
<p><a href="%5Bhttps://hasaik.com/posts/9b280ea3.html#%F0%9F%8C%9E-%E5%AE%89%E8%A3%85%5D(https://hasaik.com/posts/9b280ea3.html#%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD-%E5%AE%89%E8%A3%85)">å‚è€ƒåšä¸»2</a></p>
<h3 id="å®‰è£…">å®‰è£…</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">npm un hexo-renderer-marked --save</span><br><span class="line">npm i hexo-renderer-markdown-it --save</span><br><span class="line">npm install markdown-it-emoji --save</span><br></pre></td></tr></table></figure>
<h3 id="é…ç½®">é…ç½®</h3>
<p>ä¿®æ”¹<code>site config file</code>ï¼š_config.yml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">markdown:</span></span><br><span class="line">  <span class="attr">plugins:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">markdown-it-footnote</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">markdown-it-sup</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">markdown-it-sub</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">markdown-it-abbr</span></span><br><span class="line"><span class="comment">#å…³é”®æ·»åŠ è¿™ä¸ª</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">markdown-it-emoji</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¯¦ç»†é…ç½®<a href="https://github.com/hexojs/hexo-renderer-markdown-it/wiki/Advanced-Configuration">çœ‹è¿™é‡Œ</a></p>
</blockquote>
<hr>
<h2 id="Hexoä¸­è®¾ç½®å›¾ç‰‡FancyBoxæ’ä»¶">Hexoä¸­è®¾ç½®å›¾ç‰‡FancyBoxæ’ä»¶</h2>
<h3 id="å‰è¨€-3">#å‰è¨€</h3>
<p>é€šè¿‡æŸåšä¸»(å‰é¢æœ‰æåˆ°)çš„åšå®¢ï¼Œå‘ç°å®ƒçš„åšå®¢æ–‡ç« æ‰“å¼€å›¾ç‰‡éƒ½å¾ˆå¥½çœ‹ğŸ˜ï¼Œæ‰€ä»¥å°±æƒ³ç€è·Ÿç€ä»–åšï¼Œçœ‹åˆ°ä»–å¼•ç”¨çš„æ˜¯<a href="https://fancyapps.com/fancybox/#license">FancyBox</a>æ¡†æ¶ï¼Œåˆšå¥½<span class="ljspan ljspan-blue">NexT</span>ä¸»é¢˜ä¹Ÿæ”¯æŒï¼Œé‚£çœŸæ˜¯ç»ä½³å•ŠğŸ˜‰</p>
<h3 id="é…ç½®-2">é…ç½®</h3>
<p>ä¿®æ”¹<code>site config file</code>ï¼š_config.yml</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å¼€å¯fancyboxåŠŸèƒ½</span></span><br><span class="line">fancybox: <span class="literal">true</span></span><br><span class="line"><span class="comment">#é…ç½®fancyboxçš„css,js,jqueryçš„åœ°å€</span></span><br><span class="line"><span class="comment">#å¯é‡‡ç”¨cdnçš„æ–¹å¼ä¹Ÿå¯ä»¥ä½¿ç”¨æœ¬åœ°ç›®å½•å¼•å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FancyBox</span></span><br><span class="line">jquery: <span class="comment">#é“¾æ¥åœ°å€</span></span><br><span class="line">fancybox: <span class="comment">#é“¾æ¥åœ°å€</span></span><br><span class="line">fancybox_css: <span class="comment">#é“¾æ¥åœ°å€</span></span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹">ç¤ºä¾‹</h3>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">#é€šè¿‡é…ç½®è‡ªå®šä¹‰æ ·å¼è¡¨source/_data/styles.styl</span><br><span class="line">#æ·»åŠ ä»£ç å¦‚ä¸‹</span><br><span class="line">&lt;script&gt;</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	$(<span class="string">&quot;.fancybox&quot;</span>).fancybox(&#123;		          </span><br><span class="line">		  helpers : &#123;</span><br><span class="line">			  overlay : &#123;</span><br><span class="line">				  css : &#123;</span><br><span class="line">					  <span class="string">&#x27;background-color&#x27;</span> : <span class="string">&#x27;transparent&#x27;</span></span><br><span class="line">				  &#125;</span><br><span class="line">			  &#125;</span><br><span class="line">		  &#125;</span><br><span class="line">	  &#125;);		       </span><br><span class="line">&#125;); </span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ç¤ºä¾‹æ¼”ç¤º">ç¤ºä¾‹æ¼”ç¤º</h3>
<blockquote>
<p>ç‚¹å‡»å›¾ç‰‡ï¼Œæœ‰ä¸€ä¸ªå¼¹å‡ºæ•ˆæœå“¦ï¼</p>
</blockquote>
<p><img src="/assets/img/20200831_144728.gif" alt="ç¤ºä¾‹"></p>
<hr>
<blockquote>
<p>æ„Ÿè°¢<a href="https://wavedanger.gitee.io/blog/">æµªé™©å…„</a>æä¾›çš„åœ¨çº¿å½•å±å·¥å…·ï¼ï¼ï¼ğŸ‘Š</p>
</blockquote>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†åŒºä¸æŒ‚è½½</title>
    <url>/2020/09/09/%E5%88%86%E5%8C%BA%E4%B8%8E%E6%8C%82%E8%BD%BD/</url>
    <content><![CDATA[<h2 id="åˆ†åŒº">åˆ†åŒº</h2>
<p>æŸ¥çœ‹<span class="label danger">åˆ†åŒºä¸æŒ‚è½½</span>æƒ…å†µï¼šdf -h</p>
<p>æŸ¥çœ‹<span class="label info">å½“å‰ç›®å½•ä¸‹ä¸€çº§å­æ–‡ä»¶å’Œå­ç›®å½•å ç”¨çš„ç£ç›˜å®¹é‡</span>ï¼šdu -lh --max-depth=1</p>
<a id="more"></a>
<p>æŸ¥çœ‹<span class="label warning">ç£ç›˜çš„åˆ†åŒº</span>æƒ…å†µï¼šsudo fdisk -l</p>
<ul>
<li>disk: å°±æ˜¯åˆ†åŒº</li>
<li>device: å°±æ˜¯ä¸€äº›åˆ†åŒºå¥½äº†çš„ç£ç›˜è®¾å¤‡</li>
</ul>
<span class="label info">æŒ‚è½½</span>å’Œ<span class="label info">å¸è½½</span>åˆ†åŒºï¼šmount/umount
<blockquote>
<p>æŒ‚è½½æˆåŠŸä»¥åï¼Œéœ€è¦æŠŠæŒ‚è½½ä¿¡æ¯å†™åœ¨/etc/fstabä¸Šæ‰èƒ½åœ¨æ¯æ¬¡å¼€æœºåï¼Œè‡ªåŠ¨æŒ‚è½½åˆ†åŒº</p>
</blockquote>
<p>mountè¿˜å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿå„åˆ†åŒºçš„æ–‡ä»¶ç³»ç»Ÿâ•</p>
<hr>
<h3 id="ç¤ºä¾‹ï¼š">ç¤ºä¾‹ï¼š</h3>
<p>æƒ³æŠŠ<code>dev/sdb</code>è¿™ä¸ªç£ç›˜åˆ†åŒºğŸ’©</p>
<p><code>fdisk /dev/sdb</code>è¿›å…¥ä»¥åå°±å¯ä»¥åˆ†åŒºäº†</p>
<p>âœ¨<span class="label success">fdisk</span>åŠŸèƒ½å¯æ˜¯å¾ˆå¼ºå¤§çš„å“¦ğŸ‘€</p>
<p>åˆ†äº†ä¸¤ä¸ªä¸»ç›˜sdb1å’Œsdb2</p>
<p>åˆ†åŒºå¥½äº†ä»¥åï¼Œå‘ç°æ— æ³•ç»™è¿™äº›åˆ†åŒºæ ¼å¼åŒ–æ–‡ä»¶ç³»ç»ŸğŸ˜©</p>
<p>è°ƒæŸ¥ä¹‹åï¼Œå‘ç°æ˜¯å› ä¸º<code>/dev/sdb1</code> æ­£è¢«ç³»ç»Ÿä½¿ç”¨ï¼Œåªèƒ½å–æ¶ˆå»ºç«‹æ–‡ä»¶ç³»ç»Ÿ ï¼</p>
<p>åŸæ¥ä¹‹å‰çš„/dev/sdbæ˜¯æŒ‚è½½åœ¨data1ä¸Šçš„ï¼Œç°åœ¨è¢«åˆ†åŒºäº†ï¼Œå°±ä¸èƒ½å†æŒ‚è½½äº†ğŸ’¨</p>
<p>å¸è½½ådata1åï¼Œå°±å¯ä»¥è®¾ç½®æ–‡ä»¶ç³»ç»Ÿäº†</p>
<p>ç°åœ¨ï¼Œå°±å¯ä»¥æŠŠ/dev/sdb1æŒ‚è½½åˆ°/homeä¸Šå•¦ğŸ™‚</p>
<hr>
<h3 id="åˆ†åŒºæˆ–è€…è¯´æ˜¯æŸä¸ªæŒ‚è½½ç›®å½•æ‰©å®¹">åˆ†åŒºæˆ–è€…è¯´æ˜¯æŸä¸ªæŒ‚è½½ç›®å½•æ‰©å®¹</h3>
<p>å› ä¸ºæ²¡æœ‰ä¹‹å‰çš„ç£ç›˜æ²¡æœ‰ä½¿ç”¨é€»è¾‘ç›˜ç¬¦æ¥è®¾ç½®ï¼Œæ‰€ä»¥æ²¡åŠæ³•ä½¿ç”¨<span class="label primary">é€»è¾‘å·</span>æ¥æ‰©å®¹</p>
<p>åªèƒ½åˆ é™¤åŸæœ‰ç£ç›˜çš„æ•°æ®æˆ–è€…è¿ç§»æ•°æ®åˆ°æ–°ç£ç›˜ä¸Šäº†ï¼Œæˆ‘æ²¡æœ‰ç»™æ—§ç£ç›˜æ‰©å®¹äº†ï¼Œæ€•åˆå‡ºé”™ã€‚</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>å‰çƒ§</title>
    <url>/2020/12/07/%E5%8F%89%E7%83%A7/</url>
    <content><![CDATA[<p>ä¸»è¦ææ–™â€”<strong>æ¢…å¤´è‚‰</strong>ï¼šä¹°æ¥åæ´—å¹²å‡€</p>
<p>è°ƒå‘³æ–™ï¼šè’œè“‰å’Œå§œè“‰ï¼Œä¸€å‹ºæ–™é…’ï¼Œä¸€ä¸ªå°æ´‹è‘±ï¼Œä¸¤å‹ºç”ŸæŠ½ï¼Œä¸¤å‹ºè€—æ²¹ï¼Œä¸‰å‹ºå‰çƒ§é…±ï¼Œä¸€å‹ºè…ä¹³æ±ï¼Œä¸€å¤§å‹ºèœ‚èœœã€‚</p>
<p>ç„¶åæ”¾åœ¨ç›†é‡Œï¼Œæ…æ‹Œå‡åŒ€åï¼Œæ”¾ç½®å†°ç®±äºŒåå››å°æ—¶ã€‚ä¸­é—´è¦ç¿»å‡ æ¬¡ï¼Œè®©å®ƒè…Œåˆ¶å‡åŒ€</p>
<p>å»æ‰å§œè’œè“‰åæ”¾å…¥ç”µé¥­ç…²ä¸­ï¼Œç„¶åç‚¹å‡»ç…®é¥­é”®ï¼Œä¸­é—´éœ€è¦ç¿»è½¬å‡ æ¬¡</p>
<p>ç­‰åˆ°æ±æ”¶å¹²åˆ°å·®ä¸å¤šï¼Œå‰©ä¸‹ä¸€ç‚¹é»ç¨ çš„æ±¤æ±å°±å¯ä»¥å‡ºç‚‰å•¦ã€‚</p>
]]></content>
      <categories>
        <category>food</category>
      </categories>
  </entry>
  <entry>
    <title>å¤å‘³åˆ¶ä½œ</title>
    <url>/2020/12/07/%E5%8D%A4%E5%91%B3%E5%88%B6%E4%BD%9C/</url>
    <content><![CDATA[<h3 id="å¤å‘³åˆ¶ä½œè¿‡ç¨‹">å¤å‘³åˆ¶ä½œè¿‡ç¨‹</h3>
<p>1.å‡†å¤‡ææ–™ï¼š</p>
<ul>
<li>å¤§å—å†°ç³–ï¼Œæ²¹ï¼Œç”Ÿå§œï¼ˆæˆ–å—å§œï¼‰ï¼Œå¤§è‘±ï¼ˆå¯é€‰ï¼‰ï¼Œæ¸…æ°´ï¼Œé¦™è‡ï¼Œé±¼éœ²ï¼ˆå¯é€‰ï¼‰ï¼Œå¹²è¾£æ¤’ï¼ˆåƒè¾£çš„å¯ä»¥é€‰ï¼‰</li>
<li>è°ƒå‘³æ–™ï¼šé…±æ²¹ï¼Œç›ï¼Œè€æŠ½ï¼›æ–™åŒ…ï¼šæ¡‚çš®ï¼Œå…«è§’ï¼Œé™ˆçš®ï¼Œç½—æ±‰æœï¼Œé¦™èŒ…ï¼Œä¸é¦™ï¼Œè‰æœï¼Œé¦™å¶<a id="more"></a></li>
</ul>
<p>2.é¢„å…ˆå‡†å¤‡ä¸»ææ–™ï¼š</p>
<ul>
<li>
<p>æŠŠé¦™æ–™ç”¨æ–™åŒ…åŒ…èµ·æ¥ï¼Œæ–™åŒ…å’Œé¦™æ–™éƒ½å¯ä»¥å†æ‚è´§åº—/é¦™æ–™åº—ä¹°åˆ°</p>
</li>
<li>
<p>æˆ‘ä¹°çš„æ˜¯äº”èŠ±è‚‰ï¼Œï¼ˆå…¶ä»–ä¸œè¥¿ä¹Ÿä¸€æ ·çš„ï¼‰å…ˆç”¨æ¸…æ°´æ´—å¹²å‡€åï¼Œé”…é‡Œæ”¾æ°´ï¼ŒåŠ å…¥å‡ ç‰‡å§œç‰‡å’Œå‡ æ®µå¤§è‘±ï¼Œæ°´ç…®å¼€åä¸¤åˆ†é’Ÿåæèµ·æ²¥å¹²ã€‚</p>
</li>
</ul>
<p>3.æ­£å¼å¼€å§‹</p>
<ul>
<li>
<p>é”…é‡Œä¸‹æ²¹ï¼ŒåŠ å…¥å†°ç³–ï¼Œç‚’ç³–è‰²</p>
</li>
<li>
<p>ç„¶ååŠ å…¥æ¸…æ°´ï¼Œ<strong>ä¸€å°ç¢—é…±æ²¹</strong>ï¼Œä¸€å‹ºè€æŠ½ï¼Œä¸¤å‹ºé±¼éœ²ï¼Œä¸¤ä¸ª</p>
<p>é¦™è‡ï¼Œå‡ ç‰‡å—å§œï¼Œå‡ é¢—å¹²è¾£æ¤’ï¼Œä¸¤å¤§å‹ºç›ï¼Œæ”¾å…¥æ–™åŒ…ï¼Œç…®å¼€åï¼Œå°ç«ç„–ç…®15åˆ†é’Ÿ</p>
</li>
<li>
<p>æ”¾å…¥äº”èŠ±è‚‰ï¼Œä¹Ÿå¯ä»¥ä¸‹é¸¡è›‹ï¼Œä½†æ˜¯å¿…é¡»ç…®ç†Ÿåå‰¥å£³ä¸‹ï¼Œç…®å¼€åï¼Œå°ç«ç„–ç…®20åˆ†é’Ÿï¼Œä¸èƒ½å¤ªä¹…çš„ã€‚</p>
</li>
<li>
<p>20åˆ†é’Ÿåï¼Œè°ƒæ•´é£Ÿç‰©ï¼Œç¡®ä¿å®Œå…¨æµ¸æ²¡ï¼Œå…³ç«åæ”¾å‡‰ä¸¤ä¸ªå°æ—¶</p>
</li>
<li>
<p>åé¢æ¯æ¬¡è¦åƒï¼Œç…®å¼€å°±å¯ä»¥äº†ã€‚</p>
</li>
</ul>
]]></content>
      <categories>
        <category>food</category>
      </categories>
  </entry>
  <entry>
    <title>å¤„ç†Jsonæ ¼å¼æ•°æ®</title>
    <url>/2020/09/04/%E5%A4%84%E7%90%86Json%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>å‰å°é¡µé¢é€šå¸¸éƒ½ä¼šé€šè¿‡<code>Ajax</code>æ¥è·å–åå°çš„æ•°æ®ï¼ŒæŸäº›æ¥å£ä¼ è¾“æ•°æ®ä¹Ÿéƒ½æ˜¯ä»¥<code>Json</code>æ ¼å¼æ¥ä¼ è¾“ï¼Œæ•…å¤„ç†<code>Json</code>æ ¼å¼æ•°æ®è¾¹å¾—å¾ˆé‡è¦é¸­ğŸ¦†</p>
<a id="more"></a>
<h2 id="å¤„ç†Jsonæ ¼å¼æ•°æ®">å¤„ç†Jsonæ ¼å¼æ•°æ®</h2>
<p>åœ¨å¾®ä¿¡è¿”å›çš„æ¶ˆæ¯ä¸­ï¼Œæœ‰äº›æ˜¯ä»¥jsonæ•°æ®åŒ…çš„æ ¼å¼å‘ˆç°çš„ğŸ‘‡</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;access_token&quot;</span>:<span class="string">&quot;ACCESS_TOKEN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;expires_in&quot;</span>:<span class="number">7200</span>,</span><br><span class="line">  <span class="attr">&quot;refresh_token&quot;</span>:<span class="string">&quot;REFRESH_TOKEN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;openid&quot;</span>:<span class="string">&quot;OPENID&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scope&quot;</span>:<span class="string">&quot;SCOPE&quot;</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£å¦‚ä½•å–å‡ºè¿™é‡Œé¢çš„ä¿¡æ¯å‘¢ã€‚é‚£å°±éœ€è¦ç”¨åˆ°<span class="ljspan ljspan-reverse ljspan-red"><a href="https://github.com/alibaba/fastjson">fastjson</a></span>å•¦!ğŸ„</p>
<p>ä¸€èˆ¬ä»ç½‘ç»œğŸŒä¸Šè·å–/ä¼ è¾“çš„<code>jsonæ•°æ®åŒ…</code>ï¼Œéƒ½æ˜¯<span class="ljspan ljspan-red">jsonå­—ç¬¦ä¸²</span>ï¼Œå¦‚æœéœ€è¦å–å‡ºæ¥ï¼Œéœ€è¦æŠŠå®ƒè½¬åŒ–ä¸º<span class="ljspan ljspan-red">jsonå¯¹è±¡</span>ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//jsonå­—ç¬¦ä¸²è½¬jsonå¯¹è±¡</span></span><br><span class="line">String result = <span class="string">&#x27;&#123;&quot;name&quot;:&quot;2323&quot;,&quot;sex&quot;:&quot;afasdf&quot;,&quot;age&quot;:&quot;6262&quot;&#125;&#x27;</span>;</span><br><span class="line">JSONObject jsonObject =JSON.parseObject(result);</span><br><span class="line"><span class="comment">//è¿™æ ·å°±å¯ä»¥ä»jsonå¯¹è±¡jsonobjectä¸­è·å–åˆ°ä½ æ‰€éœ€è¦çš„ä¿¡æ¯äº†	  </span></span><br><span class="line">String name = jsonObject.getString(<span class="string">&quot;name&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¦ä¼ è¾“<code>jsonæ•°æ®åŒ…</code>â€‹â€‹ï¼Œä¸€èˆ¬ä¹Ÿæ˜¯å…ˆç¼–å†™å¥½<span class="ljspan ljspan-red">jsonå¯¹è±¡</span>åï¼Œè½¬åŒ–ä¸º<span class="ljspan ljspan-red">jsonå¯¹è±¡</span>åä¼ è¾“â€‹ã€‚ğŸŒµ</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">     <span class="attr">&quot;button&quot;</span>:[</span><br><span class="line">     &#123;	</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;view&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;æˆ‘çš„æŠ¥å‘Š&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;url&quot;</span>:<span class="string">&quot;/path/to/Report&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;	</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;click&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;æˆ‘çš„ç¤¾åŒº&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;key&quot;</span>:<span class="string">&quot;V1001_COMMUNITY&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;	</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;click&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;ä¸ªäººä¸­å¿ƒ&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;key&quot;</span>:<span class="string">&quot;V1001_TODAY_MUSIC&quot;</span></span><br><span class="line">       &#125;]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>ğŸ‘‡ä¸‹é¢ä»£ç è¿™æ˜¯å¯¹ä¸Šé¢â˜ï¸çš„å®ç°å“¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å°è£…jsonå¯¹è±¡</span></span><br><span class="line">JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">JSONArray jsonArray = <span class="keyword">new</span> JSONArray();</span><br><span class="line">JSONObject jsonObject1 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject1.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;view&quot;</span>);</span><br><span class="line">jsonObject1.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æˆ‘çš„æŠ¥å‘Š&quot;</span>);</span><br><span class="line">jsonObject1.put(<span class="string">&quot;url&quot;</span>, <span class="string">&quot;/path/to/Report&quot;</span>);</span><br><span class="line">JSONObject jsonObject2 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject2.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;click&quot;</span>);</span><br><span class="line">jsonObject2.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;æˆ‘çš„ç¤¾åŒº&quot;</span>);</span><br><span class="line">jsonObject2.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;V1001_COMMUNITY&quot;</span>);</span><br><span class="line">JSONObject jsonObject3 = <span class="keyword">new</span> JSONObject();</span><br><span class="line">jsonObject3.put(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;click&quot;</span>);</span><br><span class="line">jsonObject3.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;ä¸ªäººä¸­å¿ƒ&quot;</span>);</span><br><span class="line">jsonObject3.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;V1001_TODAY_MUSIC&quot;</span>);</span><br><span class="line">jsonArray.add(jsonObject1);</span><br><span class="line">jsonArray.add(jsonObject2);</span><br><span class="line">jsonArray.add(jsonObject3);</span><br><span class="line">jsonObject.put(<span class="string">&quot;button&quot;</span>,jsonArray);</span><br><span class="line"><span class="comment">//è½¬åŒ–ä¸ºjsonå­—ç¬¦ä¸²</span></span><br><span class="line">String jsonString = jsonObject.toJSONString();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä½¿ç”¨eclipseæç¤ºåŠŸèƒ½ï¼Œå¯ä»¥çœ‹åˆ°è®¸å¤š<code>jsonObject</code>å’Œ<code>JSON</code>çš„æ–¹æ³•ï¼</p>
</blockquote>
<hr>
<h2 id="è‡ªåŠ¨è½¬åŒ–jsonæ•°æ®">è‡ªåŠ¨è½¬åŒ–jsonæ•°æ®</h2>
<p>åå°æœåŠ¡å¯ä»¥è‡ªåŠ¨è½¬åŒ–æŸç±»å¯¹è±¡ä¸ºjsonæ ¼å¼åˆ°å‰å°é¡µé¢ï¼Œå‰ç«¯é¡µé¢å¯ç›´æ¥å–ç”¨ï¼Œä½ è¯´ç¥ä¸ç¥å¥‡ğŸ¸,å®ƒä¸€èˆ¬ç»“åˆ<code>@ResponseBody</code>ä¸€èµ·ä½¿ç”¨</p>
<p>å®ƒå°±æ˜¯<span class="ljspan ljspan-yellow"><a href="https://github.com/FasterXML/jackson-databind">jackson databind</a></span>ï¼Œè²Œä¼¼ä¸Šæ–‡æåˆ°çš„<span class="ljspan ljspan-red">fastjson</span>ä¹Ÿå¯ä»¥å®ç°(ä¸è¿‡ï¼Œè¿˜éœ€è¦å…¶ä»–é…ç½®)ï¼Œä½†æ˜¯<span class="ljspan ljspan-yellow">jackson databind</span>åªéœ€è¦å¼•å…¥ä¾èµ–åŒ…å°±è¡Œäº†ğŸ™‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼•å…¥ä¾èµ–åŒ…--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Json</tag>
        <tag>æ•°æ®å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>å¤„ç†XMLæ•°æ®</title>
    <url>/2020/09/04/%E5%A4%84%E7%90%86XML%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>è§£æ<code>XML</code>æ•°æ®ï¼Œæ„Ÿè§‰å¾ˆéš¾ï¼Œæ— ä»ä¸‹æ‰‹ğŸ™Šï¼Œå…¶å®æ˜¯å› ä¸ºè§£æ<code>XML</code>çš„<a href="https://www.cnblogs.com/c-xiaohai/p/6796116.html">æ–¹æ³•</a>å¤ªå¤šäº†ï¼Œæ„Ÿè§‰éƒ½å·®ä¸å¤šï¼Œæ··åˆåœ¨ä¸€å—ï¼Œåˆ†ä¸æ¸…äº†ğŸ˜µå°±çœ‹ä¸æ‡‚äº†ã€‚</p>
<a id="more"></a>
<h2 id="è§£æxml">è§£æxml</h2>
<p>æˆ‘é‡‡ç”¨çš„æ˜¯<code>dom4</code>çš„<a href="http://www.51gjie.com/java/739.html">æ–¹æ³•</a>è§£æ<code>XML</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SAXReader saxReader = <span class="keyword">new</span> SAXReader();</span><br><span class="line">Document document = saxReader.read(<span class="keyword">new</span> File(<span class="string">&quot;students.xml&quot;</span>));</span><br><span class="line"><span class="comment">// è·å–æ ¹å…ƒç´ </span></span><br><span class="line">Element root = document.getRootElement();</span><br><span class="line"><span class="comment">// è·å–æ‰€æœ‰å­å…ƒç´ </span></span><br><span class="line">List&lt;Element&gt; childList = root.elements();</span><br><span class="line"><span class="comment">// æŠŠxmlä¿¡æ¯è½¬åŒ–ä¸ºhashmap</span></span><br><span class="line">HashMap&lt;String,String&gt; hashMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"><span class="keyword">for</span> (Element element : elementsList) &#123;</span><br><span class="line">    hashMap.put(element.getName(), element.getText());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="åºåˆ—åŒ–-ååºåˆ—åŒ–xml">åºåˆ—åŒ–/ååºåˆ—åŒ–xml</h2>
<ol>
<li>åˆ›å»º<code>XStream</code> å¯¹è±¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">XStream xstream = <span class="keyword">new</span> XStream(<span class="keyword">new</span> StaxDriver());</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åºåˆ—åŒ–å¯¹è±¡åˆ°<code>XML</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Object to XML Conversion</span></span><br><span class="line">String xml = xstream.toXML(student);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ååºåˆ—åŒ–<code>XML</code>è·å¾—å¯¹è±¡ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// XML to Object Conversion</span></span><br><span class="line">Student student1 = (Student) xstream.fromXML(xml)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™é‡Œç”Ÿæˆçš„XMLæ˜¯åŒ…å«<code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</code>å‰ç¼€çš„xmlæ–‡æœ¬</p>
</blockquote>
<hr>
<h2 id="å¾®ä¿¡çš„XMLæ ¼å¼"><em>å¾®ä¿¡çš„XMLæ ¼å¼</em></h2>
<p>å¾®ä¿¡çš„<code>XML</code>å›å¤ä¿¡æ¯ï¼ŒæŸäº›æ–‡æœ¬éœ€è¦æ·»åŠ <code>&lt;![CDATA['text']]</code>ï¼Œç½‘å‹æä¾›çš„æ–¹æ³•å¦‚ä¸‹ï¼Œä½†æ˜¯æˆ‘è¿˜çœ‹ä¸æ‡‚å•ŠğŸ˜‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰xmlå¯¹è±¡æ ¼å¼</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> XStream xStream = <span class="keyword">new</span> XStream(<span class="keyword">new</span> XppDriver() &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> HierarchicalStreamWriter <span class="title">createWriter</span><span class="params">(Writer out)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> PrettyPrintWriter(out) &#123;</span><br><span class="line">			<span class="keyword">boolean</span> cdata = <span class="keyword">true</span>;</span><br><span class="line">			</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startNode</span><span class="params">(String name, Class clazz)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">super</span>.startNode(name, clazz);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">writeText</span><span class="params">(QuickWriter writer,String text)</span> </span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(cdata) &#123;</span><br><span class="line">					writer.write(<span class="string">&quot;&lt;![CDATA[&quot;</span>);</span><br><span class="line">					writer.write(text);</span><br><span class="line">					writer.write(<span class="string">&quot;]]&gt;&quot;</span>);</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					writer.write(text);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;	</span><br><span class="line">	&#125;		</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>æ•°æ®å¤„ç†</tag>
        <tag>XML</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…ERPNext</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85ERPNext/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>ç”±äºæˆ‘çš„æœåŠ¡å™¨å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œä¸”ä¸ºäº†é˜²æ­¢è½¯ä»¶å¤ªå¤šï¼Œç¯å¢ƒå¤ªå¤æ‚å¯¹æ–°å®‰è£…è½¯ä»¶çš„å½±å“ï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨è™šæ‹Ÿæœºçš„æ–¹å¼å®‰è£…<span class="ljspan ljspan-reverse ljspan-blue"><a href="https://github.com/frappe/erpnext">ERPNext</a></span></p>
<a id="more"></a>
<p><strong>ä½¿ç”¨è™šæ‹Ÿæœºçš„å¥½å¤„ğŸ’…</strong></p>
<ul>
<li>æ¯”è¾ƒç®€å•</li>
</ul>
<p>ç›´æ¥åˆ°<a href="https://github.com/frappe/erpnext">å®˜ç½‘ä¸‹è½½</a>è™šæ‹Ÿæœºçš„é•œåƒæ–‡ä»¶å</p>
<p>ä½¿ç”¨è™šæ‹Ÿæœºåˆ©ç”¨è¿™ä¸ªé•œåƒå®‰è£…è¿™ä¸ªç³»ç»Ÿ!</p>
<p>ç„¶åå¯åŠ¨è™šæ‹Ÿæœº</p>
<p>ç™»å½•ç½‘å€ä¸ºï¼š<a href="http://localhost:8080">http://localhost:8080</a></p>
<hr>
<h2 id="é—®é¢˜">é—®é¢˜</h2>
<p>ä½†æ˜¯æ¯æ¬¡é‡å¯ï¼Œæ•°æ®åº“éƒ½æŠ¥é”™äº†ï¼</p>
<p><a href="https://openwritings.net/pg/mariadb/mariadb-start-mysqld-tc-heuristic-recover-switch">è¿™é‡Œ</a>æœ‰è§£å†³åŠæ³•ğŸ‘´</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é€šè¿‡ ~/frappe-bench/logs/web.error.log</span></span><br><span class="line"><span class="comment">#å¯çŸ¥æ•°æ®åº“å‡ºé”™äº†</span></span><br><span class="line"></span><br><span class="line">OperationalError: (2003, <span class="string">&quot;Can&#x27;t connect to MySQL server on u&#x27;localhost&#x27; ([Errno 111] Connection refused)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#å…·ä½“çš„é”™è¯¯è®°è½½åœ¨è¿™é‡Œ</span></span><br><span class="line"><span class="comment">#~/frappe-bench/logs/bench.log	</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#è§£å†³åŠæ³•ï¼šmysqld --tc-heuristic-recover=ROLLBACK</span></span><br><span class="line"></span><br><span class="line">mysqld --tc-heuristic-recover=ROLLBACK</span><br><span class="line">systemctl start mariadb.service</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯å‘ç°è¿˜æœ‰ä¸ªé”™è¯¯</span><br><span class="line">Apr 30 06:23:45 ubuntu mysqld[4244]: 2020-04-30  6:23:45 139795985828032 [Note] /usr/sbin/mysqld (mysqld 10.2.24-MariaDB-10.2.24+maria~xenial-log) starting as process 4244 </span><br><span class="line">Apr 30 06:23:45 ubuntu mysqld[4244]: 2020-04-30  6:23:45 139795985828032 [Warning] Could not increase number of max_open_files to more than 16364 (request: 21012)</span><br><span class="line">Apr 30 06:23:45 ubuntu mysqld[4244]: 2020-04-30  6:23:45 139795985828032 [Warning] Changed limits: max_open_files: 16364  max_connections: 500 (was 500)  table_cache: 7917 </span><br><span class="line"> </span><br><span class="line"><span class="comment">#æˆ‘åªçŸ¥é“ä¿®æ”¹max_open_fileåœ¨/lib/systemd/system/mariadb.service</span></span><br><span class="line"><span class="comment">#é‚£ä¸ª LimitNOFILEæœ‰è®°è½½ï¼Œæˆ‘ä¹Ÿä¿®æ”¹äº†</span></span><br><span class="line"><span class="comment">#åŒæ—¶</span></span><br><span class="line"><span class="comment">#table_cacheæˆ‘ä¹Ÿé€šè¿‡ç™»å½•æ•°æ®åº“æŸ¥çœ‹äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆä¿®æ”¹</span></span><br><span class="line"><span class="comment">#åæ­£è¿™ä¸ªé”™è¯¯å¯¹ç³»ç»Ÿä½¿ç”¨æ— å½±å“......ä¸æäº†</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…Galaxy</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85Galaxy/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>å®‰è£…<span class="ljspan ljspan-reverse"><a href="https://github.com/galaxyproject/galaxy">Galaxy</a></span>ï¼Œä½¿ç”¨Conda,å› ä¸ºä»–éœ€è¦ä¸€ä¸ªç‰¹å®šçš„pythonç¯å¢ƒï¼Œä¸ºäº†ä¸ä¸æœåŠ¡å™¨ä¸»æœºäº§ç”Ÿè€¦åˆæˆ–è€…å†²çªï¼Œæœ€å¥½ä½¿ç”¨condaæ„å»ºä¸€ä¸ªç¯å¢ƒç»™ä½ çš„<span class="ljspan ljspan-reverse"><a href="https://github.com/galaxyproject/galaxy">Galaxy</a></span>ä½¿ç”¨å§ğŸ˜‹</p>
<a id="more"></a>
<h2 id="é…ç½®">é…ç½®</h2>
<p>é¦–å…ˆå®‰è£…<strong>conda</strong>,ç„¶åé…ç½®å›½å†…é•œåƒï¼Œæœ€å¥½æ¸…åçš„é•œåƒï¼Œåœ¨<code>/home/luoj/.condarc</code>é‡Œé¢è®¾ç½®ğŸ‘‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">channels:</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r</span><br><span class="line">  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro</span><br><span class="line">show_channel_urls: <span class="literal">true</span></span><br><span class="line">custom_channels:</span><br><span class="line">  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br><span class="line">  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud</span><br></pre></td></tr></table></figure>
<p>ä½ çš„è®¾ç½®è·Ÿæˆ‘ä¸€æ ·ä¹ˆï¼Ÿæˆ‘çš„å¯éƒ½æ˜¯æ¸…åçš„ğŸ“</p>
<h2 id="è¿è¡Œ">è¿è¡Œ</h2>
<p>ç„¶åè¿›å…¥galaxyçš„æ ¹ç›®å½•</p>
<blockquote>
<p>sh <a href="http://run.sh">run.sh</a>  #æ‰§è¡Œç¨‹åº</p>
</blockquote>
<h2 id="è®¿é—®">è®¿é—®</h2>
<p>è®¿é—®ç½‘å€ï¼š<a href="http://localhost:8080">http://localhost:8080</a> ,å·²ç»è¢«æˆ‘ä¿®æ”¹ä¸ºä»»æ„ä¸»æœºå‡å¯è®¿é—®ï¼š<a href="http://14.23.114.254:8080">http://14.23.114.254:8080</a></p>
<blockquote>
<p>é€šè¿‡config/galaxy.ymlè¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæ”¹å˜httpé…ç½®ä¸ºï¼šhttp: 0.0.0.0</p>
<p>å¦‚æœè¿˜éœ€è¦ä¿®æ”¹ç«¯å£ï¼Œå°±ç›´æ¥æ”¹ä¸ºï¼šhttp: 0.0.0.0:[ç«¯å£å·]</p>
</blockquote>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–‡æ¡£åœ¨<a href="https://docs.galaxyproject.org/en/master/admin/config.html#configuration-basics">è¿™é‡Œ</a></p>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>å›¾åƒè¦ç‚¹</title>
    <url>/2020/10/15/%E5%9B%BE%E5%83%8F%E8%A6%81%E7%82%B9/</url>
    <content><![CDATA[<h3 id="å›¾åƒè‡ªé€‚åº”">å›¾åƒè‡ªé€‚åº”</h3>
<p>å›¾åƒ<span class="ljspan ljspan-red">è‡ªé€‚åº”</span>ï¼Œæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å›¾ç‰‡çš„å¤§å°é€‚åº”æ–¹æ¡†çš„å¤§å°ï¼Œåœ¨æ–¹æ¡†é‡Œé¢ï¼Œè€Œä¸è¶Šè¾¹ç•Œ</p>
<p>çœ‹çœ‹å›¾å§ï¼Œæ‚¨å°±çŸ¥é“äº†ğŸ˜†<a id="more"></a></p>
<img src="/assets/img/image-point1.png" alt="image-point1" />
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä»£ç å¦‚ä¸‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>  <span class="attr">style</span>=<span class="string">&quot;width: 600px;height: 400px;border: 1px solid orangered;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span>  <span class="attr">src</span>=<span class="string">&quot;img/Header_img.png&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å›¾ç‰‡å¤ªå¤§ï¼Œæº¢å‡ºäº†DIVæ¡†ï¼Œé‚£å¦‚ä½•æŠŠå›¾ç‰‡å˜å¾—ä¼¸ç¼©è‡ªå¦‚ï¼Œåªåœ¨æ–¹æ¡†å†…è€Œå·²</p>
<p>åœ¨cssæ ·å¼ä¸­æ·»åŠ <code>max-width=100%</code>å°±å¯ä»¥çœ‹åˆ°å›¾ç‰‡å˜å¾—å¯<span class="ljspan ljspan-red">è‡ªé€‚åº”</span>äº†</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>  <span class="attr">style</span>=<span class="string">&quot;width: 600px;height: 400px;border: 1px solid orangered;&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ·»åŠ äº†max-widthå±æ€§--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 100%;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/Header_img.png&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/assets/img/image-point2.png" alt="image-point2"></p>
<p>å¯ä»¥çœ‹åˆ°å›¾ç‰‡æ•´ä¸ª<strong>ç¼©å°</strong>åï¼Œå®Œå…¨æ”¾ç½®äºDIVæ–¹æ¡†å†…äº†ã€‚ğŸ˜„å­¦ä¼šäº†å§ï¼</p>
<hr>
<h3 id="å›¾åƒå†…æ˜¾ç¤ºæ–‡å­—">å›¾åƒå†…æ˜¾ç¤ºæ–‡å­—</h3>
<p>ä¸€èˆ¬çš„å›¾åƒå’Œæ–‡å­—åˆ†å¼€å†™ï¼Œå¹¶ä¸ä¼šäº§ç”Ÿå†…åµŒï¼Œé‚£å¦‚ä½•è®©æ–‡å­—å†…åµŒäºå›¾ç‰‡ä¸­ï¼Œä¸‹å›¾ä¸ºä¸€èˆ¬çš„æ–‡å­—å›¾ç‰‡æ˜¾ç¤ºå†…å®¹</p>
<p><img src="/assets/img/image-point3.png" alt="image-point3"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä»£ç å¦‚ä¸‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 100%;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/Header_img.png&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;font-size:42px; line-height:49px;&quot;</span>&gt;</span> A Targeted gene sequencing database for cancer susceptibility gene.  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¦è¾¾åˆ°å†…åµŒï¼Œå¯ä»¥ä½¿ç”¨<span class="ljspan ljspan-blue">Positionå±æ€§</span>ï¼ŒDIVè®¾ç½®ä¸ºç›¸å¯¹ä½ç½®ï¼ˆrelativeï¼‰ï¼Œå›¾ç‰‡ä¸ç”¨è®¾ç½®ï¼Œæ·»åŠ åˆ°DIVä¸­ï¼Œç„¶åå†æ·»åŠ æ–‡å­—åˆ°DIVä¸­ï¼Œè¿™æ—¶å€™æ–‡å­—è®¾ç½®ä¸ºç»å¯¹å®šä½ï¼ˆabsoluteï¼‰,å¯ä»¥æ·»åŠ ä¸€äº›å®šä½çš„å±æ€§:topã€bottomã€leftã€rightç­‰ç­‰ã€‚å¦‚ä¸‹å›¾</p>
<p><img src="/assets/img/image-point4.png" alt="image-point4"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ å±æ€§position: relative;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;position: relative;&quot;</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">style</span>=<span class="string">&quot;max-width: 100%;&quot;</span> <span class="attr">src</span>=<span class="string">&quot;img/Header_img.png&quot;</span> /&gt;</span></span><br><span class="line">		<span class="comment">&lt;!--æ·»åŠ å±æ€§position: absolute;top: 10px;left: 10px; --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;font-size:42px; line-height:49px;position: absolute;top: 10px;left: 10px;&quot;</span>&gt;</span> A Targeted gene sequencing database for cancer susceptibility gene.  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>å‰ç«¯</category>
      </categories>
  </entry>
  <entry>
    <title>å®‰è£…elabFTW</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85elabFTW/</url>
    <content><![CDATA[<h3 id="å®‰è£…">å®‰è£…</h3>
<p>æ ¹æ®è¿™ä¸ª<a href="https://doc.elabftw.net/install.html">å®‰è£…æ–‡æ¡£</a>çš„å®‰è£…æ­¥éª¤ä½¿ç”¨dockeræ–¹æ³•å®‰è£…åœ¨ubuntuç³»ç»Ÿä¸Š</p>
<h3 id="é…ç½®">é…ç½®</h3>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­ï¼Œæˆ‘è®¾ç½®çš„é…ç½®å¦‚ä¸‹</p>
<a id="more"></a>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ä¸»è¦é…ç½®æ–‡ä»¶åœ¨/etc/elabftw.yml</span><br><span class="line"></span><br><span class="line">åŒ…å«elabftwçš„æ•°æ®(mysql+ä¸Šä¼ çš„æ–‡ä»¶)åœ¨/var/elabftw</span><br><span class="line"></span><br><span class="line">å¤‡ä»½æ–‡ä»¶åœ¨/var/backups/elabftw</span><br><span class="line"></span><br><span class="line">æˆ‘çš„ip:x.x.x.254</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨https</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯åœ¨å®‰è£…çš„æ—¶å€™å¤±è´¥äº†ï¼</p>
<p>åŸå› å’Œè§£å†³åŠæ³•ï¼Œ<a href="https://github.com/elabftw/elabftw/issues/849">è¿™é‡Œ</a>æœ‰äººæé—®äº†å¹¶æœ‰è§£ç­”</p>
<hr>
<h3 id="é‡è£…">é‡è£…</h3>
<p>ğŸ’¥å‰æï¼šåˆ é™¤ä¹‹å‰çš„è½¯ä»¶å’Œé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>åˆ é™¤çš„è½¯ä»¶å’Œé…ç½®æ–‡ä»¶æ˜¯åœ¨ä¹‹å‰çš„å®‰è£…è¿‡ç¨‹ä¸­ï¼Œè‡ªå·±é…ç½®æŒ‡å®šçš„å®‰è£…ç›®å½•</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">curl -L https://get.elabftw.net -o elabctl</span><br><span class="line">chmod +x elabctl</span><br><span class="line">sudo cp elabctl /usr/<span class="built_in">local</span>/bin/</span><br><span class="line"><span class="comment">#æŸ¥çœ‹æ—¥å¿—</span></span><br><span class="line">elabctl logs</span><br><span class="line"><span class="comment">#å¼€å§‹å®‰è£…</span></span><br><span class="line">elabctl install</span><br><span class="line"></span><br><span class="line"><span class="comment">#æˆ‘ä½¿ç”¨disable httpsçš„é…ç½®åé¢å‡ºé—®é¢˜äº†</span></span><br><span class="line"> eLabFTW works only <span class="keyword">in</span> HTTPS. Please <span class="built_in">enable</span> HTTPS on your server. Or click this link : http://14.23.114.254:6006</span><br><span class="line"> </span><br><span class="line"><span class="comment">#å¼€å¯elabctl</span></span><br><span class="line">elabctl start</span><br><span class="line"><span class="comment">#å¦‚æœæ•°æ®åº“ç«¯å£3306è¢«å ç”¨æˆ–è€…æƒ³æ”¹ç«¯å£ï¼Œ</span></span><br><span class="line"><span class="comment">#éƒ½å¯ä»¥åˆ°/etc/elabctl.ymlæ–‡ä»¶ä¸­ä¿®æ”¹</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹ç«¯å£å·</span></span><br><span class="line">	ports:</span><br><span class="line">        <span class="comment"># if you want elabftw to run on a different port, change the first number</span></span><br><span class="line">        <span class="comment"># host:container</span></span><br><span class="line">        - <span class="string">&#x27;&lt;your-port&gt;:443&#x27;</span></span><br><span class="line"><span class="comment">#ä¿®æ”¹æ•°æ®åº“ç«¯å£</span></span><br><span class="line">		<span class="comment"># expose should work, but sometimes it doesn&#x27;t so use full port mapping</span></span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">&#x27;&lt;your-db-port&gt;:3306&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æœ€åä¸€æ­¥</span></span><br><span class="line">docker <span class="built_in">exec</span> -it elabftw bin/install start</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…OpenELIS</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85OpenELIS/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>ç”±äºå®‰è£…tomcatä¼šå¯¼è‡´apacheå¤±æ•ˆğŸ˜¿</p>
<p>æ‰€ä»¥æˆ‘ä½¿ç”¨è™šæ‹Ÿæœºæ¥å®‰è£…è¿™ä¸ªè½¯ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´æä¾›ä¸€ä¸ªå…¨æ–°çš„ç¯å¢ƒã€‚å®‰è£…æ•™ç¨‹åœ¨<a href="https://docs.google.com/document/d/1fv-Zu41ti8yUVWusjd-mAK7YZLI0c4DMPxg-BzL7RUw/edit">è¿™é‡Œ</a></p>
<a id="more"></a>
<p>æœåŠ¡å™¨ç‰ˆæœ¬ubuntu16.04 LTS,ä½†æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‘ç°ç¨‹åºæ²¡æœ‰å¸®æˆ‘å®‰è£…ä¸Štomcatï¼Œå¯¼è‡´æ— æ³•å®‰è£…æˆåŠŸğŸ˜­</p>
<p>æŠ¥é”™å¦‚ä¸‹ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">The following <span class="built_in">command</span> may take a few minutes to complete.  Please take a short <span class="built_in">break</span> until it finishes</span><br><span class="line">java -jar  ./lib/liquibase-1.9.5.jar --defaultsFile=liquibaseInstall.properties --contexts=ci_regional --password=cUpHBdzgWyae --username=clinlims  update &gt;&gt; .././<span class="built_in">log</span>/installer.log 2&gt;&amp;3</span><br><span class="line">sudo systemctl stop tomcat</span><br><span class="line">Failed to stop tomcat.service: Unit tomcat.service not loaded.</span><br><span class="line">cp: cannot create regular file <span class="string">&#x27;/usr/share/tomcat8.5/lib/&#x27;</span>: Not a directory</span><br><span class="line">cp: cannot create regular file <span class="string">&#x27;/usr/share/tomcat8.5/conf/Catalina/localhost/&#x27;</span>: No such file or directory</span><br><span class="line">chown: cannot access <span class="string">&#x27;/usr/share/tomcat8.5/conf/Catalina/localhost/CDI_RegLabOpenElis.xml&#x27;</span>: No such file or directory</span><br><span class="line">cp ./warFiles/CDI_RegLabOpenElis.war /usr/share/tomcat8.5/webapps/</span><br><span class="line">cp: cannot create regular file <span class="string">&#x27;/usr/share/tomcat8.5/webapps/&#x27;</span>: Not a directory</span><br><span class="line">Failed to start tomcat.service: Unit tomcat.service not found.</span><br><span class="line">Installing backup</span><br><span class="line">Checking <span class="keyword">for</span> curl</span><br><span class="line">/usr/bin/curl</span><br><span class="line">Curl found, continuing with backup installation</span><br><span class="line">Checking <span class="keyword">if</span> crosstab is installed <span class="keyword">in</span> Postgres</span><br><span class="line">Crosstabs are installed</span><br><span class="line">luoj@luoj-VirtualBox:~/CDI_RegLabOpenElis/linux$ <span class="built_in">cd</span> /usr/share/tomcat8.5/</span><br><span class="line">luoj@luoj-VirtualBox:/usr/share/tomcat8.5$ ll</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x   2 tomcat tomcat  4096 Apr 28 09:23 ./</span><br><span class="line">drwxr-xr-x 305 root   root   12288 Apr 28 09:23 ../</span><br><span class="line">luoj@luoj-VirtualBox:/usr/share/tomcat8.5$ java -V</span><br><span class="line">Unrecognized option: -V</span><br><span class="line">Error: Could not create the Java Virtual Machine.</span><br><span class="line">Error: A fatal exception has occurred. Program will <span class="built_in">exit</span>.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ— æ³•æˆåŠŸå®‰è£…tomcatï¼Œå¯èƒ½é…ç½®æ–‡ä»¶é‡Œé¢å‡ºé”™äº†ï¼Œè¿™æ˜¯é‡‡ç”¨puppetæ¥è‡ªåŠ¨å®‰è£…è½¯ä»¶ï¼ŒåŒ…æ‹¬postgressqlç­‰ï¼Œå”¯ç‹¬tomcatå®‰è£…å¤±è´¥</p>
</blockquote>
<hr>
<h3 id="é‡æ–°å®‰è£…">#é‡æ–°å®‰è£…</h3>
<p><a href="https://docs.google.com/document/d/1fv-Zu41ti8yUVWusjd-mAK7YZLI0c4DMPxg-BzL7RUw/edit">å®‰è£…è¯´æ˜æ–‡æ¡£</a></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ç°åœ¨æ ¹ç›®å½•æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹web</span></span><br><span class="line">sudo mkdir web</span><br><span class="line"><span class="comment">#æµ‹è¯•ç½‘ç»œæ˜¯å¦è”é€š</span></span><br><span class="line">ping 8.8.8.8</span><br><span class="line"><span class="comment">#æ›´æ–°è½¯ä»¶åŒ…</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br></pre></td></tr></table></figure>
<p>ç”±äºæä¾›çš„ç¨‹åºæ— æ³•å®‰è£…tomcatï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦æ‰‹åŠ¨<a href="/2020/09/08/Tomcat%E7%9A%84%E4%B8%8B%E8%BD%BD%E5%92%8C%E9%85%8D%E7%BD%AE/">å®‰è£…tomcat</a></p>
<p>å…ˆå®‰è£…tomcatå,å†ç»§ç»­åé¢çš„æ“ä½œ</p>
<p>OpenElisä¸‹è½½åœ°å€</p>
<p><a href="https://www.dropbox.com/s/syafyqxhu212nvp/CDI_RegLabOpenElis_9.1_Installer.tar.gz?dl=0&amp;file_subpath=%2FCDI_RegLabOpenElis%2Flinux">åœ°å€ä¸€</a></p>
<p><a href="http://openelisglobal.org/">åœ°å€äºŒ</a></p>
<h2 id="å®‰è£…">å®‰è£…</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å®‰è£…å¿…å¤‡çš„ç³»ç»Ÿè½¯ä»¶</span></span><br><span class="line">sudo apt-get install openssh-server</span><br><span class="line">sudo apt-get install git</span><br><span class="line">sudo apt-get install python python-lxml</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½è‡ªåŠ¨åŒ–é…ç½®å·¥å…·</span></span><br><span class="line">sudo git <span class="built_in">clone</span> --recursive \</span><br><span class="line">https://github.com/I-TECH-UW/appliance-setup.git /opt/appliance-setup</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…è½¯ä»¶æ‰€éœ€çš„è¾…åŠ©è½¯ä»¶ï¼Œåƒæ•°æ®åº“ï¼ŒwebæœåŠ¡å™¨ç­‰ç­‰</span></span><br><span class="line">sudo APPLIANCE_COMPONENTS=<span class="string">&quot;openelis&quot;</span> /opt/appliance-setup/bin/appliance-setup --webapps=/web --clientcerts=default --keystorepass=changeme apply</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½OpenElisçš„å®‰è£…åŒ…</span></span><br><span class="line"><span class="comment">#å¯é€šè¿‡å®˜ç½‘ç›´æ¥ä¸‹è½½</span></span><br><span class="line"><span class="comment">#è§£å‹åˆ°å®¶ç›®å½•</span></span><br><span class="line">tar -xzf CDI_RegLabOpenElis_9.1_Installer.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ~/CDI_RegLabOpenElis/linux/</span><br><span class="line">sudo python setup_OpenELIS.py -install</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¿é—®æµè§ˆå™¨http://ip:8080/CDI_RegLabOpenElis/LoginPage.do</span></span><br><span class="line">ç™»å½•è´¦å·</span><br><span class="line">login name: admin password: adminADMIN!</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…metalims</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85metalims/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>ç”±äºæˆ‘åªæƒ³çœ‹çœ‹MetaLIMSè½¯ä»¶ä¸ºä½•æ ·ï¼Œæ•…åªéœ€ä¸‹è½½äº†MetaLIMS demo,æ‰€ä»¥æˆ‘é€‰æ‹©äº†è¿™ç§æ–¹æ³•ï¼š<a href="https://github.com/cheinle/MetaLIMS/wiki/MetaLIMS--v2.0-Hosted-Installation-(via-AWS-Lightsail)">MetaLIMS v2.0 Hosted Installation (via AWS Lightsail)</a></p>
<a id="more"></a>
<p>è¿›å…¥è¿™ä¸ªå®‰è£…è¯´æ˜æ–‡æ¡£ï¼Œå¯ä»¥æ³¨å†Œè´­ä¹°äº‘æœåŠ¡å™¨ï¼Œåªéœ€è¦å®‰è£…æ‰€éœ€çš„ä¸‰ä¸ªæ–‡ä»¶**<a href="https://github.com/cheinle/MetaLIMS/wiki/MetaLIMS--v2.0-Hosted-Installation-(via-AWS-Lightsail)#install-lamp-stack">lamp.sh</a>,<a href="https://github.com/cheinle/MetaLIMS/wiki/MetaLIMS--v2.0-Hosted-Installation-(via-AWS-Lightsail)#create-a-self-signed-ssl-certificate-for-apache-optional">apache_ssh_16.sh</a>,<a href="https://github.com/cheinle/MetaLIMS/wiki/MetaLIMS--v2.0-Hosted-Installation-(via-AWS-Lightsail)#install-metalims">metalims.sh</a>**</p>
<p>åœ¨<a href="https://github.com/cheinle/MetaLIMS/wiki">å®‰è£…è¯´æ˜æ–‡æ¡£</a>è¿™é‡Œï¼Œå°±å¯ä»¥ä¸‹è½½ä¸Šé¢çš„ä¸‰ä¸ªæ–‡ä»¶</p>
<hr>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p><a href="http://xn--lamp-9j5f881aho2a2j6a0v6ayyp.sh">ä¹‹åç›´æ¥è¿è¡Œlamp.sh</a></p>
<p>è¿è¡ŒæœŸé—´ä¼šæç¤ºè®¾ç½®âš™ï¸</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line"><span class="meta">#1.ç¬¬ä¸€æ­¥</span></span><br><span class="line">source lamp.sh</span><br><span class="line"><span class="meta">#ä¸­é€”æç¤ºè¾“å…¥mysqlå¯†ç </span></span><br><span class="line"><span class="meta">#å¹¶ä¸”è¿˜æœ‰ä¸€äº›è®¾ç½®</span></span><br><span class="line"><span class="meta">#2.ç¬¬äºŒæ­¥</span></span><br><span class="line">source apache_ssh_16.sh</span><br></pre></td></tr></table></figure>
<p>å…·ä½“é…ç½®è¿‡ç¨‹å¯å‚è€ƒ<a href="https://github.com/cheinle/MetaLIMS/wiki/MetaLIMS--v2.0-Hosted-Installation-(via-AWS-Lightsail)#create-a-self-signed-ssl-certificate-for-apache-optional">å®˜æ–¹æ–‡æ¡£</a></p>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…mysql</title>
    <url>/2020/09/10/%E5%AE%89%E8%A3%85mysql/</url>
    <content><![CDATA[<h2 id="ä¸‹è½½">ä¸‹è½½</h2>
<ol>
<li>
<p>åœ¨<span class="ljspan ljspan-reverse"><a href="https://dev.mysql.com/downloads/repo/apt/">mysqlå®˜ç½‘</a></span>ä¸‹è½½mysqlçš„aptè½¯ä»¶åŒ…ğŸ“¦</p>
<div class="note primary">
            <p>Note:åœ¨å®˜ç½‘ä¸‹è½½æ—¶ï¼Œå¦‚æœé‡‡ç”¨å¤åˆ¶é“¾æ¥ä¸‹è½½ï¼Œå¯¹äºå¤åˆ¶downloadçš„é“¾æ¥åœ°å€æ˜¯é”™è¯¯çš„ï¼Œéœ€è¦ç‚¹å‡»è¿›å…¥ï¼Œå¤åˆ¶é‡Œé¢çš„â€œ<strong><a href="https://dev.mysql.com/get/mysql-apt-config_0.8.15-1_all.deb">No thanks, just start my download.</a></strong>â€ï¼Œè¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„é“¾æ¥åœ°å€</p>
          </div>
</li>
</ol>
<a id="more"></a>
<ol start="2">
<li>ä¹Ÿå¯é€šè¿‡wgetç›´æ¥ä¸‹è½½ğŸ™‚</li>
</ol>
<blockquote>
<p>æ¯”è¾ƒç®€å•ï¼Œé…ç½®æ–‡ä»¶éƒ½è‡ªåŠ¨è®¾ç½®å¥½ï¼ŒåŒ…æ‹¬è®¾ç½®ç¯å¢ƒå˜é‡ç­‰ç­‰</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¸‹è½½</span></span><br><span class="line">wget -c https://dev.mysql.com/get/mysql-apt-config_0.8.15-1_all.deb</span><br><span class="line"><span class="comment">#debåŒ…çš„å½“å‰ç›®å½•ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹(è®°å¾—æ›¿æ¢w.x.y)</span></span><br><span class="line">sudo dpkg -i mysql-apt-config_w.x.y-z_all.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ›´æ–°apt-getä»“åº“</span></span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="å®‰è£…">å®‰è£…</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…è¿‡ç¨‹ä¸­ï¼Œå¼¹å‡ºçª—å£ä¸¤æ¬¡è®¾ç½®å¯†ç </span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="é”™è¯¯ğŸ´">é”™è¯¯ğŸ´</h2>
<p>å¦‚é‡åˆ°dpkgçš„é”™è¯¯ï¼Œéœ€è¦æ›´æ–°dpkgåŒ…</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åœ¨/var/lib/dpkg/ä¸‹ï¼Œæ‹·è´infoç›®å½•åˆ°info_old</span></span><br><span class="line">sudo mv /var/lib/dpkg/inf /var/lib/dpkg/info_old </span><br><span class="line"><span class="comment">#æ–°å»ºä¸€ä¸ªinfoç›®å½•</span></span><br><span class="line">sudo mkdir /var/lib/dpkg/info</span><br><span class="line"><span class="comment">#æ›´æ–°apt-getåŒ…,å¹¶å®‰è£…ä¸Šæ–‡å‡ºç°é”™è¯¯çš„å®‰è£…åŒ…</span></span><br><span class="line">sudo apt-get update </span><br><span class="line">sudo apt-get -f install mysql-community-server</span><br><span class="line">ç„¶åç§»åŠ¨æ‰€æœ‰æ–°ç”Ÿæˆçš„æ–‡ä»¶åŒ…åˆ°info_oldç›®å½•ä¸­</span><br><span class="line">mv /var/lib/dpkg/info/* /var/lib/dpkg/info_old</span><br><span class="line"><span class="comment">#åˆ é™¤infoç›®å½•ï¼Œç»™info_oldæ”¹åä¸ºinfo</span></span><br><span class="line">sudo rm -rf /var/lib/dpkg/info</span><br><span class="line">sudo mv /var/lib/dpkg/info_old /var/lib/dpkg/info</span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡æ–°æ‰§è¡Œä¸€é</span></span><br><span class="line">sudo apt-get install mysql-server</span><br><span class="line"><span class="comment">#æ²¡ä»€ä¹ˆé—®é¢˜</span></span><br><span class="line"><span class="comment">#ä½†æ˜¯æ²¡æœ‰è‡ªåŠ¨å¯åŠ¨msyqlæœåŠ¡</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<div class="note info">
            <p>å…¶å®ï¼Œä¸€èˆ¬mysqlé‡åˆ°é—®é¢˜ï¼Œéƒ½å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæ¯”å¦‚æˆ‘é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜â€¦=_=â€™â€™</p>
          </div>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="number">2020-03-26T06:52:46.063437Z</span> <span class="number">0</span> [<span class="string">ERROR</span>] <span class="string">Can&#x27;t</span> <span class="attr">start server: Bind on TCP/IP port:</span> <span class="string">Permission</span> <span class="string">denied</span></span><br><span class="line"><span class="number">2020-03-26T06:52:46.063462Z</span> <span class="number">0</span> [<span class="string">ERROR</span>] <span class="attr">Do you already have another mysqld server running on port:</span> <span class="number">3306</span> <span class="string">?</span></span><br><span class="line"><span class="number">2020-03-26T06:52:46.063487Z</span> <span class="number">0</span> [<span class="string">ERROR</span>] <span class="string">Aborting</span></span><br></pre></td></tr></table></figure>
<p><span class="ljspan ljspan-red">è§£å†³åŠæ³•</span>:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åŸæ¥æˆ‘æ— æ³•é€šè¿‡sshæ–¹å¼ç™»å½•ï¼Œä½¿ç”¨localhostæœ¬æœºï¼Œå°±å¯ä»¥ç™»é™†äº†ï¼Œä½†æ˜¯è¿˜æœ‰ä¸ªé”™è¯¯ï¼Œå¯é€šè¿‡æŸ¥çœ‹my.cnfæ–‡ä»¶æŸ¥çœ‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯mysqld.cnfç­‰ç­‰ï¼Œåæ­£çœ‹åˆ°æœ‰é…ç½®datadirå’Œsocketç­‰å­—çœ¼çš„æ–‡ä»¶å°±æ˜¯äº†</span></span><br><span class="line"><span class="comment">#è¿›å…¥my.cnfç„¶åå¦‚æœçœ‹åˆ°bind-address   = 127.0.0.1ï¼Œå°±æ³¨é”€æ‰ï¼Œè¿™æ ·å°±å¯ä»¥è¿œç¨‹å¼€å¯mysqlæœåŠ¡äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å ç”¨3306ç«¯å£çš„ç¨‹åº</span></span><br><span class="line">ps -aux |grep mysql</span><br><span class="line"><span class="comment">#å¦‚è¿‡è¢«å ç”¨å°±ç”¨å‘½ä»¤killæ€æ­»è¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¼€å¯æ•°æ®åº“æœåŠ¡</span></span><br><span class="line">sudo service mysql start </span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨rootç”¨æˆ·ç™»å½•</span></span><br><span class="line">mysql -uroot -p </span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹rootå¯†ç (è¿™é‡Œæ˜¯ä¿®æ”¹å½“å‰ç”¨æˆ·å¯†ç çš„ç”¨æˆ·ï¼Œ5.7.29æŒ‡å®šçš„æ–¹å¼ï¼Œä½¿ç”¨update/setéƒ½ä¸è¡Œ)</span></span><br><span class="line">alter user user() identified by <span class="string">&#x27;123456&#x27;</span>;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>å‡çº§Hexoå’Œä½¿ç”¨å¤‡ä»½é…ç½®æ–‡ä»¶</title>
    <url>/2020/09/04/%E5%8D%87%E7%BA%A7Hexo%E5%92%8C%E4%BD%BF%E7%94%A8%E5%A4%87%E4%BB%BD%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h2 id="å‡çº§">å‡çº§</h2>
<p>æƒ³ä½¿ç”¨&quot;å¤‡ä»½é…ç½®æ–‡ä»¶(Alternate Theme Config)&quot;æ¥é…ç½®NexTä¸»é¢˜çš„å‚æ•°ï¼Œä¸ºäº†ä»¥åå‡çº§è¯¥ä¸»é¢˜ï¼Œé¿å…å†²çªï¼Œæ‰€ä»¥æ‰“ç®—ä½¿ç”¨å®˜æ–¹æ–‡æ¡£æ¨èçš„<a href="https://hexo.io/docs/configuration.html#Using-an-Alternate-Config">Alternate Theme Config</a>,é€šè¿‡è¿™ä»½æ–‡æ¡£åˆå¯çŸ¥ï¼Œä½¿ç”¨Alternate Theme Configéœ€è¦ä½¿ç”¨Hexo 5.0ç‰ˆæœ¬ï¼Œé¾Ÿé¾ŸğŸ¢ğŸ¢ï¼Œé‚£å°±åªèƒ½æ›´æ–°äº†ğŸ˜­ã€‚</p>
<a id="more"></a>
<p>å®˜æ–¹æ–‡æ¡£è²Œä¼¼æ²¡æœ‰ï¼Œé‚£å°±åªèƒ½ç½‘ä¸Šæœäº†ã€‚ç”±äºæˆ‘æ²¡æœ‰ä»€ä¹ˆé—®ä»·æ”¾åœ¨ä¸ªäººåšå®¢ä¸Šï¼Œå°±å‡ ç¯‡æŒ‡å¯¼æ–‡ä»¶ï¼Œä¸”ç”µè„‘ç«¯ä¹Ÿæœ‰å­˜æ¡£ï¼Œæ‰€ä»¥â€¦â€‹.â€‹.â€‹.ğŸ˜</p>
<p>æˆ‘å°±å¯ä»¥å¤§åˆ€é˜”æ–§åœ°æäº†ğŸ’©</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å…¶å®å¾ˆç®€å•</span></span><br><span class="line"><span class="comment">#æŸ¥çœ‹å½“å‰hexoç‰ˆæœ¬</span></span><br><span class="line">hexo version</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step1:è¿›å…¥ä½ çš„hexoæ ¹ç›®å½•</span></span><br><span class="line"><span class="comment">#æ‰¾åˆ°package.jsonæ–‡ä»¶ï¼Œä¿®æ”¹è¯¥ç‰ˆæœ¬å·</span></span><br><span class="line">- <span class="string">&quot;hexo&quot;</span>: <span class="string">&quot;^4.2.0&quot;</span></span><br><span class="line">+ <span class="string">&quot;hexo&quot;</span>: <span class="string">&quot;^5.0.0&quot;</span></span><br><span class="line"><span class="comment">#ä¿å­˜é€€å‡º</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Step2:ä½¿ç”¨npmå‡çº§</span></span><br><span class="line">npm upgrade</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step3:å¦‚æœæç¤ºæœ‰ä¾èµ–éœ€è¦ä¿®å¤ï¼ŒæŒ‰æç¤ºä¿®å¤ï¼Œä¸€èˆ¬ä¸º</span></span><br><span class="line">npm audit fix</span><br><span class="line"></span><br><span class="line"><span class="comment">#Step4ï¼šå¦‚æœæœ‰å…³äºé…ç½®æ–‡ä»¶è­¦å‘Šä¹‹ç±»çš„ï¼Œè®°å¾—ä¿®æ”¹</span></span><br><span class="line">WARN  Deprecated config detected: <span class="string">&quot;use_date_for_updated&quot;</span> is deprecated, please use <span class="string">&quot;updated_option&quot;</span> instead. See https://hexo.io/docs/configuration <span class="keyword">for</span> more details.</span><br><span class="line"><span class="comment">#åƒä¸Šé¢çš„è­¦å‘Šå°±æ˜¯è¯´é…ç½®_config.ymlæ–‡ä»¶ä¸­&quot;use_date_for_updated&quot;å·²ç»è¢«åºŸå¼ƒï¼Œæ”¹ç”¨&quot;updated_option&quot;æ¥é…ç½®ï¼Œä¿®æ”¹åä¿å­˜å°±å¯ä»¥äº†ã€‚å¯ä»¥é€šè¿‡https://hexo.io/docs/configurationäº†è§£è¯¦æƒ…</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡æ£€æŸ¥hexoç‰ˆæœ¬</span></span><br><span class="line">hexo version</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤ç¼“å­˜</span></span><br><span class="line">hexo clean</span><br><span class="line"><span class="comment">#ç”Ÿæˆé™æ€æ–‡ä»¶å¹¶å¼€å¯æœ¬åœ°æœåŠ¡</span></span><br><span class="line">hexo g &amp;&amp; hexo s</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="ä½¿ç”¨å¤‡ä»½é…ç½®æ–‡ä»¶">ä½¿ç”¨å¤‡ä»½é…ç½®æ–‡ä»¶</h2>
<p><span class="ljspan ljspan-blue"><a href="https://hexo.io/docs/configuration.html#Using-an-Alternate-Config">Hexoå®˜æ–¹æ–‡æ¡£</a></span>å’Œ<span class="ljspan ljspan-black"><a href="https://hexo.io/docs/configuration.html#Using-an-Alternate-Config">NexTå®˜æ–¹æ–‡æ¡£</a></span>å†™å¾—å¾ˆæ¸…æ¥š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åœ¨æ ¹ç›®å½•_config.ymlç»“å°¾ä¸­å¡«å†™ä¸»é¢˜é…ç½®å‚æ•°</span></span><br><span class="line">+ theme_config:</span><br><span class="line"><span class="comment">#æŠŠtheme config fileæ–‡ä»¶æ‰€æœ‰å†…å®¹éƒ½å¤åˆ¶åˆ°theme_configä¸‹æ–¹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯ä»¥äº†ï¼Œso easy!</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Attentionâ€‹!ğŸ“¢</strong>:Hexoç”Ÿæˆå’Œéƒ¨ç½²çš„æ—¶å€™è®°å¾—ä¹ŸåŠ ä¸Š<code>--config xxx</code>å“¦ï¼Œä¸ç„¶åé¢çš„é—®é¢˜è®©ä½ å¤´ç–¼ğŸ˜µï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/11/18/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Test">Test</h2>
<h3 id="Span">Span</h3>
<p><span class="ljspan ljspan-reverse">ç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”</span></p>
<h3 id="Blockquotes">Blockquotes</h3>
<!-- Center quote -->
<blockquote class="blockquote-center">
            <p>Something</p>

          </blockquote>
<!-- Tag Alias -->
<blockquote class="blockquote-center">
            <p>Something</p>

          </blockquote>
<h3 id="Label">Label</h3>
<p>Lorem <span class="label default">ipsum</span> <span class="label primary">dolor sit</span> amet, consectetur <span class="label success">adipiscing elit,</span> sed <span class="label info">do eiusmod</span> tempor incididunt ut labore et dolore magna aliqua.</p>
<p>Ut enim <em><span class="label warning">ad</span></em> minim veniam, quis <strong><span class="label danger">nostrud</span></strong> exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
<p>Duis aute irure dolor in reprehenderit in voluptate <s><span class="label default">velit</span></s> <mark>esse</mark> cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
<h3 id="Label-Test">Label Test</h3>
<span class="label info">[æ•™ç¨‹]([https://vuepress.mirror.docker-practice.com/install/mirror.html#ubuntu-16-04-%E3%80%81debian-8-%E3%80%81centos-7](https://vuepress.mirror.docker-practice.com/install/mirror.html#ubuntu-16-04-ã€debian-8-ã€centos-7))</span>
<p><strong><span class="label default">&</span></strong></p>
<blockquote>
<p>This ğŸ˜„ğŸ˜­ is your very first post.</p>
</blockquote>
<h3 id="Span-2">Span</h3>
<p><span class="ljspan ljspan-reverse ljspan-red"><a href="https://hexo.io/">äººç”Ÿæœ‰æ¢¦ï¼Œå„è‡ªç²¾å½©ï¼</a></span></p>
<p><span class="ljspan ljspan-red"><a href="https://hexo.io/">äººç”Ÿæœ‰æ¢¦ï¼Œå„è‡ªç²¾å½©ï¼</a></span><br>
<span class="ljspan ljspan-reverse ljspan-yellow"><a href="https://hexo.io/">æ°´èƒ½è½½èˆŸï¼Œäº¦èƒ½è¦†èˆŸï¼</a></span></p>
<p><span class="ljspan ljspan-yellow"><a href="https://hexo.io/">æ°´èƒ½è½½èˆŸï¼Œäº¦èƒ½è¦†èˆŸï¼</a></span></p>
<h3 id="List">List</h3>
<ul>
<li>æˆ‘æ˜¯â­ï¸èœå¾å¤</li>
<li>æˆ‘æ˜¯èœå¾å½¬</li>
<li>æˆ‘æ˜¯èœå¾é‘«</li>
</ul>
<h3 id="Url">Url</h3>
<p>&lt; <a href="http://www.baidu.com">www.baidu.com</a> &gt;</p>
<h3 id="image">image</h3>
<p><img src="/assets/img/wallhaven-p869pm_1920x1080.png" alt="fantasy food"></p>
<h3 id="Code-Blocks">Code Blocks</h3>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$æˆ‘æ˜¯èœå¾å¤ä¹‹é‘«æ€»ç‰›æ‰¹</span><br></pre></td></tr></table></figure>
<h2 id="Quick-Start">Quick Start</h2>
<h3 id="Create-a-new-post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<!-- more  -->
<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
<!-- more  -->
<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
<!-- more  -->
]]></content>
  </entry>
  <entry>
    <title>æŸ¥çœ‹ç«¯å£å ç”¨</title>
    <url>/2020/09/08/%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8/</url>
    <content><![CDATA[<blockquote>
<p>æŸ¥çœ‹ç«¯å£å ç”¨ æˆ– è¿›ç¨‹ID/åçš„æ–¹æ³•æœ‰å¥½å‡ ç§ï¼Œä»¥ä¸‹åˆ†åˆ«ä¸¾ä¾‹</p>
</blockquote>
<h4 id="ç¬¬ä¸€ç§åŠæ³•ï¼š">ç¬¬ä¸€ç§åŠæ³•ï¼š</h4>
<span class="label info">sudo netstat -nltp|grep ç«¯å£å·/è¿›ç¨‹å</span>
<p>eg1ï¼š<code>sudo netstat -nltp|grep 3306</code></p>
<p>eg2:   <code>sudo netstat -ntlp|grep mysql</code></p>
<a id="more"></a>
<h4 id="ç¬¬äºŒç§åŠæ³•ï¼š">ç¬¬äºŒç§åŠæ³•ï¼š</h4>
<span class="label success">sudo lsof -i :ç«¯å£å·</span>
<p>eg:   <code>sudo lsof -i :3306</code></p>
<div class="note default">
            <h4 id="Note">Note:</h4><p>psåªèƒ½æŸ¥çœ‹è¿›ç¨‹åå’Œè¿›ç¨‹ID</p>
          </div>
<h4 id="ç¬¬ä¸‰ç§åŠæ³•ï¼š">ç¬¬ä¸‰ç§åŠæ³•ï¼š</h4>
<span class="label warning">sudo ps -aux|grep è¿›ç¨‹å</span>
<p>eg:   <code>sudo ps -aux|grep mysql</code></p>
<blockquote>
<p>éƒ½åŠ sudoçš„åŸå› æ˜¯æŸäº›ç¨‹åºçš„æŸ¥çœ‹éœ€è¦rootæƒé™é˜¿ï¼ğŸ˜‚</p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>ç•ªèŒ„è‚¥ç‰›ç…²</title>
    <url>/2020/12/07/%E7%95%AA%E8%8C%84%E8%82%A5%E7%89%9B%E7%85%B2/</url>
    <content><![CDATA[<p>åŸææ–™ï¼šç•ªèŒ„ä¸¤ä¸ªã€è‚¥ç‰›ä¸€ç›’ã€è‘±ã€è’œå¤´ï¼Œç•ªèŒ„é…±ï¼Œèšæ²¹ï¼Œé…±æ²¹ï¼Œç³–ï¼Œç›ï¼Œèƒ¡æ¤’ç²‰ï¼Œæ·€ç²‰</p>
<p>å‰æœŸå‡†å¤‡ï¼š</p>
<ol>
<li>ç•ªèŒ„ç”»åå­—åˆ€ï¼Œæ”¾å¼€æ°´é‡Œæ³¡ä¸€ä¼šï¼Œå‰¥çš®ï¼Œåˆ‡å—<a id="more"></a></li>
<li>è‘±å–è‘±ç™½ï¼Œè’œå¤´å››äº”ä¸ªåˆ‡ç‰‡</li>
<li>è‚¥ç‰›æ”¾å…¥å¼€æ°´é‡Œï¼Œç„¯ä¸€ä¸‹ï¼Œç­‰åˆ°è‚¥ç‰›å˜è‰²ä¾¿å¯æå‡º</li>
<li>è°ƒé…±æ±ï¼Œä¸¤å‹ºç•ªèŒ„é…±ï¼Œä¸€å°å‹ºç›ï¼Œä¸€å‹ºåŠé…±æ²¹ï¼Œä¸‰å°å‹ºç³–ï¼ŒåŠ å…¥æ·€ç²‰æ°´ï¼Œæ…æ‹Œå‡åŒ€</li>
</ol>
<p>å¼€å§‹çƒ¹é¥ªï¼š</p>
<ol>
<li>å†·ç…²çƒ­æ²¹ï¼ŒåŠ å…¥è‘±ç™½å’Œè’œç‰‡ï¼Œçˆ†é¦™</li>
<li>åŠ å…¥ç•ªèŒ„å—ï¼Œç‚’åˆ°ç•ªèŒ„è½¯çƒ‚ï¼Œå‡ºæ±æ°´</li>
<li>åŠ å…¥ä¸€ç¢—å¼€æ°´</li>
<li>ç­‰æ°´å¼€åï¼ŒåŠ å…¥è‚¥ç‰›å’Œé…±æ±</li>
<li>æ…æ‹Œä¸€ä¸‹è‚¥ç‰›ï¼Œç…®å¼€åï¼ŒåŠ å…¥èƒ¡æ¤’ç²‰å’Œè‘±ç²’å°±å¯ä»¥äº†ã€‚</li>
</ol>
]]></content>
      <categories>
        <category>food</category>
      </categories>
  </entry>
  <entry>
    <title>å®‰è£…Baobab</title>
    <url>/2020/09/08/%E5%AE%89%E8%A3%85Baobab/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>å®‰è£…æ•™ç¨‹æŒ‰ç…§å®˜ç½‘çš„<span class="ljspan ljspan-blue"><a href="https://github.com/BaobabLims/baobab.lims">å®‰è£…æ­¥éª¤</a></span>ï¼Œé‡‡ç”¨dockerçš„æ–¹å¼å°±å¯ä»¥å®Œæˆ</p>
<a id="more"></a>
<h3 id="é…ç½®">é…ç½®</h3>
<p>ç”±äº8080ç«¯å£ğŸŒä¸€èˆ¬éƒ½ä¼šè¢«æŸäº›è½¯ä»¶å ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œé¢çš„ç«¯å£æ˜ å°„éœ€è¦ä¿®æ”¹ï¼Œæˆ‘æƒ³æŠŠè®¾ç½®æœåŠ¡å™¨ç«¯å£å¯¹åº”dockerçš„ç«¯å£éƒ½ä¸ºï¼š8090</p>
<p>åœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤çš„æ—¶å€™ï¼Œå‘ç°ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢ğŸ¢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -p 8090:8090 quay.io/baobab-lims/baobab-lims</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯é…ç½®äº†é•œåƒåŠ é€Ÿï¼Œç½‘ä¸Šæœ‰<a href="%5Bhttps://vuepress.mirror.docker-practice.com/install/mirror.html#ubuntu-16-04-%E3%80%81debian-8-%E3%80%81centos-7%5D(https://vuepress.mirror.docker-practice.com/install/mirror.html#ubuntu-16-04-%E3%80%81debian-8-%E3%80%81centos-7)">æ•™ç¨‹</a></p>
<hr>
<h3 id="å®‰è£…">å®‰è£…</h3>
<p>é‡æ–°æ‰§è¡Œä¸€é</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker run -p 8090:8090 quay.io/baobab-lims/baobab-lims</span><br></pre></td></tr></table></figure>
<p>æˆåŠŸäº†ğŸ˜ƒ</p>
<img src="/assets/img/Baobabæ‰§è¡Œç»“æœ.png"  />
<p>ä½†æ˜¯ä½¿ç”¨ç½‘å€ç™»é™†ä¸ä¸Šï¼Œéš¾é“å®¹å™¨ä¸èƒ½ç”¨å—â“å‘çˆ¹ğŸ˜­</p>
<hr>
<h3 id="ç»“æœ">ç»“æœ</h3>
<ul>
<li>
<p>ä½¿ç”¨dockerå®‰è£…ï¼Œç½‘å€èƒ½ç™»å½•ï¼Œæç¤ºè¿æ¥è¢«é‡ç½®çš„çŠ¶æ€ï¼Œè€Œå†…ç½‘è®¡ç®—æœºæ— æ³•è¿æ¥ç½‘é¡µçš„çŠ¶æ€ã€‚</p>
</li>
<li>
<p>æ”¹ç”¨Docker-composeå®‰è£…â€”å®‰è£…å¤±è´¥</p>
</li>
</ul>
<hr>
<h3 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h3>
<p>åœ¨<span class="label info">2020/03/13</span> é€šè¿‡å¸è½½ä¹‹å‰çš„å®¹å™¨ï¼Œç„¶åæˆ‘<span class="label danger">ä¿®æ”¹dockeré•œåƒä»“åº“ä¸ºå›½å†…é˜¿é‡Œçš„ä»“åº“</span>ï¼Œé‡æ–°ä¸‹è½½baobabé•œåƒæ–‡ä»¶,ç„¶åè®©ç³»ç»Ÿç«¯å£<span class="label default">æ˜ å°„è‡ªåŠ¨è®¾ç½®</span>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡å¤–ç½‘è®¿é—®äº†ğŸ˜…ï¼</p>
]]></content>
      <categories>
        <category>lims</category>
      </categories>
      <tags>
        <tag>lims</tag>
      </tags>
  </entry>
  <entry>
    <title>ç«¯å£è½¬å‘å’Œå¾®ä¿¡æ¥å£é…ç½®</title>
    <url>/2020/12/07/%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E5%92%8C%E5%BE%AE%E4%BF%A1%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<p>ç«¯å£è½¬å‘<br>
ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘æ˜¯ç”¨nginxä»£ç†ç«¯å£çš„æ—¶å€™ï¼Œ80ç«¯å£ä¸€ç›´æ— æ³•è½¬å‘åˆ°å…¶ä»–ç«¯å£ï¼ŒæœåŠ¡ä¸€ç›´æ²¡æœ‰ç”Ÿæ•ˆï¼Œä½¿ç”¨å…¶ä»–ç«¯å£å°±å¯ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¤–ç½‘æ˜¯æ— æ³•è®¿é—®åˆ°çš„ï¼Œè€Œå†…ç½‘å¯ä»¥<a id="more"></a></p>
<p>è€Œåï¼Œæˆ‘å‘ç°tomcatçš„8080ç«¯å£ï¼Œä¹Ÿæ— æ³•æ˜ å°„åˆ°å¤–ç½‘ä¸­ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œè·Ÿnginxçš„80ç«¯å£ä¸€æ ·ï¼Œéƒ½æ— æ³•åœ¨å¤–ç½‘ä¸­ä½¿ç”¨ã€‚å¤ªæ¶å¿ƒäº†ã€‚</p>
<p>â€‹â€‹â€‹â€‹â€‹â€‹ æ³¨æ„</p>
<p>é€šè¿‡æŸ¥é˜…ï¼Œå‘ç°80ç«¯å£å’Œ8080ç«¯å£æ˜¯è¢«å±è”½äº†å¯¹å¤–è®¿é—®ï¼Œè¿™æ˜¯<span class="label danger">ç½‘ç»œè¿è¥å•†</span>çš„é—®é¢˜ã€‚</p>
<div class="note info">
            <p>åŸå› ï¼šè¿™ä¸¤ä¸ªç«¯å£æ˜¯å¸¸ç”¨çš„HTTPåè®®ç«¯å£ï¼Œç›®çš„æ˜¯é˜²æ­¢æœªå¤‡æ¡ˆçš„ç½‘ç«™å¯¹å¤–å‘å¸ƒ</p>
          </div>
<p>è§£å†³åŠæ³•ï¼šä¿®æ”¹ç«¯å£å·æˆ–ç”³è¯·ä¸€ä¸ªå·²ç»å¤‡æ¡ˆçš„åŸŸåæŒ‡å‘è¯¥æœåŠ¡å™¨å¹¶ä¸”å‘è¿è¥å•†è¦æ±‚å¼€é€šâ€‹â€‹â€‹â€‹</p>
<p>å¾®ä¿¡æ¥å£é…ç½®<br>
å¾®ä¿¡å…¬ä¼—å·çš„æ¥å£é…ç½®å¯çœŸå¤Ÿæ¶å¿ƒçš„ï¼Œç”¨IPä¸ç®¡æ€æ ·éƒ½ä»–ä¹ˆä¸è¡Œ</p>
<p>æˆ‘çš„IPæ˜¯12.23.334.254ï¼Œé¡¹ç›®ä¸ºwxï¼Œç„¶åä¸ºäº†è·å–access_tokenï¼Œéœ€è¦è®¾ç½®æœåŠ¡å™¨çš„æ¥æ”¶åœ°å€URL</p>
<p>è¿™ä¸ªURLï¼Œä¸ç®¡æˆ‘æ˜¯http://12.23.334.254/wx/configï¼Œè¿˜æ˜¯http://12.23.334.254:80/wx/configï¼Œè¦ä¹ˆæç¤ºæ— æ•ˆURLï¼Œè¦ä¹ˆæç¤ºè¯·æ±‚è¶…æ—¶</p>
<p>æˆ‘æ”¹ç”¨æµ‹è¯•å·ï¼Œä¹Ÿæ˜¯ç‰¹ä¹ˆçš„ä¸è¡Œã€‚</p>
<p>æƒ³é€šè¿‡eclipseæ¥æ‰§è¡Œï¼Œç„¶åå¯ä»¥é€šè¿‡consoleé‡Œé¢çš„è®°å½•æ¥æŸ¥çœ‹åˆ°åº•æ˜¯ä»€ä¹ˆå‡ºé”™äº†ã€‚ä½†æ˜¯æˆ‘å‘ç°è¿™ä»–ä¹ˆè¿controlleréƒ½è¿›ä¸æ¥ï¼Œè¿™ä»–ä¹ˆå°±è¡¨æ˜æˆ‘çš„URLå‡ºé”™å˜›ï¼ç”¨ä¸äº†</p>
<p>è¡Œï¼Œæä¸å®šï¼Œæˆ‘æ‰¾è…¾è®¯å®¢æœï¼Œé¥¶äº†åŠå¤©ï¼Œåé¢è¦æˆ‘å»è®ºå›è‡ªå·±æ‰¾å»/é—®å¤§ç¥</p>
<p>è¿™ä»–ä¹ˆå°±æ˜¯æ²¡æœ‰æä¾›è§£ç­”äº†ã€‚â€‹â€‹</p>
<p>é¾Ÿé¾Ÿï¼Œé‡æ–°æ¢æˆä¹‹å‰å†…ç½‘ç©¿é€çš„åŸŸåï¼Œä¸€æ­¥å°±è¿æ¥ä¸Šäº†ï¼Œè¿™â€¦ä¸æ˜¯è¯´å¯ä»¥IPè¿æ¥çš„å—ï¼Œè¿™æ€ä¹ˆå°±ä¸è¡Œäº†å‘¢ï¼Œå¯èƒ½æˆ‘æé”™äº†ï¼Œç°åœ¨ä¸è¡Œäº†å§â€‹â€‹â€‹â€‹</p>
]]></content>
  </entry>
  <entry>
    <title>ç©ºæ ¼æ›¿æ¢</title>
    <url>/2021/04/23/%E7%A9%BA%E6%A0%BC%E6%9B%BF%E6%8D%A2/</url>
    <content><![CDATA[<h2 id="æè¿°">æè¿°</h2>
<p>è®¾è®¡ä¸€ç§æ–¹æ³•ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰ç©ºæ ¼æ›¿æ¢æˆ %20 ã€‚ä½ å¯ä»¥å‡è®¾è¯¥å­—ç¬¦ä¸²æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥åŠ å…¥æ–°çš„å­—ç¬¦ï¼Œä¸”ä½ å¾—åˆ°çš„æ˜¯ â€œçœŸå®çš„â€ å­—ç¬¦é•¿åº¦ã€‚<a id="more"></a></p>
<p>ä½ çš„ç¨‹åºè¿˜éœ€è¦è¿”å›è¢«æ›¿æ¢åçš„å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p>
<h2 id="æ ·ä¾‹">æ ·ä¾‹</h2>
<p>å¯¹äºå­—ç¬¦ä¸² â€œHello Worldâ€ , é•¿åº¦ä¸º 11<br>
æ›¿æ¢ç©ºæ ¼ä¹‹åï¼Œå‚æ•°ä¸­çš„å­—ç¬¦ä¸²éœ€è¦å˜ä¸º â€œHello%20Worldâ€ï¼Œå¹¶ä¸”æŠŠæ–°é•¿åº¦ 17 ä½œä¸ºç»“æœè¿”å›</p>
<h2 id="æ€è·¯">æ€è·¯</h2>
<ol>
<li>å¾ªç¯éå†å­—ç¬¦æ•°ç»„</li>
<li>ç¢°åˆ°ç©ºå­—ç¬¦åˆ™å°†ç©ºå­—ç¬¦åæ‰€æœ‰çš„å­—ç¬¦å‘åç§»åŠ¨ä¸¤ä½ï¼ˆå‡è®¾å­—ç¬¦æ•°ç»„æœ‰è¶³å¤Ÿé•¿åº¦ï¼‰ï¼Œé˜²æ­¢æ·»åŠ  %20 æ—¶ï¼Œé€ æˆè¦†ç›–è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±.</li>
<li>å°†ç©ºå­—ç¬¦ä»¥åŠåä¸¤ä½å…± 3 ä¸ªä½ç½® æ›¿æ¢æˆ %20</li>
<li>å°†å­—ç¬¦æ•°ç»„çš„é•¿åº¦ +2</li>
</ol>
<h2 id="ä»£ç ">ä»£ç </h2>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">replaceBlank</span><span class="params">(<span class="keyword">char</span>[] string, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(string == <span class="keyword">null</span>||length ==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> k=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; length ; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(string[i]==<span class="string">&#x27; &#x27;</span>)k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> newlen = (length+k*<span class="number">2</span>);</span><br><span class="line">        string[newlen] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(string[i]==<span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j = (newlen-<span class="number">1</span>);j&gt;i;j--)&#123;</span><br><span class="line">                    string[j] = string[j-<span class="number">2</span>]; </span><br><span class="line">                &#125; </span><br><span class="line">            string[i] = <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">            string[i+<span class="number">1</span>] = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">            string[i+<span class="number">2</span>] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;  </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newlen;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>è¿ç§»mysqlæ•°æ®</title>
    <url>/2020/09/10/%E8%BF%81%E7%A7%BBmysql%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="æ‹·è´æ•°æ®">æ‹·è´æ•°æ®</h2>
<p>ä»åŸæ¥çš„mysqlæ•°æ®åº“datadirç›®å½•ï¼Œcpå‡ºæ‰€æœ‰ä¸œè¥¿ï¼Œå…¶ä¸­æœ€é‡è¦çš„ï¼Œé™¤äº†é‚£äº›æ•°æ®åº“æ•°æ®è¡¨ï¼Œè¿˜æœ‰ibdata1è¿™ä¸ªæ–‡ä»¶ï¼Œå’Œiblogfile0ã€ib_logfile1å’Œib_buffer_poolç­‰æ–‡ä»¶ï¼Œæœ€å¥½æŠŠæ•´ä¸ªç›®å½•éƒ½æ‹·è´ä¸‹æ¥ã€‚<span class="label info">å±æ€§å’Œç”¨æˆ·æƒé™</span>éƒ½è¦ä¸€å¹¶å¤åˆ¶å“¦ğŸ˜®</p>
<a id="more"></a>
<p>åœ¨æ–°çš„ç³»ç»Ÿä¸­æ–°è£…ä¸€ä¸ªmysqlï¼Œæˆ‘ä½¿ç”¨<span class="label success">APTå®‰è£…æ¨¡å¼</span>ï¼Œæ‰€ä»¥ç›®å½•é…ç½®éƒ½è‡ªåŠ¨å¸®æˆ‘é…ç½®å¥½äº†ï¼ğŸ™‚</p>
<h2 id="å¸è½½mariadb">å¸è½½mariadb</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#é¦–å…ˆå¸è½½mariadbå¹¶åˆ é™¤ç›¸å…³é…ç½®æ–‡ä»¶(datadirç›®å½•)</span></span><br><span class="line">sudo apt-get purge mariadb*</span><br><span class="line"></span><br><span class="line"><span class="comment">#åˆ é™¤æ²¡ç”¨çš„ç›¸å…³ä¾èµ–åŒ…</span></span><br><span class="line">sudo apt-get automove </span><br><span class="line"></span><br><span class="line"><span class="comment">#éªŒè¯mariadbæœåŠ¡æ˜¯å¦è¿˜åœ¨</span></span><br><span class="line">sudo service mysql status</span><br></pre></td></tr></table></figure>
<h2 id="é‡è£…mysqlæœåŠ¡">é‡è£…mysqlæœåŠ¡</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!!!æŠŠæ‹·è´çš„datadirç›®å½•æ‹·è´å›å»/var/lib/mysql</span></span><br><span class="line"><span class="comment">#datadirç›®å½•ä¸‹ä¸€èˆ¬åŒ…å«ibdata1,iblogfile0,æ•°æ®åº“ç›®å½•ç­‰</span></span><br><span class="line">sudo cp -rpf /path/to/datadir/* /var/lib/mysql/</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ·»åŠ mysql-apt-ä»“åº“åˆ°ç³»ç»Ÿä»“åº“åˆ—è¡¨</span></span><br><span class="line">sudo dpkg -i /PATH/version-specific-package-name.deb</span><br><span class="line"></span><br><span class="line"><span class="comment">#ç”±äºæˆ‘æ˜¯é‡è£…ï¼Œä¹‹å‰å·²ç»é…ç½®äº†ä»“åº“ï¼Œæ‰€ä»¥çœç•¥ä¸Šä¸€æ­¥</span></span><br><span class="line"><span class="comment">#ä»ä»“åº“æ›´æ–°åŒ…ä¿¡æ¯</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®‰è£…mysql</span></span><br><span class="line">sudo apt-get install mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹mysqlæœåŠ¡ç«¯å£3306æ˜¯å¦è¢«å ç”¨</span></span><br><span class="line">ps -aux|grep mysql</span><br><span class="line"><span class="comment">#æ²¡æœ‰çš„è¯å°±å¯ä»¥äº†å¯åŠ¨æœåŠ¡ï¼Œæœ‰çš„è¯ï¼Œç”¨å‘½ä»¤killæ€æ­»é‚£ä¸ªè¿›ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å¯åŠ¨mysqlæœåŠ¡</span></span><br><span class="line">sudo service mysql start</span><br><span class="line"></span><br><span class="line"><span class="comment">#æµ‹è¯•ä¸€ä¸‹æ˜¯å¦æ­£å¸¸å¯åŠ¨</span></span><br><span class="line">mysql --version</span><br><span class="line"><span class="comment">#çœ‹åˆ°ä»¥ä¸‹ç‰ˆæœ¬ä¿¡æ¯å°±è¯æ˜å®Œæˆå®‰è£…äº†ï¼</span></span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.29, <span class="keyword">for</span> Linux (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="å¿˜è®°å¯†ç ï¼Ÿ">#å¿˜è®°å¯†ç ï¼Ÿ</h2>
<p>æœ‰åŠæ³•æ›´æ–°rootç”¨æˆ·å¯†ç çš„ğŸ˜¸,åˆ«æ…Œ</p>
<p>å¦‚æœrootç”¨æˆ·å¯†ç å¿˜è®°ï¼Œå…ˆå…³äº†mysqlæœåŠ¡ï¼Œç„¶ååˆ°<span class="label warning"> my.cnf</span>æ–‡ä»¶ä¸­åšå¦‚ä¸‹ä¿®æ”¹</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[mysqld]</span><span class="comment">#åœ¨è¿™ä¸ªä¸‹é¢</span></span><br><span class="line">skip-grant-tables #æ·»åŠ ä¸€è¡Œ</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ç³»ç»Ÿä¸­ç›´æ¥è¾“å…¥å‘½ä»¤</p>
<blockquote>
<p>mysql -uroot    #å°±å¯ä»¥ç›´æ¥ç™»å½•</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#åœ¨ç™»å½•çš„æ—¶å€™æ›´æ–°å¯†ç </span><br><span class="line">UPDATE mysql.user SET authentication_string&#x3D;password(&#39;xxxxxx&#39;) WHERE User&#x3D;&#39;root&#39; AND Host &#x3D;&#39;localhost&#39;; </span><br><span class="line"></span><br><span class="line">#åˆ·æ–°æƒé™</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">#é€€å‡º</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
<div class="note warning">
            <p>æ³¨æ„!!!ğŸ’¥ğŸ’¥</p><p>æ›´æ”¹å¯†ç åï¼Œè®°å¾—æ³¨é‡Šæ‰skip-grant-tables;</p>
          </div>
]]></content>
      <categories>
        <category>database</category>
      </categories>
      <tags>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰è£…mediawiki</title>
    <url>/2020/09/09/%E5%AE%89%E8%A3%85mediawiki/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>å®‰è£…<span class="ljspan ljspan-reverse ljspan-yellow"><a href="https://www.mediawiki.org/wiki/MediaWiki">mediawiki</a></span>å¾ˆç®€å•ğŸ˜€ï¼Œæ¯”è¾ƒéš¾çš„æ˜¯éœ€è¦å®‰è£…å¥¹æ‰€éœ€è¦çš„è½¯ä»¶å’Œé…ç½®ï¼Œæˆ‘åœ¨ubuntuå®‰è£…è¿‡å‡ ä¸ªï¼Œéƒ½æˆåŠŸäº†ï¼Œä½†æ˜¯åœ¨centosä¸Šå®‰è£…æ—¶ï¼Œå‘ç°webæœåŠ¡å™¨å’Œ<span class="ljspan ljspan-reverse ljspan-yellow"><a href="https://www.mediawiki.org/wiki/MediaWiki">mediawiki</a></span>å‡ºç°æŸäº›å†²çªï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨ï¼Œå…·ä½“ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œå¯èƒ½æ˜¯æˆ‘çš„webæœåŠ¡å™¨é…ç½®å‡ºé—®é¢˜â€¦ğŸ˜©</p>
<a id="more"></a>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>å…·ä½“å®‰è£…æ•™ç¨‹çœ‹<a href="https://www.mediawiki.org/wiki/MediaWiki">å®˜ç½‘</a>å•¦ï¼Œå¾—<span class="label danger">ç¿»å¢™</span>å“¦ï¼Œéšè®©<span class="ljspan ljspan-yellow"><a href="https://github.com/wikimedia/mediawiki">github</a></span>ä¸Šé¢ä¹Ÿæä¾›ä¸‹è½½ï¼Œä½†æ˜¯æ²¡æœ‰æ•™ç¨‹é˜¿ï¼Œè€Œä¸”é‡åˆ°é—®é¢˜ï¼Œä¹Ÿæ²¡æœ‰ç»™å‡ºè§£å†³åŠæ³•ï¼Œè¿˜æ˜¯å»<a href="https://www.mediawiki.org/wiki/MediaWiki">å®˜ç½‘</a>å§</p>
<p>å¦‚æœæç¤ºè¯´éœ€è¦å®‰è£…composerï¼Œ<a href="https://www.mediawiki.org/wiki/MediaWiki">å®˜ç½‘</a>ä¹Ÿæœ‰æä¾›ä¸‹è½½å®‰è£…çš„æ–¹æ³•</p>
<p>ç„¶åç”¨composerå®‰è£…ä¸€äº›ä¾èµ–ï¼Œå¦‚æœè¿™æ—¶å€™æ— æ³•å®‰è£…ï¼Œå‡ºç°å†…å­˜ä¸å¤Ÿï¼ˆé‡å¯ç³»ç»Ÿï¼‰æˆ–ä¸‹è½½å¤±è´¥ï¼ˆä¿®æ”¹composeré•œåƒï¼‰ï¼Œè¿™äº›éƒ½å¯ä»¥é€šè¿‡ç™¾åº¦ä¸€ä¸€è§£å†³ï¼›ä½†æ˜¯ä¿®æ”¹composeré•œåƒæ¯”è¾ƒéº»çƒ¦ğŸ’©</p>
<p>åœ¨ä¿®æ”¹é•œåƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæç¤ºæ— æ³•ä¿®æ”¹ï¼Œå‡ºç°ç±»ä¼¼é—®é¢˜ğŸ˜µï¼š<strong>Could not read /home/ç”¨æˆ·å/.composer/config.json</strong></p>
<blockquote>
<p><a href="https://developer.aliyun.com/composer">è¿™é‡Œ</a>æ˜¯é˜¿é‡Œäº‘æä¾›çš„ä¿®æ”¹é•œåƒçš„æ–¹æ³•ğŸ’…</p>
</blockquote>
<p>é‚£ä¹ˆå°±ä¿®æ”¹ä¸€ä¸‹<code>/home/ç”¨æˆ·å/.composer/config.json</code>å’Œ<code>/home/ç”¨æˆ·å/.composer/auth.json</code>çš„æƒé™ä¸º777å†é‡æ–°è¿è¡Œcomposer å°±åº”è¯¥å¯ä»¥äº†</p>
<hr>
<h2 id="mediawikiè¯­æ³•">mediawikiè¯­æ³•</h2>
<ol>
<li>__mediawiki__è®¾ç½®æ¨¡æ¿æ—¶ï¼Œç›´æ¥åœ¨æœç´¢æ¡†è¾“å…¥â€œ<em>Template:æ¨¡æ¿å</em>â€å°±å¯ä»¥åˆ›å»ºæ¨¡æ¿äº†ï¼Œ__è°ƒç”¨æ¨¡æ¿__çš„æ–¹æ³•ä¸º:[[Template:æ¨¡æ¿å]];</li>
<li>ä¿®æ”¹çš®è‚¤çš„æ ·å¼å¯é€šè¿‡åœ¨æœç´¢ä¸­è¾“å…¥__MediaWiki:Vector.css__æ¥æ‰¾åˆ°å¯¹åº”çš„çš®è‚¤cssæ ·å¼æ–‡ä»¶åï¼Œä¿®æ”¹æ•´ä¸ªçš®è‚¤çš„æ ·å¼</li>
<li>ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æœç´¢æ¡†ä¸­è¾“å…¥__MediaWiki:Common.css__è¿›å…¥ä¿®æ”¹é¡µé¢æ¥è®¾ç½®å…¨å±€çš„æ ·å¼ï¼›</li>
<li><code>&#123;&#123;&#123;1&#125;&#125;&#125;</code>è¡¨ç¤ºå‚æ•°ï¼Œæ¨¡æ¿1å¼•ç”¨å‚æ•°å¯ä»¥ä½¿ç”¨<code>&#123;&#123;æ¨¡æ¿2|å‚æ•°å=å‚æ•°&#125;&#125;</code>æ¥å¼•å…¥ï¼›</li>
<li>åœ¨__mediawiki__ä¸­[[image/file]]è¡¨ç¤ºé“¾æ¥ğŸ”—</li>
<li><strong><code>&#123;&#123;#while&#125;&#125;</code><strong>å’Œ</strong><code>&#123;&#123;#vardefine&#125;&#125;</code><strong>ç­‰éƒ½æ˜¯</strong>è§£æå™¨å‡½æ•°</strong>ï¼Œ<a href="%5Bhttps://www.huijiwiki.com/wiki/%E5%B8%AE%E5%8A%A9:%E8%A7%A3%E6%9E%90%E5%99%A8%E5%87%BD%E6%95%B0#var.E7.B3.BB.E5.88.97.E5.87.BD.E6.95.B0%5D(https://www.huijiwiki.com/wiki/%E5%B8%AE%E5%8A%A9:%E8%A7%A3%E6%9E%90%E5%99%A8%E5%87%BD%E6%95%B0#var.E7.B3.BB.E5.88.97.E5.87.BD.E6.95.B0)">å‚è€ƒæ–‡æ¡£åœ¨è¿™é‡Œ</a></li>
<li>__vertical-align__å…ƒç´ æ˜¯è®¾ç½®å‚ç›´å¯¹é½å±æ€§çš„ï¼Œæœ‰baseline/top/middle/bottom/text-top/text-bottomç­‰ã€‚</li>
</ol>
<hr>
<h2 id="é‡è£…mediawiki">é‡è£…mediawiki</h2>
<h3 id="å¦‚æœåªæ˜¯æƒ³è¦å‡çº§"><strong>å¦‚æœåªæ˜¯æƒ³è¦å‡çº§</strong></h3>
<p>é‚£ä¹ˆç®€å•ï¼Œæ­¥éª¤å¦‚ä¸‹ğŸ¾</p>
<ol>
<li>è¾“å…¥ç½‘å€ï¼š<code>http://ip:ç«¯å£/é¡¹ç›®/mw-config</code></li>
<li>åœ¨<span class="label warning">LocalSettings.php</span>ä¸­æŸ¥æ‰¾ä¸€ä¸ªwgUpgradeçš„å‚æ•°ï¼Œç„¶åæŠŠå®ƒå¤åˆ¶åå¡«å…¥ç½‘é¡µä¸­ï¼Œå°±å¯ä»¥äº†</li>
</ol>
<h3 id="å¦‚æœæƒ³è¦è¿æ•°æ®åº“ç­‰é‡è¦é…ç½®éƒ½é‡ç½®">å¦‚æœæƒ³è¦è¿æ•°æ®åº“ç­‰é‡è¦é…ç½®éƒ½é‡ç½®</h3>
<p>æŠŠé¡¹ç›®çš„<span class="label warning">LocalSettings.php</span>æ–‡ä»¶ç»™åˆ äº†</p>
<p>è¾“å…¥ç½‘å€ï¼š<code>http://ip:ç«¯å£/é¡¹ç›®/mw-config</code></p>
<p>æ ¹æ®æŒ‡å¼•æ¥é…ç½®é¡¹ç›®ï¼Œé…ç½®æ•°æ®åº“çš„å‰ææ˜¯æå‰é…ç½®å¥½mysqlæ•°æ®åº“</p>
<p>é…ç½®æ•°æ®åº“çš„éœ€æ±‚ï¼š</p>
<ul>
<li>
<p>æ•°æ®åº“çš„åç§°</p>
</li>
<li>
<p>å¯¹åº”æ•°æ®åº“æŒ‡å®šçš„ç”¨æˆ·åå’Œå¯†ç </p>
</li>
</ul>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>éªŒè¯æ–‡ä»¶çš„å®Œæ•´æ€§</title>
    <url>/2020/09/19/%E9%AA%8C%E8%AF%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%AE%8C%E6%95%B4%E6%80%A7/</url>
    <content><![CDATA[<h2 id="å‰è¨€"># å‰è¨€</h2>
<p>éªŒè¯æ–‡ä»¶å®Œæ•´æ€§çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œåœ¨è¿™é‡Œæˆ‘åˆ—ä¸¾æˆ‘é‡åˆ°çš„å‡ ç§æˆ‘ç»å¸¸é‡åˆ°çš„éªŒè¯æ–¹æ³•ï¼ğŸ‘Šï¼Œæœ‰sha1ï¼Œsha256ï¼Œsha512å’ŒMD5,PGPç­‰ğŸ’…</p>
<a id="more"></a>
<h2 id="sha1éªŒè¯">sha1éªŒè¯</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sha1sum file</span><br></pre></td></tr></table></figure>
<h2 id="sha256-éªŒè¯">sha256 éªŒè¯</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">shasum -a 256 -c x.x.x.sha256(ä¸‹è½½çš„éªŒè¯æ–‡ä»¶) </span><br></pre></td></tr></table></figure>
<p>æˆ–</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">openssl sha256 -r x.x.x.x(ä¸‹è½½çš„æ–‡ä»¶)</span><br></pre></td></tr></table></figure>
<h2 id="sha512éªŒè¯">sha512éªŒè¯</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sha512sum file</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="MD5éªŒè¯">MD5éªŒè¯</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ md5sum file</span><br><span class="line">a612cd5d162e4620b442b0ff3474bf98  file</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="PGPéªŒè¯">PGPéªŒè¯</h2>
<blockquote>
<p>é¦–å…ˆå¾—å…ˆä¸‹è½½x.x.x.x(æ‰€è¦ä¸‹è½½çš„æ–‡ä»¶)å’Œx.x.x.x.asc(ä¸‹è½½å¾—éªŒè¯æ–‡ä»¶)</p>
</blockquote>
<h3 id="ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨GPG-The-GNU-Privacy-Guard-æ¥éªŒè¯ã€‚">ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨GPG(The GNU Privacy Guard)æ¥éªŒè¯ã€‚</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">% gpg --verify httpd-2.4.18.tar.gz.asc httpd-2.4.18.tar.gz</span><br><span class="line">gpg: Signature made Tue Dec  8 21:32:07 2015 CET using RSA key ID 791485A8</span><br><span class="line">gpg: Can<span class="string">&#x27;t check signature: public key not found</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸Šé¢çš„æƒ…å†µæ˜¯æ²¡æœ‰ç‰ˆæœ¬çš„ç®¡ç†è€…å…¬ç”¨é’¥åŒ™791485A8</p>
<p>ä¸€èˆ¬è¦å»key serverè·å–ï¼Œæ¯”å¦‚æœ€å—æ¬¢è¿çš„<code>pgpkeys.mit.edu</code></p>
</blockquote>
<h3 id="ç¬¬äºŒæ­¥ï¼šè·å–å…¬å…±é’¥åŒ™">ç¬¬äºŒæ­¥ï¼šè·å–å…¬å…±é’¥åŒ™</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">% gpg --keyserver pgpkeys.mit.edu --recv-key 791485A8</span><br><span class="line">gpg: requesting key 791485A8 from HKP keyserver pgpkeys.mit.edu</span><br><span class="line">gpg: trustdb created</span><br><span class="line">gpg: key 791485A8: public key <span class="string">&quot;Jim Jagielski &lt;jim@apache.org&gt;&quot;</span> imported</span><br><span class="line">gpg: key 791485A8: public key <span class="string">&quot;Jim Jagielski &lt;jim@apache.org&gt;&quot;</span> imported</span><br><span class="line">gpg: Total number processed: 2</span><br><span class="line">gpg:               imported: 2  (RSA: 2)</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬é€šè¿‡è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥è·å–åˆ°å…¬å…±é’¥åŒ™äº†ï¼Œä½†æ˜¯ä¸Šé¢è·å–çš„é’¥åŒ™å´æœ‰ä¸¤ä¸ªğŸ˜¦</p>
<blockquote>
<p>ä¸ç®¡æ€æ ·ï¼Œå†æ¥è®¤è¯ä¸€æ¬¡</p>
</blockquote>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šå†æ¬¡éªŒè¯">ç¬¬ä¸‰æ­¥ï¼šå†æ¬¡éªŒè¯</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">% gpg --verify httpd-2.4.18.tar.gz.asc httpd-2.4.18.tar.gz</span><br><span class="line">gpg: Signature made Tue Dec  8 21:32:07 2015 CET using RSA key ID 791485A8</span><br><span class="line">gpg: Good signature from <span class="string">&quot;Jim Jagielski &lt;jim@apache.org&gt;&quot;</span></span><br><span class="line">gpg:             aka <span class="string">&quot;Jim Jagielski &lt;jim@jimjag.com&gt;&quot;</span></span><br><span class="line">gpg:             aka <span class="string">&quot;Jim Jagielski &lt;jim@jaguNET.com&gt;&quot;</span></span><br><span class="line">gpg:             aka <span class="string">&quot;Jim Jagielski &lt;jimjag@gmail.com&gt;&quot;</span></span><br><span class="line">gpg: checking the trustdb</span><br><span class="line">gpg: no ultimately trusted keys found</span><br><span class="line">gpg: WARNING: This key is not certified with a trusted signature!</span><br><span class="line">gpg:          There is no indication that the signature belongs to the</span><br><span class="line">owner.</span><br><span class="line">Fingerprint: A93D 62EC C3C8 EA12 DB22  0EC9 34EA 76E6 7914 85A8</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°éªŒè¯æˆåŠŸäº†ï¼Œä½†æ˜¯ä»–çš„çœŸå®æ€§æœ‰å¾…å•†æ¦·ï¼Œä»ä¸­è¿˜è·å–åˆ°ä»–çš„<span class="label warning">æŒ‡çº¹</span>äº†</p>
<h3 id="ç¬¬å››æ­¥ï¼šéªŒè¯çœŸå®æ€§">ç¬¬å››æ­¥ï¼šéªŒè¯çœŸå®æ€§</h3>
<blockquote>
<p>è¿™ä¸€æ­¥çš„å†…å®¹ç¨å¤šï¼Œæ–¹æ³•ä¹Ÿæœ‰å¾ˆå¤šç§</p>
</blockquote>
<p>æ–¹æ³•ä¸€ï¼šåˆ°<span class="ljspan ljspan-yellow">PGPä¿¡ä»»çš„ç½‘ç«™</span>éªŒè¯<span class="label warning">æŒ‡çº¹</span>äº†ï¼Œæ¯”å¦‚æˆ‘ä¸‹è½½apacheï¼Œä»–æœ‰æä¾›ä¸€ä¸ª<a href="https://people.apache.org/keys/committer/">ç½‘ç«™</a>ç»™ä½ æ¯”å¯¹æŒ‡çº¹ã€‚é¢˜å¤–è¯ï¼Œå…¶å®è¿™ä¸ªç½‘ç«™ä¹Ÿæ˜¯ä¸å¤§å—ä¿¡ä»»çš„ï¼Œæ¯•ç«Ÿä¸æ˜¯PGPæä¾›çš„ï¼Œapacheå®˜æ–¹ç»™å‡ºçš„è¯´æ³•ä¹Ÿæ˜¯è¯´è¦ç•™æ„ä»–ä»¬çš„æ–°é—»ï¼Œä¸‡ä¸€ä»–ä»¬è‡ªå·±çš„ç½‘ç«™ç»™é»‘å®¢æäº†ï¼Œä»–ä»¬å°±ä¸èƒ½ä¿è¯æä¾›æŒ‡çº¹æ¯”å¯¹çš„çœŸå®æ€§äº†ï¼Œå®‰å…¨çœŸçš„å¥½é‡è¦å•ŠğŸ¢ğŸ¢ã€‚</p>
<p>æ–¹æ³•äºŒï¼šé€šè¿‡gpgç­¾ååˆ—è¡¨ä¸­çš„ç”¨æˆ·æ¥ç¡®è®¤</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">% gpg --list-sigs </span><br><span class="line">pub   4096R/791485A8 2010-11-04</span><br><span class="line">uid                  Jim Jagielski (Release Signing Key) &lt;jim@apache.org&gt;</span><br><span class="line">sig          88C3A5A5 2010-11-07  Philippe M. Chiasson (Home) &lt;gozer@ectoplasm.org&gt;</span><br><span class="line">sig          4E24517C 2011-11-10  Hyrum K. Wright (Personal) &lt;hyrum@hyrumwright.org&gt;</span><br><span class="line">sig          C4FC9A65 2011-11-10  Bernd Bohmann &lt;bommel@apache.org&gt;</span><br><span class="line">sig          1F27E622 2015-04-16  Konstantin I Boudnik (Cos) &lt;cos@boudnik.org&gt;</span><br><span class="line">sig          08C975E5 2010-11-04  Jim Jagielski &lt;jim@apache.org&gt;</span><br><span class="line">sig 2        F2EFD0F0 2011-11-14  Christopher David Schultz (Christopher David Schultz) &lt;chris@christopherschultz.net&gt;</span><br><span class="line">sig 3        311A3DE5 2010-11-10  Ruediger Pluem &lt;rpluem@apache.org&gt;</span><br><span class="line">sig          64A6A0BA 2013-02-27  Steven J. Hathaway (Apache PGP) &lt;shathaway@apache.org&gt;</span><br><span class="line">sig          00A1234F 2015-04-15  Andre Arcilla &lt;arcilla@apache.org&gt;</span><br><span class="line">sig          9A59B973 2015-04-21  Stefan Sperling &lt;stsp@stsp.name&gt;</span><br><span class="line">sig          F51BB88A 2010-11-04  Sander Temme &lt;sander@temme.net&gt;</span><br><span class="line">...more signatures redacted...</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ çš„éªŒè¯çš„æ–‡ä»¶ä¸­çš„ç”¨æˆ·åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œé‚£ä¸€èˆ¬å°±èƒ½è¯æ˜ä»–ç¡®å®æ˜¯çœŸå®çš„å•¦ï¼Œå¦‚æœè¦ä¿è¯å®ƒæ˜¯å¦æ˜¯çœŸçš„ï¼Œä½ å¯ä»¥ç›´æ¥é€šè¿‡é‚®ç®±è”ç³»ç”¨æˆ·ï¼Œè®©ä»–ç¡®è¯åˆ°åº•æ˜¯ä¸æ˜¯çœŸçš„å’¯</p>
<blockquote>
<p>å…¶å®æœ€å®‰å…¨çš„åŠæ³•å½“ç„¶æ˜¯è”ç³»ä½œè€…æœ¬äººå•¦ï¼Œä½†æ˜¯ä½œè€…ä¸€èˆ¬å“ªæœ‰æ—¶é—´å›å¤ä½ å•Šï¼Œsoâ€¦I have no idea!</p>
</blockquote>
<h2 id="éªŒè¯æˆåŠŸ">éªŒè¯æˆåŠŸ</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">% gpg --verify httpd-2.4.18.tar.gz.asc httpd-2.4.18.tar.gz</span><br><span class="line">gpg: Signature made Tue Dec  8 21:32:07 2015 CET using RSA key ID 791485A8</span><br><span class="line">gpg: Good signature from <span class="string">&quot;Jim Jagielski (Release Signing Key) &lt;jim@apache.org&gt;&quot;</span></span><br><span class="line">gpg:                 aka <span class="string">&quot;Jim Jagielski &lt;jim@jimjag.com&gt;&quot;</span></span><br><span class="line">gpg:                 aka <span class="string">&quot;Jim Jagielski &lt;jim@jaguNET.com&gt;&quot;</span></span><br><span class="line">gpg:                 aka <span class="string">&quot;Jim Jagielski &lt;jimjag@gmail.com&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæ²¡æœ‰å±é™©æç¤ºï¼Œé‚£å°±è¡¨æ˜æˆåŠŸå•¦ï¼</p>
</blockquote>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>è¿œç¨‹ç™»å½•æœåŠ¡å™¨</title>
    <url>/2020/09/09/%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>æƒ³ä½¿ç”¨xshellè½¯ä»¶è¿œç¨‹ç™»å½•æœåŠ¡å™¨ï¼Œä¸€èˆ¬ä½¿ç”¨sshæ¥è¿æ¥ï¼Œæ‰€ä»¥éœ€è¦ä¸‹è½½sshå“¦ğŸ˜’</p>
<a id="more"></a>
<h2 id="å®‰è£…SSH">å®‰è£…SSH</h2>
<p>é¦–å…ˆå¿…é¡»ä¸‹è½½sshæœåŠ¡å™¨ç«¯,</p>
<p>æˆ‘çš„ç³»ç»Ÿæ˜¯ubuntu18.04,æ‰€ä»¥é‡‡ç”¨apt-getä¸‹è½½å®‰è£…</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹æœåŠ¡å™¨æ—¶å€™æœ‰opensshè½¯ä»¶åŒ…</span></span><br><span class="line">sudo dpkg list |grep openssh</span><br><span class="line"><span class="comment">#ä¸‹è½½å®‰è£…openssh-serverè½¯ä»¶åŒ…</span></span><br><span class="line">sudo apt-get install openssh-server</span><br></pre></td></tr></table></figure>
<h2 id="é…ç½®SSH">é…ç½®SSH</h2>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¿®æ”¹åˆ°é…ç½®æ–‡ä»¶</span></span><br><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment">#xshellè½¬å‘å¼€å¯</span></span><br><span class="line">X11Forwarding yes</span><br><span class="line"><span class="comment">#å¼€å¯ç”¨æˆ·å¯†ç è®¤è¯</span></span><br><span class="line">PasswordAuthentication yes</span><br><span class="line"><span class="comment">#å¼€å¯ç”¨æˆ·è¿œç¨‹ç™»å½•,usernameä¸ºä½ çš„ç”¨æˆ·å</span></span><br><span class="line">AllowUsers username</span><br><span class="line"><span class="comment">#è®¾ç½®æ–­å¼€è¿æ¥æ—¶é—´ï¼ŒäºŒè€…ç›¸ä¹˜ä¸ºå®¢æˆ·ç«¯æ²¡æœ‰å“åº”åæ–­å¼€è¿æ¥çš„å…·ä½“æ—¶é—´</span></span><br><span class="line"><span class="comment">#æ¯ç§’é’Ÿå‘é€ä¸€èµ·è¯·æ±‚ç»™å®¢æˆ·ç«¯ï¼ˆå•ä½ä¸ºç§’ï¼‰</span></span><br><span class="line">ClientAliveInterval 60</span><br><span class="line"><span class="comment">#å®¢æˆ·ç«¯æ²¡æœ‰å“åº”çš„æœ€å¤§æ•°</span></span><br><span class="line">ClientAliveCountMax 120</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="åˆ°åº•æœ‰æ²¡æœ‰SSHâ”">#åˆ°åº•æœ‰æ²¡æœ‰SSHâ”</h3>
<p>æ–°è£…çš„ç³»ç»Ÿï¼Œåœ¨<code>/etc/init.d/</code>è·¯å¾„ä¸‹ï¼Œæ²¡æœ‰æ‰¾åˆ°sshæ–‡ä»¶</p>
<p>ä½†æ˜¯,ç³»ç»Ÿé‡Œé¢æœ‰sshå•Šï¼Œâ€‹çœ‹ğŸ‘‡</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">$ whereis ssh</span><br><span class="line">ssh: /usr/bin/ssh /etc/ssh  /ssh/share/man/man1/ssh1.gz</span><br></pre></td></tr></table></figure>
<p>å¯æ˜¯å‘¢</p>
<p><code>service ssh start</code> å’Œ <code>systemctl start ssh.service </code>éƒ½è¡Œä¸é€š</p>
<p>ğŸ˜µé‚£åˆ°åº•æ—¶æ€ä¹ˆä¸€å›äº‹ï¼Ÿï¼Ÿï¼Ÿ</p>
<p>åŸæ¥åŸè£…çš„ç³»ç»Ÿé‡Œé¢æœ‰openssh-clientï¼Œè€Œæ²¡æœ‰openssh-server,æ‰€ä»¥å°±å¤–ç½‘å°±æ— æ³•é€šè¿‡sshè¿æ¥ä¸Šè¿™ä¸ªæœåŠ¡å™¨å•¦ï¼</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>å¾®ä¿¡å…¬ä¼—å·å¼€å‘çŸ¥è¯†ç‚¹</title>
    <url>/2020/09/11/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86%E7%82%B9/</url>
    <content><![CDATA[<h2 id="å¾®ä¿¡æµè§ˆå™¨çš„é™åˆ¶">å¾®ä¿¡æµè§ˆå™¨çš„é™åˆ¶</h2>
<h3 id="ä¸å…·å¤‡ä¸‹è½½åŠŸèƒ½ğŸ’©">ä¸å…·å¤‡ä¸‹è½½åŠŸèƒ½ğŸ’©</h3>
<p>æƒ³è¦åœ¨å¾®ä¿¡å…¬ä¼—å·çš„ç½‘é¡µé‡Œé¢è®¾ç½®é“¾æ¥ğŸ”—ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œä½†æ˜¯å¾®ä¿¡å…¬ä¼—å·ä¸å…·å¤‡ä¸‹è½½åŠŸèƒ½ï¼Œæ‰€ä»¥å°±æ— æ³•å®ç°ä¸‹è½½ï¼›å°±ç®—è®¾ç½®äº†â€œä½¿ç”¨æ‰‹æœºğŸ“±æµè§ˆå™¨æ‰“å¼€â€ï¼Œä¹Ÿæ— æ³•â€œä¸€æ­¥åˆ°ä½â€å®ç°ä¸‹è½½ï¼Œ<a id="more"></a>å› ä¸ºæˆ‘ä¸‹è½½çš„ä¸œè¥¿æ˜¯æ ¹æ®ç”¨æˆ·ä¿¡æ¯å¯¹åº”æ¥ä¸‹è½½çš„ï¼Œ è€Œä¸”è·³è½¬åˆ°å…¶ä»–æµè§ˆå™¨ï¼Œä¼šå¯¼è‡´<code>session</code>å’Œ<code>cookie</code>éƒ½å¤±æ•ˆäº†ğŸ’…ï¼Œè¿™å°±è®©ä¸ªäººä¿¡æ¯è®¤è¯æ— æ³•å®ç°ï¼Œå¯¼è‡´æ— æ³•å®ç°ä¸‹è½½ã€‚</p>
<h3 id="æ— æ³•é€šè¿‡Buttonæäº¤è¡¨å•ğŸ’¨">æ— æ³•é€šè¿‡Buttonæäº¤è¡¨å•ğŸ’¨</h3>
<p>å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå®åœ¨æ˜¯å¤ªæ¶å¿ƒäº†ğŸ˜¡ï¼Œ<code>button</code>çš„<code>submit</code>åŠŸèƒ½è¡Œä¸é€šï¼Œæ— æ³•æäº¤è¡¨å•æ•°æ®ã€‚æˆ‘åªèƒ½é‡‡ç”¨<code>Javascriptçš„Ajaxæ–¹æ³•</code>ï¼Œé€šè¿‡<code>onclick</code>æ¥æäº¤è¡¨å•æ•°æ®</p>
<h3 id="åªé™äºå¾®ä¿¡æµè§ˆå™¨ğŸ—¯">åªé™äºå¾®ä¿¡æµè§ˆå™¨ğŸ—¯</h3>
<p>åœ¨<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html">å¾®ä¿¡å…¬ä¼—å·å¼€å‘æ–‡æ¡£</a>é‡Œé¢,<span class="label warning">ç¬¬ä¸€æ­¥ï¼šç”¨æˆ·åŒæ„æˆæƒï¼Œè·å–code</span>è¿™é‡Œå¯ä»¥äº†è§£åˆ°è·å–codeçš„æ–¹æ³•</p>
<p>ä½†æ˜¯è·³è½¬è¿™é‡Œä¼šè®¤è¯ä½ çš„è®¾å¤‡ï¼Œå¦‚æœä¸æ˜¯å¾®ä¿¡æµè§ˆå™¨ï¼Œé‚£å°±ä¼šæç¤º<span class="label success">è¯·åœ¨å¾®ä¿¡å®¢æˆ·ç«¯æ‰“å¼€é“¾æ¥</span>ã€‚ä¹Ÿå°±æ˜¯æ— æ³•æ‰“å¼€ä½ æ‰€æƒ³è¦æ‰“å¼€çš„é¡µé¢</p>
]]></content>
      <categories>
        <category>Development</category>
      </categories>
      <tags>
        <tag>å¾®ä¿¡å…¬ä¼—å·</tag>
      </tags>
  </entry>
  <entry>
    <title>Redis And Jedis</title>
    <url>/2020/09/04/Redis-And-Jedis/</url>
    <content><![CDATA[<h2 id="å‰è¨€">#å‰è¨€</h2>
<p>æƒ³é€šè¿‡ç¼“å­˜æ¥ä¿å­˜å¾®ä¿¡å…¬ä¼—å·çš„<code>accesstoken</code>å’Œ<code>refreshtoken</code>ï¼Œè‡ªå·±å†™ä¹Ÿå¯ä»¥ï¼Œå°±æ˜¯åœ¨ä¿å­˜åœ¨æŸä¸ªç±»ä¸­ï¼Œæ¯æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œè°ƒç”¨è¿™ä¸ªç±»å°±å¯ä»¥å®ç°å­˜å‚¨ï¼Œé’ˆå¯¹<code>accesstoken</code>ç”Ÿæˆä¸€ä¸ªï¼Œå¯ç”¨äºæ‰€æœ‰ç”¨æˆ·å’Œå„ä¸ªæ¥å£çš„è°ƒç”¨çš„ï¼Œè¿˜æ¯”è¾ƒå®¹æ˜“ï¼Œä½†æ˜¯<code>refreshtoken</code>éœ€è¦åŒ¹é…æ¯ä¸ªç”¨æˆ·ï¼Œæ€ä¹ˆé’ˆå¯¹ç”¨æˆ·idæ¥å­˜å‚¨ï¼Œå°±æ˜¯ä¸€ä¸ªéš¾é¢˜äº†ï¼Œè™½ç„¶æˆ‘ä¹‹å‰ä½¿ç”¨<code>list</code>ä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯è¯´å®è¯ï¼Œæœ‰ç‚¹åœŸï¼ğŸ˜’</p>
<a id="more"></a>
<h2 id="Redis">Redis</h2>
<h3 id="å‘½ä»¤">å‘½ä»¤</h3>
<p>è·å–ç¼“å­˜ï¼šget (key)</p>
<p>è®¾ç½®ç¼“å­˜ï¼šset (key) (value)</p>
<p>è·å–hashç¼“å­˜ï¼šhget (key) (field)</p>
<p>åˆ é™¤æ‰€æœ‰ç¼“å­˜ï¼šflushdb</p>
<hr>
<h2 id="Java-Operation-Objectâ€“jedis">Java Operation Objectâ€“jedis</h2>
<h3 id="é…ç½®">é…ç½®</h3>
<blockquote>
<p>æ³¨æ„ç‰ˆæœ¬spring-data-redisç‰ˆæœ¬ï¼</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">#åœ¨pom.xmlä¸Šå¼•å…¥ä¾èµ–ï¼Œæˆ‘æ˜¯ä½¿ç”¨ssmæ¡†æ¶æ¥æ­å»ºçš„</span><br><span class="line"><span class="comment">&lt;!-- é…ç½®redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨springå®¹å™¨ä¸­é…ç½®ä¸¤ä¸ªå…³é”®çš„ç±»<code>JedisConnectionFactory</code>å’Œ<code>RedisTemplate/StringRedisTemplate</code>ã€‚</p>
<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥åˆ©ç”¨<code>RedisTemplate</code>å¯¹è±¡æ¥æ“ä½œäº†ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘æ¨èä½¿ç”¨<code>StringRedisTemplate</code>,æ“ä½œæ›´åŠ æ–¹ä¾¿ï¼ğŸ˜†</p>
<hr>
<h3 id="æ“ä½œ">æ“ä½œ</h3>
<h4 id="RedisTemplateæ³¨è§£-æ“ä½œå¯¹è±¡">RedisTemplateæ³¨è§£ æ“ä½œå¯¹è±¡</h4>
<p>å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œç±»ä¼¼äºä½¿ç”¨<code>RedisTemplate</code>è°ƒç”¨<code>OpsForXxx</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Redis geospatial operations, such as GEOADD, GEORADIUS</span></span><br><span class="line">GeoOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis hash operations</span></span><br><span class="line">HashOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis HyperLogLog operations, such as PFADD, PFCOUNT</span></span><br><span class="line">HyperLogLogOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis list operations</span></span><br><span class="line">ListOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis set operations</span></span><br><span class="line">SetOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis string (or value) operations</span></span><br><span class="line">ValueOperations</span><br><span class="line"></span><br><span class="line"><span class="comment">//Redis zset (or sorted set) operations</span></span><br><span class="line">ZSetOperations</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="ç‰¹æ®Šçš„æ–¹æ³•">ç‰¹æ®Šçš„æ–¹æ³•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é€šè¿‡opsForValue()ä¹Ÿå¯æ‰§è¡ŒredisTemplateçš„æ–¹æ³•ã€‚</span></span><br><span class="line">redisTemplate.opsForValue().getOperations().getExpire(<span class="string">&quot;keyçš„åç§°&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="StringRedisTemplateæ“ä½œé›†é”¦">StringRedisTemplateæ“ä½œé›†é”¦</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">*<span class="comment">//å‘redisé‡Œå­˜å…¥æ•°æ®å’Œè®¾ç½®ç¼“å­˜æ—¶é—´*  </span></span><br><span class="line">stringRedisTemplate.opsForValue().set(<span class="string">&quot;baike&quot;</span>, <span class="string">&quot;100&quot;</span>, <span class="number">60</span> * <span class="number">10</span>, TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//valåš-1æ“ä½œ*  </span></span><br><span class="line">stringRedisTemplate.boundValueOps(<span class="string">&quot;baike&quot;</span>).increment(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//æ ¹æ®keyè·å–ç¼“å­˜ä¸­çš„val*  </span></span><br><span class="line">stringRedisTemplate.opsForValue().get(<span class="string">&quot;baike&quot;</span>)</span><br><span class="line"></span><br><span class="line">*<span class="comment">//val +1*  </span></span><br><span class="line">stringRedisTemplate.boundValueOps(<span class="string">&quot;baike&quot;</span>).increment(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//æ ¹æ®keyè·å–è¿‡æœŸæ—¶é—´*  </span></span><br><span class="line">stringRedisTemplate.getExpire(<span class="string">&quot;baike&quot;</span>);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//æ ¹æ®keyè·å–è¿‡æœŸæ—¶é—´å¹¶æ¢ç®—æˆæŒ‡å®šå•ä½*  </span></span><br><span class="line">stringRedisTemplate.getExpire(<span class="string">&quot;baike&quot;</span>,TimeUnit.SECONDS);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//æ ¹æ®keyåˆ é™¤ç¼“å­˜*  </span></span><br><span class="line">stringRedisTemplate.delete(<span class="string">&quot;baike&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨ï¼Œè¿”å›booleanå€¼*  </span></span><br><span class="line">stringRedisTemplate.hasKey(<span class="string">&quot;baike&quot;</span>);</span><br><span class="line"></span><br><span class="line">*<span class="comment">//å‘æŒ‡å®škeyä¸­å­˜æ”¾seté›†åˆ*  </span></span><br><span class="line">stringRedisTemplate.opsForSet().add(<span class="string">&quot;baike&quot;</span>, <span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®è¿‡æœŸæ—¶é—´*  </span></span><br><span class="line">stringRedisTemplate.expire(<span class="string">&quot;baike&quot;</span>,<span class="number">1000</span> , TimeUnit.MILLISECONDS);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®keyæŸ¥çœ‹é›†åˆä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šæ•°æ®*  </span></span><br><span class="line">stringRedisTemplate.opsForSet().isMember(<span class="string">&quot;baike&quot;</span>, <span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ ¹æ®keyè·å–seté›†åˆ*  </span></span><br><span class="line">stringRedisTemplate.opsForSet().members(<span class="string">&quot;baike&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//éªŒè¯æœ‰æ•ˆæ—¶é—´*</span></span><br><span class="line">Long expire = redisTemplate.boundHashOps(<span class="string">&quot;baike&quot;</span>).getExpire();</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨åº•å±‚å‘½ä»¤</span></span><br><span class="line">StringRedisTemplate.execute((RedisCallback&lt;Void&gt;) con -&gt; &#123; con.hSet(<span class="string">&quot;age&quot;</span>.getBytes(),<span class="string">&quot;23&quot;</span>.getBytes());</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;    &#125;)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="RedisTemplateå¸¸ç”¨é›†åˆä½¿ç”¨è¯´æ˜-opsForHash">RedisTemplateå¸¸ç”¨é›†åˆä½¿ç”¨è¯´æ˜-opsForHash</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>ã€put(H key, HK hashKey, HV value) </span><br><span class="line">    <span class="comment">//æ–°å¢hashMapå€¼ </span></span><br><span class="line">    redisTemplate.opsForHash().put(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map1&quot;</span>,<span class="string">&quot;map1-1&quot;</span>);   		</span><br><span class="line">	redisTemplate.opsForHash().put(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map2&quot;</span>,<span class="string">&quot;map2-2&quot;</span>);    </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>ã€values(H key) </span><br><span class="line">    <span class="comment">//è·å–æŒ‡å®šå˜é‡ä¸­çš„hashMapå€¼ã€‚</span></span><br><span class="line">    List&lt;Object&gt; hashList = redisTemplate.opsForHash().values(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡values(H key)æ–¹æ³•è·å–å˜é‡ä¸­çš„hashMapå€¼:&quot;</span> + hashList);   </span><br><span class="line"></span><br><span class="line"><span class="number">3</span>ã€entries(H key) </span><br><span class="line">    <span class="comment">//è·å–å˜é‡ä¸­çš„é”®å€¼å¯¹ã€‚ </span></span><br><span class="line">	Map&lt;Object,Object&gt; map = redisTemplate.opsForHash().entries(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡entries(H key)æ–¹æ³•è·å–å˜é‡ä¸­çš„é”®å€¼å¯¹:&quot;</span> + map);  </span><br><span class="line"></span><br><span class="line"><span class="number">4</span>ã€get(H key, Object hashKey) </span><br><span class="line">   <span class="comment">// è·å–å˜é‡ä¸­çš„æŒ‡å®šmapé”®æ˜¯å¦æœ‰å€¼,å¦‚æœå­˜åœ¨è¯¥mapé”®åˆ™è·å–å€¼ï¼Œæ²¡æœ‰åˆ™è¿”å›nullã€‚ </span></span><br><span class="line">	Object mapValue = redisTemplate.opsForHash().get(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map1&quot;</span>);   	</span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡get(H key, Object hashKey)æ–¹æ³•è·å–mapé”®çš„å€¼:&quot;</span> + mapValue); </span><br><span class="line"></span><br><span class="line"><span class="number">5</span>ã€<span class="comment">//hasKey(H key, Object hashKey) </span></span><br><span class="line">    åˆ¤æ–­å˜é‡ä¸­æ˜¯å¦æœ‰æŒ‡å®šçš„mapé”®ã€‚ </span><br><span class="line">    <span class="keyword">boolean</span> hashKeyBoolean = redisTemplate.opsForHash().hasKey(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map3&quot;</span>); </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡hasKey(H key, Object hashKey)æ–¹æ³•åˆ¤æ–­å˜é‡ä¸­æ˜¯å¦å­˜åœ¨mapé”®:&quot;</span> + hashKeyBoolean);     </span><br><span class="line"></span><br><span class="line"><span class="number">6</span>ã€keys(H key) </span><br><span class="line">   <span class="comment">// è·å–å˜é‡ä¸­çš„é”®ã€‚ </span></span><br><span class="line">	Set&lt;Object&gt; keySet = redisTemplate.opsForHash().keys(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡keys(H key)æ–¹æ³•è·å–å˜é‡ä¸­çš„é”®:&quot;</span> + keySet);    </span><br><span class="line"></span><br><span class="line"><span class="number">7</span>ã€size(H key) </span><br><span class="line">   <span class="comment">// è·å–å˜é‡çš„é•¿åº¦ã€‚ </span></span><br><span class="line">    <span class="keyword">long</span> hashLength = redisTemplate.opsForHash().size(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡size(H key)æ–¹æ³•è·å–å˜é‡çš„é•¿åº¦:&quot;</span> + hashLength);    </span><br><span class="line"></span><br><span class="line"><span class="number">8</span>ã€increment(H key, HK hashKey, <span class="keyword">double</span> delta)  </span><br><span class="line">   <span class="comment">// ä½¿å˜é‡ä¸­çš„é”®ä»¥doubleå€¼çš„å¤§å°è¿›è¡Œè‡ªå¢é•¿ã€‚</span></span><br><span class="line">    <span class="keyword">double</span> hashIncDouble = 						redisTemplate.opsForHash().increment(<span class="string">&quot;hashInc&quot;</span>,<span class="string">&quot;map1&quot;</span>,<span class="number">3</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡increment(H key, HK hashKey, double delta)æ–¹æ³•ä½¿å˜é‡ä¸­çš„é”®ä»¥å€¼çš„å¤§å°è¿›è¡Œè‡ªå¢é•¿:&quot;</span> + hashIncDouble);    </span><br><span class="line"></span><br><span class="line"><span class="number">9</span>ã€increment(H key, HK hashKey, <span class="keyword">long</span> delta) </span><br><span class="line">    <span class="comment">//ä½¿å˜é‡ä¸­çš„é”®ä»¥longå€¼çš„å¤§å°è¿›è¡Œè‡ªå¢é•¿ã€‚ </span></span><br><span class="line">    <span class="keyword">long</span> hashIncLong = redisTemplate.opsForHash().increment(<span class="string">&quot;hashInc&quot;</span>,<span class="string">&quot;map2&quot;</span>,<span class="number">6</span>);   	</span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡increment(H key, HK hashKey, long delta)æ–¹æ³•ä½¿å˜é‡ä¸­çš„é”®ä»¥å€¼çš„å¤§å°è¿›è¡Œè‡ªå¢é•¿:&quot;</span> + hashIncLong);    </span><br><span class="line"></span><br><span class="line"><span class="number">10</span>ã€multiGet(H key, Collection&lt;HK&gt; hashKeys) </span><br><span class="line">    <span class="comment">//ä»¥é›†åˆçš„æ–¹å¼è·å–å˜é‡ä¸­çš„å€¼ã€‚ </span></span><br><span class="line">    List&lt;Object&gt; list = <span class="keyword">new</span> ArrayList&lt;Object&gt;();   </span><br><span class="line">	list.add(<span class="string">&quot;map1&quot;</span>);   </span><br><span class="line">	list.add(<span class="string">&quot;map2&quot;</span>);   </span><br><span class="line">	List mapValueList = redisTemplate.opsForHash().multiGet(<span class="string">&quot;hashValue&quot;</span>,list);  </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡multiGet(H key, Collection&lt;HK&gt; hashKeys)æ–¹æ³•ä»¥é›†åˆçš„æ–¹å¼è·å–å˜é‡ä¸­çš„å€¼:&quot;</span>+mapValueList);    </span><br><span class="line"></span><br><span class="line"><span class="number">11</span>ã€putAll(H key, Map&lt;? extends HK,? extends HV&gt; m)  </span><br><span class="line">    <span class="comment">//ä»¥mapé›†åˆçš„å½¢å¼æ·»åŠ é”®å€¼å¯¹ã€‚ </span></span><br><span class="line">    Map newMap = <span class="keyword">new</span> HashMap();   </span><br><span class="line">	newMap.put(<span class="string">&quot;map3&quot;</span>,<span class="string">&quot;map3-3&quot;</span>);   </span><br><span class="line">	newMap.put(<span class="string">&quot;map5&quot;</span>,<span class="string">&quot;map5-5&quot;</span>);   	</span><br><span class="line">	redisTemplate.opsForHash().putAll(<span class="string">&quot;hashValue&quot;</span>,newMap);   </span><br><span class="line">	map = redisTemplate.opsForHash().entries(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡putAll(H key, Map&lt;? extends HK,? extends HV&gt; m)æ–¹æ³•ä»¥mapé›†åˆçš„å½¢å¼æ·»åŠ é”®å€¼å¯¹:&quot;</span> + map);    </span><br><span class="line"></span><br><span class="line"><span class="number">12</span>ã€putIfAbsent(H key, HK hashKey, HV value) </span><br><span class="line">    <span class="comment">//å¦‚æœå˜é‡å€¼å­˜åœ¨ï¼Œåœ¨å˜é‡ä¸­å¯ä»¥æ·»åŠ ä¸å­˜åœ¨çš„çš„é”®å€¼å¯¹ï¼Œå¦‚æœå˜é‡ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ä¸€ä¸ªå˜é‡ï¼ŒåŒæ—¶å°†é”®å€¼å¯¹æ·»åŠ åˆ°è¯¥å˜é‡ã€‚ </span></span><br><span class="line">    redisTemplate.opsForHash().putIfAbsent(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map6&quot;</span>,<span class="string">&quot;map6-6&quot;</span>);   </span><br><span class="line">	map = redisTemplate.opsForHash().entries(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡putIfAbsent(H key, HK hashKey, HV value)æ–¹æ³•æ·»åŠ ä¸å­˜åœ¨äºå˜é‡ä¸­çš„é”®å€¼å¯¹:&quot;</span> + map);    </span><br><span class="line"></span><br><span class="line"><span class="number">13</span>ã€scan(H key, ScanOptions options) </span><br><span class="line">	<span class="comment">//åŒ¹é…è·å–é”®å€¼å¯¹ï¼ŒScanOptions.NONEä¸ºè·å–å…¨éƒ¨é”®å¯¹</span></span><br><span class="line">    ScanOptions.scanOptions().match(<span class="string">&quot;map1&quot;</span>).build()     </span><br><span class="line">    <span class="comment">//åŒ¹é…è·å–é”®ä½map1çš„é”®å€¼å¯¹,ä¸èƒ½æ¨¡ç³ŠåŒ¹é…ã€‚ </span></span><br><span class="line">    Cursor&lt;Map.Entry&lt;Object,Object&gt;&gt; cursor = redisTemplate.opsForHash().scan(<span class="string">&quot;hashValue&quot;</span>,ScanOptions.scanOptions().match(<span class="string">&quot;map1&quot;</span>).build());  </span><br><span class="line">*<span class="comment">//Cursor&gt; cursor = redisTemplate.opsForHash().scan(&quot;hashValue&quot;,ScanOptions.NONE);*   </span></span><br><span class="line"><span class="keyword">while</span> (cursor.hasNext())&#123;    </span><br><span class="line">    Map.Entry&lt;Object,Object&gt; entry = cursor.next();    </span><br><span class="line">    System.out.println(<span class="string">&quot;é€šè¿‡scan(H key, ScanOptions options)æ–¹æ³•è·å–åŒ¹é…é”®å€¼å¯¹:&quot;</span> + entry.getKey() + <span class="string">&quot;----&gt;&quot;</span> + entry.getValue());  </span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="number">14</span>ã€delete(H key, Object... hashKeys) </span><br><span class="line">    <span class="comment">//åˆ é™¤å˜é‡ä¸­çš„é”®å€¼å¯¹ï¼Œå¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°ï¼Œåˆ é™¤å¤šä¸ªé”®å€¼å¯¹ã€‚ 	</span></span><br><span class="line">    redisTemplate.opsForHash().delete(<span class="string">&quot;hashValue&quot;</span>,<span class="string">&quot;map1&quot;</span>,<span class="string">&quot;map2&quot;</span>);   </span><br><span class="line">	map = redisTemplate.opsForHash().entries(<span class="string">&quot;hashValue&quot;</span>);   </span><br><span class="line">	System.out.println(<span class="string">&quot;é€šè¿‡delete(H key, Object... hashKeys)æ–¹æ³•åˆ é™¤å˜é‡ä¸­çš„é”®å€¼å¯¹åå‰©ä½™çš„:&quot;</span> + map); </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å¤´æ™•ä¸ğŸ’«ï¼Œæ…¢æ…¢çœ‹å§ğŸ‘€,å¤šåˆ·å‡ éï¼Œå°±æ‡‚äº†ğŸ˜</p>
</blockquote>
<hr>
<h4 id="Hash-mapping">Hash mapping</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//å®ç°objectä¸Map&lt;K,V&gt;ç›¸äº’è½¬æ¢</span></span><br><span class="line"><span class="comment">//æ³•1.ObjectHashMapper</span></span><br><span class="line">è¿™ä¸ªå¯¹è±¡è¿”å›çš„æ˜¯å­—èŠ‚ç±»å‹çš„Hashmapï¼Œæ‰€ä»¥è¿˜æ˜¯ä½¿ç”¨Jackson2HashMapperå§</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³•2.Jackson2HashMapper</span></span><br><span class="line">HashMapper&lt;Object,String,Object&gt; hashMapper = <span class="keyword">new</span> Jackson2HashMapper(<span class="keyword">false</span>);</span><br><span class="line">Map&lt;String, Object&gt; hash = hashMapper.toHash(user);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>server</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title>ç£ç›˜æ£€æµ‹å’Œæ•°æ®å¤‡ä»½</title>
    <url>/2020/09/09/%E7%A3%81%E7%9B%98%E6%A3%80%E6%B5%8B%E5%92%8C%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD/</url>
    <content><![CDATA[<h2 id="æ£€æµ‹ä¸åˆ°ç¡¬ç›˜">æ£€æµ‹ä¸åˆ°ç¡¬ç›˜</h2>
<p>åŒäº‹è®©æˆ‘çœ‹çœ‹æœåŠ¡å™¨ï¼Œæƒ³è¦åˆ©ç”¨ç£ç›˜<code>/dev/sdb</code>ï¼Œä½†æ˜¯å‘¢ï¼Œä¸ç®¡æ˜¯<span class="label info">fdisk -l</span> è¿˜æ˜¯<span class="label success">df -h</span>å‘½ä»¤éƒ½æŸ¥ä¸åˆ°æŒ‚è½½æˆ–è€…æœªæŒ‚è½½çš„ç£ç›˜sdbå’Œè¿™ä¸ªç¡¬ç›˜çš„åˆ†åŒºä¿¡æ¯ï¼Œä½†æ˜¯å½“æˆ‘å»æŸ¥çœ‹è¿™ä¸ªç¡¬ç›˜çš„æ—¶å€™ï¼Œå‘ç°å®ƒå¾ˆçƒ«ï¼Œè¯æ˜ç¡¬ç›˜è¿æ¥æ²¡é—®é¢˜çš„ï¼Œé‚£æ€ä¹ˆå°±æ£€æµ‹ä¸åˆ°å‘¢?çœŸçš„ä¸çŸ¥é“ğŸ˜µ</p>
<a id="more"></a>
<p>æŒ‰é“ç†æŸåçš„ç¡¬ç›˜ä¹Ÿæ˜¯å¯ä»¥æ‰¾åˆ°çš„å•Šï¼Œåªæ˜¯åäº†è€Œå·²ï¼</p>
<p>æœ€åå‘ç°ï¼Œæœç„¶æ˜¯æ•°æ®çº¿è¿æ¥é—®é¢˜ğŸ˜©ï¼Œé‡æ–°æ’ç¡¬ç›˜çš„æ•°æ®çº¿ï¼Œå°±å¯ä»¥æ£€æµ‹åˆ°è¿™ä¸ªæ–°çš„ç¡¬ç›˜äº†ğŸ˜ƒ</p>
<p>å¯é€šè¿‡å¼€æœº<span class="label primary">æŒ‰F2</span>è¿›å…¥BIOSç•Œé¢æŸ¥çœ‹ç›¸å…³çš„è®¾å¤‡æƒ…å†µ</p>
<hr>
<h2 id="å¤‡ä»½æ•°æ®">å¤‡ä»½æ•°æ®</h2>
<p>è€ƒè™‘åˆ°ç³»ç»Ÿå¯èƒ½å‡ºé”™ï¼Œæ‰€ä»¥æƒ³ç»™æ—§ç£ç›˜çš„æ•°æ®åšå¤‡ä»½ã€‚</p>
<p>ä½¿ç”¨<span class="label danger">dump</span> å‘½ä»¤ ï¼š</p>
<p><code>dump -0u -f å¤‡ä»½æ–‡ä»¶å å¤‡ä»½æºæ–‡ä»¶ç³»ç»Ÿ</code></p>
<div class="note info">
            <h3 id="Note">Note:</h3><p>å¤‡ä»½æ–‡ä»¶åå¦‚åœ¨ç›®å½•é‡Œé¢ï¼Œéœ€è¦å¸¦ä¸Šç›®å½•</p><p>å¤‡ä»½åŸæ–‡ä»¶ç³»ç»Ÿï¼Œä½¿ç”¨è®¾å¤‡åæˆ–è€…æŒ‚è½½çš„ç›®å½•éƒ½OK</p>
          </div>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<blockquote>
<p>è¿™é‡Œé€‰å–ä¸¤ä¸ªç³»ç»Ÿä¸Šçš„ç©ºç™½åˆ†åŒºsda1å’Œsda2</p>
</blockquote>
<p>åˆ†åŒºsda1 (100G) ç”¨ä½œå¤‡ä»½åˆ†åŒº  æŠŠ<code>/dev/sda1</code>æŒ‚è½½åˆ° <code>/data1/backup</code> ä¸Š</p>
<p>åˆ†åŒºsda2 (300G) ç”¨ä½œå®‰è£…è½¯ä»¶çš„æ•°æ®å­˜å‚¨  <code>/dev/sda2</code>æŒ‚è½½åˆ°<code>/data1 </code>ä¸Š</p>
<div class="note success">
            <h3 id="Note-å…¶å®ç³»ç»Ÿåšäº†ä¸¤ä»½å¤‡ä»½">Note:å…¶å®ç³»ç»Ÿåšäº†ä¸¤ä»½å¤‡ä»½</h3><p>ä¸€ä»½åœ¨<code>data1/lost+found/sdb1.dump</code><br>å¦ä¸€ä»½åœ¨<code>/data1/backup/sdb1.dump.1</code></p>
          </div>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>backup</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring 4.0é«˜çº§è£…é…</title>
    <url>/2020/11/18/Spring-4.0%E9%AB%98%E7%BA%A7%E8%A3%85%E9%85%8D/</url>
    <content><![CDATA[<h1>ç¯å¢ƒä¸Profile</h1>
<blockquote>
<p>Springä»3.1ç‰ˆæœ¬å°±å¼•å…¥äº†bean profileçš„åŠŸèƒ½</p>
</blockquote>
<h3 id="Profileç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ">Profileç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ</h3>
<p>å…¶å®å°±æ˜¯å®ƒå°±æ˜¯æ ¹æ®ç¯å¢ƒæ¥å†³å®šè¯¥åˆ›å»ºå“ªä¸ªbeanï¼Œä¸åˆ›å»ºå“ªä¸ªbean</p>
<p>ä¸è¿‡Springå¹¶ä¸æ˜¯åœ¨æ„å»ºçš„æ—¶å€™åšå‡ºè¿™æ ·çš„å†³ç­–ï¼Œè€Œæ˜¯<a id="more"></a>ç­‰åˆ°è¿è¡Œæ—¶å†æ¥ç¡®å®šã€‚è¿™æ ·çš„ç»“æœå°±æ˜¯åŒä¸€ä¸ªéƒ¨ç½²å•å…ƒï¼ˆå¯èƒ½ä¼šæ˜¯WARæ–‡ä»¶ï¼‰èƒ½å¤Ÿé€‚ç”¨äºæ‰€æœ‰çš„ç¯å¢ƒï¼Œæ²¡æœ‰å¿…è¦è¿›è¡Œé‡æ–°æ„å»ºã€‚</p>
<h2 id="é…ç½®profile-bean">é…ç½®profile bean</h2>
<h3 id="åŸºäºJavaConfigé…ç½®">åŸºäºJavaConfigé…ç½®</h3>
<p>åœ¨Javaé…ç½®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨@Profileæ³¨è§£æŒ‡å®šæŸä¸ªbeanå±äºå“ªä¸€ä¸ªprofileã€‚</p>
<p>å½“@Profileæ³¨è§£åº”ç”¨åœ¨äº†ç±»çº§åˆ«ä¸Šã€‚å®ƒä¼šå‘Šè¯‰Springè¿™ä¸ªé…ç½®ç±»ä¸­çš„beanåªæœ‰åœ¨dev profileæ¿€æ´»æ—¶æ‰ä¼šåˆ›å»ºã€‚profileæ¿€æ´»æ—¶æ‰ä¼šåˆ›å»ºã€‚å¦‚æœdev profileæ²¡æœ‰æ¿€æ´»çš„è¯ï¼Œé‚£ä¹ˆå¸¦æœ‰@Beanæ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚</p>
<p>ä¸è¿‡ï¼Œä»Spring 3.2å¼€å§‹ï¼Œä¹Ÿå¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä¸Šä½¿ç”¨@Profile æ³¨è§£ï¼Œä¸ @Beanæ³¨è§£ä¸€åŒä½¿ç”¨ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½å°†è¿™ä¸¤ä¸ªbeançš„å£°æ˜æ”¾åˆ°åŒä¸€ä¸ªé…ç½®ç±»ä¹‹ä¸­</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp;</span><br><span class="line"><span class="keyword">import</span> javax.activation.DataSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Profile;</span><br><span class="line"><span class="keyword">import</span></span><br><span class="line">  org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseBuilder;</span><br><span class="line"><span class="keyword">import</span></span><br><span class="line">  org.springframework.jdbc.datasource.embedded.EmbeddedDatabaseType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jndi.JndiObjectFactoryBean;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line">  <span class="meta">@Profile(&quot;dev&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> DataSource <span class="title">embeddedDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> EmbeddedDatabaseBuilder()</span><br><span class="line">          .setType(EmbeddedDatabaseType.H2)</span><br><span class="line">          .addScript(<span class="string">&quot;classpath:schema.sql&quot;</span>)</span><br><span class="line">          .addScript(<span class="string">&quot;classpath:test-data.sql&quot;</span>)</span><br><span class="line">          .build();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="meta">@Profile(&quot;prod&quot;)</span>	</span><br><span class="line">  <span class="function"><span class="keyword">public</span> DataSource <span class="title">jndiDataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    JndiObjectFactoryBean jndiObjectFactoryBean =</span><br><span class="line">        <span class="keyword">new</span> JndiObjectFactoryBean();</span><br><span class="line">    jndiObjectFactoryBean.setJndiName(<span class="string">&quot;jdbc/myDS&quot;</span>);</span><br><span class="line">    jndiObjectFactoryBean.setResourceRef(<span class="keyword">true</span>);</span><br><span class="line">    jndiObjectFactoryBean.setProxyInterface(javax.sql.DataSource.class);</span><br><span class="line">    <span class="keyword">return</span> (DataSource) jndiObjectFactoryBean.getObject();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œå°½ç®¡æ¯ä¸ªDataSource beanéƒ½è¢«å£°æ˜åœ¨ä¸€ä¸ªprofileä¸­ï¼Œå¹¶ä¸”åªæœ‰å½“è§„å®šçš„profileæ¿€æ´»æ—¶ï¼Œç›¸åº”çš„beanæ‰ä¼šè¢«åˆ›å»ºï¼Œ<strong>ä½†æ˜¯å¯èƒ½ä¼šæœ‰å…¶ä»–çš„beanå¹¶æ²¡æœ‰å£°æ˜åœ¨ä¸€ä¸ªç»™å®šçš„profileèŒƒå›´å†…</strong>ã€‚æ²¡æœ‰æŒ‡å®šprofileçš„beanå§‹ç»ˆéƒ½ä¼šè¢«åˆ›å»ºï¼Œä¸æ¿€æ´»å“ªä¸ªprofileæ²¡æœ‰å…³ç³»ã€‚</p>
<h3 id="åŸºäºXMLé…ç½®">åŸºäºXMLé…ç½®</h3>
<p>é™¤äº†å¯ä»¥ä¸ºæ¯ä¸ªç¯å¢ƒéƒ½åˆ›å»ºä¸€ä¸ªprofile XMLæ–‡ä»¶ï¼ŒæŠŠæ‰€æœ‰çš„beanå®šä¹‰åˆ°äº†åŒä¸€ä¸ªXMLæ–‡ä»¶ä¹‹ä¸­ï¼Œè¿™ç§é…ç½®æ–¹å¼ä¸å®šä¹‰åœ¨å•ç‹¬çš„XMLæ–‡ä»¶ä¸­çš„å®é™…æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚è¿™é‡Œæœ‰ä¸‰ä¸ªbeanï¼Œç±»å‹éƒ½æ˜¯javax.sql.DataSourceï¼Œå¹¶ä¸”IDéƒ½æ˜¯dataSourceã€‚ä½†æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªbeanï¼Œè¿™å–å†³äºå¤„äºæ¿€æ´»çŠ¶æ€çš„æ˜¯å“ªä¸ªprofileã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">  xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">  xmlns:jdbc=<span class="string">&quot;http://www.springframework.org/schema/jdbc&quot;</span></span><br><span class="line">  xmlns:jee=<span class="string">&quot;http://www.springframework.org/schema/jee&quot;</span></span><br><span class="line">  xmlns:p=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span><br><span class="line">  xsi:schemaLocation=<span class="string">&quot;</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/jee</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/jee/spring-jee.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/jdbc</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/jdbc/spring-jdbc.xsd</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">  &lt;beans profile=<span class="string">&quot;dev&quot;</span>&gt;	</span><br><span class="line">    &lt;jdbc:embedded-database id=<span class="string">&quot;dataSource&quot;</span>&gt;</span><br><span class="line">      &lt;jdbc:script location=<span class="string">&quot;classpath:schema.sql&quot;</span> /&gt;</span><br><span class="line">      &lt;jdbc:script location=<span class="string">&quot;classpath:test-data.sql&quot;</span> /&gt;</span><br><span class="line">    &lt;/jdbc:embedded-database&gt;</span><br><span class="line">  &lt;/beans&gt;</span><br><span class="line"></span><br><span class="line">  &lt;beans profile=<span class="string">&quot;qa&quot;</span>&gt;	</span><br><span class="line">    &lt;bean id=<span class="string">&quot;dataSource&quot;</span></span><br><span class="line">          <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span></span><br><span class="line">          destroy-method=<span class="string">&quot;close&quot;</span></span><br><span class="line">          p:url=<span class="string">&quot;jdbc:h2:tcp://dbserver/~/test&quot;</span></span><br><span class="line">          p:driverClassName=<span class="string">&quot;org.h2.Driver&quot;</span></span><br><span class="line">          p:username=<span class="string">&quot;sa&quot;</span></span><br><span class="line">          p:password=<span class="string">&quot;password&quot;</span></span><br><span class="line">          p:initialSize=<span class="string">&quot;20&quot;</span></span><br><span class="line">          p:maxActive=<span class="string">&quot;30&quot;</span> /&gt;</span><br><span class="line">  &lt;/beans&gt;</span><br><span class="line"></span><br><span class="line">  &lt;beans profile=<span class="string">&quot;prod&quot;</span>&gt;	</span><br><span class="line">     &lt;jee:jndi-lookup id=<span class="string">&quot;dataSource&quot;</span></span><br><span class="line">                     jndi-name=<span class="string">&quot;jdbc/myDatabase&quot;</span></span><br><span class="line">                     resource-ref=<span class="string">&quot;true&quot;</span></span><br><span class="line">                     proxy-<span class="class"><span class="keyword">interface</span></span>=<span class="string">&quot;javax.sql.DataSource&quot;</span> /&gt;</span><br><span class="line">  &lt;/beans&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="æ¿€æ´»profile">æ¿€æ´»profile</h2>
<p>Springåœ¨ç¡®å®šå“ªä¸ªprofileå¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œéœ€è¦ä¾èµ–ä¸¤ä¸ªç‹¬ç«‹çš„å±æ€§ï¼š<strong>spring.profiles.active</strong> å’Œ <strong>spring.profiles.default</strong>ã€‚å¦‚æœè®¾ç½®äº†spring.profiles.activeå±æ€§çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±ä¼šç”¨æ¥ç¡®å®šå“ªä¸ªprofileæ˜¯æ¿€æ´»çš„ã€‚ä½†å¦‚æœæ²¡æœ‰è®¾ç½®spring.profiles.activeå±æ€§çš„è¯ï¼Œé‚£Springå°†ä¼šæŸ¥æ‰¾spring.profiles.defaultçš„å€¼ã€‚å¦‚æœspring.profiles.active å’Œ spring.profiles.defaultå‡æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé‚£å°±æ²¡æœ‰æ¿€æ´»çš„profileï¼Œå› æ­¤åªä¼šåˆ›å»ºé‚£äº›æ²¡æœ‰å®šä¹‰åœ¨profileä¸­çš„beanã€‚</p>
<p>æœ‰å¤šç§æ–¹å¼æ¥è®¾ç½®è¿™ä¸¤ä¸ªå±æ€§ï¼š</p>
<ol>
<li>ä½œä¸º DispatcherServletçš„åˆå§‹åŒ–å‚æ•°ï¼›</li>
<li>ä½œä¸ºWebåº”ç”¨çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼›</li>
<li>ä½œä¸ºJNDIæ¡ç›®ï¼›</li>
<li>ä½œä¸ºç¯å¢ƒå˜é‡ï¼›</li>
<li>ä½œä¸ºJVMçš„ç³»ç»Ÿå±æ€§ï¼›</li>
<li>åœ¨é›†æˆæµ‹è¯•ç±»ä¸Šï¼Œä½¿ç”¨@ActiveProfilesæ³¨è§£è®¾ç½®ã€‚</li>
</ol>
<p><strong>ç¯å¢ƒå˜é‡çš„è®¾ç½®</strong>ï¼š% export SPRING_PROFILES_ACTIVE=prodï¼ˆè®¾ç½®SPRING_PROFILES_ACTIVEï¼‰</p>
<p><strong>JVMçš„è®¾ç½®</strong>ï¼š</p>
<ul>
<li>tomcat ä¸­ catalina.batï¼ˆ.shä¸­ä¸ç”¨â€œsetâ€ï¼‰ æ·»åŠ JAVA_OPSã€‚é€šè¿‡è®¾ç½®activeé€‰æ‹©ä¸åŒé…ç½®æ–‡ä»¶ set JAVA_OPTS=â€-Dspring.profiles.active=testâ€</li>
<li>eclipse ä¸­å¯åŠ¨tomcatã€‚é¡¹ç›®å³é”® run as â€“&gt; run configurationâ€“&gt;Argumentsâ€“&gt; VM argumentsä¸­æ·»åŠ ã€‚localé…ç½®æ–‡ä»¶ä¸å¿…ä¸Šä¼ gitè¿½è¸ªç®¡ç†<br>
-Dspring.profiles.active=â€localâ€</li>
</ul>
<h4 id="ä½¿ç”¨profilesè¿›è¡Œæµ‹è¯•">ä½¿ç”¨profilesè¿›è¡Œæµ‹è¯•</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes=&#123;PersistenceTestConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;dev&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistenceTest</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1>æ¡ä»¶åŒ–çš„bean</h1>
<blockquote>
<p>spring4å¼•å…¥äº†@Conditionalæ³¨è§£</p>
</blockquote>
<p>@Conditionalæ³¨è§£å¯ä»¥ç”¨åˆ°å¸¦æœ‰@Beanæ³¨è§£çš„æ–¹æ³•ä¸Šã€‚å¦‚æœç»™å®šçš„æ¡ä»¶è®¡ç®—ç»“æœä¸ºtrueï¼Œå°±ä¼šåˆ›å»ºè¿™ä¸ªbeanï¼Œå¦åˆ™çš„è¯ï¼Œè¿™ä¸ªbeanä¼šè¢«å¿½ç•¥ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Conditional(MagicExistsCondition.class)</span>	</span><br><span class="line"><span class="function"><span class="keyword">public</span> MagicBean <span class="title">magicBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MagicBean();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä»Spring 4å¼€å§‹ï¼Œ@Profileæ³¨è§£è¿›è¡Œäº†é‡æ„ï¼Œä½¿å…¶åŸºäº@Conditional å’Œ Conditionå®ç°ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional(ProfileCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Profile &#123;</span><br><span class="line">  String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>å¤„ç†è‡ªåŠ¨è£…é…çš„æ­§ä¹‰æ€§</h1>
<p>åœ¨ç¬¬2ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨è‡ªåŠ¨è£…é…è®©Springå®Œå…¨è´Ÿè´£å°†beanå¼•ç”¨æ³¨å…¥åˆ°æ„é€ å‚æ•°å’Œå±æ€§ä¸­ã€‚è‡ªåŠ¨è£…é…èƒ½å¤Ÿæä¾›å¾ˆå¤§çš„å¸®åŠ©ï¼Œå› ä¸ºå®ƒä¼šå‡å°‘è£…é…åº”ç”¨ç¨‹åºç»„ä»¶æ—¶æ‰€éœ€è¦çš„æ˜¾å¼é…ç½®çš„æ•°é‡ã€‚</p>
<p>ä»…æœ‰ä¸€ä¸ªbeanåŒ¹é…æ‰€éœ€çš„ç»“æœæ—¶ï¼Œè‡ªåŠ¨è£…é…æ‰æ˜¯æœ‰æ•ˆçš„ã€‚å¦‚æœä¸ä»…æœ‰ä¸€ä¸ªbeanèƒ½å¤ŸåŒ¹é…ç»“æœçš„è¯ï¼Œè¿™ç§æ­§ä¹‰æ€§ä¼šé˜»ç¢Springè‡ªåŠ¨è£…é…å±æ€§ã€æ„é€ å™¨å‚æ•°æˆ–æ–¹æ³•å‚æ•°ã€‚</p>
<p>æ¯”å¦‚ä»¥ä¸‹çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cake</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cookies</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ï¼Œå½“ç¡®å®å‘ç”Ÿæ­§ä¹‰æ€§çš„æ—¶å€™ï¼ŒSpringæä¾›äº†å¤šç§å¯é€‰æ–¹æ¡ˆæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ä½ å¯ä»¥å°†å¯é€‰beanä¸­çš„æŸä¸€ä¸ª<strong>è®¾ä¸ºé¦–é€‰ï¼ˆprimaryï¼‰çš„bean</strong>ï¼Œæˆ–è€…**ä½¿ç”¨é™å®šç¬¦ï¼ˆqualifierï¼‰**æ¥å¸®åŠ©Springå°†å¯é€‰çš„beançš„èŒƒå›´ç¼©å°åˆ°åªæœ‰ä¸€ä¸ªbeanã€‚</p>
<h4 id="æ ‡ç¤ºé¦–é€‰çš„bean">æ ‡ç¤ºé¦–é€‰çš„bean</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<h4 id="é™å®šè‡ªåŠ¨è£…é…çš„bean">é™å®šè‡ªåŠ¨è£…é…çš„bean</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;iceCream&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä½¿ç”¨é™å®šç¬¦çš„æœ€ç®€å•çš„ä¾‹å­ã€‚ä¸º@Qualifieræ³¨è§£æ‰€è®¾ç½®çš„å‚æ•°å°±æ˜¯æƒ³è¦æ³¨å…¥çš„beançš„IDã€‚æ‰€æœ‰ä½¿ç”¨@Componentæ³¨è§£å£°æ˜çš„ç±»éƒ½ä¼šåˆ›å»ºä¸ºbeanï¼Œå¹¶ä¸”beançš„IDä¸ºé¦–å­—æ¯å˜ä¸ºå°å†™çš„ç±»åã€‚å› æ­¤ï¼Œ@Qualifier(â€œiceCreamâ€)æŒ‡å‘çš„æ˜¯ç»„ä»¶æ‰«ææ—¶æ‰€åˆ›å»ºçš„beanï¼Œå¹¶ä¸”è¿™ä¸ªbeanæ˜¯IceCreamç±»çš„å®ä¾‹ã€‚</p>
<p>å®é™…ä¸Šï¼Œè¿˜æœ‰ä¸€ç‚¹éœ€è¦è¡¥å……ä¸€ä¸‹ã€‚æ›´å‡†ç¡®åœ°è®²ï¼Œ@Qualifier(â€œiceCreamâ€)æ‰€å¼•ç”¨çš„beanè¦å…·æœ‰Stringç±»å‹çš„â€œiceCreamâ€ä½œä¸ºé™å®šç¬¦ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå…¶ä»–çš„é™å®šç¬¦çš„è¯ï¼Œæ‰€æœ‰çš„beanéƒ½ä¼šç»™å®šä¸€ä¸ªé»˜è®¤çš„é™å®šç¬¦ï¼Œè¿™ä¸ªé™å®šç¬¦ä¸beançš„IDç›¸åŒã€‚å› æ­¤ï¼Œæ¡†æ¶ä¼šå°†å…·æœ‰â€œiceCreamâ€é™å®šç¬¦çš„beanæ³¨å…¥åˆ°setDessert()æ–¹æ³•ä¸­ã€‚è¿™æ°å·§å°±æ˜¯IDä¸ºiceCreamçš„beanï¼Œå®ƒæ˜¯IceCreamç±»åœ¨ç»„ä»¶æ‰«æçš„æ—¶å€™åˆ›å»ºçš„ã€‚</p>
<blockquote>
<p>åŸºäºé»˜è®¤çš„bean IDä½œä¸ºé™å®šç¬¦æ˜¯éå¸¸ç®€å•çš„ï¼Œä½†è¿™æœ‰å¯èƒ½ä¼šå¼•å…¥ä¸€äº›é—®é¢˜ã€‚å¦‚æœä½ é‡æ„äº†IceCreamç±»ï¼Œå°†å…¶é‡å‘½åä¸ºGelatoçš„è¯ï¼Œé‚£æ­¤æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿå¦‚æœè¿™æ ·çš„è¯ï¼Œbeançš„IDå’Œé»˜è®¤çš„é™å®šç¬¦ä¼šå˜ä¸ºgelatoï¼Œè¿™å°±æ— æ³•åŒ¹é…setDessert()æ–¹æ³•ä¸­çš„é™å®šç¬¦ã€‚è‡ªåŠ¨è£…é…ä¼šå¤±è´¥ã€‚</p>
</blockquote>
<h4 id="åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦">åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦</h4>
<p>IDä½œä¸ºé™å®šç¬¦ã€‚åœ¨è¿™é‡Œæ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨beanå£°æ˜ä¸Šæ·»åŠ @Qualifieræ³¨è§£ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ä¸@Componentç»„åˆä½¿ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;cold&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IceCream</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œcoldé™å®šç¬¦åˆ†é…ç»™äº†IceCreambeanã€‚å› ä¸ºå®ƒæ²¡æœ‰è€¦åˆç±»åï¼Œå› æ­¤ä½ å¯ä»¥éšæ„é‡æ„IceCreamçš„ç±»åï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šç ´åè‡ªåŠ¨è£…é…ã€‚åœ¨æ³¨å…¥çš„åœ°æ–¹ï¼Œåªè¦å¼•ç”¨coldé™å®šç¬¦å°±å¯ä»¥äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;cold&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDessert</span><span class="params">(Dessert dessert)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.dessert = dessert;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨è‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£">ä½¿ç”¨è‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£</h4>
<p>å¦‚æœéœ€è¦ä¸¤ä¸ªé™å®šç¬¦æ‰èƒ½å®šä½åˆ°ç›¸å…³çš„beanï¼Œå¯è¡Œå—ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;cold&quot;)</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;fruity&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Popsicle</span> <span class="keyword">implements</span> <span class="title">Dessert</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ç­”æ¡ˆæ˜¯ä¸å¯è¡Œï¼šJavaä¸å…è®¸åœ¨åŒä¸€ä¸ªæ¡ç›®ä¸Šé‡å¤å‡ºç°ç›¸åŒç±»å‹çš„å¤šä¸ªæ³¨è§£ã€‚[1]å¦‚æœä½ è¯•å›¾è¿™æ ·åšçš„è¯ï¼Œç¼–è¯‘å™¨ä¼šæç¤ºé”™è¯¯ã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨@Qualifieræ³¨è§£å¹¶æ²¡æœ‰åŠæ³•ï¼ˆè‡³å°‘æ²¡æœ‰ç›´æ¥çš„åŠæ³•ï¼‰å°†è‡ªåŠ¨è£…é…çš„å¯é€‰beanç¼©å°èŒƒå›´è‡³ä»…æœ‰ä¸€ä¸ªå¯é€‰çš„beanã€‚</p>
<p>é‚£å°±è‡ªå·±åˆ›å»ºè‡ªå®šä¹‰çš„é™å®šç¬¦æ³¨è§£å’¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„**@Cold**æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.FIELD,</span></span><br><span class="line"><span class="meta">         ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Cold &#123; &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="beançš„ä½œç”¨åŸŸ">beançš„ä½œç”¨åŸŸ</h2>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€æœ‰beanéƒ½æ˜¯ä½œä¸ºä»¥å•ä¾‹ï¼ˆsingletonï¼‰çš„å½¢å¼åˆ›å»ºçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ç»™å®šçš„ä¸€ä¸ªbeanè¢«æ³¨å…¥åˆ°å…¶ä»–beanå¤šå°‘æ¬¡ï¼Œæ¯æ¬¡æ‰€æ³¨å…¥çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå•ä¾‹beanæ˜¯å¾ˆç†æƒ³çš„æ–¹æ¡ˆã€‚åˆå§‹åŒ–å’Œåƒåœ¾å›æ”¶å¯¹è±¡å®ä¾‹æ‰€å¸¦æ¥çš„æˆæœ¬åªç•™ç»™ä¸€äº›å°è§„æ¨¡ä»»åŠ¡ï¼Œåœ¨è¿™äº›ä»»åŠ¡ä¸­ï¼Œè®©å¯¹è±¡ä¿æŒæ— çŠ¶æ€å¹¶ä¸”åœ¨åº”ç”¨ä¸­åå¤é‡ç”¨è¿™äº›å¯¹è±¡å¯èƒ½å¹¶ä¸åˆç†ã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œå¯èƒ½ä¼šå‘ç°ï¼Œä½ æ‰€ä½¿ç”¨çš„ç±»æ˜¯æ˜“å˜çš„ï¼ˆmutableï¼‰ï¼Œå®ƒä»¬ä¼šä¿æŒä¸€äº›çŠ¶æ€ï¼Œå› æ­¤é‡ç”¨æ˜¯ä¸å®‰å…¨çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†classå£°æ˜ä¸ºå•ä¾‹çš„beanå°±ä¸æ˜¯ä»€ä¹ˆå¥½ä¸»æ„äº†ï¼Œå› ä¸ºå¯¹è±¡ä¼šè¢«æ±¡æŸ“ï¼Œç¨åé‡ç”¨çš„æ—¶å€™ä¼šå‡ºç°æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚</p>
<p>Springå®šä¹‰äº†å¤šç§ä½œç”¨åŸŸï¼Œå¯ä»¥åŸºäºè¿™äº›ä½œç”¨åŸŸåˆ›å»ºbeanï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>å•ä¾‹ï¼ˆSingletonï¼‰ï¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­ï¼Œåªåˆ›å»ºbeançš„ä¸€ä¸ªå®ä¾‹ã€‚</li>
<li>åŸå‹ï¼ˆPrototypeï¼‰ï¼šæ¯æ¬¡æ³¨å…¥æˆ–è€…é€šè¿‡Springåº”ç”¨ä¸Šä¸‹æ–‡è·å–çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚</li>
<li>ä¼šè¯ï¼ˆSessionï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ã€‚</li>
<li>è¯·æ±‚ï¼ˆRquestï¼‰ï¼šåœ¨Webåº”ç”¨ä¸­ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªbeanå®ä¾‹ã€‚</li>
</ol>
<p>å•ä¾‹æ˜¯é»˜è®¤çš„ä½œç”¨åŸŸï¼Œä½†æ˜¯æ­£å¦‚ä¹‹å‰æ‰€è¿°ï¼Œå¯¹äºæ˜“å˜çš„ç±»å‹ï¼Œè¿™å¹¶ä¸åˆé€‚ã€‚å¦‚æœé€‰æ‹©å…¶ä»–çš„ä½œç”¨åŸŸï¼Œè¦ä½¿ç”¨**@Scope<strong>æ³¨è§£ï¼Œå®ƒå¯ä»¥ä¸</strong>@Component** æˆ– <strong>@Bean</strong>ä¸€èµ·ä½¿ç”¨ã€‚</p>
<blockquote>
<p>@ScopeåŒæ—¶è¿˜æœ‰è¦ç»™proxyModeå±æ€§ï¼Œå¦‚éœ€äº†è§£è¯¦æƒ…ï¼Œè¯·æŸ¥é˜… â€“ [ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindle ä½ç½® 1604-1606). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Notepad</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ConfigurableBeanFactory ç±»çš„ SCOPE_PROTOTYPEå¸¸é‡è®¾ç½®äº†åŸå‹ä½œç”¨åŸŸã€‚ä½ å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨@Scope(â€œprototypeâ€)ï¼Œä½†æ˜¯ä½¿ç”¨SCOPE_PROTOTYPEå¸¸é‡æ›´åŠ å®‰å…¨å¹¶ä¸”ä¸æ˜“å‡ºé”™ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Notepad <span class="title">notepad</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Notepad();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>åŸå‹beané…ç½®</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;notepad&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;com.myapp.Notepad&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>xmlé…ç½®æ–¹å¼</p>
</blockquote>
<hr>
<h2 id="è¿è¡Œæ—¶å€¼çš„æ³¨å…¥">è¿è¡Œæ—¶å€¼çš„æ³¨å…¥</h2>
<p>å½“è®¨è®ºä¾èµ–æ³¨å…¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šå¸¸æ‰€è®¨è®ºçš„æ˜¯å°†ä¸€ä¸ªbeanå¼•ç”¨æ³¨å…¥åˆ°å¦ä¸€ä¸ªbeançš„å±æ€§æˆ–æ„é€ å™¨å‚æ•°ä¸­ã€‚å®ƒé€šå¸¸æ¥è®²æŒ‡çš„æ˜¯å°†ä¸€ä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡è¿›è¡Œå…³è”ã€‚</p>
<p>ä½†æ˜¯beanè£…é…çš„å¦å¤–ä¸€ä¸ªæ–¹é¢æŒ‡çš„æ˜¯å°†ä¸€ä¸ªå€¼æ³¨å…¥åˆ°beançš„å±æ€§æˆ–è€…æ„é€ å™¨å‚æ•°ä¸­ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ç¡¬ç¼–ç çš„å½¢å¼ï¼Œå°±æ˜¯ç›´æ¥æ³¨å…¥å€¼ï¼Œä½†æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¸Œæœ›é¿å…ç¡¬ç¼–ç å€¼ï¼Œè€Œæ˜¯æƒ³è®©è¿™äº›å€¼åœ¨è¿è¡Œæ—¶å†ç¡®å®šã€‚ä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼ŒSpringæä¾›äº†ä¸¤ç§åœ¨è¿è¡Œæ—¶æ±‚å€¼çš„æ–¹å¼ï¼š</p>
<ul>
<li>
<p>å±æ€§å ä½ç¬¦ï¼ˆProperty placeholderï¼‰</p>
</li>
<li>
<p>Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰</p>
</li>
</ul>
<p>å¾ˆå¿«ä½ å°±ä¼šå‘ç°è¿™ä¸¤ç§æŠ€æœ¯çš„ç”¨æ³•æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡å®ƒä»¬çš„ç›®çš„å’Œè¡Œä¸ºæ˜¯æœ‰æ‰€å·®åˆ«çš„ã€‚</p>
<h3 id="æ³¨å…¥å¤–éƒ¨çš„å€¼">æ³¨å…¥å¤–éƒ¨çš„å€¼</h3>
<p>åœ¨Springä¸­ï¼Œå¤„ç†å¤–éƒ¨å€¼çš„æœ€ç®€å•æ–¹å¼å°±æ˜¯å£°æ˜å±æ€§æºå¹¶é€šè¿‡Springçš„Environmentæ¥æ£€ç´¢å±æ€§ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.soundsystem;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.PropertySource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.env.Environment;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:/com/soundsystem/app.properties&quot;)</span>	</span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExpressiveConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  Environment env;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BlankDisc <span class="title">disc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BlankDisc(</span><br><span class="line">        env.getProperty(<span class="string">&quot;disc.titleâ€),	</span></span><br><span class="line"><span class="string">         env.getProperty(&quot;</span>disc.artist<span class="string">&quot;));</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹ä¸­ï¼Œ@PropertySourceå¼•ç”¨äº†ç±»è·¯å¾„ä¸­ä¸€ä¸ªåä¸ºapp.propertiesçš„æ–‡ä»¶ã€‚å®ƒå¤§è‡´ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š è¿™ä¸ªå±æ€§æ–‡ä»¶ä¼šåŠ è½½åˆ°Springçš„Environmentä¸­ï¼Œç¨åå¯ä»¥ä»è¿™é‡Œæ£€ç´¢å±æ€§ã€‚åŒæ—¶ï¼Œåœ¨disc()æ–¹æ³•ä¸­ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„BlankDiscï¼Œå®ƒçš„æ„é€ å™¨å‚æ•°æ˜¯ä»å±æ€§æ–‡ä»¶ä¸­è·å–çš„ï¼Œè€Œè¿™æ˜¯é€šè¿‡è°ƒç”¨getProperty()</p>
<h4 id="æ·±å…¥å­¦ä¹ Springçš„Environment">æ·±å…¥å­¦ä¹ Springçš„Environment</h4>
<p>å…¶å®getProperty()æ–¹æ³•æœ‰å››ä¸ªé‡è½½çš„å˜ç§å½¢å¼ï¼š</p>
<ul>
<li>String getProperty(String key)</li>
<li>String getProperty(String key, String defaultValue)</li>
<li>T getProperty(String key, Class<T> type)</li>
<li>T getProperty(String key, Class<T> type, T defaultValue)</li>
</ul>
<blockquote>
<p>è¯¦æƒ…è¯·çœ‹â€“&gt;[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindle ä½ç½® 1660-1661). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
</blockquote>
<p>å½“ç„¶Environmentè¿˜æä¾›äº†ä¸€äº›è·Ÿå±æ€§ç›¸å…³çš„æ–¹æ³•å’Œç”¨æ¥æ£€æŸ¥å“ªä¸ªprofileå¤„äºæ¿€æ´»çŠ¶æ€çš„æ–¹æ³•ï¼Œè¯¦ç»†ç« èŠ‚åœ¨[Spring å®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ç¬¬ä¸‰ç«  3.5å°èŠ‚-è¿è¡Œæ—¶å€¼æ³¨å…¥-æ³¨å…¥å¤–éƒ¨çš„å€¼]æœ‰è¯¦ç»†è®°è½½</p>
<h4 id="è§£æå±æ€§å ä½ç¬¦">è§£æå±æ€§å ä½ç¬¦</h4>
<p>Springä¸€ç›´æ”¯æŒå°†å±æ€§å®šä¹‰åˆ°å¤–éƒ¨çš„å±æ€§çš„æ–‡ä»¶ä¸­ï¼Œå¹¶ä½¿ç”¨å ä½ç¬¦å€¼å°†å…¶æ’å…¥åˆ°Spring beanä¸­ã€‚åœ¨Springè£…é…ä¸­ï¼Œå ä½ç¬¦çš„å½¢å¼ä¸ºä½¿ç”¨â€œ${ â€¦ }â€åŒ…è£…çš„å±æ€§åç§°ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sgtPeppers&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:_title</span>=<span class="string">&quot;$&#123;disc.title&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:_artist</span>=<span class="string">&quot;$&#123;disc.artist&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä¾èµ–äºç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…æ¥åˆ›å»ºå’Œåˆå§‹åŒ–åº”ç”¨ç»„ä»¶çš„è¯ï¼Œé‚£ä¹ˆå°±æ²¡æœ‰æŒ‡å®šå ä½ç¬¦çš„é…ç½®æ–‡ä»¶æˆ–ç±»äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼ä¸@Autowiredæ³¨è§£éå¸¸ç›¸ä¼¼ã€‚æ¯”å¦‚ï¼Œåœ¨BlankDiscç±»ä¸­ï¼Œæ„é€ å™¨å¯ä»¥æ”¹æˆå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@Value(&quot;$&#123;disc.title&#125;&quot;)</span> String title,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@Value(&quot;$&#123;disc.artist&#125;&quot;)</span> String artist)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.title = title;</span><br><span class="line">  <span class="keyword">this</span>.artist = artist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸ºäº†ä½¿ç”¨å ä½ç¬¦</strong>ï¼Œæˆ‘ä»¬å¿…é¡»è¦é…ç½®ä¸€ä¸ªPropertyPlaceholderConfigurer beanæˆ–PropertySourcesPlaceholderConfigurer beanã€‚ä»Spring 3.1å¼€å§‹ï¼Œæ¨èä½¿ç”¨PropertySourcesPlaceholderConfigurerï¼Œå› ä¸ºå®ƒèƒ½å¤ŸåŸºäºSpring EnvironmentåŠå…¶å±æ€§æºæ¥è§£æå ä½ç¬¦ã€‚</p>
<p>å¦‚ä¸‹çš„ @Beanæ–¹æ³•åœ¨Javaä¸­é…ç½®äº†PropertySourcesPlaceholderConfigurer ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> PropertySourcesPlaceholderConfigurer <span class="title">placeholderConfigurer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ æƒ³ä½¿ç”¨XMLé…ç½®çš„è¯ï¼ŒSpring contextå‘½åç©ºé—´ä¸­çš„&lt;context:propertyplaceholder&gt;å…ƒç´ å°†ä¼šä¸ºä½ ç”ŸæˆPropertySourcesPlaceholderConfigurer beanï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:property-placeholder</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è§£æå¤–éƒ¨å±æ€§èƒ½å¤Ÿå°†å€¼çš„å¤„ç†æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ï¼Œä½†æ˜¯å®ƒçš„å…³æ³¨ç‚¹åœ¨äºæ ¹æ®åç§°è§£ææ¥è‡ªäºSpring Environmentå’Œå±æ€§æºçš„å±æ€§ã€‚è€ŒSpringè¡¨è¾¾å¼è¯­è¨€æä¾›äº†ä¸€ç§æ›´é€šç”¨çš„æ–¹å¼åœ¨è¿è¡Œæ—¶è®¡ç®—æ‰€è¦æ³¨å…¥çš„å€¼ã€‚</p>
<h4 id="ä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…">ä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…</h4>
<p>Spring 3å¼•å…¥äº†Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpring Expression Languageï¼ŒSpELï¼‰ï¼Œå®ƒèƒ½å¤Ÿä»¥ä¸€ç§å¼ºå¤§å’Œç®€æ´çš„æ–¹å¼å°†å€¼è£…é…åˆ°beanå±æ€§å’Œæ„é€ å™¨å‚æ•°ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨çš„è¡¨è¾¾å¼ä¼šåœ¨è¿è¡Œæ—¶è®¡ç®—å¾—åˆ°å€¼ã€‚</p>
<p>SpELæ‹¥æœ‰å¾ˆå¤šç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>ä½¿ç”¨beançš„IDæ¥å¼•ç”¨beanï¼›</li>
<li>è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§ï¼›</li>
<li>å¯¹å€¼è¿›è¡Œç®—æœ¯ã€å…³ç³»å’Œé€»è¾‘è¿ç®—ï¼›</li>
<li>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼›</li>
<li>é›†åˆæ“ä½œã€‚</li>
</ol>
<p>éœ€è¦äº†è§£çš„ç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯<strong>SpELè¡¨è¾¾å¼</strong>è¦æ”¾åˆ°â€œ<strong>#{ â€¦ }</strong>â€ä¹‹ä¸­ï¼Œè¿™ä¸å±æ€§å ä½ç¬¦æœ‰äº›ç±»ä¼¼ï¼Œå±æ€§å ä½ç¬¦éœ€è¦æ”¾åˆ°â€œ<strong>${ â€¦ }</strong>â€ä¹‹ä¸­ã€‚ä¸‹é¢æ‰€å±•ç°çš„å¯èƒ½æ˜¯æœ€ç®€å•çš„SpELè¡¨è¾¾å¼äº†ï¼š</p>
<p>å¦‚æœé€šè¿‡ç»„ä»¶æ‰«æåˆ›å»ºbeançš„è¯ï¼Œåœ¨æ³¨å…¥å±æ€§å’Œæ„é€ å™¨å‚æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£ï¼Œè¿™ä¸ä¹‹å‰çœ‹åˆ°çš„å±æ€§å ä½ç¬¦éå¸¸ç±»ä¼¼ã€‚ä¸è¿‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ‰€ä½¿ç”¨çš„ä¸æ˜¯å ä½ç¬¦è¡¨è¾¾å¼ï¼Œè€Œæ˜¯SpELè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æ ·ä¾‹å±•ç°äº†BlankDiscï¼Œå®ƒä¼šä»ç³»ç»Ÿå±æ€§ä¸­è·å–ä¸“è¾‘åç§°å’Œè‰ºæœ¯å®¶çš„åå­—ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BlankDisc</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;&quot;)</span> String title,</span></span></span><br><span class="line"><span class="function"><span class="params">      <span class="meta">@Value(&quot;#&#123;systemProperties[&#x27;disc.artist&#x27;]&#125;&quot;)</span> String artist)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.title = title;</span><br><span class="line">  <span class="keyword">this</span>.artist = artist;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨XMLé…ç½®ä¸­ï¼Œä½ å¯ä»¥å°†SpELè¡¨è¾¾å¼ä¼ å…¥<property> æˆ– <constructor-arg> çš„ valueå±æ€§ä¸­ï¼Œæˆ–è€…å°†å…¶ä½œä¸ºp-å‘½åç©ºé—´æˆ–c-å‘½åç©ºé—´æ¡ç›®çš„å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å¦‚ä¸‹BlankDisc</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sgtPeppers&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;soundsystem.BlankDisc&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:_title</span>=<span class="string">&quot;#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">c:_artist</span>=<span class="string">&quot;#&#123;systemProperties[&#x27;disc.artist&#x27;]&#125;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>SpELè¡¨è¾¾å¼ä¹Ÿå¯ä»¥å¼•ç”¨å…¶ä»–çš„beanæˆ–å…¶ä»–beançš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„è¡¨è¾¾å¼ä¼šè®¡ç®—å¾—åˆ°IDä¸ºsgtPeppersçš„beançš„artist</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#&#123;sgtPeppers.artist&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡systemPropertieså¯¹è±¡å¼•ç”¨ç³»ç»Ÿå±æ€§ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#&#123;systemProperties[&#x27;disc.title&#x27;]&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦åœ¨SpELä¸­è®¿é—®ç±»ä½œç”¨åŸŸçš„æ–¹æ³•å’Œå¸¸é‡çš„è¯ï¼Œè¦ä¾èµ–T()è¿™ä¸ªå…³é”®çš„è¿ç®—ç¬¦ã€‚ä¾‹å¦‚ï¼Œä¸ºäº†åœ¨SpELä¸­è¡¨è¾¾Javaçš„Mathç±»ï¼Œéœ€è¦æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼ä½¿ç”¨T() è¿ç®—ç¬¦ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">T(java.lang.Math)</span><br></pre></td></tr></table></figure>
<h5 id="SpELè¿ç®—ç¬¦">SpELè¿ç®—ç¬¦</h5>
<table>
<thead>
<tr>
<th>è¿è¡Œç¬¦ç±»å‹</th>
<th>è¿ç®—ç¬¦</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç®—æ•°è¿ç®—</td>
<td>+ ã€ - ã€ * ã€ / ã€ % ã€ ^</td>
</tr>
<tr>
<td>æ¯”è¾ƒè¿ç®—</td>
<td>&lt; ã€ &gt; ã€ == ã€ &lt;= ã€ &gt;= ã€ lt ã€ gt ã€ eq ã€ le ã€ ge</td>
</tr>
<tr>
<td>é€»è¾‘è¿ç®—</td>
<td>and ã€ or ã€ not ã€ â”‚</td>
</tr>
<tr>
<td>æ¡ä»¶è¿ç®—</td>
<td>?: (ternary) ã€ ?: (Elvis)</td>
</tr>
<tr>
<td>æ­£åˆ™è¡¨è¾¾å¼</td>
<td>matches</td>
</tr>
</tbody>
</table>
<blockquote>
<p>å…·ä½“è¯¦ç»†ç« èŠ‚åœ¨ [Spring å®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ç¬¬ä¸‰ç«  3.5å°èŠ‚-è¿è¡Œæ—¶å€¼æ³¨å…¥-ä½¿ç”¨Springè¡¨è¾¾å¼è¯­è¨€è¿›è¡Œè£…é…] æœ‰è¯¦ç»†è®°è½½</p>
</blockquote>
<p>[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-ç¼“å­˜æ•°æ®</title>
    <url>/2020/11/24/Spring-%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<h2 id="å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ">å¯ç”¨å¯¹ç¼“å­˜çš„æ”¯æŒ</h2>
<p>Springå¯¹ç¼“å­˜çš„æ”¯æŒæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>æ³¨è§£é©±åŠ¨çš„ç¼“å­˜</li>
<li>XMLå£°æ˜çš„ç¼“å­˜<a id="more"></a></li>
</ul>
<p>ä½¿ç”¨Springçš„ç¼“å­˜æŠ½è±¡æ—¶ï¼Œæœ€ä¸ºé€šç”¨çš„æ–¹å¼å°±æ˜¯åœ¨æ–¹æ³•ä¸Šæ·»åŠ @Cacheable å’Œ @CacheEvictæ³¨è§£ã€‚åœ¨æœ¬ç« ä¸­ï¼Œå¤§å¤šæ•°å†…å®¹éƒ½ä¼šä½¿ç”¨è¿™ç§ç±»å‹çš„å£°æ˜å¼æ³¨è§£ã€‚åœ¨13.3å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨XMLæ¥å£°æ˜ç¼“å­˜è¾¹ç•Œã€‚</p>
<p>åœ¨å¾€ beanä¸Šæ·»åŠ ç¼“å­˜æ³¨è§£ä¹‹å‰ï¼Œå¿…é¡»è¦å¯ç”¨Springå¯¹æ³¨è§£é©±åŠ¨ç¼“å­˜çš„æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨Javaé…ç½®çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨å…¶ä¸­çš„ä¸€ä¸ªé…ç½®ç±»ä¸Šæ·»åŠ @EnableCachingï¼Œè¿™æ ·çš„è¯å°±èƒ½å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚ä»¥ä¸‹å±•ç°äº†å¦‚ä½•å®é™…ä½¿ç”¨@EnableCaching ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.cachefun;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.concurrent.ConcurrentMapCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ConcurrentMapCacheManager();</span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä»¥XMLçš„æ–¹å¼é…ç½®åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Spring cacheå‘½åç©ºé—´ä¸­çš„&lt;cache:annotation-driven&gt;å…ƒç´ æ¥å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:annotation-driven</span> /&gt;</span>	</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">class</span>=</span></span><br><span class="line"><span class="tag">  &quot;<span class="attr">org.springframework.cache.concurrent.ConcurrentMapCacheManager</span>&quot; /&gt;</span>	</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®åœ¨æœ¬è´¨ä¸Šï¼Œ@EnableCaching å’Œ &lt;cache:annotation-driven&gt;çš„å·¥ä½œæ–¹å¼æ˜¯ç›¸åŒçš„ã€‚å®ƒä»¬éƒ½ä¼šåˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼ˆaspectï¼‰å¹¶è§¦å‘Springç¼“å­˜æ³¨è§£çš„åˆ‡ç‚¹ï¼ˆpointcutï¼‰ã€‚æ ¹æ®æ‰€ä½¿ç”¨çš„æ³¨è§£ä»¥åŠç¼“å­˜çš„çŠ¶æ€ï¼Œè¿™ä¸ªåˆ‡é¢ä¼šä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¹‹ä¸­æˆ–è€…ä»ç¼“å­˜ä¸­ç§»é™¤æŸä¸ªå€¼ã€‚</p>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œå®ƒä»¬ä¸ä»…ä»…å¯ç”¨äº†æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ï¼Œè¿˜å£°æ˜äº†ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼ˆcache managerï¼‰çš„beanã€‚ç¼“å­˜ç®¡ç†å™¨æ˜¯Springç¼“å­˜æŠ½è±¡çš„æ ¸å¿ƒï¼Œå®ƒèƒ½å¤Ÿä¸å¤šä¸ªæµè¡Œçš„ç¼“å­˜å®ç°è¿›è¡Œé›†æˆã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå£°æ˜äº†ConcurrentMapCacheManagerï¼Œè¿™ä¸ªç®€å•çš„ç¼“å­˜ç®¡ç†å™¨ä½¿ç”¨java.util.concurrent.ConcurrentHashMapä½œä¸ºå…¶ç¼“å­˜å­˜å‚¨ã€‚å®ƒéå¸¸ç®€å•ï¼Œå› æ­¤å¯¹äºå¼€å‘ã€æµ‹è¯•æˆ–åŸºç¡€çš„åº”ç”¨æ¥è®²ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚ä½†å®ƒçš„ç¼“å­˜å­˜å‚¨æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ‰€ä»¥å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸åº”ç”¨å…³è”çš„ï¼Œå¯¹äºç”Ÿäº§çº§åˆ«çš„å¤§å‹ä¼ä¸šçº§åº”ç”¨ç¨‹åºï¼Œè¿™å¯èƒ½å¹¶ä¸æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚</p>
<p>å¹¸å¥½ï¼Œæœ‰å¤šä¸ªå¾ˆæ£’çš„ç¼“å­˜ç®¡ç†å™¨æ–¹æ¡ˆå¯ä¾›ä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å‡ ä¸ªæœ€ä¸ºå¸¸ç”¨çš„ç¼“å­˜ç®¡ç†å™¨ã€‚</p>
<h3 id="é…ç½®ç¼“å­˜ç®¡ç†å™¨">é…ç½®ç¼“å­˜ç®¡ç†å™¨</h3>
<p>Spring 3.1å†…ç½®äº†äº”ä¸ªç¼“å­˜ç®¡ç†å™¨å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>SimpleCacheManager</li>
<li>NoOpCacheManager</li>
<li>ConcurrentMapCacheManager</li>
<li>CompositeCacheManager</li>
<li>EhCacheCacheManager</li>
</ul>
<p>Spring 3.2å¼•å…¥äº†å¦å¤–ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œè¿™ä¸ªç®¡ç†å™¨å¯ä»¥ç”¨åœ¨åŸºäºJCacheï¼ˆJSR-107ï¼‰çš„ç¼“å­˜æä¾›å•†ä¹‹ä¸­ã€‚é™¤äº†æ ¸å¿ƒçš„Springæ¡†æ¶ï¼ŒSpring Dataåˆæä¾›äº†ä¸¤ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼š</p>
<ul>
<li>RedisCacheManagerï¼ˆæ¥è‡ªäºSpring Data Redisé¡¹ç›®ï¼‰</li>
<li>GemfireCacheManagerï¼ˆæ¥è‡ªäºSpring Data GemFireé¡¹ç›®ï¼‰</li>
</ul>
<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸ºSpringçš„ç¼“å­˜æŠ½è±¡é€‰æ‹©ç¼“å­˜ç®¡ç†å™¨æ—¶ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šå¯é€‰æ–¹æ¡ˆã€‚å…·ä½“é€‰æ‹©å“ªä¸€ä¸ªè¦å–å†³äºæƒ³è¦ä½¿ç”¨çš„åº•å±‚ç¼“å­˜ä¾›åº”å•†ã€‚æ¯ä¸€ä¸ªæ–¹æ¡ˆéƒ½å¯ä»¥ä¸ºåº”ç”¨æä¾›ä¸åŒé£æ ¼çš„ç¼“å­˜ï¼Œå…¶ä¸­æœ‰ä¸€äº›ä¼šæ¯”å…¶ä»–çš„æ›´åŠ é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚å°½ç®¡æ‰€åšå‡ºçš„é€‰æ‹©ä¼šå½±å“åˆ°æ•°æ®å¦‚ä½•ç¼“å­˜ï¼Œä½†æ˜¯Springå£°æ˜ç¼“å­˜çš„æ–¹å¼ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆå·®åˆ«ã€‚</p>
<h4 id="ä½¿ç”¨Ehcacheç¼“å­˜">ä½¿ç”¨Ehcacheç¼“å­˜</h4>
<p>Ehcacheæ˜¯æœ€ä¸ºæµè¡Œçš„ç¼“å­˜ä¾›åº”å•†ä¹‹ä¸€ã€‚Ehcacheç½‘ç«™ä¸Šè¯´å®ƒæ˜¯â€œJavaé¢†åŸŸåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ç¼“å­˜â€ã€‚é‰´äºå®ƒçš„å¹¿æ³›é‡‡ç”¨ï¼ŒSpringæä¾›é›†æˆEhcacheçš„ç¼“å­˜ç®¡ç†å™¨æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ã€‚è¿™ä¸ªç¼“å­˜ç®¡ç†å™¨ä¹Ÿå°±æ˜¯EhCacheCacheManager ã€‚</p>
<p>Javaé…ç½®EhCacheCacheManageræ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.cachefun;</span><br><span class="line"><span class="keyword">import</span> net.sf.ehcache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.ehcache.EhCacheManagerFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.ClassPathResource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> EhCacheCacheManager <span class="title">cacheManager</span><span class="params">(CacheManager cm)</span> </span>&#123;	</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(cm);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title">ehcache</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">     EhCacheManagerFactoryBean ehCacheFactoryBean =</span><br><span class="line">        <span class="keyword">new</span> EhCacheManagerFactoryBean();</span><br><span class="line">    ehCacheFactoryBean.setConfigLocation(</span><br><span class="line">        <span class="keyword">new</span> ClassPathResource(<span class="string">&quot;com/habuma/spittr/cache/ehcache.xml&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> ehCacheFactoryBean;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ç¨‹åºæ¸…å•ä¸­ï¼ŒcacheManager()æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªEhCacheCacheManagerçš„å®ä¾‹ï¼Œè¿™æ˜¯é€šè¿‡ä¼ å…¥Ehcache CacheManagerå®ä¾‹å®ç°çš„ã€‚åœ¨è¿™é‡Œï¼Œç¨å¾®æœ‰ç‚¹è¯¡å¼‚çš„æ³¨å…¥å¯èƒ½ä¼šè®©äººæ„Ÿè§‰è¿·æƒ‘ï¼Œè¿™æ˜¯å› ä¸ºSpringå’ŒEhCacheéƒ½å®šä¹‰äº†CacheManagerç±»å‹ã€‚éœ€è¦æ˜ç¡®çš„æ˜¯ï¼ŒEhCacheçš„CacheManagerè¦è¢«æ³¨å…¥åˆ°Springçš„EhCacheCacheManagerï¼ˆSpring CacheManagerçš„å®ç°ï¼‰ä¹‹ä¸­ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä½¿ç”¨EhCacheçš„CacheManageræ¥è¿›è¡Œæ³¨å…¥ï¼Œæ‰€ä»¥å¿…é¡»ä¹Ÿè¦å£°æ˜ä¸€ä¸ªCacheManager beanã€‚ä¸ºäº†å¯¹å…¶è¿›è¡Œç®€åŒ–ï¼ŒSpringæä¾›äº†EhCacheManager-FactoryBeanæ¥ç”ŸæˆEhCacheçš„CacheManager ã€‚æ–¹æ³• ehcache()ä¼šåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªEhCacheManagerFactoryBeanå®ä¾‹ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå·¥å‚beanï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå®ç°äº†Springçš„FactoryBeanæ¥å£ï¼‰ï¼Œæ‰€ä»¥æ³¨å†Œåœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„å¹¶ä¸æ˜¯EhCacheManagerFactoryBeançš„å®ä¾‹ï¼Œè€Œæ˜¯CacheManagerçš„ä¸€ä¸ªå®ä¾‹ï¼Œå› æ­¤é€‚åˆæ³¨å…¥åˆ°EhCacheCacheManagerä¹‹ä¸­</p>
<p>é™¤äº†åœ¨Springä¸­é…ç½®çš„beanï¼Œè¿˜éœ€è¦æœ‰é’ˆå¯¹EhCacheçš„é…ç½®ã€‚EhCacheä¸ºXMLå®šä¹‰äº†è‡ªå·±çš„é…ç½®æ¨¡å¼ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¸€ä¸ªXMLæ–‡ä»¶ä¸­é…ç½®ç¼“å­˜ï¼Œè¯¥æ–‡ä»¶éœ€è¦ç¬¦åˆEhCacheæ‰€å®šä¹‰çš„æ¨¡å¼ã€‚åœ¨åˆ›å»ºEhCacheManagerFactoryBeançš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å‘Šè¯‰å®ƒEhCacheé…ç½®æ–‡ä»¶åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚åœ¨è¿™é‡Œé€šè¿‡è°ƒç”¨setConfigLocation()æ–¹æ³•ï¼Œä¼ å…¥ClassPath-Resourceï¼Œç”¨æ¥æŒ‡æ˜EhCache XMLé…ç½®æ–‡ä»¶ç›¸å¯¹äºæ ¹ç±»è·¯å¾„ï¼ˆclasspathï¼‰çš„ä½ç½®ã€‚</p>
<p>è‡³äºehcache.xmlæ–‡ä»¶çš„å†…å®¹ï¼Œä¸åŒçš„åº”ç”¨ä¹‹é—´ä¼šæœ‰æ‰€å·®åˆ«ï¼Œä½†æ˜¯è‡³å°‘éœ€è¦å£°æ˜ä¸€ä¸ªæœ€å°çš„ç¼“å­˜ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„EhCacheé…ç½®å£°æ˜ä¸€ä¸ªåä¸ºspittleCacheçš„ç¼“å­˜ï¼Œå®ƒæœ€å¤§çš„å †å­˜å‚¨ä¸º50MBï¼Œå­˜æ´»æ—¶é—´ä¸º100ç§’ã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;ehcache&gt;</span><br><span class="line">  &lt;cache name=<span class="string">&quot;spittleCache&quot;</span></span><br><span class="line">          maxBytesLocalHeap=<span class="string">&quot;50m&quot;</span></span><br><span class="line">          timeToLiveSeconds=<span class="string">&quot;100&quot;</span>&gt;</span><br><span class="line">  &lt;/cache&gt;</span><br><span class="line">&lt;/ehcache&gt;</span><br></pre></td></tr></table></figure>
<p>æ˜¾ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºç¡€çš„EhCacheé…ç½®ã€‚åœ¨ä½ çš„åº”ç”¨ä¹‹ä¸­ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨EhCacheæ‰€æä¾›çš„ä¸°å¯Œçš„é…ç½®é€‰é¡¹ã€‚å‚è€ƒEhCacheçš„æ–‡æ¡£ä»¥äº†è§£è°ƒä¼˜EhCacheé…ç½®çš„ç»†èŠ‚ï¼Œåœ°å€æ˜¯http://ehcache.org/documentation/configuration ã€‚</p>
<h4 id="ä½¿ç”¨redisç¼“å­˜">ä½¿ç”¨redisç¼“å­˜</h4>
<p>Rediså¯ä»¥ç”¨æ¥ä¸ºSpringç¼“å­˜æŠ½è±¡æœºåˆ¶å­˜å‚¨ç¼“å­˜æ¡ç›®ï¼ŒSpring Data Redisæä¾›äº†RedisCacheManager ï¼Œè¿™æ˜¯ CacheManagerçš„ä¸€ä¸ªå®ç°ã€‚RedisCacheManagerä¼šä¸ä¸€ä¸ªRedisæœåŠ¡å™¨åä½œï¼Œå¹¶é€šè¿‡RedisTemplateå°†ç¼“å­˜æ¡ç›®å­˜å‚¨åˆ°Redisä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.myapp;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.jedis</span><br><span class="line">                                      .JedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisTemplate redisTemplate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisTemplate);	</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> JedisConnectionFactory <span class="title">redisConnectionFactory</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">    JedisConnectionFactory jedisConnectionFactory =</span><br><span class="line">           <span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">   jedisConnectionFactory.afterPropertiesSet();</span><br><span class="line">   <span class="keyword">return</span> jedisConnectionFactory;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="title">redisTemplate</span><span class="params">(	</span></span></span><br><span class="line"><span class="function"><span class="params">           RedisConnectionFactory redisCF)</span> </span>&#123;</span><br><span class="line">    RedisTemplate&lt;String, String&gt; redisTemplate =</span><br><span class="line">            <span class="keyword">new</span> RedisTemplate&lt;String, String&gt;();</span><br><span class="line">    redisTemplate.setConnectionFactory(redisCF);</span><br><span class="line">    redisTemplate.afterPropertiesSet();</span><br><span class="line">    <span class="keyword">return</span> redisTemplate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨">ä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨</h4>
<p>æˆ‘ä»¬å¹¶ä¸æ˜¯åªèƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ã€‚å¦‚æœä½ å¾ˆéš¾ç¡®å®šè¯¥ä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œæˆ–è€…æœ‰åˆæ³•çš„æŠ€æœ¯ç†ç”±ä½¿ç”¨è¶…è¿‡ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥å°è¯•ä½¿ç”¨Springçš„CompositeCacheManager</p>
<p>CompositeCacheManagerè¦é€šè¿‡ä¸€ä¸ªæˆ–æ›´å¤šçš„ç¼“å­˜ç®¡ç†å™¨æ¥è¿›è¡Œé…ç½®ï¼Œå®ƒä¼šè¿­ä»£è¿™äº›ç¼“å­˜ç®¡ç†å™¨ï¼Œä»¥æŸ¥æ‰¾ä¹‹å‰æ‰€ç¼“å­˜çš„å€¼ã€‚ä»¥ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•åˆ›å»ºCompositeCacheManager beanï¼Œå®ƒä¼šè¿­ä»£JCacheCacheManager ã€ EhCacheCache-Manager å’Œ RedisCacheManager ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      net.sf.ehcache.CacheManager cm,</span></span></span><br><span class="line"><span class="function"><span class="params">      javax.cache.CacheManager jcm)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  CompositeCacheManager cacheManager = <span class="keyword">new</span> CompositeCacheManager();	</span><br><span class="line">  List&lt;CacheManager&gt; managers = <span class="keyword">new</span> ArrayList&lt;CacheManager&gt;();</span><br><span class="line">  managers.add(<span class="keyword">new</span> JCacheCacheManager(jcm));</span><br><span class="line">  managers.add(<span class="keyword">new</span> EhCacheCacheManager(cm))</span><br><span class="line">  managers.add(<span class="keyword">new</span> RedisCacheManager(redisTemplate()));</span><br><span class="line">  cacheManager.setCacheManagers(managers);	</span><br><span class="line">  <span class="keyword">return</span> cacheManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æŸ¥æ‰¾ç¼“å­˜æ¡ç›®æ—¶ï¼ŒCompositeCacheManager é¦–å…ˆä¼šä» JCacheCacheManagerå¼€å§‹æ£€æŸ¥JCacheå®ç°ï¼Œç„¶åé€šè¿‡EhCacheCacheManageræ£€æŸ¥Ehcacheï¼Œæœ€åä¼šä½¿ç”¨RedisCacheManageræ¥æ£€æŸ¥Redisï¼Œå®Œæˆç¼“å­˜æ¡ç›®çš„æŸ¥æ‰¾ã€‚</p>
<p>åœ¨é…ç½®å®Œç¼“å­˜ç®¡ç†å™¨å¹¶å¯ç”¨ç¼“å­˜åï¼Œå°±å¯ä»¥åœ¨beanæ–¹æ³•ä¸Šåº”ç”¨ç¼“å­˜è§„åˆ™äº†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Springçš„ç¼“å­˜æ³¨è§£æ¥å®šä¹‰ç¼“å­˜è¾¹ç•Œã€‚</p>
<h2 id="ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜">ä¸ºæ–¹æ³•æ·»åŠ æ³¨è§£ä»¥æ”¯æŒç¼“å­˜</h2>
<p>å¦‚å‰æ–‡æ‰€è¿°ï¼ŒSpringçš„ç¼“å­˜æŠ½è±¡åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å›´ç»•åˆ‡é¢æ„å»ºçš„ã€‚åœ¨Springä¸­å¯ç”¨ç¼“å­˜æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåˆ‡é¢ï¼Œå®ƒè§¦å‘ä¸€ä¸ªæˆ–æ›´å¤šçš„Springçš„ç¼“å­˜æ³¨è§£ã€‚è¡¨13.1åˆ—å‡ºäº†Springæ‰€æä¾›çš„ç¼“å­˜æ³¨è§£ã€‚</p>
<p>è¡¨13.1ä¸­çš„æ‰€æœ‰æ³¨è§£éƒ½èƒ½è¿ç”¨åœ¨æ–¹æ³•æˆ–ç±»ä¸Šã€‚å½“å°†å…¶æ”¾åœ¨å•ä¸ªæ–¹æ³•ä¸Šæ—¶ï¼Œæ³¨è§£æ‰€æè¿°çš„ç¼“å­˜è¡Œä¸ºåªä¼šè¿ç”¨åˆ°è¿™ä¸ªæ–¹æ³•ä¸Šã€‚å¦‚æœæ³¨è§£æ”¾åœ¨ç±»çº§åˆ«çš„è¯ï¼Œé‚£ä¹ˆç¼“å­˜è¡Œä¸ºå°±ä¼šåº”ç”¨åˆ°è¿™ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•ä¸Šã€‚</p>
<p>è¡¨13.1ã€€Springæä¾›äº†å››ä¸ªæ³¨è§£æ¥å£°æ˜ç¼“å­˜è§„åˆ™</p>
<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Cacheable</td>
<td>è¡¨æ˜Springåœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰ï¼Œé¦–å…ˆåº”è¯¥åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾æ–¹æ³•çš„è¿”å›å€¼ã€‚å¦‚æœè¿™ä¸ªå€¼èƒ½å¤Ÿæ‰¾åˆ°ï¼Œå°±ä¼šè¿”å›ç¼“å­˜çš„å€¼ã€‚å¦åˆ™çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œè¿”å›å€¼ä¼šæ”¾åˆ°ç¼“å­˜ä¹‹ä¸­</td>
</tr>
<tr>
<td>@CachePut</td>
<td>è¡¨æ˜Springåº”è¯¥å°†æ–¹æ³•çš„è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¸­ã€‚åœ¨æ–¹æ³•çš„è°ƒç”¨å‰å¹¶ä¸ä¼šæ£€æŸ¥ç¼“å­˜ï¼Œæ–¹æ³•å§‹ç»ˆéƒ½ä¼šè¢«è°ƒç”¨</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>è¡¨æ˜Springåº”è¯¥åœ¨ç¼“å­˜ä¸­æ¸…é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®</td>
</tr>
<tr>
<td>@Caching</td>
<td>è¿™æ˜¯ä¸€ä¸ªåˆ†ç»„çš„æ³¨è§£ï¼Œèƒ½å¤ŸåŒæ—¶åº”ç”¨å¤šä¸ªå…¶ä»–çš„ç¼“å­˜æ³¨è§£</td>
</tr>
</tbody>
</table>
<h3 id="å¡«å……ç¼“å­˜">å¡«å……ç¼“å­˜</h3>
<p>@Cacheableå’Œ@CachePutæœ‰ä¸€äº›å…±æœ‰çš„å±æ€§</p>
<table>
<thead>
<tr>
<th>å±         æ€§</th>
<th>ç±»          å‹</th>
<th>æ          è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>String[]</td>
<td>è¦ä½¿ç”¨çš„ç¼“å­˜åç§°</td>
</tr>
<tr>
<td>condition</td>
<td>String</td>
<td>SpELè¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯falseçš„è¯ï¼Œä¸ä¼šå°†ç¼“å­˜åº”ç”¨åˆ°æ–¹æ³•è°ƒç”¨ä¸Š</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>SpELè¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—è‡ªå®šä¹‰çš„ç¼“å­˜key</td>
</tr>
<tr>
<td>unless</td>
<td>String</td>
<td>SpELè¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯trueçš„è¯ï¼Œè¿”å›å€¼ä¸ä¼šæ”¾åˆ°ç¼“å­˜ä¹‹ä¸­</td>
</tr>
</tbody>
</table>
<p>åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œåœ¨@Cacheable å’Œ @CachePutçš„è¿™äº›å±æ€§ä¸­ï¼Œåªéœ€ä½¿ç”¨valueå±æ€§æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç¼“å­˜å³å¯ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘SpittleRepository çš„ findOne()æ–¹æ³•ã€‚åœ¨åˆå§‹ä¿å­˜ä¹‹åï¼ŒSpittleå°±ä¸ä¼šå†å‘ç”Ÿå˜åŒ–äº†ã€‚å¦‚æœæœ‰çš„Spittleæ¯”è¾ƒçƒ­é—¨å¹¶ä¸”ä¼šè¢«é¢‘ç¹è¯·æ±‚ï¼Œåå¤åœ°åœ¨æ•°æ®åº“ä¸­è¿›è¡Œè·å–æ˜¯å¯¹æ—¶é—´å’Œèµ„æºçš„æµªè´¹ã€‚é€šè¿‡åœ¨findOne()æ–¹æ³•ä¸Šæ·»åŠ @Cacheableæ³¨è§£ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºï¼Œèƒ½å¤Ÿç¡®ä¿å°†Spittleä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œä»è€Œé¿å…å¯¹æ•°æ®åº“çš„ä¸å¿…è¦è®¿é—®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(&quot;spittleCache&quot;)</span>	</span><br><span class="line"><span class="function"><span class="keyword">public</span> Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcTemplate.queryForObject(</span><br><span class="line">        SELECT_SPITTLE_BY_ID,</span><br><span class="line">        <span class="keyword">new</span> SpittleRowMapper(),</span><br><span class="line">        id);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (EmptyResultDataAccessException e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ findOne()è¢«è°ƒç”¨æ—¶ï¼Œç¼“å­˜åˆ‡é¢ä¼šæ‹¦æˆªè°ƒç”¨å¹¶åœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾ä¹‹å‰ä»¥åspittleCacheå­˜å‚¨çš„è¿”å›å€¼ã€‚ç¼“å­˜çš„key æ˜¯ä¼ é€’åˆ° findOne() æ–¹æ³•ä¸­çš„ idå‚æ•°ã€‚å¦‚æœæŒ‰ç…§è¿™ä¸ªkeyèƒ½å¤Ÿæ‰¾åˆ°å€¼çš„è¯ï¼Œå°±ä¼šè¿”å›æ‰¾åˆ°çš„å€¼ï¼Œæ–¹æ³•ä¸ä¼šå†è¢«è°ƒç”¨ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å€¼çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¹¶å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­ï¼Œä¸ºä¸‹ä¸€æ¬¡è°ƒç”¨findOne()æ–¹æ³•åšå¥½å‡†å¤‡ã€‚</p>
<p>åœ¨ç¨‹åºæ¸…å•13.6ä¸­ï¼Œ@Cacheableæ³¨è§£è¢«æ”¾åˆ°äº†JdbcSpittleRepository çš„ findOne()æ–¹æ³•å®ç°ä¸Šã€‚è¿™æ ·èƒ½å¤Ÿèµ·ä½œç”¨ï¼Œä½†æ˜¯ç¼“å­˜çš„ä½œç”¨åªé™äºJdbcSpittleRepositoryè¿™ä¸ªå®ç°ç±»ä¸­ï¼ŒSpittleRepositoryçš„å…¶ä»–å®ç°å¹¶æ²¡æœ‰ç¼“å­˜åŠŸèƒ½ï¼Œé™¤éä¹Ÿä¸ºå…¶æ·»åŠ ä¸Š@Cacheableæ³¨è§£ã€‚å› æ­¤ï¼Œå¯ä»¥è€ƒè™‘å°†æ³¨è§£æ·»åŠ åˆ°SpittleRepositoryçš„æ–¹æ³•å£°æ˜ä¸Šï¼Œè€Œä¸æ˜¯æ”¾åœ¨å®ç°ç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(&quot;spittleCache&quot;)</span></span><br><span class="line"><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å½“ä¸ºæ¥å£æ–¹æ³•æ·»åŠ æ³¨è§£åï¼Œ@Cacheable æ³¨è§£ä¼šè¢« SpittleRepositoryçš„æ‰€æœ‰å®ç°ç»§æ‰¿ï¼Œè¿™äº›å®ç°ç±»éƒ½ä¼šåº”ç”¨ç›¸åŒçš„ç¼“å­˜è§„åˆ™ã€‚</p>
<h4 id="å°†å€¼æ”¾åˆ°ç¼“å­˜ä¸­">å°†å€¼æ”¾åˆ°ç¼“å­˜ä¸­</h4>
<p>@Cacheableä¼šæ¡ä»¶æ€§åœ°è§¦å‘å¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿™å–å†³äºç¼“å­˜ä¸­æ˜¯ä¸æ˜¯å·²ç»æœ‰äº†æ‰€éœ€è¦çš„å€¼ï¼Œå¯¹äºæ‰€æ³¨è§£çš„æ–¹æ³•ï¼Œ@CachePuté‡‡ç”¨äº†ä¸€ç§æ›´ä¸ºç›´æ¥çš„æµç¨‹ã€‚å¸¦æœ‰@CachePutæ³¨è§£çš„æ–¹æ³•å§‹ç»ˆéƒ½ä¼šè¢«è°ƒç”¨ï¼Œè€Œä¸”å®ƒçš„è¿”å›å€¼ä¹Ÿä¼šæ”¾åˆ°ç¼“å­˜ä¸­ã€‚è¿™æä¾›ä¸€ç§å¾ˆä¾¿åˆ©çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨è¯·æ±‚ä¹‹å‰é¢„å…ˆåŠ è½½ç¼“å­˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå…¨æ–°çš„Spittle é€šè¿‡ SpittleRepository çš„ save()æ–¹æ³•ä¿å­˜ä¹‹åï¼Œå¾ˆå¯èƒ½é©¬ä¸Šå°±ä¼šè¯·æ±‚è¿™æ¡è®°å½•ã€‚æ‰€ä»¥ï¼Œå½“save()æ–¹æ³•è°ƒç”¨åï¼Œç«‹å³å°†Spittleå¡åˆ°ç¼“å­˜ä¹‹ä¸­æ˜¯å¾ˆæœ‰æ„ä¹‰çš„ï¼Œè¿™æ ·å½“å…¶ä»–äººé€šè¿‡findOne()å¯¹å…¶è¿›è¡ŒæŸ¥æ‰¾æ—¶ï¼Œå®ƒå°±å·²ç»å‡†å¤‡å°±ç»ªäº†ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åœ¨save()æ–¹æ³•ä¸Šæ·»åŠ @CachePutæ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CachePut(&quot;spittleCache&quot;)</span></span><br><span class="line"><span class="function">Spittle <span class="title">save</span><span class="params">(Spittle spittle)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å½“ save()æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œå®ƒé¦–å…ˆä¼šåšæ‰€æœ‰å¿…è¦çš„äº‹æƒ…æ¥ä¿å­˜Spittleï¼Œç„¶åè¿”å›çš„Spittle ä¼šè¢«æ”¾åˆ° spittleCache ç¼“å­˜ä¸­ã€‚</p>
<p>åœ¨è¿™é‡Œåªæœ‰ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜çš„keyã€‚å¦‚å‰æ–‡æ‰€è¿°ï¼Œé»˜è®¤çš„ç¼“å­˜keyè¦åŸºäºæ–¹æ³•çš„å‚æ•°æ¥ç¡®å®šã€‚å› ä¸ºsave()æ–¹æ³•çš„å”¯ä¸€å‚æ•°å°±æ˜¯Spittleï¼Œæ‰€ä»¥å®ƒä¼šç”¨ä½œç¼“å­˜çš„keyã€‚å°†Spittleæ”¾åœ¨ç¼“å­˜ä¸­ï¼Œè€Œå®ƒçš„ç¼“å­˜keyæ°å¥½æ˜¯åŒä¸€ä¸ªSpittleï¼Œè¿™æ˜¯ä¸æ˜¯æœ‰ä¸€ç‚¹è¯¡å¼‚å‘¢ï¼Ÿ</p>
<p>æ˜¾ç„¶ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œé»˜è®¤çš„ç¼“å­˜keyå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æˆ‘ä»¬éœ€è¦çš„ç¼“å­˜keyæ˜¯æ–°ä¿å­˜Spittleçš„IDï¼Œè€Œä¸æ˜¯Spittleæœ¬èº«ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™é‡Œéœ€è¦æŒ‡å®šä¸€ä¸ªkeyè€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤çš„keyã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ€æ ·è‡ªå®šä¹‰ç¼“å­˜keyã€‚</p>
<h4 id="è‡ªå®šä¹‰ç¼“å­˜">è‡ªå®šä¹‰ç¼“å­˜</h4>
<p>@Cacheable å’Œ @CachePutéƒ½æœ‰ä¸€ä¸ªåä¸ºkeyå±æ€§ï¼Œè¿™ä¸ªå±æ€§èƒ½å¤Ÿæ›¿æ¢é»˜è®¤çš„keyï¼Œå®ƒæ˜¯é€šè¿‡ä¸€ä¸ªSpELè¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„ã€‚ä»»æ„çš„SpELè¡¨è¾¾å¼éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯æ›´å¸¸è§çš„åœºæ™¯æ˜¯æ‰€å®šä¹‰çš„è¡¨è¾¾å¼ä¸å­˜å‚¨åœ¨ç¼“å­˜ä¸­çš„å€¼æœ‰å…³ï¼Œæ®æ­¤è®¡ç®—å¾—åˆ°keyã€‚</p>
<p>å…·ä½“åˆ°æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬éœ€è¦å°†keyè®¾ç½®ä¸ºæ‰€ä¿å­˜Spittle çš„ IDã€‚ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™save() çš„ Spittleè¿˜æ²¡æœ‰ä¿å­˜ï¼Œå› æ­¤å¹¶æ²¡æœ‰IDã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡save() è¿”å›çš„ Spittle å¾—åˆ° id å±æ€§ã€‚</p>
<p>å¹¸å¥½ï¼Œåœ¨ä¸ºç¼“å­˜ç¼–å†™SpELè¡¨è¾¾å¼çš„æ—¶å€™ï¼ŒSpringæš´éœ²äº†ä¸€äº›å¾ˆæœ‰ç”¨çš„å…ƒæ•°æ®ã€‚è¡¨13.3åˆ—å‡ºäº†SpELä¸­å¯ç”¨çš„ç¼“å­˜å…ƒæ•°æ®ã€‚</p>
<p>è¡¨13.3ã€€Springæä¾›äº†å¤šä¸ªç”¨æ¥å®šä¹‰ç¼“å­˜è§„åˆ™çš„SpELæ‰©å±•</p>
<table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>#root.args</td>
<td>ä¼ é€’ç»™ç¼“å­˜æ–¹æ³•çš„å‚æ•°ï¼Œå½¢å¼ä¸ºæ•°ç»„</td>
</tr>
<tr>
<td>#root.caches</td>
<td>è¯¥æ–¹æ³•æ‰§è¡Œæ—¶æ‰€å¯¹åº”çš„ç¼“å­˜ï¼Œå½¢å¼ä¸ºæ•°ç»„</td>
</tr>
<tr>
<td>#root.target</td>
<td>ç›®æ ‡å¯¹è±¡</td>
</tr>
<tr>
<td>#root.targetClass</td>
<td>ç›®æ ‡å¯¹è±¡çš„ç±»ï¼Œæ˜¯ #root.target.classçš„ç®€å†™å½¢å¼</td>
</tr>
<tr>
<td>#root.method</td>
<td>ç¼“å­˜æ–¹æ³•</td>
</tr>
<tr>
<td>#root.methodName</td>
<td>ç¼“å­˜æ–¹æ³•çš„åå­—ï¼Œæ˜¯ #root.method.nameçš„ç®€å†™å½¢å¼</td>
</tr>
<tr>
<td>#result</td>
<td>æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼ï¼ˆä¸èƒ½ç”¨åœ¨ @Cacheable æ³¨è§£ä¸Šï¼‰</td>
</tr>
<tr>
<td>#Argument</td>
<td>ä»»æ„çš„æ–¹æ³•å‚æ•°åï¼ˆå¦‚ #argNameï¼‰æˆ–å‚æ•°ç´¢å¼•ï¼ˆå¦‚#a0 æˆ– #p0 ï¼‰</td>
</tr>
</tbody>
</table>
<p>å¯¹äº save()æ–¹æ³•æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦çš„é”®æ˜¯æ‰€è¿”å›Spittle å¯¹è±¡çš„ idå±æ€§ã€‚è¡¨è¾¾å¼#resultèƒ½å¤Ÿå¾—åˆ°è¿”å›çš„Spittleã€‚å€ŸåŠ©è¿™ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†keyå±æ€§è®¾ç½®ä¸º#<a href="http://result.id">result.id</a> æ¥å¼•ç”¨ id å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CachePut(value=&quot;spittleCache&quot;, key=&quot;#result.id&quot;)</span></span><br><span class="line"><span class="function">Spittle <span class="title">save</span><span class="params">(Spittle spittle)</span></span>;</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§è¿™ç§æ–¹å¼é…ç½®@CachePutï¼Œç¼“å­˜ä¸ä¼šå»å¹²æ¶‰save()æ–¹æ³•çš„æ‰§è¡Œï¼Œä½†æ˜¯è¿”å›çš„Spittleå°†ä¼šä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”ç¼“å­˜çš„keyä¸Spittle çš„ idå±æ€§ç›¸åŒã€‚</p>
<h4 id="æ¡ä»¶åŒ–ç¼“å­˜">æ¡ä»¶åŒ–ç¼“å­˜</h4>
<p>é€šè¿‡ä¸ºæ–¹æ³•æ·»åŠ Springçš„ç¼“å­˜æ³¨è§£ï¼ŒSpringå°±ä¼šå›´ç»•ç€è¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ‡é¢ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›åœºæ™¯ä¸‹æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†ç¼“å­˜åŠŸèƒ½å…³é—­ã€‚</p>
<p>@Cacheable å’Œ @CachePutæä¾›äº†ä¸¤ä¸ªå±æ€§ç”¨ä»¥å®ç°æ¡ä»¶åŒ–ç¼“å­˜ï¼šunless å’Œ conditionï¼Œè¿™ä¸¤ä¸ªå±æ€§éƒ½æ¥å—ä¸€ä¸ªSpELè¡¨è¾¾å¼ã€‚å¦‚æœunlesså±æ€§çš„SpELè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºtrueï¼Œé‚£ä¹ˆç¼“å­˜æ–¹æ³•è¿”å›çš„æ•°æ®å°±ä¸ä¼šæ”¾åˆ°ç¼“å­˜ä¸­ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œå¦‚æœconditionå±æ€§çš„SpELè¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºfalseï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªæ–¹æ³•ç¼“å­˜å°±ä¼šè¢«ç¦ç”¨æ‰ã€‚</p>
<p>è¡¨é¢ä¸Šæ¥çœ‹ï¼Œunless å’Œ conditionå±æ€§åšçš„æ˜¯ç›¸åŒçš„äº‹æƒ…ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ç»†å¾®çš„å·®åˆ«ã€‚unlesså±æ€§åªèƒ½é˜»æ­¢å°†å¯¹è±¡æ”¾è¿›ç¼“å­˜ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œä¾ç„¶ä¼šå»ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†åŒ¹é…çš„å€¼ï¼Œå°±ä¼šè¿”å›æ‰¾åˆ°çš„å€¼ã€‚ä¸ä¹‹ä¸åŒï¼Œå¦‚æœconditionçš„è¡¨è¾¾å¼è®¡ç®—ç»“æœä¸ºfalseï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç¼“å­˜æ˜¯è¢«ç¦ç”¨çš„ã€‚å°±æ˜¯è¯´ï¼Œä¸ä¼šå»ç¼“å­˜è¿›è¡ŒæŸ¥æ‰¾ï¼ŒåŒæ—¶è¿”å›å€¼ä¹Ÿä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ã€‚</p>
<p>ä½œä¸ºæ ·ä¾‹ï¼ˆå°½ç®¡æœ‰äº›ç‰µå¼ºï¼‰ï¼Œå‡è®¾å¯¹äºmessageå±æ€§åŒ…å«â€œNoCacheâ€çš„Spittleå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸æƒ³å¯¹å…¶è¿›è¡Œç¼“å­˜ã€‚ä¸ºäº†é˜»æ­¢è¿™æ ·çš„Spittleå¯¹è±¡è¢«ç¼“å­˜èµ·æ¥ï¼Œå¯ä»¥è¿™æ ·è®¾ç½®unless å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;spittleCache&quot;</span></span><br><span class="line"><span class="meta">    unless=&quot;#result.message.contains(&#x27;NoCache&#x27;)&quot;)</span></span><br><span class="line"><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>
<p>ä¸º unlessè®¾ç½®çš„SpELè¡¨è¾¾å¼ä¼šæ£€æŸ¥è¿”å›çš„Spittleå¯¹è±¡ï¼ˆåœ¨è¡¨è¾¾å¼ä¸­é€šè¿‡#resultæ¥è¯†åˆ«ï¼‰çš„messageå±æ€§ã€‚å¦‚æœå®ƒåŒ…å«â€œNoCacheâ€æ–‡æœ¬å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—å€¼ä¸ºtrue ï¼Œè¿™ä¸ª Spittleå¯¹è±¡ä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ã€‚å¦åˆ™çš„è¯ï¼Œè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸ºfalseï¼Œæ— æ³•æ»¡è¶³unlessçš„æ¡ä»¶ï¼Œè¿™ä¸ªSpittleå¯¹è±¡ä¼šè¢«ç¼“å­˜ã€‚</p>
<p>å±æ€§ unlessèƒ½å¤Ÿé˜»æ­¢å°†å€¼å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å°†ç¼“å­˜å…¨éƒ¨ç¦ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬æ—¢ä¸å¸Œæœ›å°†å€¼æ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œä¹Ÿä¸å¸Œæœ›ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºIDå€¼å°äº10çš„Spittleå¯¹è±¡ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å¯¹å…¶ä½¿ç”¨ç¼“å­˜ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œè¿™äº›Spittleæ˜¯ç”¨æ¥è¿›è¡Œè°ƒè¯•çš„æµ‹è¯•æ¡ç›®ï¼Œå¯¹å…¶è¿›è¡Œç¼“å­˜å¹¶æ²¡æœ‰å®é™…çš„ä»·å€¼ã€‚ä¸ºäº†è¦å¯¹IDå°äº10çš„Spittleå…³é—­ç¼“å­˜ï¼Œå¯ä»¥åœ¨@Cacheable ä¸Šä½¿ç”¨ conditionå±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&quot;spittleCache&quot;</span></span><br><span class="line"><span class="meta">    unless=&quot;#result.message.contains(&#x27;NoCache&#x27;)&quot;</span></span><br><span class="line"><span class="meta">    condition=&quot;#id &gt;= 10&quot;)</span></span><br><span class="line"><span class="function">Spittle <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span></span>;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ findOne()è°ƒç”¨æ—¶ï¼Œå‚æ•°å€¼å°äº10ï¼Œé‚£ä¹ˆå°†ä¸ä¼šåœ¨ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿”å›çš„Spittleä¹Ÿä¸ä¼šæ”¾è¿›ç¼“å­˜ä¸­ï¼Œå°±åƒè¿™ä¸ªæ–¹æ³•æ²¡æœ‰æ·»åŠ @Cacheableæ³¨è§£ä¸€æ ·ã€‚</p>
<h3 id="ç§»é™¤ç¼“å­˜æ¡ç›®">ç§»é™¤ç¼“å­˜æ¡ç›®</h3>
<p>@CacheEvictå¹¶ä¸ä¼šå¾€ç¼“å­˜ä¸­æ·»åŠ ä»»ä½•ä¸œè¥¿ã€‚ç›¸åï¼Œå¦‚æœå¸¦æœ‰@CacheEvictæ³¨è§£çš„æ–¹æ³•è¢«è°ƒç”¨çš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰ä¸€ä¸ªæˆ–æ›´å¤šçš„æ¡ç›®ä¼šåœ¨ç¼“å­˜ä¸­ç§»é™¤ã€‚</p>
<p>é‚£ä¹ˆåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦ä»ç¼“å­˜ä¸­ç§»é™¤å†…å®¹å‘¢ï¼Ÿå½“ç¼“å­˜å€¼ä¸å†åˆæ³•æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç¡®ä¿å°†å…¶ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œè¿™æ ·çš„è¯ï¼Œåç»­çš„ç¼“å­˜å‘½ä¸­å°±ä¸ä¼šè¿”å›æ—§çš„æˆ–è€…å·²ç»ä¸å­˜åœ¨çš„å€¼ï¼Œå…¶ä¸­ä¸€ä¸ªè¿™æ ·çš„åœºæ™¯å°±æ˜¯æ•°æ®è¢«åˆ é™¤æ‰äº†ã€‚è¿™æ ·çš„è¯ï¼ŒSpittleRepository çš„ remove()æ–¹æ³•å°±æ˜¯ä½¿ç”¨@CacheEvictçš„ç»ä½³é€‰æ‹©ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(&quot;spittleCache&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">long</span> spittleId)</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸ @Cacheable å’Œ @CachePut ä¸åŒï¼Œ @CacheEvictèƒ½å¤Ÿåº”ç”¨åœ¨è¿”å›å€¼ä¸ºvoidçš„æ–¹æ³•ä¸Šï¼Œè€Œ@Cacheable å’Œ @CachePut éœ€è¦é voidçš„è¿”å›å€¼ï¼Œå®ƒå°†ä¼šä½œä¸ºæ”¾åœ¨ç¼“å­˜ä¸­çš„æ¡ç›®ã€‚å› ä¸º@CacheEvictåªæ˜¯å°†æ¡ç›®ä»ç¼“å­˜ä¸­ç§»é™¤ï¼Œå› æ­¤å®ƒå¯ä»¥æ”¾åœ¨ä»»æ„çš„æ–¹æ³•ä¸Šï¼Œç”šè‡³void æ–¹æ³•ã€‚</p>
</blockquote>
<p>è¡¨13.4ã€€@CacheEvictæ³¨è§£çš„å±æ€§ï¼ŒæŒ‡å®šäº†å“ªäº›ç¼“å­˜æ¡ç›®åº”è¯¥è¢«ç§»é™¤æ‰</p>
<table>
<thead>
<tr>
<th>å±ã€€ã€€æ€§</th>
<th>ç±»ã€€ã€€å‹</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>String []</td>
<td>è¦ä½¿ç”¨çš„ç¼“å­˜åç§°</td>
</tr>
<tr>
<td>key</td>
<td>String</td>
<td>SpELè¡¨è¾¾å¼ï¼Œç”¨æ¥è®¡ç®—è‡ªå®šä¹‰çš„ç¼“å­˜key</td>
</tr>
<tr>
<td>condition</td>
<td>String</td>
<td>SpELè¡¨è¾¾å¼ï¼Œå¦‚æœå¾—åˆ°çš„å€¼æ˜¯falseçš„è¯ï¼Œç¼“å­˜ä¸ä¼šåº”ç”¨åˆ°æ–¹æ³•è°ƒç”¨ä¸Š</td>
</tr>
<tr>
<td>allEntries</td>
<td>boolean</td>
<td>å¦‚æœä¸ºtrueçš„è¯ï¼Œç‰¹å®šç¼“å­˜çš„æ‰€æœ‰æ¡ç›®éƒ½ä¼šè¢«ç§»é™¤æ‰</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>boolean</td>
<td>å¦‚æœä¸ºtrueçš„è¯ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰ç§»é™¤æ¡ç›®ã€‚å¦‚æœä¸º falseï¼ˆé»˜è®¤å€¼ï¼‰çš„è¯ï¼Œåœ¨æ–¹æ³•æˆåŠŸè°ƒç”¨ä¹‹åå†ç§»é™¤æ¡ç›®</td>
</tr>
</tbody>
</table>
<h2 id="ä½¿ç”¨XMLå£°æ˜ç¼“å­˜">ä½¿ç”¨XMLå£°æ˜ç¼“å­˜</h2>
<p>ä½ å¯èƒ½æƒ³è¦çŸ¥é“ä¸ºä»€ä¹ˆæƒ³è¦ä»¥XMLçš„æ–¹å¼å£°æ˜ç¼“å­˜ã€‚æ¯•ç«Ÿï¼Œæœ¬ç« ä¸­æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç¼“å­˜æ³¨è§£è¦ä¼˜é›…å¾—å¤šã€‚</p>
<p>æˆ‘è®¤ä¸ºæœ‰ä¸¤ä¸ªåŸå› ï¼š</p>
<ul>
<li>ä½ å¯èƒ½ä¼šè§‰å¾—åœ¨è‡ªå·±çš„æºç ä¸­æ·»åŠ Springçš„æ³¨è§£æœ‰ç‚¹ä¸å¤ªèˆ’æœï¼›</li>
<li>ä½ éœ€è¦åœ¨æ²¡æœ‰æºç çš„beanä¸Šåº”ç”¨ç¼“å­˜åŠŸèƒ½ã€‚</li>
</ul>
<p>åœ¨ä¸Šé¢çš„ä»»æ„ä¸€ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ï¼ˆæˆ–è€…è¯´éœ€è¦ï¼‰å°†ç¼“å­˜é…ç½®ä¸ç¼“å­˜æ•°æ®çš„ä»£ç åˆ†éš”å¼€æ¥ã€‚Springçš„cacheå‘½åç©ºé—´æä¾›äº†ä½¿ç”¨XMLå£°æ˜ç¼“å­˜è§„åˆ™çš„æ–¹æ³•ï¼Œå¯ä»¥ä½œä¸ºé¢å‘æ³¨è§£ç¼“å­˜çš„æ›¿ä»£æ–¹æ¡ˆã€‚å› ä¸ºç¼“å­˜æ˜¯ä¸€ç§é¢å‘åˆ‡é¢çš„è¡Œä¸ºï¼Œæ‰€ä»¥cacheå‘½åç©ºé—´ä¼šä¸Springçš„aopå‘½åç©ºé—´ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œç”¨æ¥å£°æ˜ç¼“å­˜æ‰€åº”ç”¨çš„åˆ‡ç‚¹åœ¨å“ªé‡Œã€‚</p>
<p>è¦å¼€å§‹é…ç½®XMLå£°æ˜çš„ç¼“å­˜ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºSpringé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­è¦åŒ…å«cache å’Œ aopå‘½åç©ºé—´ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Caching configuration will go here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>cacheå‘½åç©ºé—´å®šä¹‰äº†åœ¨Spring XMLé…ç½®æ–‡ä»¶ä¸­å£°æ˜ç¼“å­˜çš„é…ç½®å…ƒç´ ã€‚è¡¨13.5åˆ—å‡ºäº†cacheå‘½åç©ºé—´æ‰€æä¾›çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<table>
<thead>
<tr>
<th>å…ƒç´ </th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;cache:annotation-driven&gt;</td>
<td>å¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚ç­‰åŒäºJavaé…ç½®ä¸­çš„ @EnableCaching</td>
</tr>
<tr>
<td>&lt;cache:advice&gt;</td>
<td>å®šä¹‰ç¼“å­˜é€šçŸ¥ï¼ˆadviceï¼‰ã€‚ç»“åˆ &lt;aop:advisor&gt;ï¼Œå°†é€šçŸ¥åº”ç”¨åˆ°åˆ‡ç‚¹ä¸Š</td>
</tr>
<tr>
<td>&lt;cache:caching&gt;</td>
<td>åœ¨ç¼“å­˜é€šçŸ¥ä¸­ï¼Œå®šä¹‰ä¸€ç»„ç‰¹å®šçš„ç¼“å­˜è§„åˆ™</td>
</tr>
<tr>
<td>&lt;cache:cacheable&gt;</td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦è¿›è¡Œç¼“å­˜ã€‚ç­‰åŒäº @Cacheable æ³¨è§£</td>
</tr>
<tr>
<td>&lt;cache:cache-put&gt;</td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦å¡«å……ç¼“å­˜ï¼Œä½†ä¸ä¼šè€ƒè™‘ç¼“å­˜ä¸­æ˜¯å¦å·²æœ‰åŒ¹é…çš„å€¼ã€‚ç­‰åŒäº @CachePut æ³¨è§£</td>
</tr>
<tr>
<td>&lt;cache:cache-evict&gt;</td>
<td>æŒ‡æ˜æŸä¸ªæ–¹æ³•è¦ä»ç¼“å­˜ä¸­ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ï¼Œç­‰åŒäº @CacheEvict æ³¨è§£</td>
</tr>
</tbody>
</table>
<p>&lt;cache:annotation-driven&gt;å…ƒç´ ä¸Javaé…ç½®ä¸­æ‰€å¯¹åº”çš„@EnableCachingéå¸¸ç±»ä¼¼ï¼Œä¼šå¯ç”¨æ³¨è§£é©±åŠ¨çš„ç¼“å­˜ã€‚æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡è¿™ç§é£æ ¼çš„ç¼“å­˜ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦å†å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚</p>
<p>è¡¨13.5ä¸­å…¶ä»–çš„å…ƒç´ éƒ½ç”¨äºåŸºäºXMLçš„ç¼“å­˜é…ç½®ã€‚æ¥ä¸‹æ¥çš„ä»£ç æ¸…å•å±•ç°äº†å¦‚ä½•ä½¿ç”¨è¿™äº›å…ƒç´ ä¸ºSpittleRepositorybeané…ç½®ç¼“å­˜ï¼Œå…¶ä½œç”¨ç­‰åŒäºæœ¬ç« å‰é¢ç« ä½¿ç”¨ç¼“å­˜æ³¨è§£çš„æ–¹å¼ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:cache</span>=<span class="string">&quot;http://www.springframework.org/schema/cache&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>	</span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;cacheAdvice&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">pointcut</span>=</span></span><br><span class="line"><span class="tag">          &quot;<span class="attr">execution</span>(* <span class="attr">com.habuma.spittr.db.SpittleRepository.</span>*(<span class="attr">..</span>))&quot;/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:advice</span> <span class="attr">id</span>=<span class="string">&quot;cacheAdvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:caching</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">cache:cacheable</span>	</span></span><br><span class="line"><span class="tag">          <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">&quot;findRecent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">cache:cacheable</span>	</span></span><br><span class="line"><span class="tag">           <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span>         <span class="attr">method</span>=<span class="string">&quot;findOne&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">cache:cacheable</span>	</span></span><br><span class="line"><span class="tag">          <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">&quot;findBySpitterId&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">cache:cache-put</span>	</span></span><br><span class="line"><span class="tag">          <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">&quot;save&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">key</span>=<span class="string">&quot;#result.id&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">cache:cache-evict</span>	</span></span><br><span class="line"><span class="tag">          <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">method</span>=<span class="string">&quot;remove&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache:caching</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cache:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cacheManager&quot;</span> <span class="attr">class</span>=</span></span><br><span class="line"><span class="tag">      &quot;<span class="attr">org.springframework.cache.concurrent.ConcurrentMapCacheManager</span>&quot;</span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ç¨‹åºæ¸…å•13.7ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆçœ‹åˆ°çš„æ˜¯&lt;aop:advisor&gt;ï¼Œå®ƒå¼•ç”¨IDä¸ºcacheAdviceçš„é€šçŸ¥ï¼Œè¯¥å…ƒç´ å°†è¿™ä¸ªé€šçŸ¥ä¸ä¸€ä¸ªåˆ‡ç‚¹è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„åˆ‡é¢ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªåˆ‡é¢çš„åˆ‡ç‚¹ä¼šåœ¨æ‰§è¡ŒSpittleRepositoryçš„ä»»æ„æ–¹æ³•æ—¶è§¦å‘ã€‚å¦‚æœè¿™æ ·çš„æ–¹æ³•è¢«Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ä»»æ„æŸä¸ªbeanæ‰€è°ƒç”¨ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨åˆ‡é¢çš„é€šçŸ¥ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œé€šçŸ¥åˆ©ç”¨&lt;cache:advice&gt;å…ƒç´ è¿›è¡Œäº†å£°æ˜ã€‚åœ¨&lt;cache:advice&gt;å…ƒç´ ä¸­ï¼Œå¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„&lt;cache:caching&gt;å…ƒç´ ï¼Œè¿™äº›å…ƒç´ ç”¨æ¥å®Œæ•´åœ°å®šä¹‰åº”ç”¨çš„ç¼“å­˜è§„åˆ™ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒåªåŒ…å«äº†ä¸€ä¸ª&lt;cache:caching&gt;å…ƒç´ ã€‚è¿™ä¸ªå…ƒç´ åˆåŒ…å«äº†ä¸‰ä¸ª&lt;cache:cacheable&gt;å…ƒç´ å’Œä¸€ä¸ª&lt;cache:cache-put&gt; å…ƒç´ ã€‚</p>
<p>æ¯ä¸ª &lt;cache:cacheable&gt;å…ƒç´ éƒ½å£°æ˜äº†åˆ‡ç‚¹ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•æ˜¯æ”¯æŒç¼“å­˜çš„ã€‚è¿™æ˜¯ä¸@Cacheableæ³¨è§£åŒç­‰ä½œç”¨çš„XMLå…ƒç´ ã€‚å…·ä½“æ¥è®²ï¼ŒfindRecent() ã€ findOne() å’Œ findBySpitterId()éƒ½å£°æ˜ä¸ºæ”¯æŒç¼“å­˜ï¼Œå®ƒä»¬çš„è¿”å›å€¼å°†ä¼šä¿å­˜åœ¨åä¸ºspittleCacheçš„ç¼“å­˜ä¹‹ä¸­ã€‚</p>
<p>&lt;cache:cache-put&gt;æ˜¯Spring XMLä¸­ä¸@CachePutæ³¨è§£åŒç­‰ä½œç”¨çš„å…ƒç´ ã€‚å®ƒè¡¨æ˜ä¸€ä¸ªæ–¹æ³•çš„è¿”å›å€¼è¦å¡«å……åˆ°ç¼“å­˜ä¹‹ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ¬èº«å¹¶ä¸ä¼šä»ç¼“å­˜ä¸­è·å–è¿”å›å€¼ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œsave()æ–¹æ³•ç”¨æ¥å¡«å……ç¼“å­˜ã€‚åŒé¢å‘æ³¨è§£çš„ç¼“å­˜ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦å°†é»˜è®¤çš„keyæ”¹ä¸ºè¿”å›Spittle å¯¹è±¡çš„ id å±æ€§ã€‚</p>
<p>æœ€åï¼Œ &lt;cache:cache-evict&gt;å…ƒç´ æ˜¯Spring XMLä¸­ç”¨æ¥æ›¿ä»£@CacheEvictæ³¨è§£çš„ã€‚å®ƒä¼šä»ç¼“å­˜ä¸­ç§»é™¤å…ƒç´ ï¼Œè¿™æ ·çš„è¯ï¼Œä¸‹æ¬¡æœ‰äººè¿›è¡ŒæŸ¥æ‰¾çš„æ—¶å€™å°±æ‰¾ä¸åˆ°äº†ã€‚åœ¨è¿™é‡Œï¼Œè°ƒç”¨remove()æ—¶ï¼Œä¼šå°†ç¼“å­˜ä¸­çš„Spittleåˆ é™¤æ‰ï¼Œå…¶ä¸­keyä¸remove()æ–¹æ³•æ‰€ä¼ é€’è¿›æ¥çš„IDå‚æ•°ç›¸ç­‰çš„æ¡ç›®ä¼šä»ç¼“å­˜ä¸­ç§»é™¤ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;cache:advice&gt;å…ƒç´ æœ‰ä¸€ä¸ªcache-managerå…ƒç´ ï¼Œç”¨æ¥æŒ‡å®šä½œä¸ºç¼“å­˜ç®¡ç†å™¨çš„beanã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯cacheManagerï¼Œè¿™ä¸ç¨‹åºæ¸…å•13.7åº•éƒ¨çš„<bean>å£°æ˜æ°å¥½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å†æ˜¾å¼åœ°è¿›è¡Œè®¾ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¼“å­˜ç®¡ç†å™¨çš„IDä¸ä¹‹ä¸åŒçš„è¯ï¼ˆä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®cache-managerå±æ€§æŒ‡å®šè¦ä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ&lt;cache:advice&gt;å…ƒç´ æœ‰ä¸€ä¸ªcache-managerå…ƒç´ ï¼Œç”¨æ¥æŒ‡å®šä½œä¸ºç¼“å­˜ç®¡ç†å™¨çš„beanã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯cacheManagerï¼Œè¿™ä¸ç¨‹åºæ¸…å•13.7åº•éƒ¨çš„<bean>å£°æ˜æ°å¥½æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥æ²¡æœ‰å¿…è¦å†æ˜¾å¼åœ°è¿›è¡Œè®¾ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¼“å­˜ç®¡ç†å™¨çš„IDä¸ä¹‹ä¸åŒçš„è¯ï¼ˆä½¿ç”¨å¤šä¸ªç¼“å­˜ç®¡ç†å™¨çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®cache-managerå±æ€§æŒ‡å®šè¦ä½¿ç”¨å“ªä¸ªç¼“å­˜ç®¡ç†å™¨ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜è¦ç•™æ„çš„æ˜¯ï¼Œ&lt;cache:cacheable&gt; ã€ &lt;cache:cache-put&gt; å’Œ &lt;cache:cache-evict&gt;å…ƒç´ éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªåä¸ºspittleCacheçš„ç¼“å­˜ã€‚ä¸ºäº†æ¶ˆé™¤è¿™ç§é‡å¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨&lt;cache:caching&gt;å…ƒç´ ä¸ŠæŒ‡æ˜ç¼“å­˜çš„åå­—ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache:advice</span> <span class="attr">id</span>=<span class="string">&quot;cacheAdvice&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">cache:caching</span> <span class="attr">cache</span>=<span class="string">&quot;spittleCache&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findRecent&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findOne&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:cacheable</span> <span class="attr">method</span>=<span class="string">&quot;findBySpitterId&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:cache-put</span></span></span><br><span class="line"><span class="tag">        <span class="attr">method</span>=<span class="string">&quot;save&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">key</span>=<span class="string">&quot;#result.id&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache:cache-evict</span> <span class="attr">method</span>=<span class="string">&quot;remove&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">cache:caching</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cache:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&lt;cache:caching&gt;æœ‰å‡ ä¸ªå¯ä»¥ä¾›&lt;cache:cacheable&gt; ã€ &lt;cache:cache-put&gt; å’Œ &lt;cache:cache-evict&gt;å…±äº«çš„å±æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>cacheï¼šæŒ‡æ˜è¦å­˜å‚¨å’Œè·å–å€¼çš„ç¼“å­˜ï¼›</li>
<li>conditionï¼šSpELè¡¨è¾¾å¼ï¼Œå¦‚æœè®¡ç®—å¾—åˆ°çš„å€¼ä¸ºfalseï¼Œå°†ä¼šä¸ºè¿™ä¸ªæ–¹æ³•ç¦ç”¨ç¼“å­˜ï¼›</li>
<li>keyï¼šSpELè¡¨è¾¾å¼ï¼Œç”¨æ¥å¾—åˆ°ç¼“å­˜çš„keyï¼ˆé»˜è®¤ä¸ºæ–¹æ³•çš„å‚æ•°ï¼‰ï¼›</li>
<li>methodï¼šè¦ç¼“å­˜çš„æ–¹æ³•åã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œ&lt;cache:cacheable&gt; å’Œ &lt;cache:cache-put&gt; è¿˜æœ‰ä¸€ä¸ª unlesså±æ€§ï¼Œå¯ä»¥ä¸ºè¿™ä¸ªå¯é€‰çš„å±æ€§æŒ‡å®šä¸€ä¸ªSpELè¡¨è¾¾å¼ï¼Œå¦‚æœè¿™ä¸ªè¡¨è¾¾å¼çš„è®¡ç®—ç»“æœä¸ºtrueï¼Œé‚£ä¹ˆå°†ä¼šé˜»æ­¢å°†è¿”å›å€¼æ”¾åˆ°ç¼“å­˜ä¹‹ä¸­ã€‚</p>
<p>&lt;cache:cache-evict&gt;å…ƒç´ è¿˜æœ‰å‡ ä¸ªç‰¹æœ‰çš„å±æ€§ï¼š</p>
<ul>
<li>all-entries ï¼šå¦‚æœæ˜¯ trueçš„è¯ï¼Œç¼“å­˜ä¸­æ‰€æœ‰çš„æ¡ç›®éƒ½ä¼šè¢«ç§»é™¤æ‰ã€‚å¦‚æœæ˜¯falseçš„è¯ï¼Œåªæœ‰åŒ¹é…keyçš„æ¡ç›®æ‰ä¼šè¢«ç§»é™¤æ‰ã€‚</li>
<li>before-invocation ï¼šå¦‚æœæ˜¯ trueçš„è¯ï¼Œç¼“å­˜æ¡ç›®å°†ä¼šåœ¨æ–¹æ³•è°ƒç”¨ä¹‹å‰è¢«ç§»é™¤æ‰ã€‚å¦‚æœæ˜¯falseçš„è¯ï¼Œæ–¹æ³•è°ƒç”¨ä¹‹åæ‰ä¼šç§»é™¤ç¼“å­˜ã€‚</li>
</ul>
<p>all-entries å’Œ before-invocationçš„é»˜è®¤å€¼éƒ½æ˜¯falseã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨&lt;cache:cache-evict&gt;å…ƒç´ ä¸”ä¸é…ç½®è¿™ä¸¤ä¸ªå±æ€§æ—¶ï¼Œä¼šåœ¨æ–¹æ³•è°ƒç”¨å®Œæˆååªåˆ é™¤ä¸€ä¸ªç¼“å­˜æ¡ç›®ã€‚è¦åˆ é™¤çš„æ¡ç›®ä¼šé€šè¿‡é»˜è®¤çš„keyï¼ˆåŸºäºæ–¹æ³•çš„å‚æ•°ï¼‰è¿›è¡Œè¯†åˆ«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡ä¸ºåä¸ºkeyçš„å±æ€§è®¾ç½®ä¸€ä¸ªSpELè¡¨è¾¾å¼æŒ‡å®šè¦åˆ é™¤çš„keyã€‚</p>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>è™šæ‹Ÿæœºçš„ç½‘ç»œ</title>
    <url>/2020/09/09/%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%9A%84%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<h2 id="åˆ†ç±»">åˆ†ç±»</h2>
<p>è™šæ‹Ÿæœºçš„ç½‘ç»œåˆ†å¥½å‡ ç§ğŸ’¬</p>
<p>ç°åœ¨æˆ‘åªå…³æ³¨ä¸¤ç§å¯ä»¥ä¸Šç½‘çš„æ¨¡å¼ï¼š<span class="ljspan ljspan-blue">æ¡¥æ¥ç½‘ç»œ</span>ã€<span class="ljspan ljspan-red">ç½‘ç»œåœ°å€è½¬æ¢NAT</span>;</p>
<p>è¿™ä¸¤ç§éƒ½èƒ½å¤Ÿå®ç°ç½‘ç»œåŠŸèƒ½ï¼Œå…·ä½“è®²ä¸€è®²ğŸ˜ƒ</p>
<a id="more"></a>
<p>æ¡¥æ¥ç½‘ç»œï¼šå…¶å®å°±æ˜¯ç»™ä½ çš„è™šæ‹Ÿæœºåˆ†é…ä¸€ä¸ª<span class="label info">å±€åŸŸç½‘</span>åœ°å€ï¼Œä¸€ä¸ªç‹¬ç«‹çš„å±€åŸŸç½‘</p>
<p>ç½‘ç»œåœ°å€è½¬æ¢NAT:å…¶å®æ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œåœ°å€ï¼Œä¸å­˜åœ¨çš„ï¼Œä»–çš„å®é™…ç½‘ç»œåœ°å€æ˜¯ä½ çš„<span class="label success">ç”µè„‘ä¸»æœºIP</span>,ä¹Ÿå°±æ˜¯ä¸»æœºçš„å±€åŸŸç½‘åœ°å€</p>
<p>ğŸ’¥æ•…åœ¨è®¾ç½®è·¯ç”±IPç«¯å£è½¬æ¢çš„æ—¶å€™ï¼Œå°±æœ‰ä¸åŒç‚¹äº†</p>
<ol>
<li>
<p>æ¡¥æ¥ç½‘ç»œï¼šç®€å•ï¼Œç›´æ¥æŠŠä»–çš„IPåœ°å€å’Œç«¯å£åœ¨è·¯ç”±ä¸Šæ˜ å°„å°±å¯ä»¥äº†</p>
</li>
<li>
<p>ç½‘ç»œåœ°å€è½¬æ¢NAT:</p>
<ul>
<li>
<p>åœ¨è¿™å°è™šæ‹Ÿæœºçš„ç½‘ç»œè®¾ç½®ä¸­è®¾ç½®ç«¯å£è½¬å‘åˆ°ä½ çš„ä¸»æœºç«¯å£</p>
</li>
<li>
<p>å†æŠŠåˆšåˆšçš„è®¾ç½®çš„ä¸»æœºç«¯å£åœ¨è·¯ç”±å™¨æ˜ å°„å°±å¯ä»¥äº†</p>
</li>
</ul>
</li>
</ol>
<div class="note info">
            <p>Noteï¼šç½‘ç»œåœ°å€è½¬æ¢æ¯”æ¡¥æ¥åœ°å€å¤šäº†ä¸€å±‚ç«¯å£çš„æ˜ å°„</p>
          </div>
<hr>
<h2 id="ç¤ºä¾‹ï¼šç½‘ç»œåœ°å€è½¬æ¢NAT">ç¤ºä¾‹ï¼šç½‘ç»œåœ°å€è½¬æ¢NAT</h2>
<blockquote>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯VM virtualBox</p>
</blockquote>
<h4 id="æ­¥éª¤1ï¼šæ‰“å¼€ä»»æ„ä¸€å°è™šæ‹Ÿæœºâ€“è®¾ç½®â€“ç½‘ç»œ">æ­¥éª¤1ï¼šæ‰“å¼€ä»»æ„ä¸€å°è™šæ‹Ÿæœºâ€“è®¾ç½®â€“ç½‘ç»œ</h4>
<p><img src="/assets/img/%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C1.png" alt=""></p>
<h4 id="æ­¥éª¤2ï¼šç‚¹å‡»é«˜çº§â€“ç«¯å£è½¬å‘">æ­¥éª¤2ï¼šç‚¹å‡»é«˜çº§â€“ç«¯å£è½¬å‘</h4>
<p><img src="/assets/img/%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C2.png" alt=""></p>
<h4 id="æ­¥éª¤3ï¼šåœ¨ç«¯å£è½¬å‘è§„åˆ™è¿™é‡Œå°±å¯ä»¥è®¾ç½®ç«¯å£çš„è½¬å‘åˆ°ä¸»æœºä¸Šå•¦">æ­¥éª¤3ï¼šåœ¨ç«¯å£è½¬å‘è§„åˆ™è¿™é‡Œå°±å¯ä»¥è®¾ç½®ç«¯å£çš„è½¬å‘åˆ°ä¸»æœºä¸Šå•¦</h4>
<p><img src="/assets/img/%E9%85%8D%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E7%BB%9C3.png" alt=""></p>
]]></content>
      <categories>
        <category>network</category>
      </categories>
      <tags>
        <tag>network</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¨‹åºå¯åŠ¨çš„æ–¹æ³•</title>
    <url>/2020/09/21/%E7%A8%8B%E5%BA%8F%E5%90%AF%E5%8A%A8%E7%9A%84%E6%96%B9%E6%B3%95/</url>
    <content><![CDATA[<p>å¯åŠ¨å…³é—­apacheã€mysqlç­‰æ—¶ï¼Œç½‘å‹æœ‰æ—¶å€™ç”¨ <span class="ljspan ljspan-reverse ljspan-blue">systemctl</span>æœ‰æ—¶å€™å´ç”¨ <span class="ljspan ljspan-reverse ljspan-red">service</span>ï¼Œæˆ‘è§‰å¾—å¾ˆå¥‡æ€ªï¼Œç”šè‡³è¿˜æœ‰ç”¨<code>/etc/init.d/xxx start</code>çš„</p>
<p>æ‰€ä»¥æˆ‘è§‰å¾—æœ‰å¿…è¦è¿›è¡Œäº†è§£å’Œè®¤è¯†è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ã€‚</p>
<a id="more"></a>
<p>å…¶å®ä»–ä»¬éƒ½å±äºæŸç§å¼€å¯å¯åŠ¨æ–¹å¼ã€‚<span class="ljspan ljspan-blue">systemd</span>å’Œ <span class="ljspan ljspan-red">systemV</span>çŸ¥é“å§ï¼Œå…¶å®å°±æ˜¯è¿™ç§å¯åŠ¨æ–¹å¼çš„ä¸åŒè€Œå·²ï¼Œå¬è¿‡è¿˜æœ‰ä¸€ç§ <span class="ljspan ljspan-green">UpStart</span>çš„ï¼Œå“¥ä¸æ¸…æ¥šï¼Œä¹Ÿæ²¡å…´è¶£ï¼Œç­‰æ¥è§¦è¿‡å†è¯´å§ï¼Œè¿™ä¸¤ä¸ªå°±å¤Ÿæˆ‘çœ‹çš„äº†</p>
<p>å…³äº <span class="ljspan ljspan-blue">systemd</span>ã€<span class="ljspan ljspan-red">sysvinit</span>å’Œ <span class="ljspan ljspan-green">UpStart</span>çš„è¯¦ç»†è¯´æ˜ï¼Œå¯å‚è€ƒå¦‚ä¸‹æ–‡ç« </p>
<ol>
<li>
<p><a href="https://linux.cn/article-4422-1.html">æµ…æ Linux åˆå§‹åŒ– init ç³»ç»Ÿ: sysvinit</a></p>
</li>
<li>
<p><a href="https://linux.cn/article-4423-1.html">æµ…æ Linux åˆå§‹åŒ– init ç³»ç»Ÿ: UpStart</a></p>
</li>
<li>
<p><a href="https://linux.cn/article-4424-1.html">æµ…æ Linux åˆå§‹åŒ– init ç³»ç»Ÿ: Systemd</a></p>
</li>
</ol>
<hr>
<h2 id="systemctl">systemctl</h2>
<p>è¿™æ˜¯å±äº <span class="ljspan ljspan-blue">systemd</span>çš„å¼€æœºæ–¹å¼</p>
<h3 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨-mariadb">è®¾ç½®å¼€æœºè‡ªå¯åŠ¨(mariadb)</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‰æï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">#RHEL,Centos,Fedoraç­‰ç³»ç»Ÿ</span></span><br><span class="line"><span class="comment">#mariadb.serviceè¢«å®‰è£…åˆ°/usr/lib/systemd/system/mariadb.service</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Ubuntu,Debianç³»ç»Ÿ</span></span><br><span class="line">mariadb.serviceè¢«å®‰è£…åˆ°/lib/systemd/system/mariadb.service</span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> mariadb</span><br></pre></td></tr></table></figure>
<h3 id="å¸¸ç”¨å‘½ä»¤æ–¹å¼">å¸¸ç”¨å‘½ä»¤æ–¹å¼</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sudo systemctl start mariadb</span><br><span class="line"></span><br><span class="line">sudo systemctl stop mariadb</span><br><span class="line"></span><br><span class="line">systemctl status mariadb</span><br><span class="line"></span><br><span class="line">systemctl restart mariadb</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="service">service</h2>
<p>è¿™æ˜¯å±äº <span class="ljspan ljspan-red">systemV</span>çš„å¼€æœºæ–¹å¼</p>
<h3 id="è®¾ç½®å¼€æœºè‡ªå¯åŠ¨-mariadb-2">è®¾ç½®å¼€æœºè‡ªå¯åŠ¨(mariadb)</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å‰æï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">#mysql.serverè¢«å®‰è£…åˆ°/etc/init.d/mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨RHEL/Centosä¸Š</span></span><br><span class="line">chkconfig --add mysql</span><br><span class="line"></span><br><span class="line"><span class="comment">#è®¾ç½®runlevel</span></span><br><span class="line">chkconfig --level 345 mysql on</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#åœ¨Debian/Ubuntuä¸Š</span></span><br><span class="line">update-rc.d mysql defaults</span><br></pre></td></tr></table></figure>
<h3 id="è½¯ä»¶å¸¸ç”¨å‘½ä»¤æ–¹å¼">è½¯ä»¶å¸¸ç”¨å‘½ä»¤æ–¹å¼</h3>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">service xxx start </span><br><span class="line"></span><br><span class="line">service xxx stop</span><br><span class="line"></span><br><span class="line">service xxx status</span><br><span class="line"></span><br><span class="line">service xxx restart </span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
  </entry>
  <entry>
    <title>Spring-å¯¹è±¡å…³ç³»æ˜ å°„æŒä¹…åŒ–æ•°æ®</title>
    <url>/2020/11/24/Spring-%E5%AF%B9%E8%B1%A1%E5%85%B3%E7%B3%BB%E6%98%A0%E5%B0%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE/</url>
    <content><![CDATA[<p><strong>å¯¹è±¡â€“å…³ç³»æ˜ å°„</strong>å°±æ˜¯å¤§å®¶æ‰€è¯´çš„ORM</p>
<p>è¿™é¡¹æŠ€æœ¯å…·ä½“åŠŸèƒ½å°±æ˜¯å°†å¯¹è±¡çš„å±æ€§æ˜ å°„åˆ°æ•°æ®åº“çš„åˆ—ä¸Šï¼Œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆè¯­å¥å’ŒæŸ¥è¯¢ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ä»æ— ä¼‘æ­¢çš„é—®å·å­—ç¬¦ä¸²ä¸­è§£è„±å‡ºæ¥ã€‚<a id="more"></a></p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›æ›´å¤æ‚çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>å»¶è¿ŸåŠ è½½ï¼ˆLazy loadingï¼‰ï¼šéšç€æˆ‘ä»¬çš„å¯¹è±¡å…³ç³»å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¹¶ä¸å¸Œæœ›ç«‹å³è·å–å®Œæ•´çš„å¯¹è±¡é—´å…³ç³»ã€‚ä¸¾ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸€ç»„PurchaseOrderå¯¹è±¡ï¼Œè€Œæ¯ä¸ªå¯¹è±¡ä¸­éƒ½åŒ…å«ä¸€ä¸ªLineItemå¯¹è±¡é›†åˆã€‚å¦‚æœæˆ‘ä»¬åªå…³å¿ƒPurchaseOrderçš„å±æ€§ï¼Œé‚£æŸ¥è¯¢å‡ºLineItemçš„æ•°æ®å°±æ¯«æ— æ„ä¹‰ã€‚è€Œä¸”è¿™å¯èƒ½æ˜¯å¼€é”€å¾ˆå¤§çš„æ“ä½œã€‚å»¶è¿ŸåŠ è½½å…è®¸æˆ‘ä»¬åªåœ¨éœ€è¦çš„æ—¶å€™è·å–æ•°æ®ã€‚</li>
<li>é¢„å…ˆæŠ“å–ï¼ˆEager fetchingï¼‰ï¼šè¿™ä¸å»¶è¿ŸåŠ è½½æ˜¯ç›¸å¯¹çš„ã€‚å€ŸåŠ©äºé¢„å…ˆæŠ“å–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŸ¥è¯¢è·å–å®Œæ•´çš„å…³è”å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦PurchaseOrderåŠå…¶å…³è”çš„LineItemå¯¹è±¡ï¼Œé¢„å…ˆæŠ“å–çš„åŠŸèƒ½å¯ä»¥åœ¨ä¸€ä¸ªæ“ä½œä¸­å°†å®ƒä»¬å…¨éƒ¨ä»æ•°æ®åº“ä¸­å–å‡ºæ¥ï¼ŒèŠ‚çœäº†å¤šæ¬¡æŸ¥è¯¢çš„æˆæœ¬ã€‚</li>
<li>çº§è”ï¼ˆ Cascadingï¼‰ï¼šæœ‰æ—¶ï¼Œæ›´æ”¹æ•°æ®åº“ä¸­çš„è¡¨ä¼šåŒæ—¶ä¿®æ”¹å…¶ä»–è¡¨ã€‚å›åˆ°æˆ‘ä»¬è®¢è´­å•çš„ä¾‹å­ä¸­ï¼Œå½“åˆ é™¤Orderå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åŒæ—¶åœ¨æ•°æ®åº“ä¸­åˆ é™¤å…³è”çš„LineItem ã€‚</li>
</ul>
<p>ä¸€äº›å¯ç”¨çš„æ¡†æ¶æä¾›äº†è¿™æ ·çš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡çš„é€šç”¨åç§°æ˜¯å¯¹è±¡/å…³ç³»æ˜ å°„ï¼ˆobject-relational mappingï¼ŒORMï¼‰ã€‚åœ¨æŒä¹…å±‚ä½¿ç”¨ORMå·¥å…·ï¼Œå¯ä»¥èŠ‚çœæ•°åƒè¡Œçš„ä»£ç å’Œå¤§é‡çš„å¼€å‘æ—¶é—´ã€‚ORMå·¥å…·èƒ½å¤ŸæŠŠä½ çš„æ³¨æ„åŠ›ä»å®¹æ˜“å‡ºé”™çš„SQLä»£ç è½¬å‘å¦‚ä½•å®ç°åº”ç”¨ç¨‹åºçš„çœŸæ­£éœ€æ±‚ã€‚</p>
<p>Springå¯¹å¤šä¸ªæŒä¹…åŒ–æ¡†æ¶éƒ½æä¾›äº†æ”¯æŒï¼ŒåŒ…æ‹¬Hibernateã€iBATISã€Javaæ•°æ®å¯¹è±¡ï¼ˆJava Data Objectsï¼ŒJDOï¼‰ä»¥åŠJavaæŒä¹…åŒ–APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰ã€‚ä¸Springå¯¹JDBCçš„æ”¯æŒé‚£æ ·ï¼ŒSpringå¯¹ORMæ¡†æ¶çš„æ”¯æŒæä¾›äº†ä¸è¿™äº›æ¡†æ¶çš„é›†æˆç‚¹ä»¥åŠä¸€äº›é™„åŠ çš„æœåŠ¡ï¼š</p>
<ul>
<li>æ”¯æŒé›†æˆSpringå£°æ˜å¼äº‹åŠ¡ï¼›</li>
<li>é€æ˜çš„å¼‚å¸¸å¤„ç†ï¼›</li>
<li>çº¿ç¨‹å®‰å…¨çš„ã€è½»é‡çº§çš„æ¨¡æ¿ç±»ï¼›</li>
<li>DAOæ”¯æŒç±»ï¼›</li>
<li>èµ„æºç®¡ç†ã€‚</li>
</ul>
<p>æœ¬ç« æ²¡æœ‰è¶³å¤Ÿçš„ç¯‡å¹…ä»‹ç»Springæ”¯æŒçš„å…¨éƒ¨ORMæ¡†æ¶ã€‚å…¶å®è¿™å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºSpringå¯¹ä¸åŒORMè§£å†³æ–¹æ¡ˆçš„æ”¯æŒæ˜¯å¾ˆç›¸ä¼¼çš„ã€‚ä¸€æ—¦æŒæ¡äº†Springå¯¹æŸç§ORMæ¡†æ¶çš„æ”¯æŒåï¼Œä½ å¯ä»¥è½»æ¾åœ°åˆ‡æ¢åˆ°å¦ä¸€ä¸ªæ¡†æ¶ã€‚</p>
<h2 id="åœ¨Springä¸­é›†æˆHibernate">åœ¨Springä¸­é›†æˆHibernate</h2>
<p>Hibernateæ˜¯åœ¨å¼€å‘è€…ç¤¾åŒºå¾ˆæµè¡Œçš„å¼€æºæŒä¹…åŒ–æ¡†æ¶ã€‚å®ƒä¸ä»…æä¾›äº†åŸºæœ¬çš„å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œè¿˜æä¾›äº†ORMå·¥å…·æ‰€åº”å…·æœ‰çš„æ‰€æœ‰å¤æ‚åŠŸèƒ½ï¼Œæ¯”å¦‚ç¼“å­˜ã€å»¶è¿ŸåŠ è½½ã€é¢„å…ˆæŠ“å–ä»¥åŠåˆ†å¸ƒå¼ç¼“å­˜ã€‚</p>
<p>ä½¿ç”¨Hibernateæ‰€éœ€çš„ä¸»è¦æ¥å£æ˜¯org.hibernate.Session ã€‚ Sessionæ¥å£æä¾›äº†åŸºæœ¬çš„æ•°æ®è®¿é—®åŠŸèƒ½ï¼Œå¦‚ä¿å­˜ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠä»æ•°æ®åº“åŠ è½½å¯¹è±¡çš„åŠŸèƒ½ã€‚é€šè¿‡Hibernateçš„Sessionæ¥å£ï¼Œåº”ç”¨ç¨‹åºçš„Repositoryèƒ½å¤Ÿæ»¡è¶³æ‰€æœ‰çš„æŒä¹…åŒ–éœ€æ±‚ã€‚</p>
<p>è·å–Hibernate Sessionå¯¹è±¡çš„æ ‡å‡†æ–¹å¼æ˜¯å€ŸåŠ©äºHibernate SessionFactoryæ¥å£çš„å®ç°ç±»ã€‚é™¤äº†ä¸€äº›å…¶ä»–çš„ä»»åŠ¡ï¼ŒSessionFactoryä¸»è¦è´Ÿè´£Hibernate Sessionçš„æ‰“å¼€ã€å…³é—­ä»¥åŠç®¡ç†ã€‚</p>
<p>åœ¨Springä¸­ï¼Œæˆ‘ä»¬è¦é€šè¿‡Springçš„æŸä¸€ä¸ªHibernate Sessionå·¥å‚beanæ¥è·å–Hibernate SessionFactoryã€‚ä»3.1ç‰ˆæœ¬å¼€å§‹ï¼ŒSpringæä¾›äº†ä¸‰ä¸ªSessionå·¥å‚beanä¾›æˆ‘ä»¬é€‰æ‹©ï¼š</p>
<ol>
<li>org.springframework.orm.hibernate3.LocalSessionFactoryBean</li>
<li>org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean</li>
<li>org.springframework.orm.hibernate4.LocalSessionFactoryBean</li>
</ol>
<p>è¿™äº›Sessionå·¥å‚beanéƒ½æ˜¯Spring FactoryBeanæ¥å£çš„å®ç°ï¼Œå®ƒä»¬ä¼šäº§ç”Ÿä¸€ä¸ªHibernateSessionFactoryï¼Œå®ƒèƒ½å¤Ÿè£…é…è¿›ä»»ä½•SessionFactoryç±»å‹çš„å±æ€§ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½åœ¨åº”ç”¨çš„Springä¸Šä¸‹æ–‡ä¸­ï¼Œä¸å…¶ä»–çš„beanä¸€èµ·é…ç½®Hibernate Sessionå·¥å‚ã€‚</p>
<p>è·å–Hibernate Sessionå¯¹è±¡çš„æ ‡å‡†æ–¹å¼æ˜¯å€ŸåŠ©äºHibernate SessionFactoryæ¥å£çš„å®ç°ç±»ã€‚é™¤äº†ä¸€äº›å…¶ä»–çš„ä»»åŠ¡ï¼ŒSessionFactoryä¸»è¦è´Ÿè´£Hibernate Sessionçš„æ‰“å¼€ã€å…³é—­ä»¥åŠç®¡ç†ã€‚</p>
<p>åœ¨Springä¸­ï¼Œæˆ‘ä»¬è¦é€šè¿‡Springçš„æŸä¸€ä¸ªHibernate Sessionå·¥å‚beanæ¥è·å–Hibernate SessionFactoryã€‚ä»3.1ç‰ˆæœ¬å¼€å§‹ï¼ŒSpringæä¾›äº†ä¸‰ä¸ªSessionå·¥å‚beanä¾›æˆ‘ä»¬é€‰æ‹©ï¼š</p>
<ol>
<li>org.springframework.orm.hibernate3.LocalSessionFactoryBean</li>
<li>org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean</li>
<li>org.springframework.orm.hibernate4.LocalSessionFactoryBean</li>
</ol>
<p>è¿™äº›Sessionå·¥å‚beanéƒ½æ˜¯Spring FactoryBeanæ¥å£çš„å®ç°ï¼Œå®ƒä»¬ä¼šäº§ç”Ÿä¸€ä¸ªHibernateSessionFactoryï¼Œå®ƒèƒ½å¤Ÿè£…é…è¿›ä»»ä½•SessionFactoryç±»å‹çš„å±æ€§ä¸­ã€‚è¿™æ ·çš„è¯ï¼Œå°±èƒ½åœ¨åº”ç”¨çš„Springä¸Šä¸‹æ–‡ä¸­ï¼Œä¸å…¶ä»–çš„beanä¸€èµ·é…ç½®Hibernate Sessionå·¥å‚ã€‚</p>
<p>è‡³äºé€‰æ‹©ä½¿ç”¨å“ªä¸€ä¸ªSessionå·¥å‚ï¼Œè¿™å–å†³äºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„Hibernateä»¥åŠä½ ä½¿ç”¨XMLè¿˜æ˜¯ä½¿ç”¨æ³¨è§£æ¥å®šä¹‰å¯¹è±¡-æ•°æ®åº“ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚å¦‚æœä½ ä½¿ç”¨Hibernate 3.2æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç›´åˆ°Hibernate 4.0ï¼Œä½†ä¸åŒ…å«è¿™ä¸ªç‰ˆæœ¬ï¼‰å¹¶ä¸”ä½¿ç”¨XMLå®šä¹‰æ˜ å°„çš„è¯ï¼Œé‚£ä¹ˆä½ éœ€è¦å®šä¹‰Springçš„org.springframework.orm.hibernate3 åŒ…ä¸­çš„ LocalSessionFactoryBean ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  LocalSessionFactoryBean sfb = <span class="keyword">new</span> LocalSessionFactoryBean();</span><br><span class="line">  sfb.setDataSource(dataSource);</span><br><span class="line">  sfb.setMappingResources(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;Spitter.hbm.xml&quot;</span> &#125;);</span><br><span class="line">  Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">  props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);</span><br><span class="line">  sfb.setHibernateProperties(props);</span><br><span class="line">  <span class="keyword">return</span> sfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨é…ç½® LocalSessionFactoryBeanæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸‰ä¸ªå±æ€§ã€‚å±æ€§dataSourceè£…é…äº†ä¸€ä¸ªDataSource beançš„å¼•ç”¨ã€‚å±æ€§mappingResourcesåˆ—å‡ºäº†ä¸€ä¸ªæˆ–å¤šä¸ªçš„<strong>Hibernateæ˜ å°„æ–‡ä»¶</strong>ï¼Œåœ¨è¿™äº›æ–‡ä»¶ä¸­å®šä¹‰äº†åº”ç”¨ç¨‹åºçš„æŒä¹…åŒ–ç­–ç•¥ã€‚æœ€åï¼ŒhibernatePropertieså±æ€§é…ç½®äº†Hibernateå¦‚ä½•è¿›è¡Œæ“ä½œçš„ç»†èŠ‚ã€‚åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é…ç½®Hibernateä½¿ç”¨H2æ•°æ®åº“å¹¶ä¸”è¦æŒ‰ç…§H2Dialectæ¥æ„å»ºSQLã€‚</p>
<blockquote>
<p>è¿™é‡Œçš„Hibernateæ˜ å°„æ–‡ä»¶å…¶å®å°±æ˜¯é‚£äº›ç”¨äºæŒä¹…åŒ–çš„å¯¹è±¡</p>
</blockquote>
<p>å¦‚æœä½ æ›´å€¾å‘äºä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥å®šä¹‰æŒä¹…åŒ–ï¼Œå¹¶ä¸”ä½ è¿˜æ²¡æœ‰ä½¿ç”¨Hibernate 4çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨AnnotationSessionFactoryBean æ¥ä»£æ›¿ LocalSessionFactoryBean ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnnotationSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource ds)</span> </span>&#123;</span><br><span class="line">  AnnotationSessionFactoryBean sfb = <span class="keyword">new</span> AnnotationSessionFactoryBean();</span><br><span class="line">  sfb.setDataSource(ds);</span><br><span class="line">  sfb.setPackagesToScan(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;com.habuma.spittr.domain&quot;</span> &#125;);</span><br><span class="line">  Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">  props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);</span><br><span class="line">  sfb.setHibernateProperties(props);</span><br><span class="line">  <span class="keyword">return</span> sfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ ä½¿ç”¨Hibernate 4çš„è¯ï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨org.springframework.orm.hibernate4 ä¸­çš„ LocalSessionFactoryBeanã€‚å°½ç®¡å®ƒä¸Hibernate 3åŒ…ä¸­çš„LocalSessionFactoryBeanä½¿ç”¨äº†ç›¸åŒçš„åç§°ï¼Œä½†æ˜¯Spring 3.1æ–°å¼•å…¥çš„è¿™ä¸ªSessionå·¥å‚ç±»ä¼¼äºHibernate 3ä¸­LocalSessionFactoryBean å’Œ AnnotationSessionFactoryBeançš„ç»“åˆä½“ã€‚å®ƒæœ‰å¾ˆå¤šç›¸åŒçš„å±æ€§ï¼Œèƒ½å¤Ÿæ”¯æŒåŸºäºXMLçš„æ˜ å°„å’ŒåŸºäºæ³¨è§£çš„æ˜ å°„ã€‚å¦‚ä¸‹çš„ä»£ç å±•ç°äº†å¦‚ä½•å¯¹å®ƒè¿›è¡Œé…ç½®ï¼Œä½¿å…¶æ”¯æŒåŸºäºæ³¨è§£çš„æ˜ å°„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalSessionFactoryBean <span class="title">sessionFactory</span><span class="params">(DataSource dataSource)</span> </span>&#123;</span><br><span class="line">  LocalSessionFactoryBean sfb = <span class="keyword">new</span> LocalSessionFactoryBean();</span><br><span class="line">  sfb.setDataSource(dataSource);</span><br><span class="line">  sfb.setPackagesToScan(<span class="keyword">new</span> String[] &#123; <span class="string">&quot;com.habuma.spittr.domain&quot;</span> &#125;);</span><br><span class="line">  Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">  props.setProperty(<span class="string">&quot;dialect&quot;</span>, <span class="string">&quot;org.hibernate.dialect.H2Dialect&quot;</span>);</span><br><span class="line">  sfb.setHibernateProperties(props);</span><br><span class="line">  <span class="keyword">return</span> sfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸¤ä¸ªé…ç½®ä¸­ï¼ŒdataSource å’Œ hibernatePropertieså±æ€§éƒ½å£°æ˜äº†ä»å“ªé‡Œè·å–æ•°æ®åº“è¿æ¥ä»¥åŠè¦ä½¿ç”¨å“ªä¸€ç§æ•°æ®åº“ã€‚è¿™é‡Œä¸å†åˆ—å‡ºHibernateé…ç½®æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>packagesToScan</strong>å±æ€§å‘Šè¯‰Springæ‰«æä¸€ä¸ªæˆ–å¤šä¸ªåŒ…ä»¥æŸ¥æ‰¾åŸŸç±»ï¼Œè¿™äº›ç±»é€šè¿‡æ³¨è§£çš„æ–¹å¼è¡¨æ˜è¦ä½¿ç”¨Hibernateè¿›è¡ŒæŒä¹…åŒ–ï¼Œè¿™äº›ç±»å¯ä»¥ä½¿ç”¨çš„æ³¨è§£åŒ…æ‹¬JPAçš„@Entity æˆ– @MappedSuperclassä»¥åŠHibernateçš„@Entity ã€‚</p>
<p>åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­é…ç½®å®ŒHibernateçš„Sessionå·¥å‚beanåï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºè‡ªå·±çš„Repositoryç±»äº†ã€‚</p>
<h4 id="æ„å»ºä¸ä¾èµ–äºSpringçš„Hibernateä»£ç ">æ„å»ºä¸ä¾èµ–äºSpringçš„Hibernateä»£ç </h4>
<p>åœ¨Springå’ŒHibernateçš„æ—©æœŸå²æœˆä¸­ï¼Œç¼–å†™Repositoryç±»å°†ä¼šæ¶‰åŠåˆ°ä½¿ç”¨Springçš„HibernateTemplate ã€‚ HibernateTemplateèƒ½å¤Ÿä¿è¯æ¯ä¸ªäº‹åŠ¡ä½¿ç”¨åŒä¸€ä¸ªSessionã€‚ä½†æ˜¯è¿™ç§æ–¹å¼çš„å¼Šç«¯åœ¨äºæˆ‘ä»¬çš„Repositoryå®ç°ä¼šç›´æ¥ä¸Springè€¦åˆã€‚</p>
<p>ç°åœ¨çš„æœ€ä½³å®è·µæ˜¯ä¸å†ä½¿ç”¨HibernateTemplateï¼Œè€Œæ˜¯ä½¿ç”¨ä¸Šä¸‹æ–‡Sessionï¼ˆContextual sessionï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¼šç›´æ¥å°†Hibernate SessionFactoryè£…é…åˆ°Repositoryä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥è·å–Sessionï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> spittr.db.hibernate4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.inject.Inject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.criterion.Restrictions;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> spittr.db.SpitterRepository;</span><br><span class="line"><span class="keyword">import</span> spittr.domain.Spitter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> SessionFactory sessionFactory;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Inject</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HibernateSpitterRepository</span><span class="params">(SessionFactory sessionFactory)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.sessionFactory = sessionFactory;		 <span class="comment">//&lt;co id=&quot;co_InjectSessionFactory&quot;/&gt;</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Session <span class="title">currentSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sessionFactory.getCurrentSession();<span class="comment">//&lt;co id=&quot;co_RetrieveCurrentSession&quot;/&gt;</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> findAll().size();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Spitter <span class="title">save</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">		Serializable id = currentSession().save(spitter);  <span class="comment">//&lt;co id=&quot;co_UseCurrentSession&quot;/&gt;</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Spitter((Long) id, </span><br><span class="line">				spitter.getUsername(), </span><br><span class="line">				spitter.getPassword(), </span><br><span class="line">				spitter.getFullName(), </span><br><span class="line">				spitter.getEmail(), </span><br><span class="line">				spitter.isUpdateByEmail());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Spitter <span class="title">findOne</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (Spitter) currentSession().get(Spitter.class, id); </span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Spitter <span class="title">findByUsername</span><span class="params">(String username)</span> </span>&#123;		</span><br><span class="line">		<span class="keyword">return</span> (Spitter) currentSession() </span><br><span class="line">				.createCriteria(Spitter.class) </span><br><span class="line">				.add(Restrictions.eq(<span class="string">&quot;username&quot;</span>, username))</span><br><span class="line">				.list().get(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Spitter&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (List&lt;Spitter&gt;) currentSession() </span><br><span class="line">				.createCriteria(Spitter.class).list(); </span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡@Injectæ³¨è§£è®©Springè‡ªåŠ¨å°†ä¸€ä¸ªSessionFactory æ³¨å…¥åˆ° HibernateSpitterRepository çš„ sessionFactoryå±æ€§ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œåœ¨currentSession()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªSessionFactoryæ¥è·å–å½“å‰äº‹åŠ¡çš„Sessionã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ç±»ä¸Šä½¿ç”¨äº†@Repositoryæ³¨è§£ï¼Œè¿™ä¼šä¸ºæˆ‘ä»¬åšä¸¤ä»¶äº‹æƒ…ã€‚é¦–å…ˆï¼Œ@Repositoryæ˜¯Springçš„å¦ä¸€ç§æ„é€ æ€§æ³¨è§£ï¼Œå®ƒèƒ½å¤Ÿåƒå…¶ä»–æ³¨è§£ä¸€æ ·è¢«Springçš„ç»„ä»¶æ‰«ææ‰€æ‰«æåˆ°ã€‚è¿™æ ·å°±ä¸å¿…æ˜ç¡®å£°æ˜HibernateSpitterRepository beanäº†ï¼Œåªè¦è¿™ä¸ªRepositoryç±»åœ¨ç»„ä»¶æ‰«ææ‰€æ¶µç›–çš„åŒ…ä¸­å³å¯ã€‚</p>
<p>é™¤äº†å¸®åŠ©å‡å°‘æ˜¾å¼é…ç½®ä»¥å¤–ï¼Œ@Repositoryè¿˜æœ‰å¦å¤–ä¸€ä¸ªç”¨å¤„ã€‚è®©æˆ‘ä»¬å›æƒ³ä¸€ä¸‹æ¨¡æ¿ç±»ï¼Œå®ƒæœ‰ä¸€é¡¹ä»»åŠ¡å°±æ˜¯æ•è·å¹³å°ç›¸å…³çš„å¼‚å¸¸ï¼Œç„¶åä½¿ç”¨Springç»Ÿä¸€éæ£€æŸ¥å‹å¼‚å¸¸çš„å½¢å¼é‡æ–°æŠ›å‡ºã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨Hibernateä¸Šä¸‹æ–‡Sessionè€Œä¸æ˜¯Hibernateæ¨¡æ¿çš„è¯ï¼Œé‚£å¼‚å¸¸è½¬æ¢ä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p>
<p>ä¸ºäº†ç»™ä¸ä½¿ç”¨æ¨¡æ¿çš„Hibernate Repositoryæ·»åŠ å¼‚å¸¸è½¬æ¢åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ·»åŠ ä¸€ä¸ªPersistenceExceptionTranslationPostProcessor beanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BeanPostProcessor <span class="title">persistenceTranslation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PersistenceExceptionTranslationPostProcessoræ˜¯ä¸€ä¸ªbeanåç½®å¤„ç†å™¨ï¼ˆbean post-processorï¼‰ï¼Œå®ƒä¼šåœ¨æ‰€æœ‰æ‹¥æœ‰@Repositoryæ³¨è§£çš„ç±»ä¸Šæ·»åŠ ä¸€ä¸ªé€šçŸ¥å™¨ï¼ˆadvisorï¼‰ï¼Œè¿™æ ·å°±ä¼šæ•è·ä»»ä½•å¹³å°ç›¸å…³çš„å¼‚å¸¸å¹¶ä»¥Springéæ£€æŸ¥å‹æ•°æ®è®¿é—®å¼‚å¸¸çš„å½¢å¼é‡æ–°æŠ›å‡ºã€‚</p>
<p>ç°åœ¨ï¼ŒHibernateç‰ˆæœ¬çš„Repositoryå·²ç»å®Œæˆäº†ã€‚æˆ‘ä»¬å¼€å‘æ—¶ï¼Œæ²¡æœ‰ä¾èµ–Springçš„ç‰¹å®šç±»ï¼ˆé™¤äº†@Repositoryæ³¨è§£ä»¥å¤–ï¼‰ã€‚è¿™ç§ä¸ä½¿ç”¨æ¨¡æ¿çš„æ–¹å¼ä¹Ÿé€‚ç”¨äºå¼€å‘çº¯ç²¹çš„åŸºäºJPAçš„Repositoryï¼Œè®©æˆ‘ä»¬å†å°è¯•å¼€å‘å¦ä¸€ä¸ªSpitterRepositoryå®ç°ç±»ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯JPAã€‚</p>
<h2 id="Spring-ä¸JavaæŒä¹…åŒ–API">Spring ä¸JavaæŒä¹…åŒ–API</h2>
<p>JavaæŒä¹…åŒ–APIï¼ˆJava Persistence APIï¼ŒJPAï¼‰è¯ç”Ÿåœ¨EJB 2å®ä½“Beançš„åºŸå¢Ÿä¹‹ä¸Šï¼Œå¹¶æˆä¸ºä¸‹ä¸€ä»£JavaæŒä¹…åŒ–æ ‡å‡†ã€‚JPAæ˜¯åŸºäºPOJOçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œå®ƒä»Hibernateå’ŒJavaæ•°æ®å¯¹è±¡ï¼ˆJava Data Objectï¼ŒJDOï¼‰ä¸Šå€Ÿé‰´äº†å¾ˆå¤šç†å¿µå¹¶åŠ å…¥äº†Java 5æ³¨è§£çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨Springä¸­ä½¿ç”¨JPAçš„ç¬¬ä¸€æ­¥æ˜¯è¦åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°†å®ä½“ç®¡ç†å™¨å·¥å‚ï¼ˆentity manager factoryï¼‰æŒ‰ç…§beançš„å½¢å¼æ¥è¿›è¡Œé…ç½®ã€‚</p>
<p>ç®€å•æ¥è®²ï¼ŒåŸºäºJPAçš„åº”ç”¨ç¨‹åºéœ€è¦ä½¿ç”¨EntityManagerFactoryçš„å®ç°ç±»æ¥è·å–EntityManagerå®ä¾‹ã€‚JPAå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„å®ä½“ç®¡ç†å™¨ï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹ï¼ˆApplication-managedï¼‰ï¼šå½“åº”ç”¨ç¨‹åºå‘å®ä½“ç®¡ç†å™¨å·¥å‚ç›´æ¥è¯·æ±‚å®ä½“ç®¡ç†å™¨æ—¶ï¼Œå·¥å‚ä¼šåˆ›å»ºä¸€ä¸ªå®ä½“ç®¡ç†å™¨ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œç¨‹åºè¦è´Ÿè´£æ‰“å¼€æˆ–å…³é—­å®ä½“ç®¡ç†å™¨å¹¶åœ¨äº‹åŠ¡ä¸­å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™ç§æ–¹å¼çš„å®ä½“ç®¡ç†å™¨é€‚åˆäºä¸è¿è¡Œåœ¨Java EEå®¹å™¨ä¸­çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºã€‚</li>
<li>å®¹å™¨ç®¡ç†ç±»å‹ï¼ˆContainer-managedï¼‰ï¼šå®ä½“ç®¡ç†å™¨ç”±Java EEåˆ›å»ºå’Œç®¡ç†ã€‚åº”ç”¨ç¨‹åºæ ¹æœ¬ä¸ä¸å®ä½“ç®¡ç†å™¨å·¥å‚æ‰“äº¤é“ã€‚ç›¸åï¼Œå®ä½“ç®¡ç†å™¨ç›´æ¥é€šè¿‡æ³¨å…¥æˆ–JNDIæ¥è·å–ã€‚å®¹å™¨è´Ÿè´£é…ç½®å®ä½“ç®¡ç†å™¨å·¥å‚ã€‚è¿™ç§ç±»å‹çš„å®ä½“ç®¡ç†å™¨æœ€é€‚ç”¨äºJava EEå®¹å™¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¼šå¸Œæœ›åœ¨persistence.xmlæŒ‡å®šçš„JPAé…ç½®ä¹‹å¤–ä¿æŒä¸€äº›è‡ªå·±å¯¹JPAçš„æ§åˆ¶ã€‚</li>
</ul>
<p>ä»¥ä¸Šçš„ä¸¤ç§å®ä½“ç®¡ç†å™¨å®ç°äº†åŒä¸€ä¸ªEntityManageræ¥å£ã€‚å…³é”®çš„åŒºåˆ«ä¸åœ¨äºEntityManageræœ¬èº«ï¼Œè€Œæ˜¯åœ¨äºEntityManagerçš„åˆ›å»ºå’Œç®¡ç†æ–¹å¼ã€‚åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„EntityManager æ˜¯ç”± EntityManagerFactoryåˆ›å»ºçš„ï¼Œè€Œåè€…æ˜¯é€šè¿‡PersistenceProvider çš„ createEntityManagerFactory()æ–¹æ³•å¾—åˆ°çš„ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œå®¹å™¨ç®¡ç†ç±»å‹çš„Entity ManagerFactory æ˜¯é€šè¿‡ PersistenceProvider çš„ createContainerEntityManager Factory()æ–¹æ³•è·å¾—çš„ã€‚</p>
<p>ä»¥ä¸Šçš„ä¸¤ç§å®ä½“ç®¡ç†å™¨å®ç°äº†åŒä¸€ä¸ªEntityManageræ¥å£ã€‚å…³é”®çš„åŒºåˆ«ä¸åœ¨äºEntityManageræœ¬èº«ï¼Œè€Œæ˜¯åœ¨äºEntityManagerçš„åˆ›å»ºå’Œç®¡ç†æ–¹å¼ã€‚åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„EntityManager æ˜¯ç”± EntityManagerFactoryåˆ›å»ºçš„ï¼Œè€Œåè€…æ˜¯é€šè¿‡PersistenceProvider çš„ createEntityManagerFactory()æ–¹æ³•å¾—åˆ°çš„ã€‚ä¸æ­¤ç›¸å¯¹ï¼Œå®¹å™¨ç®¡ç†ç±»å‹çš„Entity ManagerFactory æ˜¯é€šè¿‡ PersistenceProvider çš„ createContainerEntityManager Factory()æ–¹æ³•è·å¾—çš„ã€‚</p>
<p>è¿™å¯¹æƒ³ä½¿ç”¨JPAçš„Springå¼€å‘è€…æ¥è¯´åˆæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®è¿™å¹¶æ²¡å¤ªå¤§çš„å…³ç³»ã€‚ä¸ç®¡ä½ å¸Œæœ›ä½¿ç”¨å“ªç§EntityManagerFactoryï¼ŒSpringéƒ½ä¼šè´Ÿè´£ç®¡ç†EntityManagerã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„å®ä½“ç®¡ç†å™¨ï¼ŒSpringæ‰¿æ‹…äº†åº”ç”¨ç¨‹åºçš„è§’è‰²å¹¶ä»¥é€æ˜çš„æ–¹å¼å¤„ç†EntityManagerã€‚åœ¨å®¹å™¨ç®¡ç†çš„åœºæ™¯ä¸‹ï¼ŒSpringä¼šæ‹…å½“å®¹å™¨çš„è§’è‰²ã€‚</p>
<p>è¿™ä¸¤ç§å®ä½“ç®¡ç†å™¨å·¥å‚åˆ†åˆ«ç”±å¯¹åº”çš„Springå·¥å‚Beanåˆ›å»ºï¼š</p>
<ul>
<li>
<p>LocalEntityManagerFactoryBeanç”Ÿæˆåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„EntityManager-Factory</p>
</li>
<li>
<p>LocalContainerEntityManagerFactoryBeanç”Ÿæˆå®¹å™¨ç®¡ç†ç±»å‹çš„Entity-ManagerFactory ã€‚</p>
</li>
</ul>
<p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé€‰æ‹©åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„è¿˜æ˜¯å®¹å™¨ç®¡ç†ç±»å‹çš„EntityManager Factoryï¼Œå¯¹äºåŸºäºSpringçš„åº”ç”¨ç¨‹åºæ¥è®²æ˜¯å®Œå…¨é€æ˜çš„ã€‚å½“ç»„åˆä½¿ç”¨Springå’ŒJPAæ—¶ï¼Œå¤„ç†EntityManagerFactoryçš„å¤æ‚ç»†èŠ‚è¢«éšè—äº†èµ·æ¥ï¼Œæ•°æ®è®¿é—®ä»£ç åªéœ€å…³æ³¨å®ƒä»¬çš„çœŸæ­£ç›®æ ‡å³å¯ï¼Œä¹Ÿå°±æ˜¯æ•°æ®è®¿é—®ã€‚</p>
<h5 id="é…ç½®åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„JPA">é…ç½®åº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„JPA</h5>
<p>å¯¹äºåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„å®ä½“ç®¡ç†å™¨å·¥å‚æ¥è¯´ï¼Œå®ƒç»å¤§éƒ¨åˆ†é…ç½®ä¿¡æ¯æ¥æºäºä¸€ä¸ªåä¸ºpersistence.xmlçš„é…ç½®æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å¿…é¡»ä½äºç±»è·¯å¾„ä¸‹çš„META-INFç›®å½•ä¸‹ã€‚</p>
<p>persistence.xmlçš„ä½œç”¨åœ¨äºå®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæŒä¹…åŒ–å•å…ƒã€‚æŒä¹…åŒ–å•å…ƒæ˜¯åŒä¸€ä¸ªæ•°æ®æºä¸‹çš„ä¸€ä¸ªæˆ–å¤šä¸ªæŒä¹…åŒ–ç±»ã€‚ç®€å•æ¥è®²ï¼Œpersistence.xmlåˆ—å‡ºäº†ä¸€ä¸ªæˆ–å¤šä¸ªçš„æŒä¹…åŒ–ç±»ä»¥åŠä¸€äº›å…¶ä»–çš„é…ç½®å¦‚æ•°æ®æºå’ŒåŸºäºXMLçš„é…ç½®æ–‡ä»¶ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„persistence.xmlæ–‡ä»¶ï¼Œå®ƒæ˜¯ç”¨äºSpittråº”ç”¨ç¨‹åºçš„ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">persistence</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/persistence&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">version</span>=<span class="string">&quot;1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">persistence-unit</span> <span class="attr">name</span>=<span class="string">&quot;spitterPU&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.habuma.spittr.domain.Spitter<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.habuma.spittr.domain.Spittle<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.driver&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">&quot;org.hsqldb.jdbcDriver&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.url&quot;</span> <span class="attr">value</span>=</span></span><br><span class="line"><span class="tag">            &quot;<span class="attr">jdbc:hsqldb:hsql:</span>//<span class="attr">localhost</span>/<span class="attr">spitter</span>/<span class="attr">spitter</span>&quot; /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.user&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">&quot;sa&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;toplink.jdbc.password&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">persistence-unit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">persistence</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å› ä¸ºåœ¨persistence.xmlæ–‡ä»¶ä¸­åŒ…å«äº†å¤§é‡çš„é…ç½®ä¿¡æ¯ï¼Œæ‰€ä»¥åœ¨Springä¸­éœ€è¦é…ç½®çš„å°±å¾ˆå°‘äº†ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹çš„@Beanæ³¨è§£æ–¹æ³•åœ¨Springä¸­å£°æ˜LocalEntityManagerFactoryBean ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalEntityManagerFactoryBean <span class="title">entityManagerFactoryBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  LocalEntityManagerFactoryBean emfb</span><br><span class="line">      = <span class="keyword">new</span> LocalEntityManagerFactoryBean();</span><br><span class="line">  emfb.setPersistenceUnitName(<span class="string">&quot;spitterPU&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> emfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºåº”ç”¨ç¨‹åºç®¡ç†ç±»å‹çš„EntityManagerFactoryéƒ½æ˜¯åœ¨persistence.xmlä¸­è¿›è¡Œçš„ï¼Œè€Œè¿™æ­£æ˜¯åº”ç”¨ç¨‹åºç®¡ç†çš„æœ¬æ„ã€‚åœ¨åº”ç”¨ç¨‹åºç®¡ç†çš„åœºæ™¯ä¸‹ï¼ˆä¸è€ƒè™‘Springæ—¶ï¼‰ï¼Œå®Œå…¨ç”±åº”ç”¨ç¨‹åºæœ¬èº«æ¥è´Ÿè´£è·å–EntityManagerFactoryï¼Œè¿™æ˜¯é€šè¿‡JPAå®ç°çš„PersistenceProvideråšåˆ°çš„ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚EntityManagerFactoryæ—¶éƒ½éœ€è¦å®šä¹‰æŒä¹…åŒ–å•å…ƒï¼Œé‚£ä»£ç å°†ä¼šè¿…é€Ÿè†¨èƒ€ã€‚é€šè¿‡å°†å…¶é…ç½®åœ¨persistence.xmlä¸­ï¼ŒJPAå°±èƒ½å¤Ÿåœ¨è¿™ä¸ªç‰¹å®šçš„ä½ç½®æŸ¥æ‰¾æŒä¹…åŒ–å•å…ƒå®šä¹‰äº†ã€‚</p>
<p>ä½†å€ŸåŠ©äºSpringå¯¹JPAçš„æ”¯æŒï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ç›´æ¥å¤„ç†PersistenceProvideräº†ã€‚å› æ­¤ï¼Œå†å°†é…ç½®ä¿¡æ¯æ”¾åœ¨persistence.xmlä¸­å°±æ˜¾å¾—ä¸é‚£ä¹ˆæ˜æ™ºäº†ã€‚å®é™…ä¸Šï¼Œè¿™æ ·åšå¦¨ç¢äº†æˆ‘ä»¬åœ¨Springä¸­é…ç½®EntityManagerFactoryï¼ˆå¦‚æœä¸æ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªSpringé…ç½®çš„æ•°æ®æºï¼‰ã€‚</p>
<h5 id="é…ç½®å®¹å™¨ç®¡ç†ç±»å‹çš„JPA">é…ç½®å®¹å™¨ç®¡ç†ç±»å‹çš„JPA</h5>
<p>å®¹å™¨ç®¡ç†çš„JPAé‡‡å–äº†ä¸€ä¸ªä¸åŒçš„æ–¹å¼ã€‚å½“è¿è¡Œåœ¨å®¹å™¨ä¸­æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®¹å™¨ï¼ˆåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹æ˜¯Springï¼‰æä¾›çš„ä¿¡æ¯æ¥ç”ŸæˆEntityManagerFactory</p>
<p>ä½ å¯ä»¥å°†æ•°æ®æºä¿¡æ¯é…ç½®åœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œè€Œä¸æ˜¯åœ¨persistence.xmlä¸­äº†ã€‚ä¾‹å¦‚ï¼Œå¦‚ä¸‹çš„@Beanæ³¨è§£æ–¹æ³•å£°æ˜äº†åœ¨Springä¸­å¦‚ä½•ä½¿ç”¨LocalContainerEntity-ManagerFactoryBeanæ¥é…ç½®å®¹å™¨ç®¡ç†ç±»å‹çš„JPAï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocalContainerEntityManagerFactoryBean <span class="title">entityManagerFactory</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        DataSource dataSource, JpaVendorAdapter jpaVendorAdapter)</span> </span>&#123;</span><br><span class="line">  LocalContainerEntityManagerFactoryBean emfb =</span><br><span class="line">      <span class="keyword">new</span> LocalContainerEntityManagerFactoryBean();</span><br><span class="line">  emfb.setDataSource(dataSource);</span><br><span class="line">  emfb.setJpaVendorAdapter(jpaVendorAdapter);</span><br><span class="line">  emfb.setPackagesToScan(<span class="string">&quot;com.habuma.spittr.domain&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> emfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Springé…ç½®çš„æ•°æ®æºæ¥è®¾ç½®dataSourceå±æ€§ã€‚ä»»ä½•javax.sql.DataSourceçš„å®ç°éƒ½æ˜¯å¯ä»¥çš„ã€‚å°½ç®¡æ•°æ®æºè¿˜å¯ä»¥åœ¨persistence.xmlä¸­è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯è¿™ä¸ªå±æ€§æŒ‡å®šçš„æ•°æ®æºå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ persistence.xmlæ–‡ä»¶çš„ä¸»è¦ä½œç”¨å°±åœ¨äºè¯†åˆ«æŒä¹…åŒ–å•å…ƒä¸­çš„å®ä½“ç±»ã€‚ä½†æ˜¯ä»Spring 3.1å¼€å§‹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨LocalContainerEntityManagerFactoryBeanä¸­ç›´æ¥è®¾ç½®packagesToScan å±æ€§</p>
<p>jpaVendorAdapterå±æ€§ç”¨äºæŒ‡æ˜æ‰€ä½¿ç”¨çš„æ˜¯å“ªä¸€ä¸ªå‚å•†çš„JPAå®ç°ã€‚Springæä¾›äº†å¤šä¸ªJPAå‚å•†é€‚é…å™¨ï¼š</p>
<ul>
<li>EclipseLinkJpaVendorAdapter</li>
<li>HibernateJpaVendorAdapter</li>
<li>OpenJpaVendorAdapter</li>
<li>TopLinkJpaVendorAdapterï¼ˆåœ¨Spring 3.1ç‰ˆæœ¬ä¸­ï¼Œå·²ç»å°†å…¶åºŸå¼ƒäº†ï¼‰</li>
</ul>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Hibernateä½œä¸ºJPAå®ç°ï¼Œæ‰€ä»¥å°†å…¶é…ç½®ä¸ºHibernate-JpaVendorAdapter ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JpaVendorAdapter <span class="title">jpaVendorAdapter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  HibernateJpaVendorAdapter adapter = <span class="keyword">new</span> HibernateJpaVendorAdapter();</span><br><span class="line">  adapter.setDatabase(<span class="string">&quot;HSQL&quot;</span>);</span><br><span class="line">  adapter.setShowSql(<span class="keyword">true</span>);</span><br><span class="line">  adapter.setGenerateDdl(<span class="keyword">false</span>);</span><br><span class="line">  adapter.setDatabasePlatform(<span class="string">&quot;org.hibernate.dialect.HSQLDialect&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> adapter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰å¤šä¸ªå±æ€§éœ€è¦è®¾ç½®åˆ°å‚å•†é€‚é…å™¨ä¸Šï¼Œä½†æ˜¯æœ€é‡è¦çš„æ˜¯databaseå±æ€§ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬è®¾ç½®äº†è¦ä½¿ç”¨çš„æ•°æ®åº“æ˜¯Hypersonicã€‚è¿™ä¸ªå±æ€§æ”¯æŒçš„å…¶ä»–å€¼å¦‚è¡¨11.1æ‰€ç¤ºã€‚</p>
<blockquote>
<p>è¡¨11.1ã€€Hibernateçš„JPAé€‚é…å™¨æ”¯æŒå¤šç§æ•°æ®åº“ï¼Œå¯ä»¥é€šè¿‡å…¶databaseå±æ€§é…ç½®ä½¿ç”¨å“ªä¸ªæ•°æ®åº“</p>
</blockquote>
<p>nihao</p>
<table>
<thead>
<tr>
<th>æ•°æ®åº“å¹³å°</th>
<th>å±æ€§databaseçš„å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>IBM DB2</td>
<td>DB2</td>
</tr>
<tr>
<td>Apache Derby</td>
<td>DERBY</td>
</tr>
<tr>
<td>H2</td>
<td>H2</td>
</tr>
<tr>
<td>Hypersonic</td>
<td>HSQL</td>
</tr>
<tr>
<td>Informix</td>
<td>INFORMIX</td>
</tr>
<tr>
<td>MySQL</td>
<td>MYSQL</td>
</tr>
<tr>
<td>Oracle</td>
<td>ORACLE</td>
</tr>
<tr>
<td>PostgresQL</td>
<td>POSTGRESQL</td>
</tr>
<tr>
<td>Microsoft SQL</td>
<td>Server    SQLSERVER</td>
</tr>
<tr>
<td>Sybase</td>
<td>SYBASE</td>
</tr>
</tbody>
</table>
<h4 id="ä»JNDIè·å–å®ä½“ç®¡ç†å™¨å·¥å‚">ä»JNDIè·å–å®ä½“ç®¡ç†å™¨å·¥å‚</h4>
<p>è¿˜æœ‰ä¸€ä»¶éœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼Œå¦‚æœå°†Springåº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨åº”ç”¨æœåŠ¡å™¨ä¸­ï¼ŒEntityManagerFactoryå¯èƒ½å·²ç»åˆ›å»ºå¥½äº†å¹¶ä¸”ä½äºJNDIä¸­ç­‰å¾…æŸ¥è¯¢ä½¿ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨Spring jeeå‘½åç©ºé—´ä¸‹çš„&lt;jee:jndi-lookup&gt;å…ƒç´ æ¥è·å–å¯¹EntityManagerFactory çš„å¼•ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jee:jndi-lookup</span> <span class="attr">id</span>=<span class="string">&quot;emf&quot;</span> <span class="attr">jndi-name</span>=<span class="string">&quot;persistence/spitterPU&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„Javaé…ç½®æ¥è·å–EntityManagerFactory ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> JndiObjectFactoryBean <span class="title">entityManagerFactory</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">JndiObjectFactoryBean jndiObjectFB = <span class="keyword">new</span> JndiObjectFactoryBean();</span><br><span class="line">  jndiObjectFB.setJndiName(<span class="string">&quot;jdbc/SpittrDS&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> jndiObjectFB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°½ç®¡è¿™ç§æ–¹æ³•æ²¡æœ‰è¿”å›EntityManagerFactoryï¼Œä½†æ˜¯å®ƒçš„ç»“æœå°±æ˜¯ä¸€ä¸ªEntityManagerFactory beanã€‚è¿™æ˜¯å› ä¸ºå®ƒæ‰€è¿”å›çš„JndiObjectFactoryBean æ˜¯ FactoryBeanæ¥å£çš„å®ç°ï¼Œå®ƒèƒ½å¤Ÿåˆ›å»ºEntityManagerFactory ã€‚</p>
<h3 id="ç¼–å†™åŸºäºJPAçš„Repository">ç¼–å†™åŸºäºJPAçš„Repository</h3>
<p>æ­£å¦‚Springå¯¹å…¶ä»–æŒä¹…åŒ–æ–¹æ¡ˆçš„é›†æˆä¸€æ ·ï¼ŒSpringå¯¹JPAé›†æˆä¹Ÿæä¾›äº†JpaTemplateæ¨¡æ¿ä»¥åŠå¯¹åº”çš„æ”¯æŒç±»JpaDaoSupportã€‚ä½†æ˜¯ï¼Œä¸ºäº†å®ç°æ›´çº¯ç²¹çš„JPAæ–¹å¼ï¼ŒåŸºäºæ¨¡æ¿çš„JPAå·²ç»è¢«å¼ƒç”¨äº†ã€‚è¿™ä¸æˆ‘ä»¬åœ¨11.1.2å°èŠ‚ä½¿ç”¨çš„Hibernateä¸Šä¸‹æ–‡Sessionæ˜¯å¾ˆç±»ä¼¼çš„ã€‚</p>
<p>é‰´äºçº¯ç²¹çš„JPAæ–¹å¼è¿œèƒœäºåŸºäºæ¨¡æ¿çš„JPAï¼Œæ‰€ä»¥åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†ä¼šé‡ç‚¹å…³æ³¨å¦‚ä½•æ„å»ºä¸ä¾èµ–Springçš„JPA Repositoryã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„JpaSpitterRepositoryå±•ç°äº†å¦‚ä½•å¼€å‘ä¸ä½¿ç”¨Spring JpaTemplate çš„JPA Repositoryã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.persistence;</span><br><span class="line">  <span class="keyword">import</span> java.util.List;</span><br><span class="line">  <span class="keyword">import</span> javax.persistence.EntityManagerFactory;</span><br><span class="line">  <span class="keyword">import</span> javax.persistence.PersistenceUnit;</span><br><span class="line">  <span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line">  <span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line">  <span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line">  <span class="keyword">import</span> com.habuma.spittr.domain.Spitter;</span><br><span class="line">  <span class="keyword">import</span> com.habuma.spittr.domain.Spittle;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Repository</span></span><br><span class="line">  <span class="meta">@Transactional</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceUnit</span></span><br><span class="line">    <span class="keyword">private</span> EntityManagerFactory emf;	</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">      emf.createEntityManager().persist(spitter);	</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Spitter <span class="title">getSpitterById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> emf.createEntityManager().find(Spitter.class, id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">      emf.createEntityManager().merge(spitter);</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯EntityManagerFactoryå±æ€§ï¼Œå®ƒä½¿ç”¨äº†@PersistenceUnitæ³¨è§£ï¼Œå› æ­¤ï¼ŒSpringä¼šå°†EntityManagerFactory æ³¨å…¥åˆ° Repositoryä¹‹ä¸­ã€‚æœ‰äº†EntityManagerFactory ä¹‹åï¼Œ JpaSpitterRepositoryçš„æ–¹æ³•å°±èƒ½ä½¿ç”¨å®ƒæ¥åˆ›å»ºEntityManager äº†ï¼Œç„¶å EntityManagerå¯ä»¥é’ˆå¯¹æ•°æ®åº“æ‰§è¡Œæ“ä½œã€‚</p>
<p>JpaSpitterRepositoryä¸­ï¼Œå”¯ä¸€çš„é—®é¢˜åœ¨äºæ¯ä¸ªæ–¹æ³•éƒ½ä¼šè°ƒç”¨createEntityManager()ã€‚é™¤äº†å¼•å…¥æ˜“å‡ºé”™çš„é‡å¤ä»£ç ä»¥å¤–ï¼Œè¿™è¿˜æ„å‘³ç€æ¯æ¬¡è°ƒç”¨Repositoryçš„æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„EntityManagerã€‚è¿™ç§å¤æ‚æ€§æºäºäº‹åŠ¡ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿé¢„å…ˆå‡†å¤‡å¥½EntityManagerï¼Œé‚£ä¼šä¸ä¼šæ›´åŠ æ–¹ä¾¿å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œçš„é—®é¢˜åœ¨äºEntityManagerå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¸€èˆ¬æ¥è®²å¹¶ä¸é€‚åˆæ³¨å…¥åˆ°åƒRepositoryè¿™æ ·å…±äº«çš„å•ä¾‹beanä¸­ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬æ²¡æœ‰åŠæ³•è¦æ±‚æ³¨å…¥EntityManagerã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¦‚ä½•å€ŸåŠ©@PersistentContext æ³¨è§£ä¸º JpaSpitterRepository è®¾ç½® EntityManager</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.habuma.spittr.persistence;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.dao.DataAccessException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> com.habuma.spittr.domain.Spitter;</span><br><span class="line"><span class="keyword">import</span> com.habuma.spittr.domain.Spittle;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaSpitterRepository</span> <span class="keyword">implements</span> <span class="title">SpitterRepository</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PersistenceContext</span></span><br><span class="line">  <span class="keyword">private</span> EntityManager em;	</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">    em.persist(spitter);	</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Spitter <span class="title">getSpitterById</span><span class="params">(<span class="keyword">long</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> em.find(Spitter.class, id);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">    em.merge(spitter);</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªæ–°ç‰ˆæœ¬çš„JpaSpitterRepositoryä¸­ï¼Œç›´æ¥ä¸ºå…¶è®¾ç½®äº†EntityManagerï¼Œè¿™æ ·çš„è¯ï¼Œåœ¨æ¯ä¸ªæ–¹æ³•ä¸­å°±æ²¡æœ‰å¿…è¦å†é€šè¿‡EntityManagerFactory åˆ›å»º EntityManageräº†ã€‚å°½ç®¡è¿™ç§æ–¹å¼éå¸¸ä¾¿åˆ©ï¼Œä½†æ˜¯ä½ å¯èƒ½ä¼šæ‹…å¿ƒæ³¨å…¥çš„EntityManagerä¼šæœ‰çº¿ç¨‹å®‰å…¨æ€§çš„é—®é¢˜ã€‚</p>
<p>è¿™é‡Œçš„çœŸç›¸æ˜¯@PersistenceContextå¹¶ä¸ä¼šçœŸæ­£æ³¨å…¥EntityManagerâ€”â€”è‡³å°‘ï¼Œç²¾ç¡®æ¥è®²ä¸æ˜¯è¿™æ ·çš„ã€‚å®ƒæ²¡æœ‰å°†çœŸæ­£çš„EntityManagerè®¾ç½®ç»™Repositoryï¼Œè€Œæ˜¯ç»™äº†å®ƒä¸€ä¸ªEntityManagerçš„ä»£ç†ã€‚çœŸæ­£çš„EntityManageræ˜¯ä¸å½“å‰äº‹åŠ¡ç›¸å…³è”çš„é‚£ä¸€ä¸ªï¼Œå¦‚æœä¸å­˜åœ¨è¿™æ ·çš„EntityManagerçš„è¯ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å§‹ç»ˆä»¥çº¿ç¨‹å®‰å…¨çš„æ–¹å¼ä½¿ç”¨å®ä½“ç®¡ç†å™¨ã€‚</p>
<p>å¦å¤–ï¼Œè¿˜éœ€è¦äº†è§£@PersistenceUnit å’Œ @PersistenceContextå¹¶ä¸æ˜¯Springçš„æ³¨è§£ï¼Œå®ƒä»¬æ˜¯ç”±JPAè§„èŒƒæä¾›çš„ã€‚ä¸ºäº†è®©Springç†è§£è¿™äº›æ³¨è§£ï¼Œå¹¶æ³¨å…¥EntityManager Factory æˆ– EntityManagerï¼Œæˆ‘ä»¬å¿…é¡»è¦é…ç½®Springçš„Persistence-AnnotationBeanPostProcessorã€‚å¦‚æœä½ å·²ç»ä½¿ç”¨äº†&lt;context:annotation-config&gt; æˆ– &lt;context:component-scan&gt;ï¼Œé‚£ä¹ˆä½ å°±ä¸å¿…å†æ‹…å¿ƒäº†ï¼Œå› ä¸ºè¿™äº›é…ç½®å…ƒç´ ä¼šè‡ªåŠ¨æ³¨å†ŒPersistenceAnnotationBeanPostProcessor beanã€‚å¦åˆ™çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°æ³¨å†Œè¿™ä¸ªbeanï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PersistenceAnnotationBeanPostProcessor <span class="title">paPostProcessor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PersistenceAnnotationBeanPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½ å¯èƒ½ä¹Ÿæ³¨æ„åˆ°äº†JpaSpitterRepository ä½¿ç”¨äº† @Repository å’Œ @Transactional æ³¨è§£ã€‚ @Transactionalè¡¨æ˜è¿™ä¸ªRepositoryä¸­çš„æŒä¹…åŒ–æ–¹æ³•æ˜¯åœ¨äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œçš„ã€‚</p>
<p>åŒæ ·çš„ï¼Œä¸ºäº†è®©JPAæŠŠå¼‚å¸¸è½¬æ¢æˆSpringçš„ç»Ÿä¸€æ•°æ®è®¿é—®å¼‚å¸¸ã€‚éœ€è¦å°†PersistenceExceptionTranslationPostProcessorè£…é…åˆ°Springä¸­ï¼Œå°±åƒåœ¨Hibernateæ ·ä¾‹ä¸­ä¸€æ ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> BeanPostProcessor <span class="title">persistenceTranslation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> PersistenceExceptionTranslationPostProcessor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æé†’ä¸€ä¸‹ï¼Œä¸ç®¡å¯¹äºJPAè¿˜æ˜¯Hibernateï¼Œå¼‚å¸¸è½¬æ¢éƒ½ä¸æ˜¯å¼ºåˆ¶è¦æ±‚çš„ã€‚å¦‚æœä½ å¸Œæœ›åœ¨Repositoryä¸­æŠ›å‡ºç‰¹å®šçš„JPAæˆ–Hibernateå¼‚å¸¸ï¼Œåªéœ€å°†PersistenceException-TranslationPostProcessorçœç•¥æ‰å³å¯ï¼Œè¿™æ ·åŸæ¥çš„å¼‚å¸¸å°±ä¼šæ­£å¸¸åœ°å¤„ç†ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½¿ç”¨äº†Springçš„å¼‚å¸¸è½¬æ¢ï¼Œä½ ä¼šå°†æ‰€æœ‰çš„æ•°æ®è®¿é—®å¼‚å¸¸ç½®äºSpringçš„ä½“ç³»ä¹‹ä¸‹ï¼Œè¿™æ ·ä»¥ååˆ‡æ¢æŒä¹…åŒ–æœºåˆ¶çš„è¯ä¼šæ›´å®¹æ˜“ã€‚</p>
<h2 id="å€ŸåŠ©Spring-Dataå®ç°è‡ªåŠ¨åŒ–çš„-JPA-Repository">å€ŸåŠ©Spring Dataå®ç°è‡ªåŠ¨åŒ–çš„ JPA Repository</h2>
<p>é‡æ–°å®¡è§†addSpitter()æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addSpitter</span><span class="params">(Spitter spitter)</span> </span>&#123;</span><br><span class="line">    entityManager.persist(spitter);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ä»»ä½•å…·æœ‰ä¸€å®šè§„æ¨¡çš„åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½ä¼šä»¥å‡ ä¹å®Œå…¨ç›¸åŒçš„æ–¹å¼å¤šæ¬¡ç¼–å†™è¿™ç§æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œé™¤äº†æ‰€æŒä¹…åŒ–çš„Spitterå¯¹è±¡ä¸åŒä»¥å¤–ï¼Œæˆ‘æ•¢æ‰“èµŒä½ ä»¥å‰è‚¯å®šå†™è¿‡ç±»ä¼¼çš„æ–¹æ³•ã€‚å…¶å®ï¼ŒJpaSpitterRepositoryä¸­çš„å…¶ä»–æ–¹æ³•ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åˆ›é€ æ€§ã€‚é¢†åŸŸå¯¹è±¡ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†æ˜¯æ‰€æœ‰Repositoryä¸­çš„æ–¹æ³•éƒ½æ˜¯å¾ˆé€šç”¨çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä¸€ééåœ°ç¼–å†™ç›¸åŒçš„æŒä¹…åŒ–æ–¹æ³•å‘¢ï¼Œéš¾é“ä»…ä»…æ˜¯å› ä¸ºè¦å¤„ç†çš„é¢†åŸŸç±»å‹ä¸åŒå—ï¼ŸSpring Data JPAèƒ½å¤Ÿç»ˆç»“è¿™ç§æ ·æ¿å¼çš„æ„šè ¢è¡Œä¸ºã€‚æˆ‘ä»¬ä¸å†éœ€è¦ä¸€ééåœ°ç¼–å†™ç›¸åŒçš„Repositoryå®ç°ï¼ŒSpring Dataèƒ½å¤Ÿè®©æˆ‘ä»¬åªç¼–å†™Repositoryæ¥å£å°±å¯ä»¥äº†ã€‚æ ¹æœ¬å°±ä¸å†éœ€è¦å®ç°ç±»äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span></span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–å†™Spring Data JPA Repositoryçš„å…³é”®åœ¨äºè¦ä»ä¸€ç»„æ¥å£ä¸­æŒ‘é€‰ä¸€ä¸ªè¿›è¡Œæ‰©å±•ã€‚è¿™é‡Œï¼ŒSpitterRepositoryæ‰©å±•äº†Spring Data JPAçš„JpaRepositoryï¼ˆç¨åï¼Œæˆ‘ä¼šä»‹ç»å‡ ä¸ªå…¶ä»–çš„æ¥å£ï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒJpaRepositoryè¿›è¡Œäº†å‚æ•°åŒ–ï¼Œæ‰€ä»¥å®ƒå°±èƒ½çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç”¨æ¥æŒä¹…åŒ–Spitterå¯¹è±¡çš„Repositoryï¼Œå¹¶ä¸”Spitterçš„IDç±»å‹ä¸ºLongã€‚å¦å¤–ï¼Œå®ƒè¿˜ä¼šç»§æ‰¿18ä¸ªæ‰§è¡ŒæŒä¹…åŒ–æ“ä½œçš„é€šç”¨æ–¹æ³•ï¼Œå¦‚ä¿å­˜Spitter ã€åˆ é™¤ Spitterä»¥åŠæ ¹æ®IDæŸ¥è¯¢Spitter ã€‚</p>
<p>æ­¤æ—¶ï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸‹ä¸€æ­¥å°±è¯¥ç¼–å†™ä¸€ä¸ªç±»å®ç°SpitterRepositoryå’Œå®ƒçš„18ä¸ªæ–¹æ³•äº†ã€‚å¦‚æœçœŸçš„æ˜¯è¿™æ ·çš„è¯ï¼Œé‚£æœ¬ç« å°±ä¼šå˜å¾—ä¹å‘³æ— èŠäº†ã€‚å…¶å®ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦ç¼–å†™SpitterRepositoryçš„ä»»ä½•å®ç°ç±»ï¼Œç›¸åï¼Œæˆ‘ä»¬è®©Spring Dataæ¥ä¸ºæˆ‘ä»¬åšè¿™ä»¶äº‹è¯·ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å¯¹å®ƒæå‡ºè¦æ±‚ã€‚</p>
<p>ä¸ºäº†è¦æ±‚Spring Dataåˆ›å»ºSpitterRepositoryçš„å®ç°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springé…ç½®ä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†åœ¨XMLé…ç½®ä¸­å¯ç”¨Spring Data JPAæ‰€éœ€è¦æ·»åŠ çš„å†…å®¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:jpa</span>=<span class="string">&quot;http://www.springframework.org/schema/data/jpa&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/data/jpa</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/data/jpa/spring-jpa-1.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.habuma.spittr.db&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&lt;jpa:repositories&gt;ä¼šæ‰«æå®ƒçš„åŸºç¡€åŒ…æ¥æŸ¥æ‰¾æ‰©å±•è‡ªSpring Data JPA Repositoryæ¥å£çš„æ‰€æœ‰æ¥å£ã€‚å¦‚æœå‘ç°äº†æ‰©å±•è‡ªRepositoryçš„æ¥å£ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆï¼ˆåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼‰è¿™ä¸ªæ¥å£çš„å®ç°ã€‚</p>
<p>å¦‚æœè¦ä½¿ç”¨Javaé…ç½®çš„è¯ï¼Œé‚£å°±ä¸éœ€è¦ä½¿ç”¨&lt;jpa:repositories&gt;å…ƒç´ äº†ï¼Œè€Œæ˜¯è¦åœ¨Javaé…ç½®ç±»ä¸Šæ·»åŠ @EnableJpaRepositoriesæ³¨è§£ã€‚å¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªJavaé…ç½®ç±»ï¼Œå®ƒä½¿ç”¨äº†@EnableJpaRepositoriesæ³¨è§£ï¼Œå¹¶ä¸”ä¼šæ‰«æcom.habuma.spittr.db åŒ…ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableJpaRepositories(basePackages=&quot;com.habuma.spittr.db&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaConfiguration</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è®©æˆ‘ä»¬å›åˆ°SpitterRepositoryæ¥å£ï¼Œå®ƒæ‰©å±•è‡ªJpaRepository ï¼Œè€Œ JpaRepositoryåˆæ‰©å±•è‡ªRepositoryæ ‡è®°æ¥å£ï¼ˆè™½ç„¶æ˜¯é—´æ¥çš„ï¼‰ã€‚å› æ­¤ï¼ŒSpitterRepositoryå°±ä¼ é€’æ€§åœ°æ‰©å±•äº†Repositoryæ¥å£ï¼Œä¹Ÿå°±æ˜¯Repositoryæ‰«ææ—¶æ‰€è¦æŸ¥æ‰¾çš„æ¥å£ã€‚å½“Spring Dataæ‰¾åˆ°å®ƒåï¼Œå°±ä¼šåˆ›å»ºSpitterRepositoryçš„å®ç°ç±»ï¼Œå…¶ä¸­åŒ…å«äº†ç»§æ‰¿è‡ªJpaRepository ã€ PagingAndSortingRepository å’Œ CrudRepositoryçš„18ä¸ªæ–¹æ³•ã€‚</p>
<p>å¾ˆé‡è¦çš„ä¸€ç‚¹åœ¨äºRepositoryçš„å®ç°ç±»æ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯Springçš„åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»ºçš„æ—¶å€™ã€‚å®ƒå¹¶ä¸æ˜¯åœ¨æ„å»ºæ—¶é€šè¿‡ä»£ç ç”ŸæˆæŠ€æœ¯äº§ç”Ÿçš„ï¼Œä¹Ÿä¸æ˜¯æ¥å£æ–¹æ³•è°ƒç”¨æ—¶æ‰åˆ›å»ºçš„ã€‚</p>
<p>Spring Data JPAå¾ˆæ£’çš„ä¸€ç‚¹åœ¨äºå®ƒèƒ½ä¸ºSpitterå¯¹è±¡æä¾›18ä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥è¿›è¡Œé€šç”¨çš„JPAæ“ä½œï¼Œè€Œæ— éœ€ä½ ç¼–å†™ä»»ä½•æŒä¹…åŒ–ä»£ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ çš„éœ€æ±‚è¶…è¿‡äº†å®ƒæ‰€æä¾›çš„è¿™18ä¸ªæ–¹æ³•çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¹¸å¥½ï¼ŒSpring Data JPAæä¾›äº†å‡ ç§æ–¹å¼æ¥ä¸ºRepositoryæ·»åŠ è‡ªå®šä¹‰çš„æ–¹æ³•ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä¸ºSpring Data JPAç¼–å†™è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•ã€‚</p>
<h4 id="å®šä¹‰æŸ¥è¯¢æ–¹æ³•">å®šä¹‰æŸ¥è¯¢æ–¹æ³•</h4>
<p>ç°åœ¨ï¼Œ SpitterRepositoryéœ€è¦å®Œæˆçš„ä¸€é¡¹åŠŸèƒ½æ˜¯æ ¹æ®ç»™å®šçš„usernameæŸ¥æ‰¾Spitterå¯¹è±¡ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å°†SpitterRepositoryæ¥å£ä¿®æ”¹ä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„æ ·å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span></span></span><br><span class="line"><span class="class">       <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function">Spitter <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å®ç°findByUsername()ã€‚æ–¹æ³•ç­¾åå·²ç»å‘Šè¯‰Spring Data JPAè¶³å¤Ÿçš„ä¿¡æ¯æ¥åˆ›å»ºè¿™ä¸ªæ–¹æ³•çš„å®ç°äº†ã€‚</p>
<p>å½“åˆ›å»ºRepositoryå®ç°çš„æ—¶å€™ï¼ŒSpring Dataä¼šæ£€æŸ¥Repositoryæ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œè§£ææ–¹æ³•çš„åç§°ï¼Œå¹¶åŸºäºè¢«æŒä¹…åŒ–çš„å¯¹è±¡æ¥è¯•å›¾æ¨æµ‹æ–¹æ³•çš„ç›®çš„ã€‚æœ¬è´¨ä¸Šï¼ŒSpring Dataå®šä¹‰äº†ä¸€ç»„å°å‹çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆdomain-specific language ï¼ŒDSLï¼‰ï¼Œåœ¨è¿™é‡Œï¼ŒæŒä¹…åŒ–çš„ç»†èŠ‚éƒ½æ˜¯é€šè¿‡Repositoryæ–¹æ³•çš„ç­¾åæ¥æè¿°çš„ã€‚</p>
<p>Spring Dataèƒ½å¤ŸçŸ¥é“è¿™ä¸ªæ–¹æ³•æ˜¯è¦æŸ¥æ‰¾Spitterçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨Spitter å¯¹ JpaRepositoryè¿›è¡Œäº†å‚æ•°åŒ–ã€‚æ–¹æ³•åfindByUsernameç¡®å®šè¯¥æ–¹æ³•éœ€è¦æ ¹æ®usernameå±æ€§ç›¸åŒ¹é…æ¥æŸ¥æ‰¾Spitter ï¼Œè€Œ usernameæ˜¯ä½œä¸ºå‚æ•°ä¼ é€’åˆ°æ–¹æ³•ä¸­æ¥çš„ã€‚å¦å¤–ï¼Œå› ä¸ºåœ¨æ–¹æ³•ç­¾åä¸­å®šä¹‰äº†è¯¥æ–¹æ³•è¦è¿”å›ä¸€ä¸ªSpitterå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé›†åˆï¼Œå› æ­¤å®ƒåªä¼šæŸ¥æ‰¾ä¸€ä¸ªusernameå±æ€§åŒ¹é…çš„Spitter ã€‚</p>
<p>findByUsername()æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯Spring Dataä¹Ÿèƒ½å¤„ç†æ›´åŠ æœ‰æ„æ€çš„æ–¹æ³•åç§°ã€‚Repositoryæ–¹æ³•æ˜¯ç”±ä¸€ä¸ªåŠ¨è¯ã€ä¸€ä¸ªå¯é€‰çš„ä¸»é¢˜ï¼ˆSubjectï¼‰ã€å…³é”®è¯Byä»¥åŠä¸€ä¸ªæ–­è¨€æ‰€ç»„æˆã€‚åœ¨findByUsername()è¿™ä¸ªæ ·ä¾‹ä¸­ï¼ŒåŠ¨è¯æ˜¯find</p>
<blockquote>
<p>å…¶å®è¿˜å¯ä»¥å†™æ›´åŠ å¤æ‚çš„æ–¹æ³•ï¼Œå…·ä½“å†…å®¹å¯å‚è€ƒâ€“ã€‹[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindle ä½ç½® 5495-5496). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
</blockquote>
<p>ä¸è¿‡ï¼ŒSpring Dataè¿™ä¸ªå°å‹çš„DSLä¾æ—§æœ‰å…¶å±€é™æ€§ï¼Œæœ‰æ—¶å€™é€šè¿‡æ–¹æ³•åç§°è¡¨è¾¾é¢„æœŸçš„æŸ¥è¯¢å¾ˆçƒ¦çï¼Œç”šè‡³æ— æ³•å®ç°ã€‚å¦‚æœé‡åˆ°è¿™ç§æƒ…å½¢çš„è¯ï¼ŒSpring Dataèƒ½å¤Ÿè®©æˆ‘ä»¬é€šè¿‡@Queryæ³¨è§£æ¥è§£å†³é—®é¢˜ã€‚</p>
<h4 id="å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢">å£°æ˜è‡ªå®šä¹‰æŸ¥è¯¢</h4>
<p>å‡è®¾æˆ‘ä»¬æƒ³è¦åˆ›å»ºä¸€ä¸ªRepositoryæ–¹æ³•ï¼Œç”¨æ¥æŸ¥æ‰¾E-mailåœ°å€æ˜¯Gmailé‚®ç®±çš„Spitterã€‚æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯å®šä¹‰ä¸€ä¸ªfindByEmailLike()æ–¹æ³•ï¼Œç„¶åæ¯æ¬¡æƒ³æŸ¥æ‰¾Gmailç”¨æˆ·çš„æ—¶å€™å°±å°†â€œ%<a href="http://gmail.com">gmail.com</a>â€ä¼ é€’è¿›æ¥ã€‚ä¸è¿‡ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ªæ›´åŠ ä¾¿åˆ©çš„findAllGmailSpitters()æ–¹æ³•ï¼Œè¿™æ ·çš„è¯ï¼Œå°±ä¸ç”¨å°†Emailåœ°å€çš„ä¸€éƒ¨åˆ†ä¼ é€’è¿›æ¥äº†ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">findAllGmailSpitters</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>ä¸è¿‡ï¼Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸ç¬¦åˆSpring Dataçš„æ–¹æ³•å‘½åçº¦å®šã€‚å½“Spring Dataè¯•å›¾ç”Ÿæˆè¿™ä¸ªæ–¹æ³•çš„å®ç°æ—¶ï¼Œæ— æ³•å°†æ–¹æ³•åçš„å†…å®¹ä¸Spitterå…ƒæ¨¡å‹è¿›è¡ŒåŒ¹é…ï¼Œå› æ­¤ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>å¦‚æœæ‰€éœ€çš„æ•°æ®æ— æ³•é€šè¿‡æ–¹æ³•åç§°è¿›è¡Œæ°å½“åœ°æè¿°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Queryæ³¨è§£ï¼Œä¸ºSpring Dataæä¾›è¦æ‰§è¡Œçš„æŸ¥è¯¢ã€‚å¯¹äºfindAllGmailSpitters()æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥ä½¿ç”¨@Query æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select s from Spitter s where s.email like &#x27;%gmail.com&#x27;&quot;)</span></span><br><span class="line"><span class="function">List&lt;Spitter&gt; <span class="title">findAllGmailSpitters</span><span class="params">()</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¾ç„¶ä¸éœ€è¦ç¼–å†™findAllGmailSpitters()æ–¹æ³•çš„å®ç°ï¼Œåªéœ€æä¾›æŸ¥è¯¢å³å¯ï¼Œè®©Spring Data JPAçŸ¥é“å¦‚ä½•å®ç°è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p>å¯¹äºSpring Data JPAçš„æ¥å£æ¥è¯´ï¼Œ@Queryæ˜¯ä¸€ç§æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢çš„ä¾¿åˆ©æ–¹å¼ã€‚ä½†æ˜¯ï¼Œå®ƒä»…é™äºå•ä¸ªJPAæŸ¥è¯¢ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æ›´ä¸ºå¤æ‚çš„åŠŸèƒ½ï¼Œæ— æ³•åœ¨ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ä¸­å¤„ç†çš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h4 id="æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½">æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½</h4>
<p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦Repositoryæ‰€æä¾›çš„åŠŸèƒ½æ˜¯æ— æ³•ç”¨Spring Dataçš„æ–¹æ³•å‘½åçº¦å®šæ¥æè¿°çš„ï¼Œç”šè‡³æ— æ³•ç”¨@Queryæ³¨è§£è®¾ç½®æŸ¥è¯¢æ¥å®ç°ã€‚å°½ç®¡Spring Data JPAéå¸¸æ£’ï¼Œä½†æ˜¯å®ƒä¾ç„¶æœ‰å…¶å±€é™æ€§ï¼Œå¯èƒ½éœ€è¦æˆ‘ä»¬æŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼æ¥ç¼–å†™Repositoryæ–¹æ³•ï¼šä¹Ÿå°±æ˜¯ç›´æ¥ä½¿ç”¨EntityManagerã€‚å½“é‡åˆ°è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¦æ”¾å¼ƒSpring Data JPAï¼Œé‡æ–°æŒ‰ç…§11.2.2å°èŠ‚ä¸­çš„æ–¹å¼æ¥ç¼–å†™Repositoryå‘¢ï¼Ÿ</p>
<p>ç®€å•æ¥è¯´ï¼Œæ˜¯è¿™æ ·çš„ã€‚å¦‚æœä½ éœ€è¦åšçš„äº‹æƒ…æ— æ³•é€šè¿‡Spring Data JPAæ¥å®ç°ï¼Œé‚£å°±å¿…é¡»è¦åœ¨ä¸€ä¸ªæ¯”Spring Data JPAæ›´ä½çš„å±‚çº§ä¸Šä½¿ç”¨JPAã€‚å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬æ²¡æœ‰å¿…è¦å®Œå…¨æ”¾å¼ƒSpring Data JPAã€‚æˆ‘ä»¬åªéœ€åœ¨å¿…é¡»ä½¿ç”¨è¾ƒä½å±‚çº§JPAçš„æ–¹æ³•ä¸Šï¼Œæ‰ä½¿ç”¨è¿™ç§ä¼ ç»Ÿçš„æ–¹å¼å³å¯ï¼Œè€Œå¯¹äºSpring Data JPAçŸ¥é“è¯¥å¦‚ä½•å¤„ç†çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡å®ƒæ¥å®ç°ã€‚</p>
<p><strong>å½“Spring Data JPAä¸ºRepositoryæ¥å£ç”Ÿæˆå®ç°çš„æ—¶å€™ï¼Œå®ƒè¿˜ä¼šæŸ¥æ‰¾åå­—ä¸æ¥å£ç›¸åŒï¼Œå¹¶ä¸”æ·»åŠ äº†Implåç¼€çš„ä¸€ä¸ªç±»ã€‚å¦‚æœè¿™ä¸ªç±»å­˜åœ¨çš„è¯ï¼ŒSpring Data JPAå°†ä¼šæŠŠå®ƒçš„æ–¹æ³•ä¸Spring Data JPAæ‰€ç”Ÿæˆçš„æ–¹æ³•åˆå¹¶åœ¨ä¸€èµ·</strong>ã€‚å¯¹äºSpitterRepositoryæ¥å£è€Œè¨€ï¼Œè¦æŸ¥æ‰¾çš„ç±»åä¸ºSpitterRepositoryImpl ã€‚</p>
<p>ä¸ºäº†é˜è¿°è¯¥åŠŸèƒ½ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åœ¨SpitterRepositoryä¸­æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œå‘è¡¨Spittleæ•°é‡åœ¨10,000åŠä»¥ä¸Šçš„Spitterå°†ä¼šæ›´æ–°ä¸ºEliteçŠ¶æ€ã€‚ä½¿ç”¨Spring Data JPAçš„æ–¹æ³•å‘½åçº¦å®šæˆ–ä½¿ç”¨@Queryå‡æ²¡æœ‰åŠæ³•å£°æ˜è¿™æ ·çš„æ–¹æ³•ã€‚æœ€ä¸ºå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨å¦‚ä¸‹çš„eliteSweep() æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpitterRepositoryImpl</span> <span class="keyword">implements</span> <span class="title">SpitterSweeper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@PersistenceContext</span></span><br><span class="line">  <span class="keyword">private</span> EntityManager em;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eliteSweep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String update =</span><br><span class="line">        <span class="string">&quot;UPDATE Spitter spitter &quot;</span> +</span><br><span class="line">        <span class="string">&quot;SET spitter.status = &#x27;Elite&#x27; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;WHERE spitter.status = &#x27;Newbie&#x27; &quot;</span> +</span><br><span class="line">        <span class="string">&quot;AND spitter.id IN (&quot;</span> +</span><br><span class="line">        <span class="string">&quot;SELECT s FROM Spitter s WHERE (&quot;</span> +</span><br><span class="line">        <span class="string">&quot;  SELECT COUNT(spittles) FROM s.spittles spittles) &gt; 10000&quot;</span> +</span><br><span class="line">        <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> em.createQuery(update).executeUpdate();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpitterRepositoryImplæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šä¹‹å¤„ï¼Œå®ƒä½¿ç”¨è¢«æ³¨å…¥çš„EntityManageræ¥å®Œæˆé¢„æœŸçš„ä»»åŠ¡ã€‚</p>
<p>æ³¨æ„ï¼Œ SpitterRepositoryImplå¹¶æ²¡æœ‰å®ç°SpitterRepositoryæ¥å£ã€‚Spring Data JPAè´Ÿè´£å®ç°è¿™ä¸ªæ¥å£ã€‚SpitterRepositoryImplï¼ˆå°†å®ƒä¸Spring Dataçš„Repositoryå…³è”èµ·æ¥çš„æ˜¯å®ƒçš„åå­—ï¼‰å®ç°äº†SpitterSweeperæ¥å£ï¼Œå®ƒå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterSweeper</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">eliteSweep</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬<strong>è¿˜éœ€è¦ç¡®ä¿eliteSweep()æ–¹æ³•ä¼šè¢«å£°æ˜åœ¨SpitterRepositoryæ¥å£ä¸­ã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼Œé¿å…ä»£ç é‡å¤çš„ç®€å•æ–¹å¼å°±æ˜¯ä¿®æ”¹SpitterRepository</strong>ï¼Œè®©å®ƒæ‰©å±•SpitterSweeper ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SpitterRepository</span></span></span><br><span class="line"><span class="class">       <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Spitter</span>, <span class="title">Long</span>&gt;,</span></span><br><span class="line"><span class="class">               <span class="title">SpitterSweeper</span> </span>&#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚å‰æ‰€è¿°ï¼ŒSpring Data JPAå°†å®ç°ç±»ä¸æ¥å£å…³è”èµ·æ¥æ˜¯åŸºäºæ¥å£çš„åç§°ã€‚ä½†æ˜¯ï¼ŒImplåç¼€åªæ˜¯é»˜è®¤çš„åšæ³•ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨å…¶ä»–åç¼€çš„è¯ï¼Œåªéœ€åœ¨é…ç½®@EnableJpa-Repositoriesçš„æ—¶å€™ï¼Œè®¾ç½®repositoryImplementationPostfixå±æ€§å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@EnableJpaRepositories(</span></span><br><span class="line"><span class="meta">  basePackages=&quot;com.habuma.spittr.db&quot;,</span></span><br><span class="line"><span class="meta">  repositoryImplementationPostfix=&quot;Helper&quot;)</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœåœ¨XMLä¸­ä½¿ç”¨<a href="jpa:repositories">jpa:repositories</a>å…ƒç´ æ¥é…ç½®Spring Data JPAçš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©repository-impl-postfixå±æ€§æŒ‡å®šåç¼€ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">jpa:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.habuma.spittr.db&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">repository-impl-postfix</span>=<span class="string">&quot;Helper&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶å®ï¼Œæ··åˆè‡ªå®šä¹‰çš„æ„æ€å°±æ˜¯è¿™æ®µè¯ï¼š<strong>å½“Spring Data JPAä¸ºRepositoryæ¥å£ç”Ÿæˆå®ç°çš„æ—¶å€™ï¼Œå®ƒè¿˜ä¼šæŸ¥æ‰¾åå­—ä¸æ¥å£ç›¸åŒï¼Œå¹¶ä¸”æ·»åŠ äº†Implåç¼€çš„ä¸€ä¸ªç±»ã€‚å¦‚æœè¿™ä¸ªç±»å­˜åœ¨çš„è¯ï¼ŒSpring Data JPAå°†ä¼šæŠŠå®ƒçš„æ–¹æ³•ä¸Spring Data JPAæ‰€ç”Ÿæˆçš„æ–¹æ³•åˆå¹¶åœ¨ä¸€èµ·</strong>ã€‚</p>
<p>å°±æ˜¯æ‰€éœ€è¦æ·»åŠ çš„åŠŸèƒ½é€šè¿‡åˆå¹¶ä¸€ä¸ªå®ç°ç±»æ¥å®Œæˆå…¶æ‰€éœ€è¦çš„åŠŸèƒ½ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦ä¿®æ”¹xxxRepositoryæ¥å£ã€‚</p>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Spring-ä½¿ç”¨NoSQLæ•°æ®åº“</title>
    <url>/2020/11/24/Spring-%E4%BD%BF%E7%94%A8NoSQL%E6%95%B0%E6%8D%AE%E5%BA%93/</url>
    <content><![CDATA[<h2 id="ä½¿ç”¨MongoDBæŒä¹…åŒ–æ•°æ®æ–‡æ¡£">ä½¿ç”¨MongoDBæŒä¹…åŒ–æ•°æ®æ–‡æ¡£</h2>
<p>MongoDBæ˜¯æœ€ä¸ºæµè¡Œçš„å¼€æºæ–‡æ¡£æ•°æ®åº“ä¹‹ä¸€ã€‚Spring Data MongoDBæä¾›äº†ä¸‰ç§æ–¹å¼åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨MongoDBï¼š<a id="more"></a></p>
<ul>
<li>é€šè¿‡æ³¨è§£å®ç°å¯¹è±¡-æ–‡æ¡£æ˜ å°„ï¼›</li>
<li>ä½¿ç”¨ MongoTemplateå®ç°åŸºäºæ¨¡æ¿çš„æ•°æ®åº“è®¿é—®ï¼›</li>
<li>è‡ªåŠ¨åŒ–çš„è¿è¡Œæ—¶Repositoryç”ŸæˆåŠŸèƒ½ã€‚</li>
</ul>
<p>ä¸è¿‡ï¼Œä¸Spring Data JPAä¸åŒçš„æ˜¯ï¼ŒSpring Data MongoDBæä¾›äº†å°†Javaå¯¹è±¡æ˜ å°„ä¸ºæ–‡æ¡£çš„åŠŸèƒ½ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒSpring Data MongoDBä¸ºé€šç”¨çš„æ–‡æ¡£æ“ä½œä»»åŠ¡æä¾›äº†åŸºäºæ¨¡æ¿çš„æ•°æ®è®¿é—®æ–¹å¼ã€‚</p>
<h3 id="å¯åŠ¨MongoDB">å¯åŠ¨MongoDB</h3>
<p>ä¸ºäº†æœ‰æ•ˆåœ°ä½¿ç”¨Spring Data MongoDBï¼Œæˆ‘ä»¬éœ€è¦åœ¨Springé…ç½®ä¸­æ·»åŠ å‡ ä¸ªå¿…è¦çš„beanã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é…ç½®MongoClientï¼Œä»¥ä¾¿äºè®¿é—®MongoDBæ•°æ®åº“ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ªMongoTemplate beanï¼Œå®ç°åŸºäºæ¨¡æ¿çš„æ•°æ®åº“è®¿é—®ã€‚æ­¤å¤–ï¼Œä¸æ˜¯å¿…é¡»ï¼Œä½†æ˜¯å¼ºçƒˆæ¨èå¯ç”¨Spring Data MongoDBçš„è‡ªåŠ¨åŒ–Repositoryç”ŸæˆåŠŸèƒ½ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.config.</span><br><span class="line">                                              EnableMongoRepositories;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.Mongo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMongoRepositories(basePackages=&quot;orders.db&quot;)</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConfig</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MongoFactoryBean <span class="title">mongo</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">      MongoFactoryBean mongo = <span class="keyword">new</span> MongoFactoryBean();</span><br><span class="line">      mongo.setHost(<span class="string">&quot;localhost&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> mongo;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MongoOperations <span class="title">mongoTemplate</span><span class="params">(Mongo mongo)</span> </span>&#123;	</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> MongoTemplate(mongo, <span class="string">&quot;OrdersDB&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Repositoryç”ŸæˆåŠŸèƒ½ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œ@EnableMongoRepositoriesä¸ºMongoDBå®ç°äº†è‡ªåŠ¨åŒ–Repositoryç”ŸæˆåŠŸèƒ½ï¼›</p>
<p>ç¬¬ä¸€ä¸ª@Beanæ–¹æ³•ä½¿ç”¨MongoFactoryBeanå£°æ˜äº†ä¸€ä¸ªMongoå®ä¾‹ã€‚è¿™ä¸ªbeanå°†Spring Data MongoDBä¸æ•°æ®åº“æœ¬èº«è¿æ¥äº†èµ·æ¥ï¼ˆä¸ä½¿ç”¨å…³ç³»å‹æ•°æ®æ—¶DataSourceæ‰€åšçš„äº‹æƒ…å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼‰ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨MongoClient ç›´æ¥åˆ›å»º Mongoå®ä¾‹ï¼Œä½†å¦‚æœè¿™æ ·åšçš„è¯ï¼Œå°±å¿…é¡»è¦å¤„ç†MongoClientæ„é€ å™¨æ‰€æŠ›å‡ºçš„UnknownHostExceptionå¼‚å¸¸ã€‚åœ¨è¿™é‡Œï¼Œä½¿ç”¨Spring Data MongoDBçš„MongoFactoryBeanæ›´åŠ ç®€å•ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå·¥å‚beanï¼Œå› æ­¤MongoFactoryBeanä¼šè´Ÿè´£æ„å»ºMongoå®ä¾‹ï¼Œæˆ‘ä»¬ä¸å¿…å†æ‹…å¿ƒUnknownHostException å¼‚å¸¸ã€‚</p>
<p>å¦å¤–ä¸€ä¸ª @Beanæ–¹æ³•å£°æ˜äº†MongoTemplate beanï¼Œåœ¨å®ƒæ„é€ æ—¶ï¼Œä½¿ç”¨äº†å…¶ä»–@Beanæ–¹æ³•æ‰€åˆ›å»ºçš„Mongoå®ä¾‹çš„å¼•ç”¨ä»¥åŠæ•°æ®åº“çš„åç§°ã€‚ç¨åï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨MongoTemplateæ¥æŸ¥è¯¢æ•°æ®åº“ã€‚å³ä¾¿ä¸ç›´æ¥ä½¿ç”¨MongoTemplateï¼Œæˆ‘ä»¬ä¹Ÿä¼šéœ€è¦è¿™ä¸ªbeanï¼Œå› ä¸ºRepositoryçš„è‡ªåŠ¨åŒ–ç”ŸæˆåŠŸèƒ½åœ¨åº•å±‚ä½¿ç”¨äº†å®ƒã€‚</p>
<p>é™¤äº†ç›´æ¥å£°æ˜è¿™äº›beanï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®©é…ç½®ç±»æ‰©å±•AbstractMongo-Configuration å¹¶é‡è½½ getDatabaseName() å’Œ mongo()æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.config.</span><br><span class="line">                                           AbstractMongoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.config.</span><br><span class="line">                                              EnableMongoRepositories;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.Mongo;</span><br><span class="line"><span class="keyword">import</span> com.mongodb.MongoClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableMongoRepositories(&quot;orders.db&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoConfig</span> <span class="keyword">extends</span> <span class="title">AbstractMongoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> String <span class="title">getDatabaseName</span><span class="params">()</span> </span>&#123;	</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;OrdersDB&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;	</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MongoClient();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ–°çš„é…ç½®ç±»ä¸ä¸Šä¸€ä¸ªé…ç½®ç±»çš„åŠŸèƒ½æ˜¯ç›¸åŒçš„ï¼Œåªä¸è¿‡åœ¨ç¯‡å¹…ä¸Šæ›´åŠ ç®€æ´ã€‚æœ€ä¸ºæ˜¾è‘—çš„åŒºåˆ«åœ¨äºè¿™ä¸ªé…ç½®ä¸­æ²¡æœ‰ç›´æ¥å£°æ˜MongoTemplate beanï¼Œå½“ç„¶å®ƒè¿˜æ˜¯ä¼šè¢«éšå¼åœ°åˆ›å»ºã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé‡è½½äº†getDatabaseName()æ–¹æ³•æ¥æä¾›æ•°æ®åº“çš„åç§°ã€‚mongo()æ–¹æ³•ä¾ç„¶ä¼šåˆ›å»ºä¸€ä¸ªMongoClientçš„å®ä¾‹ï¼Œå› ä¸ºå®ƒä¼šæŠ›å‡ºExceptionï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨MongoClientï¼Œè€Œä¸å¿…å†ä½¿ç”¨MongoFactoryBean</p>
<p>MongoDBæä¾›äº†ä¸€ä¸ªè¿è¡Œé…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦MongoDBæœåŠ¡å™¨è¿è¡Œåœ¨æœ¬åœ°å³å¯ã€‚å¦‚æœMongoDBæœåŠ¡å™¨è¿è¡Œåœ¨å…¶ä»–çš„æœºå™¨ä¸Šï¼Œé‚£ä¹ˆå¯ä»¥åœ¨åˆ›å»ºMongoClientçš„æ—¶å€™è¿›è¡ŒæŒ‡å®šï¼›å¦å¤–ï¼ŒMongoDBæœåŠ¡å™¨æœ‰å¯èƒ½ç›‘å¬çš„ç«¯å£å¹¶ä¸æ˜¯é»˜è®¤çš„27017ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œåœ¨åˆ›å»ºMongoClientçš„æ—¶å€™ï¼Œè¿˜éœ€è¦æŒ‡å®šç«¯å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MongoClient(<span class="string">&quot;mongodbserver&quot;</span>, <span class="number">37017</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœMongoDBæœåŠ¡å™¨è¿è¡Œåœ¨ç”Ÿäº§é…ç½®ä¸Šï¼Œæˆ‘è®¤ä¸ºä½ å¯èƒ½è¿˜å¯ç”¨äº†è®¤è¯åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†è®¿é—®æ•°æ®åº“ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›åº”ç”¨çš„å‡­è¯ã€‚è®¿é—®éœ€è¦è®¤è¯çš„MongoDBæœåŠ¡å™¨ç¨å¾®æœ‰äº›å¤æ‚ï¼Œå¦‚ä¸‹é¢çš„ç¨‹åºæ¸…å•æ‰€ç¤ºã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Mongo <span class="title">mongo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  MongoCredential credential =</span><br><span class="line">    MongoCredential.createMongoCRCredential(	</span><br><span class="line">        env.getProperty(<span class="string">&quot;mongo.username&quot;</span>),</span><br><span class="line">        <span class="string">&quot;OrdersDB&quot;</span>,</span><br><span class="line">        env.getProperty(<span class="string">&quot;mongo.password&quot;</span>).toCharArray());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MongoClient(	</span><br><span class="line">       <span class="keyword">new</span> ServerAddress(<span class="string">&quot;localhost&quot;</span>, <span class="number">37017</span>),</span><br><span class="line">      Arrays.asList(credential));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è®¿é—®éœ€è¦è®¤è¯çš„MongoDBæœåŠ¡å™¨ï¼ŒMongoClientåœ¨å®ä¾‹åŒ–çš„æ—¶å€™å¿…é¡»è¦æœ‰ä¸€ä¸ªMongoCredentialçš„åˆ—è¡¨ã€‚ä¸ºæ­¤æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªMongoCredentialã€‚ä¸ºäº†å°†å‡­è¯ä¿¡æ¯çš„ç»†èŠ‚æ”¾åœ¨é…ç½®ç±»å¤–è¾¹ï¼Œå®ƒä»¬æ˜¯é€šè¿‡æ³¨å…¥çš„Environmentå¯¹è±¡è§£æå¾—åˆ°çš„ã€‚</p>
<h4 id="xmlé…ç½®">xmlé…ç½®</h4>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:mongo</span>=<span class="string">&quot;http://www.springframework.org/schema/data/mongo&quot;</span>	</span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/data/mongo</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/data/mongo/spring-mongo.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;orders.db&quot;</span> /&gt;</span>	</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:mongo</span> /&gt;</span>	</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mongoTemplate&quot;</span>	</span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">&quot;mongo&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;OrdersDB&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç°åœ¨Spring Data MongoDBå·²ç»é…ç½®å®Œæˆäº†ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¿å­˜å’ŒæŸ¥è¯¢æ–‡æ¡£äº†ã€‚ä½†é¦–å…ˆï¼Œéœ€è¦ä½¿ç”¨Spring Data MongoDBçš„å¯¹è±¡-æ–‡æ¡£æ˜ å°„æ³¨è§£ä¸ºJavaé¢†åŸŸå¯¹è±¡å»ºç«‹åˆ°æŒä¹…åŒ–æ–‡æ¡£çš„æ˜ å°„å…³ç³»ã€‚</p>
<p>MongoDBå¹¶æ²¡æœ‰æä¾›å¯¹è±¡-æ–‡æ¡£æ˜ å°„çš„æ³¨è§£ã€‚Spring Data MongoDBå¡«è¡¥äº†è¿™ä¸€ç©ºç™½ï¼Œæä¾›äº†ä¸€äº›å°†Javaç±»å‹æ˜ å°„ä¸ºMongoDBæ–‡æ¡£çš„æ³¨è§£ã€‚</p>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Document</td>
<td>æ ‡ç¤ºæ˜ å°„åˆ°MongoDBæ–‡æ¡£ä¸Šçš„é¢†åŸŸå¯¹è±¡</td>
</tr>
<tr>
<td>@Id</td>
<td>æ ‡ç¤ºæŸä¸ªåŸŸä¸ºIDåŸŸ</td>
</tr>
<tr>
<td>@DbRef</td>
<td>æ ‡ç¤ºæŸä¸ªåŸŸè¦å¼•ç”¨å…¶ä»–çš„æ–‡æ¡£ï¼Œè¿™ä¸ªæ–‡æ¡£æœ‰å¯èƒ½ä½äºå¦å¤–ä¸€ä¸ªæ•°æ®åº“ä¸­</td>
</tr>
<tr>
<td>@Field</td>
<td>ä¸ºæ–‡æ¡£åŸŸæŒ‡å®šè‡ªå®šä¹‰çš„å…ƒæ•°æ®</td>
</tr>
<tr>
<td>@Version</td>
<td>æ ‡ç¤ºæŸä¸ªå±æ€§ç”¨ä½œç‰ˆæœ¬åŸŸ</td>
</tr>
</tbody>
</table>
<p>@Document å’Œ @Idæ³¨è§£ç±»ä¼¼äºJPAçš„@Entity å’Œ @Idæ³¨è§£ã€‚æˆ‘ä»¬å°†ä¼šç»å¸¸ä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ï¼Œå¯¹äºè¦ä»¥æ–‡æ¡£å½¢å¼ä¿å­˜åˆ°MongoDBæ•°æ®åº“çš„æ¯ä¸ªJavaç±»å‹éƒ½ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashSet;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Field;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Document</span>	</span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="keyword">private</span> String id;	</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Field(&quot;client&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String customer;	</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Collection&lt;Item&gt; items = <span class="keyword">new</span> LinkedHashSet&lt;Item&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> customer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(String customer)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.customer = customer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> type;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setType</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.type = type;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Collection&lt;Item&gt; <span class="title">getItems</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItems</span><span class="params">(Collection&lt;Item&gt; items)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.items = items;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŒæ—¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯itemså±æ€§ï¼Œå®ƒæŒ‡çš„æ˜¯è®¢å•ä¸­å…·ä½“æ¡ç›®çš„é›†åˆã€‚åœ¨ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ä¸­ï¼Œè¿™äº›æ¡ç›®å°†ä¼šä¿å­˜åœ¨å¦å¤–çš„ä¸€ä¸ªæ•°æ®åº“è¡¨ä¸­ï¼Œé€šè¿‡å¤–é”®è¿›è¡Œåº”ç”¨ï¼ŒitemsåŸŸä¸Šå¾ˆå¯èƒ½è¿˜ä¼šä½¿ç”¨JPAçš„@OneToManyæ³¨è§£ã€‚ä½†åœ¨è¿™é‡Œï¼Œæƒ…å½¢å®Œå…¨ä¸åŒã€‚å®ƒå§‹ç»ˆå›äº‹Orderæ–‡æ¡£ä¸­Itemåˆ—è¡¨çš„ä¸€ä¸ªæˆå‘˜ï¼Œå¹¶ä¸”ä¼šä½œä¸ºæ–‡æ¡£ä¸­çš„åµŒå…¥å…ƒç´ ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ æƒ³æŒ‡å®šItemä¸­çš„æŸä¸ªåŸŸå¦‚ä½•æŒä¹…åŒ–åˆ°æ–‡æ¡£ä¸­ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ºå¯¹åº”çš„Item å±æ€§æ·»åŠ  @Fieldæ³¨è§£ã€‚ä¸è¿‡åœ¨æœ¬ä¾‹ä¸­ï¼Œå¹¶æ²¡æœ‰å¿…è¦è¿™æ ·åšã€‚</p>
<h4 id="ä½¿ç”¨MongoTemplateè®¿é—®MongoDB">ä½¿ç”¨MongoTemplateè®¿é—®MongoDB</h4>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">MongoOperations mongo;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†MongoTemplateæ³¨å…¥åˆ°ä¸€ä¸ªç±»å‹ä¸ºMongoOperationsçš„å±æ€§ä¸­ã€‚MongoOperations æ˜¯ MongoTemplateæ‰€å®ç°çš„æ¥å£ï¼Œä¸ä½¿ç”¨å…·ä½“å®ç°æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ï¼Œå°¤å…¶æ˜¯åœ¨æ³¨å…¥çš„æ—¶å€™ã€‚</p>
<p>MongoOperationsæš´éœ²äº†å¤šä¸ªä½¿ç”¨MongoDBæ–‡æ¡£æ•°æ®åº“çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å¯èƒ½è®¨è®ºæ‰€æœ‰çš„æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸€ä¸‹æœ€ä¸ºå¸¸ç”¨çš„å‡ ä¸ªæ“ä½œï¼Œæ¯”å¦‚è®¡ç®—æ–‡æ¡£é›†åˆä¸­æœ‰å¤šå°‘æ¡æ–‡æ¡£ã€‚ä½¿ç”¨æ³¨å…¥çš„MongoOperationsï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°Orderé›†åˆå¹¶è°ƒç”¨count()æ¥å¾—åˆ°æ•°é‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">long</span> orderCount = mongo.getCollection(<span class="string">&quot;order&quot;</span>).count();</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œå‡è®¾è¦ä¿å­˜ä¸€ä¸ªæ–°çš„Orderã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Order order = <span class="keyword">new</span> Order();</span><br><span class="line">... <span class="comment">// set properties and add line items</span></span><br><span class="line">mongo.save(order, <span class="string">&quot;order&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ›´é«˜çº§çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬éœ€è¦æ„é€ Queryå¯¹è±¡å¹¶å°†å…¶ä¼ é€’ç»™find()æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾æ‰€æœ‰clientåŸŸç­‰äºâ€œChuck Wagon&quot;çš„è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Order&gt; chucksOrders = mongo.find(Query.query(</span><br><span class="line">    Criteria.where(<span class="string">&quot;client&quot;</span>).is(<span class="string">&quot;Chuck Wagon&quot;</span>)), Order.class);</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œç”¨æ¥æ„é€ Queryå¯¹è±¡çš„Criteriaåªæ£€æŸ¥äº†ä¸€ä¸ªåŸŸï¼Œä½†æ˜¯å®ƒä¹Ÿå¯ä»¥ç”¨æ¥æ„é€ æ›´åŠ æœ‰æ„æ€çš„æŸ¥è¯¢ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦æŸ¥è¯¢Chuckæ‰€æœ‰é€šè¿‡Webåˆ›å»ºçš„è®¢å•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Order&gt; chucksWebOrders = mongo.find(Query.query(</span><br><span class="line">    Criteria.where(<span class="string">&quot;customer&quot;</span>).is(<span class="string">&quot;Chuck Wagon&quot;</span>)</span><br><span class="line">            .and(<span class="string">&quot;type&quot;</span>).is(<span class="string">&quot;WEB&quot;</span>)), Order.class);</span><br></pre></td></tr></table></figure>
<p>é€šå¸¸æ¥è®²ï¼Œæˆ‘ä»¬ä¼šå°†MongoOperationsæ³¨å…¥åˆ°è‡ªå·±è®¾è®¡çš„Repositoryç±»ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒçš„æ“ä½œæ¥å®ç°Repositoryæ–¹æ³•ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä¸æ„¿æ„ç¼–å†™Repositoryçš„è¯ï¼Œé‚£ä¹ˆSpring Data MongoDBèƒ½å¤Ÿè‡ªåŠ¨åœ¨è¿è¡Œæ—¶ç”ŸæˆRepositoryå®ç°ã€‚ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<h4 id="ç¼–å†™MongoDB-Responsitory">ç¼–å†™MongoDB Responsitory</h4>
<p>æˆ‘ä»¬å·²ç»é€šè¿‡@EnableMongoRepositoriesæ³¨è§£å¯ç”¨äº†Spring Data MongoDBçš„RepositoryåŠŸèƒ½ï¼Œæ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ¥å£ï¼ŒRepositoryå®ç°è¦åŸºäºè¿™ä¸ªæ¥å£æ¥ç”Ÿæˆã€‚ä¸è¿‡ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å†æ‰©å±•JpaRepositoryï¼Œè€Œæ˜¯è¦æ‰©å±•MongoRepositoryã€‚å¦‚ä¸‹ç¨‹åºæ¸…å•ä¸­çš„OrderRepository æ‰©å±•äº† MongoRepository ï¼Œä¸º Orderæ–‡æ¡£æä¾›äº†åŸºæœ¬çš„CRUDæ“ä½œã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;</span><br><span class="line"><span class="keyword">import</span> orders.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span></span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Order</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MongoRepositoryæ¥å£æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å¸¦æœ‰@Documentæ³¨è§£çš„å¯¹è±¡ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¯¥Repositoryè¦å¤„ç†çš„ç±»å‹ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¸¦æœ‰@Idæ³¨è§£çš„å±æ€§ç±»å‹ã€‚</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>long count();</td>
<td>è¿”å›æŒ‡å®šRepositoryç±»å‹çš„æ–‡æ¡£æ•°é‡</td>
</tr>
<tr>
<td>void delete(Iterable&lt;? extends T);</td>
<td>åˆ é™¤ä¸æŒ‡å®šå¯¹è±¡å…³è”çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td>void delete(T);</td>
<td>åˆ é™¤ä¸æŒ‡å®šå¯¹è±¡å…³è”çš„æ–‡æ¡£</td>
</tr>
<tr>
<td>void delete(ID);</td>
<td>æ ¹æ®IDåˆ é™¤æŸä¸€ä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td>void deleteAll();</td>
<td>åˆ é™¤æŒ‡å®šRepositoryç±»å‹çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td>boolean exists(Object);</td>
<td>å¦‚æœå­˜åœ¨ä¸æŒ‡å®šå¯¹è±¡ç›¸å…³è”çš„æ–‡æ¡£ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td>boolean exists(ID);</td>
<td>å¦‚æœå­˜åœ¨æŒ‡å®šIDçš„æ–‡æ¡£ï¼Œåˆ™è¿”å›true</td>
</tr>
<tr>
<td>List<T> findAll();</td>
<td>è¿”å›æŒ‡å®šRepositoryç±»å‹çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td>List<T> findAll(Iterable<ID>);</td>
<td>è¿”å›æŒ‡å®šæ–‡æ¡£IDå¯¹åº”çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td>List<T> findAll(Pageable);</td>
<td>ä¸ºæŒ‡å®šçš„Repositoryç±»å‹ï¼Œè¿”å›åˆ†é¡µä¸”æ’åºçš„æ–‡æ¡£åˆ—è¡¨</td>
</tr>
<tr>
<td>List<T> findAll(Sort);</td>
<td>ä¸ºæŒ‡å®šçš„Repositoryç±»å‹ï¼Œè¿”å›æ’åºåçš„æ‰€æœ‰æ–‡æ¡£åˆ—è¡¨</td>
</tr>
<tr>
<td>T findOne(ID);</td>
<td>ä¸ºæŒ‡å®šçš„IDè¿”å›å•ä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td>Save( terable<s>) ;</td>
<td>ä¿å­˜æŒ‡å®šIterableä¸­çš„æ‰€æœ‰æ–‡æ¡£</td>
</tr>
<tr>
<td>save ( &lt; S &gt; );</td>
<td>ä¸ºç»™å®šçš„å¯¹è±¡ä¿å­˜ä¸€æ¡æ–‡æ¡£</td>
</tr>
</tbody>
</table>
<p>è¡¨ä¸­çš„æ–¹æ³•ä½¿ç”¨äº†ä¼ é€’è¿›æ¥å’Œæ–¹æ³•è¿”å›çš„æ³›å‹ã€‚OrderRepository æ‰©å±•äº† MongoRepository&lt;Order, String&gt; ï¼Œé‚£ä¹ˆ T å°±æ˜ å°„ä¸º Order ï¼Œ ID æ˜ å°„ä¸º String ï¼Œè€Œ Sæ˜ å°„ä¸ºæ‰€æœ‰æ‰©å±•Order çš„ç±»å‹ã€‚</p>
<h5 id="æ·»åŠ è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•">æ·»åŠ è‡ªå®šä¹‰çš„æŸ¥è¯¢æ–¹æ³•</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span></span></span><br><span class="line"><span class="class">         <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Order</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomer</span><span class="params">(String c)</span></span>;</span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerLike</span><span class="params">(String c)</span></span>;</span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerAndType</span><span class="params">(String c, String t)</span></span>;</span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerLikeAndType</span><span class="params">(String c, String t)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæˆ‘ä»¬æœ‰å››ä¸ªæ–°çš„æ–¹æ³•ï¼Œæ¯ä¸€ä¸ªéƒ½æ˜¯æŸ¥æ‰¾æ»¡è¶³ç‰¹å®šæ¡ä»¶çš„Orderå¯¹è±¡ã€‚å…¶ä¸­ç¬¬ä¸€ä¸ªç”¨æ¥è·å–customerå±æ€§ç­‰äºä¼ å…¥å€¼çš„Orderåˆ—è¡¨ï¼›ç¬¬äºŒä¸ªæ–¹æ³•è·å–customerå±æ€§likeä¼ å…¥å€¼çš„Orderåˆ—è¡¨ï¼›æ¥ä¸‹æ¥æ–¹æ³•ä¼šè¿”å›customer å’Œ typeå±æ€§ç­‰äºä¼ å…¥å€¼çš„Orderå¯¹è±¡ï¼›æœ€åä¸€ä¸ªæ–¹æ³•ä¸å‰ä¸€ä¸ªç±»ä¼¼ï¼Œåªä¸è¿‡customeråœ¨å¯¹æ¯”çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯like è€Œä¸æ˜¯ equals ã€‚</p>
<p>å…·ä½“è¯¦æƒ…è¯·å‚è€ƒâ€“ã€‹[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindle ä½ç½® 5806-5809). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
<h5 id="æŒ‡å®šæŸ¥è¯¢">æŒ‡å®šæŸ¥è¯¢</h5>
<p>@Queryèƒ½å¤Ÿåƒåœ¨JPAä¸­é‚£æ ·ç”¨åœ¨MongoDBä¸Šã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºé’ˆå¯¹MongoDBæ—¶ï¼Œ@Queryä¼šæ¥å—ä¸€ä¸ªJSONæŸ¥è¯¢ï¼Œè€Œä¸æ˜¯JPAæŸ¥è¯¢ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ç»™å®šç±»å‹çš„è®¢å•ï¼Œå¹¶ä¸”è¦æ±‚customerçš„åç§°ä¸ºâ€œChuck Wagonâ€ã€‚OrderRepositoryä¸­å¦‚ä¸‹çš„æ–¹æ³•å£°æ˜èƒ½å¤Ÿå®Œæˆæ‰€éœ€çš„ä»»åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;&#123;&#x27;customer&#x27;: &#x27;Chuck Wagon&#x27;, &#x27;type&#x27; : ?0&#125;&quot;)</span></span><br><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findChucksOrders</span><span class="params">(String t)</span></span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>@Queryä¸­ç»™å®šçš„JSONå°†ä¼šä¸æ‰€æœ‰çš„Orderæ–‡æ¡£è¿›è¡ŒåŒ¹é…ï¼Œå¹¶è¿”å›åŒ¹é…çš„æ–‡æ¡£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtypeå±æ€§æ˜ å°„æˆäº†â€œ?0â€ï¼Œè¿™è¡¨æ˜typeå±æ€§åº”è¯¥ä¸æŸ¥è¯¢<strong>æ–¹æ³•(findChucksOrders)çš„ç¬¬é›¶ä¸ªå‚æ•°</strong>ç›¸ç­‰ã€‚å¦‚æœæœ‰å¤šä¸ªå‚æ•°çš„è¯ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡â€œ?1â€ã€â€œ?2â€ç­‰æ–¹å¼è¿›è¡Œå¼•ç”¨ã€‚</p>
<h5 id="æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½">æ··åˆè‡ªå®šä¹‰çš„åŠŸèƒ½</h5>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å°†å®Œå…¨è‡ªå®šä¹‰çš„æ–¹æ³•æ··åˆåˆ°è‡ªåŠ¨ç”Ÿæˆçš„Repositoryä¸­ã€‚å¯¹äºJPAæ¥è¯´ï¼Œè¿™è¿˜æ¶‰åŠåˆ°åˆ›å»ºä¸€ä¸ªä¸­é—´æ¥å£æ¥å£°æ˜è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œä¸ºè¿™äº›è‡ªå®šä¹‰æ–¹æ³•åˆ›å»ºå®ç°ç±»å¹¶ä¿®æ”¹è‡ªåŠ¨åŒ–çš„Repositoryæ¥å£ï¼Œä½¿å…¶æ‰©å±•ä¸­é—´æ¥å£ã€‚å¯¹äºSpring Data MongoDBæ¥è¯´ï¼Œè¿™äº›æ­¥éª¤éƒ½æ˜¯ç›¸åŒçš„ã€‚</p>
<blockquote>
<p>å…·ä½“è¯¦æƒ…è¯·å‚è€ƒâ€“ã€‹[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindle ä½ç½® 5829-5832). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
</blockquote>
<hr>
<h2 id="ä½¿ç”¨Neo4jæ“ä½œå›¾æ•°æ®">ä½¿ç”¨Neo4jæ“ä½œå›¾æ•°æ®</h2>
<p>Spring Data Neo4jæä¾›äº†å¾ˆå¤šä¸Spring Data JPAå’ŒSpring Data MongoDBç›¸åŒçš„åŠŸèƒ½ï¼Œå½“ç„¶æ‰€é’ˆå¯¹çš„æ˜¯Neo4jå›¾æ•°æ®åº“ã€‚å®ƒæä¾›äº†å°†Javaå¯¹è±¡æ˜ å°„åˆ°èŠ‚ç‚¹å’Œå…³è”å…³ç³»çš„æ³¨è§£ã€é¢å‘æ¨¡æ¿çš„Neo4jè®¿é—®æ–¹å¼ä»¥åŠRepositoryå®ç°çš„è‡ªåŠ¨åŒ–ç”ŸæˆåŠŸèƒ½ã€‚</p>
<p>é…ç½®Spring Data Neo4jçš„å…³é”®åœ¨äºå£°æ˜GraphDatabaseService beanå’Œå¯ç”¨Neo4j Repositoryè‡ªåŠ¨ç”ŸæˆåŠŸèƒ½ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†Spring Data Neo4jæ‰€éœ€çš„åŸºæœ¬é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.config;</span><br><span class="line"><span class="keyword">import</span> org.neo4j.graphdb.GraphDatabaseService;</span><br><span class="line"><span class="keyword">import</span> org.neo4j.graphdb.factory.GraphDatabaseFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.config.EnableNeo4jRepositories;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.config.Neo4jConfiguration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableNeo4jRepositories(basePackages=&quot;orders.db&quot;)</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Neo4jConfig</span> <span class="keyword">extends</span> <span class="title">Neo4jConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Neo4jConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    setBasePackage(<span class="string">&quot;orders&quot;</span>);	</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">graphDatabaseService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> GraphDatabaseFactory()</span><br><span class="line">              .newEmbeddedDatabase(<span class="string">&quot;/tmp/graphdb&quot;</span>);	</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@EnableNeo4jRepositoriesæ³¨è§£èƒ½å¤Ÿè®©Spring Data Neo4jè‡ªåŠ¨ç”ŸæˆNeo4j Repositoryå®ç°ã€‚å®ƒçš„basePackageså±æ€§è®¾ç½®ä¸ºorders.dbåŒ…ï¼Œè¿™æ ·å®ƒå°±ä¼šæ‰«æè¿™ä¸ªåŒ…æ¥æŸ¥æ‰¾ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰æ‰©å±•Repositoryæ ‡è®°æ¥å£çš„å…¶ä»–æ¥å£ã€‚</p>
<p>Neo4jConfig æ‰©å±•è‡ª Neo4jConfigurationï¼Œåè€…æä¾›äº†å¤šä¸ªä¾¿åˆ©çš„æ–¹æ³•æ¥é…ç½®Spring Data Neo4jã€‚åœ¨è¿™äº›æ–¹æ³•ä¸­ï¼Œå°±åŒ…æ‹¬setBasePackage() ï¼Œå®ƒä¼šåœ¨ Neo4jConfigçš„æ„é€ å™¨ä¸­è°ƒç”¨ï¼Œç”¨æ¥å‘Šè¯‰Spring Data Neo4jè¦åœ¨ordersåŒ…ä¸­æŸ¥æ‰¾æ¨¡å‹ç±»ã€‚</p>
<p>è¿™ä¸ªæ‹¼å›¾çš„æœ€åä¸€éƒ¨åˆ†æ˜¯å®šä¹‰GraphDatabaseServicebeanã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒgraphDatabaseService() æ–¹æ³•ä½¿ç”¨ GraphDatabaseFactoryæ¥åˆ›å»ºåµŒå…¥å¼çš„Neo4jæ•°æ®åº“ã€‚åœ¨Neo4jä¸­ï¼ŒåµŒå…¥å¼æ•°æ®åº“ä¸è¦ä¸å†…å­˜æ•°æ®åº“ç›¸æ··æ·†ã€‚åœ¨è¿™é‡Œï¼Œâ€œåµŒå…¥å¼â€æŒ‡çš„æ˜¯æ•°æ®åº“å¼•æ“ä¸åº”ç”¨è¿è¡Œåœ¨åŒä¸€ä¸ªJVMä¸­ï¼Œä½œä¸ºåº”ç”¨çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚æ•°æ®ä¾ç„¶ä¼šæŒä¹…åŒ–åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œä¹Ÿå°±æ˜¯â€œ/tmp/graphdbâ€ä¸­ï¼‰ã€‚</p>
<p>ä½œä¸ºå¦å¤–çš„ä¸€ç§æ–¹å¼ï¼Œä½ å¯èƒ½ä¼šå¸Œæœ›é…ç½®GraphDatabaseServiceè¿æ¥è¿œç¨‹çš„Neo4jæœåŠ¡å™¨ã€‚å¦‚æœspring-data-neo4j-reståº“åœ¨åº”ç”¨çš„ç±»è·¯å¾„ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é…ç½®SpringRestGraphDatabaseï¼Œå®ƒä¼šé€šè¿‡RESTful APIæ¥è®¿é—®è¿œç¨‹çš„Neo4jæ•°æ®åº“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">graphDatabaseService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SpringRestGraphDatabase(</span><br><span class="line">      <span class="string">&quot;http://graphdbserver:7474/db/data/&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒSpringRestGraphDatabaseåœ¨é…ç½®æ—¶ï¼Œå‡è®¾è¿œç¨‹çš„æ•°æ®åº“å¹¶ä¸éœ€è¦è®¤è¯ã€‚ä½†æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒçš„é…ç½®ä¸­ï¼Œå½“åˆ›å»ºSpringRestGraphDatabaseçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›æä¾›åº”ç”¨çš„å‡­è¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(destroyMethod=&quot;shutdown&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> GraphDatabaseService <span class="title">graphDatabaseService</span><span class="params">(Environment env)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SpringRestGraphDatabase(</span><br><span class="line">      <span class="string">&quot;http://graphdbserver:7474/db/data/&quot;</span>,</span><br><span class="line">      env.getProperty(<span class="string">&quot;db.username&quot;</span>), env.getProperty(<span class="string">&quot;db.password&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œå‡­è¯æ˜¯é€šè¿‡æ³¨å…¥çš„Environmentè·å–åˆ°çš„ï¼Œé¿å…äº†åœ¨é…ç½®ç±»ä¸­çš„ç¡¬ç¼–ç ã€‚ Spring Data Neo4jåŒæ—¶è¿˜æä¾›äº†XMLå‘½åç©ºé—´ã€‚å¦‚æœä½ æ›´æ„¿æ„åœ¨XMLä¸­é…ç½®Spring Data Neo4jçš„è¯ï¼Œé‚£å¯ä»¥ä½¿ç”¨è¯¥å‘½åç©ºé—´ä¸­çš„&lt;neo4j:config&gt; å’Œ &lt;neo4j:repositories&gt;å…ƒç´ ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œä¸Javaé…ç½®æ˜¯ç›¸åŒçš„ã€‚</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:neo4j</span>=<span class="string">&quot;http://www.springframework.org/schema/data/neo4j&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/data/neo4j</span></span></span><br><span class="line"><span class="tag"><span class="string">   http://www.springframework.org/schema/data/neo4j/spring-neo4j.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">neo4j:config</span>	</span></span><br><span class="line"><span class="tag">      <span class="attr">storeDirectory</span>=<span class="string">&quot;/tmp/graphdb&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">base-package</span>=<span class="string">&quot;orders&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">neo4j:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;orders.db&quot;</span> /&gt;</span>	</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¦é…ç½®Spring Data Neo4jè®¿é—®è¿œç¨‹çš„Neo4jæœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å£°æ˜SpringRestGraphDatabasebeanï¼Œå¹¶è®¾ç½®<a href="neo4j:config">neo4j:config</a> çš„ graphDatabaseService å±æ€§ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">neo4j:config</span> <span class="attr">base-package</span>=<span class="string">&quot;orders&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">graphDatabaseService</span>=<span class="string">&quot;graphDatabaseService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;graphDatabaseService&quot;</span> <span class="attr">class</span>=</span></span><br><span class="line"><span class="tag">        &quot;<span class="attr">org.springframework.data.neo4j.rest.SpringRestGraphDatabase</span>&quot;&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;http://graphdbserver:7474/db/data/&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;db.username&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;db.password&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“">ä½¿ç”¨æ³¨è§£æ ‡æ³¨å›¾å®ä½“</h4>
<p>Neo4jå®šä¹‰äº†ä¸¤ç§ç±»å‹çš„å®ä½“ï¼šèŠ‚ç‚¹ï¼ˆnodeï¼‰å’Œå…³è”å…³ç³»ï¼ˆrelationshipï¼‰ã€‚ä¸€èˆ¬æ¥è®²ï¼ŒèŠ‚ç‚¹åæ˜ äº†åº”ç”¨ä¸­çš„äº‹ç‰©ï¼Œè€Œå…³è”å…³ç³»å®šä¹‰äº†è¿™äº›äº‹ç‰©æ˜¯å¦‚ä½•è”ç³»åœ¨ä¸€èµ·çš„ã€‚</p>
<p>Spring Data Neo4jæä¾›äº†å¤šä¸ªæ³¨è§£ï¼Œå®ƒä»¬å¯ä»¥åº”ç”¨åœ¨æ¨¡å‹ç±»å‹åŠå…¶åŸŸä¸Šï¼Œå®ç°Neo4jä¸­çš„æŒä¹…åŒ–ã€‚</p>
<table>
<thead>
<tr>
<th>æ³¨ã€€ã€€è§£</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>@NodeEntity</td>
<td>å°†Javaç±»å‹å£°æ˜ä¸ºèŠ‚ç‚¹å®ä½“</td>
</tr>
<tr>
<td>@RelationshipEntity</td>
<td>å°†Javaç±»å‹å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“</td>
</tr>
<tr>
<td>@StartNode</td>
<td>å°†æŸä¸ªå±æ€§å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“çš„å¼€å§‹èŠ‚ç‚¹</td>
</tr>
<tr>
<td>@EndNode</td>
<td>å°†æŸä¸ªå±æ€§å£°æ˜ä¸ºå…³è”å…³ç³»å®ä½“çš„ç»“æŸèŠ‚ç‚¹</td>
</tr>
<tr>
<td>@Fetch</td>
<td>å°†å®ä½“çš„å±æ€§å£°æ˜ä¸ºç«‹å³åŠ è½½</td>
</tr>
<tr>
<td>@GraphId</td>
<td>å°†æŸä¸ªå±æ€§è®¾ç½®ä¸ºå®ä½“çš„IDåŸŸï¼ˆè¿™ä¸ªåŸŸçš„ç±»å‹å¿…é¡»æ˜¯ Long</td>
</tr>
<tr>
<td>@GraphProperty</td>
<td>æ˜ç¡®å£°æ˜æŸä¸ªå±æ€§</td>
</tr>
<tr>
<td>@GraphTraversal</td>
<td>å£°æ˜æŸä¸ªå±æ€§ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ªiterableå…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯å›¾éå†æ‰€æ„å»ºçš„</td>
</tr>
<tr>
<td>@Indexed</td>
<td>å£°æ˜æŸä¸ªå±æ€§åº”è¯¥è¢«ç´¢å¼•</td>
</tr>
<tr>
<td>@Labels</td>
<td>ä¸º@NodeEntityå£°æ˜æ ‡ç­¾</td>
</tr>
<tr>
<td>@Query</td>
<td>å£°æ˜æŸä¸ªå±æ€§ä¼šè‡ªåŠ¨æä¾›ä¸€ä¸ªiterableå…ƒç´ ï¼Œè¿™ä¸ªå…ƒç´ æ˜¯æ‰§è¡Œç»™å®šçš„CypheræŸ¥è¯¢æ‰€æ„å»ºçš„</td>
</tr>
<tr>
<td>@QueryResult</td>
<td>å£°æ˜æŸä¸ªJavaæˆ–æ¥å£èƒ½å¤ŸæŒæœ‰æŸ¥è¯¢çš„ç»“æœ</td>
</tr>
<tr>
<td>@RelatedTo</td>
<td>é€šè¿‡æŸä¸ªå±æ€§ï¼Œå£°æ˜å½“å‰çš„ @NodeEntityä¸å¦å¤–ä¸€ä¸ª@NodeEntityä¹‹é—´çš„å…³è”å…³ç³»</td>
</tr>
<tr>
<td>@RelatedToVia</td>
<td>åœ¨  @NodeEntityä¸Šå£°æ˜æŸä¸ªå±æ€§ï¼ŒæŒ‡å®šå…¶å¼•ç”¨è¯¥èŠ‚ç‚¹æ‰€å±çš„æŸä¸€ä¸ª@RelationshipEntity</td>
</tr>
<tr>
<td>@RelationshipType</td>
<td>å°†æŸä¸ªåŸŸå£°æ˜ä¸ºå…³è”å®ä½“ç±»å‹</td>
</tr>
<tr>
<td>@ResultColumn</td>
<td>åœ¨å¸¦æœ‰@QueryResultæ³¨è§£çš„ç±»å‹ä¸Šï¼Œå°†æŸä¸ªå±æ€§å£°æ˜ä¸ºè·å–æŸ¥è¯¢ç»“æœé›†ä¸­çš„æŸä¸ªç‰¹å®šåˆ—</td>
</tr>
</tbody>
</table>
<p>ä¸ºäº†äº†è§£å¦‚ä½•ä½¿ç”¨å…¶ä¸­çš„æŸäº›æ³¨è§£ï¼Œæˆ‘ä»¬ä¼šå°†å…¶åº”ç”¨åˆ°è®¢å•/æ¡ç›®æ ·ä¾‹ä¸­ã€‚ åœ¨è¯¥æ ·ä¾‹ä¸­ï¼Œæ•°æ®å»ºæ¨¡çš„ä¸€ç§æ–¹å¼å°±æ˜¯å°†è®¢å•è®¾å®šä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä¼šä¸ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®å…³è”ã€‚å›¾12.2ä»¥å›¾çš„å½¢å¼æè¿°äº†è¿™ç§æ¨¡å‹ã€‚</p>
<p><img src="https://drek4537l1klr.cloudfront.net/walls5/Figures/12fig02.jpg" alt="å›¾12.2"></p>
<p>å›¾12.2ã€€è¿æ¥ä¸¤ä¸ªèŠ‚ç‚¹çš„ç®€å•å…³è”å…³ç³»ï¼Œå…³ç³»æœ¬èº«ä¸åŒ…å«ä»»ä½•å±æ€§</p>
<p>ä¸ºäº†å°†è®¢å•æŒ‡å®šä¸ºèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºOrder ç±»æ·»åŠ  @NodeEntityæ³¨è§£ã€‚å¦‚ä¸‹çš„ç¨‹åºæ¸…å•å±•ç°äº†å¸¦æœ‰@NodeEntity æ³¨è§£çš„ Orderç±»ï¼Œå®ƒè¿˜åŒ…å«äº†è¡¨12.3ä¸­çš„å‡ ä¸ªå…¶ä»–æ³¨è§£ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedHashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.NodeEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.RelatedTo;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NodeEntity</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GraphId</span>	</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  <span class="keyword">private</span> String customer;</span><br><span class="line">  <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RelatedTo(type=&quot;HAS_ITEMS&quot;)</span>	</span><br><span class="line">  <span class="keyword">private</span> Set&lt;Item&gt; items = <span class="keyword">new</span> LinkedHashSet&lt;Item&gt;();</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ç±»çº§åˆ«ä¸Šçš„@NodeEntityï¼Œè¿˜è¦æ³¨æ„idå±æ€§ä¸Šä½¿ç”¨äº†@GraphIdæ³¨è§£ã€‚Neo4jä¸Šçš„æ‰€æœ‰å®ä½“å¿…è¦è¦æœ‰ä¸€ä¸ªå›¾IDã€‚è¿™å¤§è‡´ç±»ä¼¼äºJPA @Entityä»¥åŠMongoDB @Document ç±»ä¸­ä½¿ç”¨ @Idæ³¨è§£çš„å±æ€§ã€‚åœ¨è¿™é‡Œï¼Œ@GraphIdæ³¨è§£æ ‡æ³¨çš„å±æ€§å¿…é¡»æ˜¯Long ç±»å‹ã€‚</p>
<p>customer å’Œ typeå±æ€§ä¸Šæ²¡æœ‰ä»»ä½•æ³¨è§£ã€‚åªè¦è¿™äº›å±æ€§ä¸æ˜¯ç¬æ€çš„ï¼Œå®ƒä»¬éƒ½ä¼šæˆä¸ºæ•°æ®åº“ä¸­èŠ‚ç‚¹çš„å±æ€§ã€‚</p>
<p>itemså±æ€§ä¸Šä½¿ç”¨äº†@RelatedToæ³¨è§£ï¼Œè¿™è¡¨æ˜Order ä¸ä¸€ä¸ª Item çš„ Setå­˜åœ¨å…³è”å…³ç³»ã€‚typeå±æ€§å®é™…ä¸Šå°±æ˜¯ä¸ºå…³è”å…³ç³»å»ºç«‹äº†ä¸€ä¸ªæ–‡æœ¬æ ‡è®°ã€‚å®ƒå¯ä»¥è®¾ç½®æˆä»»æ„çš„å€¼ï¼Œä½†é€šå¸¸ä¼šç»™å®šä¸€ä¸ªæ˜“äºäººç±»é˜…è¯»çš„æ–‡æœ¬ï¼Œç”¨æ¥ç®€å•æè¿°è¿™ä¸ªå…³è”å…³ç³»çš„ç‰¹å¾ã€‚ç¨åï¼Œä½ å°†ä¼šçœ‹åˆ°å¦‚ä½•å°†è¿™ä¸ªæ ‡è®°ç”¨åœ¨æŸ¥è¯¢ä¸­ï¼Œå®ç°è·¨å…³è”å…³ç³»çš„æŸ¥è¯¢ã€‚</p>
<p>å°± Itemæœ¬èº«æ¥è¯´ï¼Œä¸‹é¢å±•ç°äº†å¦‚ä½•ä¸ºå…¶æ·»åŠ æ³¨è§£å®ç°å›¾çš„æŒä¹…åŒ–ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.NodeEntity;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NodeEntity</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GraphId</span>	</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  <span class="keyword">private</span> String product;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> quantity;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼äº Order ï¼Œ Item ä¹Ÿä½¿ç”¨äº† @NodeEntityæ³¨è§£ï¼Œå°†å…¶æ ‡è®°ä¸ºä¸€ä¸ªèŠ‚ç‚¹ã€‚å®ƒåŒæ—¶ä¹Ÿæœ‰ä¸€ä¸ªLongç±»å‹çš„å±æ€§ï¼Œå€ŸåŠ©@GraphIdæ³¨è§£å°†å…¶æ ‡æ³¨ä¸ºèŠ‚ç‚¹çš„å›¾IDï¼Œè€Œproduct ã€ price ä»¥åŠ quantityå±æ€§å‡ä¼šä½œä¸ºå›¾æ•°æ®åº“ä¸­èŠ‚ç‚¹çš„å±æ€§ã€‚</p>
<p>Order å’Œ Itemä¹‹é—´çš„å…³è”å…³ç³»å¾ˆç®€å•ï¼Œå…³ç³»æœ¬èº«å¹¶ä¸åŒ…å«ä»»ä½•çš„æ•°æ®ã€‚å› æ­¤ï¼Œ@RelatedToæ³¨è§£å°±è¶³ä»¥å®šä¹‰å…³è”å…³ç³»ã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å…³è”å…³ç³»éƒ½è¿™ä¹ˆç®€å•ã€‚</p>
<p>è®©æˆ‘ä»¬é‡æ–°è€ƒè™‘è¯¥å¦‚ä½•ä¸ºæ•°æ®å»ºæ¨¡ï¼Œä»è€Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨æ›´ä¸ºå¤æ‚çš„å…³è”å…³ç³»ã€‚åœ¨å½“å‰çš„æ•°æ®æ¨¡å‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¡ç›®å’Œäº§å“çš„ä¿¡æ¯ç»„åˆåˆ°äº†Itemç±»ä¸­ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬é‡æ–°è€ƒè™‘çš„æ—¶å€™ï¼Œä¼šå‘ç°è®¢å•ä¼šä¸ä¸€ä¸ªæˆ–å¤šä¸ªäº§å“ç›¸å…³è”ã€‚è®¢å•ä¸äº§å“ä¹‹é—´çš„å…³ç³»æ„æˆäº†è®¢å•çš„ä¸€ä¸ªæ¡ç›®ã€‚å›¾12.3æè¿°äº†å¦å¤–ä¸€ç§åœ¨å›¾ä¸­å»ºæ¨¡æ•°æ®çš„æ–¹å¼ã€‚</p>
<p><img src="https://drek4537l1klr.cloudfront.net/walls5/Figures/12fig03.jpg" alt="å›¾12.3"></p>
<p>å›¾12.3ã€€å…³è”å…³ç³»å®ä½“è‡ªèº«å…·æœ‰å±æ€§</p>
<p>åœ¨è¿™ä¸ªæ–°çš„æ¨¡å‹ä¸­ï¼Œè®¢å•ä¸­äº§å“çš„æ•°é‡æ˜¯æ¡ç›®ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œè€Œäº§å“æœ¬èº«æ˜¯å¦å¤–ä¸€ä¸ªæ¦‚å¿µã€‚ä¸å‰é¢ä¸€æ ·ï¼Œè®¢å•å’Œäº§å“éƒ½æ˜¯èŠ‚ç‚¹ï¼Œè€Œæ¡ç›®æ˜¯å…³è”å…³ç³»ã€‚å› ä¸ºç°åœ¨çš„æ¡ç›®å¿…é¡»è¦åŒ…å«ä¸€ä¸ªæ•°é‡å€¼ï¼Œå…³è”å…³ç³»ä¸åƒå‰é¢é‚£ä¹ˆç®€å•ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªç±»æ¥ä»£è¡¨æ¡ç›®ï¼Œæ¯”å¦‚å¦‚ä¸‹ç¨‹åºæ¸…å•æ‰€ç¤ºçš„LineItem ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.EndNode;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.GraphId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.RelationshipEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.annotation.StartNode;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RelationshipEntity(type=&quot;HAS_LINE_ITEM_FOR&quot;)</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineItem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@GraphId</span>	</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@StartNode</span>	</span><br><span class="line">  <span class="keyword">private</span> Order order;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@EndNode</span>	</span><br><span class="line">  <span class="keyword">private</span> Product product;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> quantity;</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Orderç±»é€šè¿‡@NodeEntityæ³¨è§£å°†å…¶æ ‡ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€ŒLineItemç±»åˆ™ä½¿ç”¨äº†@RelationshipEntity æ³¨è§£ã€‚ LineItemåŒæ ·ä¹Ÿæœ‰ä¸€ä¸ªidå±æ€§æ ‡æ³¨äº†@GraphIdæ³¨è§£ï¼Œä¸ç®¡æ˜¯èŠ‚ç‚¹å®ä½“è¿˜æ˜¯å…³è”å…³ç³»å®ä½“ï¼Œéƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ªå›¾IDï¼Œè€Œä¸”å…¶ç±»å‹å¿…é¡»ä¸ºLong ã€‚</p>
<p>å…³è”å…³ç³»å®ä½“çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒä»¬è¿æ¥äº†ä¸¤ä¸ªèŠ‚ç‚¹ã€‚@StartNode å’Œ @EndNodeæ³¨è§£ç”¨åœ¨å®šä¹‰å…³è”å…³ç³»ä¸¤ç«¯çš„å±æ€§ä¸Šã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒOrderæ˜¯å¼€å§‹èŠ‚ç‚¹ï¼ŒProductæ˜¯ç»“æŸèŠ‚ç‚¹ã€‚</p>
<p>æœ€åï¼Œ LineItem ç±»æœ‰ä¸€ä¸ª quantityå±æ€§ï¼Œå½“å…³è”å…³ç³»åˆ›å»ºçš„æ—¶å€™ï¼Œå®ƒä¼šæŒä¹…åŒ–åˆ°æ•°æ®åº“ä¸­ã€‚</p>
<p>é¢†åŸŸå¯¹è±¡å·²ç»æ·»åŠ äº†æ³¨è§£ï¼Œç°åœ¨å°±å¯ä»¥ä¿å­˜ä¸è¯»å–èŠ‚ç‚¹å’Œå…³è”å…³ç³»äº†ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨Spring Data Neo4jä¸­çš„Neo4jTemplateå®ç°é¢å‘æ¨¡æ¿çš„æ•°æ®è®¿é—®ã€‚</p>
<h4 id="ä½¿ç”¨Neo4jTemplate">ä½¿ç”¨Neo4jTemplate</h4>
<p>Spring Data MongoDBæä¾›äº†MongoTemplateå®ç°åŸºäºæ¨¡æ¿çš„MongoDBæŒä¹…åŒ–ï¼Œä¸ä¹‹ç±»ä¼¼ï¼ŒSpring Data Neo4jæä¾›äº†Neo4jTemplateæ¥æ“ä½œNeo4jå›¾æ•°æ®åº“ä¸­çš„èŠ‚ç‚¹å’Œå…³è”å…³ç³»ã€‚å¦‚æœä½ å·²ç»æŒ‰ç…§å‰é¢çš„æ–¹å¼é…ç½®äº†Spring Data Neo4jï¼Œåœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°±å·²ç»å…·å¤‡äº†ä¸€ä¸ªNeo4jTemplatebeanã€‚æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯å°†å…¶æ³¨å…¥åˆ°ä»»æ„æƒ³ä½¿ç”¨å®ƒçš„åœ°æ–¹ã€‚</p>
<p>Spring Data MongoDBæä¾›äº†MongoTemplateå®ç°åŸºäºæ¨¡æ¿çš„MongoDBæŒä¹…åŒ–ï¼Œå¦‚æœä½ å·²ç»æŒ‰ç…§å‰é¢çš„æ–¹å¼é…ç½®äº†Spring Data Neo4jï¼Œåœ¨Springåº”ç”¨ä¸Šä¸‹æ–‡ä¸­å°±å·²ç»å…·å¤‡äº†ä¸€ä¸ªNeo4jTemplatebeanã€‚æ¥ä¸‹æ¥éœ€è¦åšçš„å°±æ˜¯å°†å…¶æ³¨å…¥åˆ°ä»»æ„æƒ³ä½¿ç”¨å®ƒçš„åœ°æ–¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Neo4jOperations neo4j;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æƒ³å€ŸåŠ©Neo4jTemplateå®Œæˆçš„æœ€åŸºæœ¬çš„ä¸€ä»¶äº‹æƒ…å¯èƒ½å°±æ˜¯å°†æŸä¸ªå¯¹è±¡ä¿å­˜ä¸ºèŠ‚ç‚¹ã€‚å‡è®¾è¿™ä¸ªå¯¹è±¡å·²ç»ä½¿ç”¨äº†@NodeEntityæ³¨è§£ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼æ¥ä½¿ç”¨save() æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Order order = ...;</span><br><span class="line">Order savedOrder = neo4j.save(order);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="åˆ›å»ºè‡ªåŠ¨åŒ–çš„Neo4j-Respository">åˆ›å»ºè‡ªåŠ¨åŒ–çš„Neo4j Respository</h4>
<p>æˆ‘ä»¬å·²ç»å°†@EnableNeo4jRepositoriesæ·»åŠ åˆ°äº†é…ç½®ä¸­ï¼Œæ‰€ä»¥Spring Data Neo4jå·²ç»é…ç½®ä¸ºæ”¯æŒè‡ªåŠ¨åŒ–ç”ŸæˆRepositoryçš„åŠŸèƒ½ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ç¼–å†™æ¥å£ï¼Œå¦‚ä¸‹çš„OrderRepositoryå°±æ˜¯å¾ˆå¥½çš„èµ·ç‚¹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;</span><br><span class="line"><span class="keyword">import</span> orders.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.repository.GraphRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">GraphRepository</span>&lt;<span class="title">Order</span>&gt; </span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸å…¶ä»–çš„Spring Dataé¡¹ç›®ä¸€æ ·ï¼ŒSpring Data Neo4jä¼šä¸ºæ‰©å±•Repositoryæ¥å£çš„å…¶ä»–æ¥å£ç”ŸæˆRepositoryæ–¹æ³•å®ç°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒOrderRepository æ‰©å±•äº† GraphRepositoryï¼Œè€Œåè€…åˆé—´æ¥æ‰©å±•äº†Repositoryæ¥å£ã€‚å› æ­¤ï¼ŒSpring Data Neo4jå°†ä¼šåœ¨è¿è¡Œæ—¶åˆ›å»ºOrderRepository çš„å®ç°ã€‚</p>
<p>æ³¨æ„ï¼Œ GraphRepository ä½¿ç”¨ Orderè¿›è¡Œäº†å‚æ•°åŒ–ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªRepositoryæ‰€è¦ä½¿ç”¨çš„å®ä½“ç±»å‹ã€‚å› ä¸ºNeo4jè¦æ±‚å›¾IDçš„ç±»å‹ä¸ºLongï¼Œå› æ­¤åœ¨æ‰©å±•GraphRepositoryçš„æ—¶å€™ï¼Œæ²¡æœ‰å¿…è¦å†å»æŒ‡å®šIDç±»å‹ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä½¿ç”¨å¾ˆå¤šé€šç”¨çš„CRUDæ“ä½œï¼Œè¿™ä¸JpaRepository å’Œ MongoRepositoryæ‰€æä¾›çš„åŠŸèƒ½ç±»ä¼¼ã€‚è¡¨12.4æè¿°äº†æ‰©å±•GraphRepositoryæ‰€èƒ½å¤Ÿå¾—åˆ°çš„æ–¹æ³•ã€‚</p>
<p>è¡¨12.4ã€€é€šè¿‡æ‰©å±•GraphRepositoryï¼ŒRepositoryæ¥å£èƒ½å¤Ÿç»§æ‰¿å¤šä¸ªCRUDæ“ä½œï¼Œå®ƒä»¬ä¼šç”±Spring Data Neo4jè‡ªåŠ¨å®ç°</p>
<table>
<thead>
<tr>
<th>æ–¹ã€€ã€€æ³•</th>
<th>æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>long count();</td>
<td>è¿”å›åœ¨æ•°æ®åº“ä¸­ï¼Œç›®æ ‡ç±»å‹æœ‰å¤šå°‘å®ä½“</td>
</tr>
<tr>
<td>void delete(Iterable&lt;?extendsT&gt;);</td>
<td>åˆ é™¤å¤šä¸ªå®ä½“</td>
</tr>
<tr>
<td>void delete(Long id);</td>
<td>æ ¹æ®IDï¼Œåˆ é™¤ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>void delete(T);</td>
<td>åˆ é™¤ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>void deleteAll();</td>
<td>åˆ é™¤ç›®æ ‡ç±»å‹çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>boolean exists(Long id);</td>
<td>æ ¹æ®æŒ‡å®šçš„IDï¼Œæ£€æŸ¥å®ä½“æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td>EndResult<T> findAll();</td>
<td>è·å–ç›®æ ‡ç±»å‹çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>Iterable<T> findAll(Iterable<Long>);</td>
<td>æ ¹æ®ç»™å®šçš„IDï¼Œè·å–ç›®æ ‡ç±»å‹çš„å®ä½“</td>
</tr>
<tr>
<td>Page<T> findAll(Pageable);</td>
<td>è¿”å›ç›®æ ‡ç±»å‹åˆ†é¡µå’Œæ’åºåçš„å®ä½“åˆ—è¡¨</td>
</tr>
<tr>
<td>EndResult<T> findAll(Sort);</td>
<td>è¿”å›ç›®æ ‡ç±»å‹æ’åºåçš„å®ä½“åˆ—è¡¨</td>
</tr>
<tr>
<td>EndResult<T> findAllBySchemaPropertyValue(String,Object);</td>
<td>è¿”å›æŒ‡å®šå±æ€§åŒ¹é…ç»™å®šå€¼çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>Iterable<T> findAllByTraversal(N, TraversalDescription);</td>
<td>è¿”å›ä»æŸä¸ªèŠ‚ç‚¹å¼€å§‹ï¼Œå›¾éå†åˆ°è¾¾çš„èŠ‚ç‚¹</td>
</tr>
<tr>
<td>T findBySchemaPropertyValue (String,Object);</td>
<td>è¿”å›æŒ‡å®šå±æ€§åŒ¹é…ç»™å®šå€¼çš„ä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>T findOne(Long);</td>
<td>æ ¹æ®IDï¼Œè·å¾—æŸä¸€ä¸ªå®ä½“</td>
</tr>
<tr>
<td>EndResult<T> query(String, Map&lt;String,Object&gt;);</td>
<td>è¿”å›åŒ¹é…ç»™å®šCypheræŸ¥è¯¢çš„æ‰€æœ‰å®ä½“</td>
</tr>
<tr>
<td>Iterable<T> save(Iterable<T>);</td>
<td>ä¿å­˜å¤šä¸ªå®ä½“</td>
</tr>
<tr>
<td>S save(S);</td>
<td>ä¿å­˜ä¸€ä¸ªå®ä½“</td>
</tr>
</tbody>
</table>
<p>å¦‚ä¸‹çš„ä»£ç èƒ½å¤Ÿä¿å­˜ä¸€ä¸ªOrder å®ä½“ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Order savedOrder = orderRepository.save(order);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>å½“å®ä½“ä¿å­˜ä¹‹åï¼Œsave()æ–¹æ³•å°†ä¼šè¿”å›è¢«ä¿å­˜çš„å®ä½“ï¼Œå¦‚æœä¹‹å‰å®ƒä½¿ç”¨@GraphIdæ³¨è§£çš„å±æ€§å€¼ä¸ºnullçš„è¯ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§å°†ä¼šå¡«å……ä¸Šå€¼ã€‚</p>
<h5 id="æ·»åŠ æŸ¥è¯¢æ–¹æ³•">æ·»åŠ æŸ¥è¯¢æ–¹æ³•</h5>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> orders.db;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> orders.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.neo4j.repository.GraphRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderRepository</span> <span class="keyword">extends</span> <span class="title">GraphRepository</span>&lt;<span class="title">Order</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomer</span><span class="params">(String customer)</span></span>;	</span><br><span class="line">  <span class="function">List&lt;Order&gt; <span class="title">findByCustomerAndType</span><span class="params">(String customer, String type)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–¹æ³•ã€‚å…¶ä¸­ä¸€ä¸ªä¼šæŸ¥è¯¢customerå±æ€§ç­‰äºç»™å®šString å€¼çš„ OrderèŠ‚ç‚¹ã€‚å¦å¤–ä¸€ä¸ªæ–¹æ³•ä¸ä¹‹ç±»ä¼¼ï¼Œä½†æ˜¯é™¤äº†åŒ¹é…customerå±æ€§ä»¥å¤–ï¼ŒOrder èŠ‚ç‚¹çš„ typeå±æ€§å¿…é¡»è¿˜è¦ç­‰äºç»™å®šçš„ç±»å‹å€¼ã€‚</p>
<p>æˆ‘ä»¬ä¹‹å‰å·²ç»è®¨è®ºè¿‡æŸ¥è¯¢æ–¹æ³•çš„å‘½åçº¦å®šï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰å¿…è¦å†è¿›è¡Œæ·±å…¥åœ°è®¨è®ºã€‚å¯ä»¥ç¿»çœ‹ä¹‹å‰å­¦ä¹ Spring Data JPAçš„ç« èŠ‚ï¼Œé‡æ–°æ¸©ä¹ å¦‚ä½•ç¼–å†™è¿™äº›æ–¹æ³•ã€‚</p>
<h5 id="æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢">æŒ‡å®šè‡ªå®šä¹‰æŸ¥è¯¢</h5>
<p>å½“å‘½åçº¦å®šæ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸ºæ–¹æ³•æ·»åŠ @Queryæ³¨è§£ï¼Œä¸ºå…¶æŒ‡å®šè‡ªå®šä¹‰çš„æŸ¥è¯¢ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»è§è¿‡@Queryæ³¨è§£ã€‚MongoDBä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æŒ‡å®šåŒ¹é…JSONçš„æŸ¥è¯¢ã€‚ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨Spring Data Neo4jçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šCypheræŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;match (o:Order)-[:HAS_ITEMS]-&gt;(i:Item) &quot; +</span></span><br><span class="line"><span class="meta">       &quot;where i.product=&#x27;Spring in Action&#x27; return o&quot;)</span></span><br><span class="line"><span class="function">List&lt;Order&gt; <span class="title">findSiAOrders</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œ findSiAOrders()æ–¹æ³•ä¸Šä½¿ç”¨äº†@Queryæ³¨è§£ï¼Œå¹¶è®¾ç½®äº†ä¸€ä¸ªCypheræŸ¥è¯¢ï¼Œå®ƒä¼šæŸ¥æ‰¾ä¸Item å…³è”å¹¶ä¸” productå±æ€§ç­‰äºâ€œSpring in Actionâ€çš„æ‰€æœ‰Order èŠ‚ç‚¹ã€‚</p>
<h5 id="æ··åˆè‡ªå®šä¹‰çš„Responsitory">æ··åˆè‡ªå®šä¹‰çš„Responsitory</h5>
<blockquote>
<p>å…·ä½“å†…å®¹å‚è€ƒâ€“ã€‹[ç¾] Craig Walls. Springå®æˆ˜ï¼ˆç¬¬4ç‰ˆï¼‰ (Kindleä½ç½®6100). äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾. Kindle ç‰ˆæœ¬.</p>
</blockquote>
<h2 id="ä½¿ç”¨Redisæ“ä½œkey-valueæ•°æ®">ä½¿ç”¨Redisæ“ä½œkey-valueæ•°æ®</h2>
<p>Redisæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ•°æ®åº“ï¼Œå®ƒè¢«ç§°ä¹‹ä¸ºkey-valueå­˜å‚¨ã€‚é¡¾åæ€ä¹‰ï¼Œkey-valueå­˜å‚¨ä¿å­˜çš„æ˜¯é”®å€¼å¯¹ã€‚å®é™…ä¸Šï¼Œkey-valueå­˜å‚¨ä¸å“ˆå¸ŒMapæœ‰å¾ˆå¤§çš„ç›¸ä¼¼æ€§ã€‚å¯ä»¥ä¸å¤ªå¤¸å¼ åœ°è¯´ï¼Œå®ƒä»¬å°±æ˜¯æŒä¹…åŒ–çš„å“ˆå¸ŒMapã€‚</p>
<p>å½“ä½ æ€è€ƒè¿™ä¸€ç‚¹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šæ„è¯†åˆ°ï¼Œå¯¹äºå“ˆå¸ŒMapæˆ–è€…key-valueå­˜å‚¨æ¥è¯´ï¼Œå…¶å®å¹¶æ²¡æœ‰å¤ªå¤šçš„æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥å°†æŸä¸ªvalueå­˜å‚¨åˆ°ç‰¹å®šçš„keyä¸Šï¼Œå¹¶ä¸”èƒ½å¤Ÿæ ¹æ®ç‰¹å®škeyï¼Œè·å–valueã€‚å·®ä¸å¤šä¹Ÿå°±æ˜¯è¿™æ ·äº†ã€‚å› æ­¤ï¼ŒSpring Dataçš„è‡ªåŠ¨Repositoryç”ŸæˆåŠŸèƒ½å¹¶æ²¡æœ‰åº”ç”¨åˆ°Redisä¸Šã€‚ä¸è¿‡ï¼ŒSpring Dataçš„å¦å¤–ä¸€ä¸ªå…³é”®ç‰¹æ€§ï¼Œä¹Ÿå°±æ˜¯é¢å‘æ¨¡æ¿çš„æ•°æ®è®¿é—®ï¼Œèƒ½å¤Ÿåœ¨ä½¿ç”¨Redisçš„æ—¶å€™ï¼Œä¸ºæˆ‘ä»¬æä¾›å¸®åŠ©ã€‚</p>
<p>Spring Data RedisåŒ…å«äº†å¤šä¸ªæ¨¡æ¿å®ç°ï¼Œç”¨æ¥å®ŒæˆRedisæ•°æ®åº“çš„æ•°æ®å­˜å–åŠŸèƒ½ã€‚</p>
<h3 id="è¿æ¥åˆ°Redis">è¿æ¥åˆ°Redis</h3>
<p>Redisè¿æ¥å·¥å‚ä¼šç”Ÿæˆåˆ°Redisæ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥ã€‚Spring Data Redisä¸ºå››ç§Rediså®¢æˆ·ç«¯å®ç°æä¾›äº†è¿æ¥å·¥å‚ï¼š</p>
<ul>
<li>JedisConnectionFactory</li>
<li>JredisConnectionFactory</li>
<li>LettuceConnectionFactory</li>
<li>SrpConnectionFactory</li>
</ul>
<p>é…ç½®JedisConnectionFactory bean:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RedisConnectionFactory <span class="title">redisCF</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  JedisConnectionFactory cf = <span class="keyword">new</span> JedisConnectionFactory();</span><br><span class="line">  cf.setHostName(<span class="string">&quot;redis-server&quot;</span>);</span><br><span class="line">  cf.setPort(<span class="number">7379</span>);</span><br><span class="line">  cf.setPassword(<span class="string">&quot;foobared&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> cf;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨RedisTemplate">ä½¿ç”¨RedisTemplate</h3>
<p>é¡¾åæ€ä¹‰ï¼ŒRedisè¿æ¥å·¥å‚ä¼šç”Ÿæˆåˆ°Redis key-valueå­˜å‚¨çš„è¿æ¥ï¼ˆä»¥RedisConnectionçš„å½¢å¼ï¼‰ã€‚å€ŸåŠ©RedisConnectionï¼Œå¯ä»¥å­˜å‚¨å’Œè¯»å–æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è·å–è¿æ¥å¹¶ä½¿ç”¨å®ƒæ¥ä¿å­˜ä¸€ä¸ªé—®å€™ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;</span><br><span class="line">RedisConnection conn = cf.getConnection();</span><br><span class="line">conn.set(<span class="string">&quot;greeting&quot;</span>.getBytes(), <span class="string">&quot;Hello World&quot;</span>.getBytes());</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸ä¹‹ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨RedisConnectionæ¥è·å–ä¹‹å‰å­˜å‚¨çš„é—®å€™ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] greetingBytes = conn.get(<span class="string">&quot;greeting&quot;</span>.getBytes());</span><br><span class="line">String greeting = <span class="keyword">new</span> String(greetingBytes);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ä¸ç›´æ¥ä½¿ç”¨å­—èŠ‚æ•°ç»„ï¼Œä¸å…¶ä»–çš„Spring Dataé¡¹ç›®ç±»ä¼¼ï¼ŒSpring Data Redisä»¥æ¨¡æ¿çš„å½¢å¼æä¾›äº†è¾ƒé«˜ç­‰çº§çš„æ•°æ®è®¿é—®æ–¹æ¡ˆã€‚å®é™…ä¸Šï¼ŒSpring Data Redisæä¾›äº†ä¸¤ä¸ªæ¨¡æ¿ï¼š</p>
<ul>
<li>RedisTemplate</li>
<li>StringRedisTemplate</li>
</ul>
<p>RedisTemplateå¯ä»¥æå¤§åœ°ç®€åŒ–Redisæ•°æ®è®¿é—®ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬æŒä¹…åŒ–å„ç§ç±»å‹çš„keyå’Œvalueï¼Œå¹¶ä¸å±€é™äºå­—èŠ‚æ•°ç»„ã€‚åœ¨è®¤è¯†åˆ°keyå’Œvalueé€šå¸¸æ˜¯Stringç±»å‹ä¹‹åï¼ŒStringRedisTemplate æ‰©å±•äº† RedisTemplate ï¼Œåªå…³æ³¨ String ç±»å‹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å·²ç»æœ‰RedisConnectionFactory,é‚£ä¹ˆå¯ä»¥è¿™æ ·æ„é€ RedisTemplate:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;</span><br><span class="line">RedisTemplate&lt;String, Product&gt; redis =</span><br><span class="line">    <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();</span><br><span class="line">redis.setConnectionFactory(cf);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œ RedisTemplateä½¿ç”¨ä¸¤ä¸ªç±»å‹è¿›è¡Œäº†å‚æ•°åŒ–ã€‚ç¬¬ä¸€ä¸ªæ˜¯keyçš„ç±»å‹ï¼Œç¬¬äºŒä¸ªæ˜¯valueçš„ç±»å‹ã€‚åœ¨è¿™é‡Œæ‰€æ„å»ºçš„RedisTemplateä¸­ï¼Œå°†ä¼šä¿å­˜Productå¯¹è±¡ä½œä¸ºvalueï¼Œå¹¶å°†å…¶èµ‹äºˆä¸€ä¸ªStringç±»å‹çš„keyã€‚</p>
<p>å¦‚æœä½ æ‰€ä½¿ç”¨çš„valueå’Œkeyéƒ½æ˜¯Stringç±»å‹ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨StringRedisTemplate æ¥ä»£æ›¿ RedisTemplate ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RedisConnectionFactory cf = ...;</span><br><span class="line">StringRedisTemplate redis = <span class="keyword">new</span> StringRedisTemplate(cf);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œä¸ RedisTemplate ä¸åŒï¼Œ StringRedisTemplateæœ‰ä¸€ä¸ªæ¥å—RedisConnectionFactoryçš„æ„é€ å™¨ï¼Œå› æ­¤æ²¡æœ‰å¿…è¦åœ¨æ„å»ºåå†è°ƒç”¨setConnectionFactory() ã€‚</p>
<p>å°½ç®¡è¿™å¹¶éå¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœä½ ç»å¸¸ä½¿ç”¨RedisTemplate æˆ– StringRedisTemplateçš„è¯ï¼Œä½ å¯ä»¥è€ƒè™‘å°†å…¶é…ç½®ä¸ºbeanï¼Œç„¶åæ³¨å…¥åˆ°éœ€è¦çš„åœ°æ–¹ã€‚å¦‚ä¸‹å°±æ˜¯ä¸€ä¸ªå£°æ˜RedisTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate&lt;String, Product&gt;</span><br><span class="line">                            redisTemplate(RedisConnectionFactory cf) &#123;</span><br><span class="line">  RedisTemplate&lt;String, Product&gt; redis =</span><br><span class="line">      <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();</span><br><span class="line">  redis.setConnectionFactory(cf);</span><br><span class="line">  <span class="keyword">return</span> redis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹æ˜¯å£°æ˜StringRedisTemplate beançš„@Bean æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> StringRedisTemplate</span><br><span class="line">                      stringRedisTemplate(RedisConnectionFactory cf) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> StringRedisTemplate(cf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº† RedisTemplate ï¼ˆæˆ– StringRedisTemplateï¼‰ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä¿å­˜ã€è·å–ä»¥åŠåˆ é™¤key-valueæ¡ç›®äº†ã€‚RedisTemplateçš„å¤§å¤šæ•°æ“ä½œéƒ½æ˜¯è¡¨12.5ä¸­çš„å­APIæä¾›çš„ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ–¹ã€€ã€€æ³•</th>
<th style="text-align:center">å­APIæ¥å£</th>
<th style="text-align:center">æã€€ã€€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">opsForValue()</td>
<td style="text-align:center">ValueOperations&lt;K, V&gt;</td>
<td style="text-align:center">æ“ä½œå…·æœ‰ç®€å•å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">opsForList()</td>
<td style="text-align:center">ListOperations&lt;K, V&gt;</td>
<td style="text-align:center">æ“ä½œå…·æœ‰listå€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">opsForSet()</td>
<td style="text-align:center">SetOperations&lt;K, V&gt;</td>
<td style="text-align:center">æ“ä½œå…·æœ‰setå€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">opsForZSet()</td>
<td style="text-align:center">ZSetOperations&lt;K, V&gt;</td>
<td style="text-align:center">æ“ä½œå…·æœ‰ZSetå€¼ï¼ˆæ’åºçš„setï¼‰çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">opsForHash()</td>
<td style="text-align:center">HashOperations&lt;K, HK, HV&gt;</td>
<td style="text-align:center">æ“ä½œå…·æœ‰hashå€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">boundValueOps(K)</td>
<td style="text-align:center">BoundValueOperations&lt;K,V&gt;</td>
<td style="text-align:center">ä»¥ç»‘å®šæŒ‡å®škeyçš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰ç®€å•å€¼çš„æ¡ç›®</td>
</tr>
<tr>
<td style="text-align:center">boundListOps(K)</td>
<td style="text-align:center">BoundListOperations&lt;K,V&gt;</td>
<td style="text-align:center">ä»¥ç»‘å®šæŒ‡å®škeyçš„æ–¹å¼ï¼Œæ“ä½œå…·æœ‰listå€¼çš„æ¡ç›®</td>
</tr>
</tbody>
</table>
<p>è¡¨ä¸­çš„å­APIèƒ½å¤Ÿé€šè¿‡RedisTemplateï¼ˆå’Œ StringRedis-Templateï¼‰è¿›è¡Œè°ƒç”¨ã€‚å…¶ä¸­æ¯ä¸ªå­APIéƒ½æä¾›äº†ä½¿ç”¨æ•°æ®æ¡ç›®çš„æ“ä½œï¼ŒåŸºäºvalueä¸­æ‰€åŒ…å«çš„æ˜¯å•ä¸ªå€¼è¿˜æ˜¯ä¸€ä¸ªå€¼çš„é›†åˆå®ƒä»¬ä¼šæœ‰æ‰€å·®åˆ«ã€‚</p>
<h4 id="ä½¿ç”¨ç®€å•çš„å€¼">ä½¿ç”¨ç®€å•çš„å€¼</h4>
<p>å‡è®¾æˆ‘ä»¬æƒ³é€šè¿‡RedisTemplate&lt;String, Product&gt; ä¿å­˜ Productï¼Œå…¶ä¸­keyæ˜¯skuå±æ€§çš„å€¼ã€‚å¦‚ä¸‹çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•å€ŸåŠ©opsForValue()æ–¹æ³•å®Œæˆè¯¥åŠŸèƒ½ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">redis.opsForValue().set(product.getSku(), product);</span><br></pre></td></tr></table></figure>
<h4 id="ä½¿ç”¨Listç±»å‹çš„å€¼">ä½¿ç”¨Listç±»å‹çš„å€¼</h4>
<p>ä½¿ç”¨Listç±»å‹çš„valueä¸ä¹‹ç±»ä¼¼ï¼Œåªéœ€ä½¿ç”¨opsForList()æ–¹æ³•å³å¯ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªListç±»å‹çš„æ¡ç›®å°¾éƒ¨æ·»åŠ ä¸€ä¸ªå€¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">redis.opsForList().rightPush(<span class="string">&quot;cart&quot;</span>, product);</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨keyå’Œvalueçš„åºåˆ—åŒ–å™¨">ä½¿ç”¨keyå’Œvalueçš„åºåˆ—åŒ–å™¨</h3>
<p>å½“æŸä¸ªæ¡ç›®ä¿å­˜åˆ°Redis key-valueå­˜å‚¨çš„æ—¶å€™ï¼Œkeyå’Œvalueéƒ½ä¼šä½¿ç”¨Redisçš„åºåˆ—åŒ–å™¨ï¼ˆserializerï¼‰è¿›è¡Œåºåˆ—åŒ–ã€‚Spring Data Redisæä¾›äº†å¤šä¸ªè¿™æ ·çš„åºåˆ—åŒ–å™¨ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>GenericToStringSerializerï¼šä½¿ç”¨Springè½¬æ¢æœåŠ¡è¿›è¡Œåºåˆ—åŒ–ï¼›</li>
<li>JacksonJsonRedisSerializerï¼šä½¿ç”¨Jackson 1ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼›</li>
<li>Jackson2JsonRedisSerializerï¼šä½¿ç”¨Jackson 2ï¼Œå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONï¼›</li>
<li>JdkSerializationRedisSerializerï¼šä½¿ç”¨Javaåºåˆ—åŒ–ï¼›</li>
<li>OxmSerializerï¼šä½¿ç”¨Spring O/Xæ˜ å°„çš„ç¼–æ’å™¨å’Œè§£æ’å™¨ï¼ˆmarshalerå’Œunmarshalerï¼‰å®ç°åºåˆ—åŒ–ï¼Œç”¨äºXMLåºåˆ—åŒ–ï¼›</li>
<li>StringRedisSerializerï¼šåºåˆ—åŒ–Stringç±»å‹çš„keyå’Œvalueã€‚</li>
</ul>
<p>è¿™äº›åºåˆ—åŒ–å™¨éƒ½å®ç°äº†RedisSerializeræ¥å£ï¼Œå¦‚æœå…¶ä¸­æ²¡æœ‰ç¬¦åˆéœ€æ±‚çš„åºåˆ—åŒ–å™¨ï¼Œé‚£ä¹ˆä½ è¿˜å¯ä»¥è‡ªè¡Œåˆ›å»ºã€‚</p>
<p>RedisTemplate ä¼šä½¿ç”¨ JdkSerializationRedisSerializerï¼Œè¿™æ„å‘³ç€keyå’Œvalueéƒ½ä¼šé€šè¿‡Javaè¿›è¡Œåºåˆ—åŒ–ã€‚StringRedisTemplateé»˜è®¤ä¼šä½¿ç”¨StringRedis-Serializerï¼Œè¿™åœ¨æˆ‘ä»¬çš„é¢„æ–™ä¹‹ä¸­ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯å®ç°String ä¸ byteæ•°ç»„ä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚è¿™äº›é»˜è®¤çš„è®¾ç½®é€‚ç”¨äºå¾ˆå¤šçš„åœºæ™¯ï¼Œä½†æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åºåˆ—åŒ–å™¨ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨å¤„çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾å½“ä½¿ç”¨RedisTemplateçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å°†Productç±»å‹çš„valueåºåˆ—åŒ–ä¸ºJSONï¼Œè€Œkeyæ˜¯String ç±»å‹ã€‚ RedisTemplate çš„ setKeySerializer() å’Œ setValueSerializer()æ–¹æ³•å°±éœ€è¦å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate&lt;String, Product&gt;</span><br><span class="line">       redisTemplate(RedisConnectionFactory cf) &#123;</span><br><span class="line">  RedisTemplate&lt;String, Product&gt; redis =</span><br><span class="line">      <span class="keyword">new</span> RedisTemplate&lt;String, Product&gt;();</span><br><span class="line">  redis.setConnectionFactory(cf);</span><br><span class="line">  redis.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">  redis.setValueSerializer(</span><br><span class="line">      <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;Product&gt;(Product.class));</span><br><span class="line">  <span class="keyword">return</span> redis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¾ç½®RedisTemplateåœ¨åºåˆ—åŒ–keyçš„æ—¶å€™ï¼Œä½¿ç”¨StringRedisSerializerï¼Œå¹¶ä¸”ä¹Ÿè®¾ç½®äº†åœ¨åºåˆ—åŒ–Productçš„æ—¶å€™ï¼Œä½¿ç”¨Jackson2JsonRedisSerializer</p>
]]></content>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
</search>
